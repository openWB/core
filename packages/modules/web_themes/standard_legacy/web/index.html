<!DOCTYPE html>
<html lang="de">

<head>
	<!-- theme for openWB layout for standard and dark, only css is different-->
	<!-- 2020 Michael Ortenstein -->

	<title>openWB</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="openWB">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="description" content="openWB">
	<meta name="keywords" content="openWB">
	<meta name="author" content="Michael Ortenstein">
	<link rel="apple-touch-icon" sizes="72x72" href="/openWB/web/img/favicons/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/openWB/web/img/favicons/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/openWB/web/img/favicons/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/openWB/web/img/favicons/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/openWB/web/img/favicons/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/openWB/web/img/favicons/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/openWB/web/img/favicons/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="/openWB/web/img/favicons/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/openWB/web/img/favicons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/openWB/web/img/favicons/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/openWB/web/img/favicons/favicon-16x16.png">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="msapplication-TileImage" content="/openWB/web/img/favicons/ms-icon-144x144.png">
	<link rel="manifest" href="/openWB/web/manifest.json">
	<link rel="shortcut icon" href="/openWB/web/img/favicons/favicon.ico">
	<meta name="msapplication-config" content="/openWB/web/browserconfig.xml">
	<meta name="theme-color" content="#ffffff">

	<!-- Bootstrap -->
	<link rel="stylesheet" type="text/css" href="css/bootstrap-4.4.1/bootstrap.min.css">
	<!-- Bootstrap-Toggle -->
	<link rel="stylesheet" type="text/css" href="css/bootstrap4-toggle/bootstrap4-toggle.min.css">
	<!-- Normalize -->
	<link rel="stylesheet" type="text/css" href="css/normalize-8.0.1.css">
	<!-- Font Awesome, all styles -->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-6.7.2/css/all.min.css">
	<!-- local css due to async loading of theme css -->
	<style>
		#preloader {
			background-color: black;
			position: fixed;
			top: 0px;
			left: 0px;
			width: 100%;
			height: 100%;
			z-index: 999999;
		}

		#preloader-inner {
			margin-top: 150px;
			text-align: center;
		}

		#preloader-image {
			max-width: 300px;
		}

		#preloader-info {
			color: grey;
		}
	</style>
	<link rel="stylesheet" href="style.css?v=20250731">
	<!-- important scripts to be loaded -->
	<script src="js/jquery-3.6.0.min.js"></script>
	<script src="js/bootstrap-4.4.1/bootstrap.bundle.min.js"></script>
	<script src="js/bootstrap4-toggle/bootstrap4-toggle.min.js"></script>
</head>

<body>
	<!-- Preloader with Progress Bar -->
	<div id="preloader">
		<div id="preloader-inner">
			<div class="row">
				<div class="mx-auto d-block justify-content-center">
					<img id="preloader-image" src="/openWB/web/img/openWB_logo_dark.png" alt="openWB">
				</div>
			</div>
			<div id="preloader-info" class="row justify-content-center mt-2">
				<div class="col-10 col-sm-6">
					Bitte warten, während die Seite aufgebaut wird.
				</div>
			</div>
			<div class="row justify-content-center mt-2">
				<div class="col-10 col-sm-6">
					<div class="progress active">
						<div class="progress-bar progress-bar-success progress-bar-striped progress-bar-animated"
							id="preloader-bar" role="progressbar">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Landing Page -->
	<div id="nav-placeholder"></div>

	<div class="container regularTextSize">

		<!-- Header Section -->
		<div id="info-header" class="row no-gutters">

			<!-- Battery Card -->
			<div class="house-battery-configured col-sm hide">
				<div class="card border-warning fill-height">
					<div class="card-header bg-warning collapsed" data-toggle="collapse" data-target="#cardBat">
						<i class="fas fa-car-battery"></i>
						<span class="house-battery-sum-soc">XX %</span>
						<i class="house-battery-sum-charging fas fa-angle-double-left hide"></i>
						<i class="house-battery-sum-discharging fas fa-angle-double-right hide"></i>
						<span class="house-battery-sum-power">XX W</span>
						<span class="collPlus"></span>
					</div>
					<div id="cardBat" class="card-body collapse">
						<div class="row">
							<div class="col pr-0">
								SoC
							</div>
							<div class="house-battery-sum-soc col pl-0 text-right">
								-- %
							</div>
						</div>
						<div class="row">
							<div class="col font-italic font-weight-bold">
								Heute:
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Geladen
							</div>
							<div class="house-battery-sum-import col pl-0 text-right">
								-- Wh
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Entladen
							</div>
							<div class="house-battery-sum-export col pl-0 text-right">
								-- Wh
							</div>
						</div>
						<div class="pv-configured">
							<hr class="border-warning">
							<div class="row">
								<div class="col font-italic font-weight-bold">
									Speicher-Beachtung
								</div>
							</div>
							<div class="row vaRow">
								<div class="col pr-0">
									Überschuss primär für:
								</div>
								<div class="col-md-8 btn-group btn-group-toggle bat-consideration-mode"
									data-toggle="buttons" data-name="bat_consideration_mode"
									data-topic="openWB/set/general/chargemode_config/pv_charging/bat_mode">
									<label class="btn btn-outline-primary btn-toggle" title="Fahrzeuge">
										<input type="radio" name="bat_mode_name" data-option="ev_mode"><i class="fas fa-car-side"></i>
									</label>
									<label class="btn btn-outline-warning btn-toggle" title="Speicher">
										<input type="radio" name="bat_mode_name" data-option="bat_mode"><i class="fas fa-car-battery"></i>
									</label>
									<label class="btn btn-outline-success btn-toggle" title="Mindest-SoC des Speichers">
										<input type="radio" name="bat_mode_name" data-option="min_soc_bat_mode"><i class="fas fa-battery-half"></i>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- PV Card -->
			<div class="pv-configured col-sm">
				<div class="card border-success fill-height">
					<div class="card-header bg-success collapsed" data-toggle="collapse" data-target="#cardPV">
						<i class="fas fa-solar-panel"></i>
						<i class="pv-sum-power-consumption fas fa-angle-double-left hide"></i>
						<i class="pv-sum-power-production fas fa-angle-double-right hide"></i>
						<span class="pv-sum-power">-- W</span>
						<span class="collPlus"></span>
					</div>
					<div id="cardPV" class="card-body collapse">
						<div class="row">
							<div class="col font-italic font-weight-bold">
								Heute:
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Ertrag
							</div>
							<div class="pv-sum-production col pl-0 text-right">
								-- Wh
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Grid Card -->
			<div class="grid-configured col-sm">
				<div class="card border-danger fill-height">
					<div class="card-header bg-danger collapsed" data-toggle="collapse" data-target="#cardGrid">
						<img src="img/icons/electric-tower.svg" alt="electric tower" style="width: 1.1em;">
						<i class="et-configured fas fa-coins hide"></i>
						<i class="grid-exporting fas fa-angle-double-left hide"></i>
						<i class="grid-importing fas fa-angle-double-right hide"></i>
						<span class="grid-power">600 W</span>
						<span class="collPlus"></span>
					</div>
					<div id="cardGrid" class="card-body collapse">
						<div class="row">
							<div class="col font-italic font-weight-bold">
								Heute:
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Bezug
							</div>
							<div class="grid-import col pl-0 text-right">
								-- Wh
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Einspeisung
							</div>
							<div class="grid-export col pl-0 text-right">
								-- Wh
							</div>
						</div>
						<div class="et-configured hide">
							<hr class="border-danger">
							<div class="row">
								<div class="col font-italic font-weight-bold">
									Strompreis:
								</div>
							</div>
							<div class="row">
								<div class="col pr-0">
									Anbieter
								</div>
								<div class="et-name col pl-0 text-right">
									--
								</div>
							</div>
							<div class="row">
								<div class="col pr-0">
									aktuell
								</div>
								<div class="et-current-price col pl-0 text-right">
									-- ct/kWh
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- House Card -->
			<div class="house-consumption-configured col-sm">
				<div class="card border-secondary fill-height">
					<div class="card-header bg-secondary collapsed" data-toggle="collapse"
						data-target="#cardHouseConsumption">
						<i class="fas fa-home"></i>
						<span class="house-consumption-power">-- W</span>
						<span class="collPlus"></span>
					</div>
					<div id="cardHouseConsumption" class="card-body collapse">
						<div class="row">
							<div class="col font-italic font-weight-bold">
								Heute:
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Energie
							</div>
							<div class="house-consumption-daily col pl-0 text-right">
								-- Wh
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- charge point sum card -->
			<div class="charge-point-sum-configured col-sm">
				<div class="card border-primary fill-height">
					<div class="card-header bg-primary collapsed" data-toggle="collapse"
						data-target="#cardChargePointSum">
						<i class="fas fa-charging-station"></i>
						<i class="charge-point-sum-power-charging fas fa-angle-double-left hide"></i>
						<i class="charge-point-sum-power-discharging fas fa-angle-double-right hide"></i>
						<span class="charge-point-sum-power">-- W</span>
						<span class="collPlus"></span>
					</div>
					<div id="cardChargePointSum" class="card-body collapse">
						<div class="row">
							<div class="col font-italic font-weight-bold">
								Heute:
							</div>
						</div>
						<div class="row">
							<div class="col pr-0">
								Geladen
							</div>
							<div class="charge-point-sum-import-daily col pl-0 text-right">
								-- Wh
							</div>
						</div>
						<!-- Preparation for bidirectional charging V2H/V2G
						<div class="row">
							<div class="col pr-0">
								Entladen
							</div>
							<div class="charge-point-sum-export-daily col pl-0 text-right">
								-- Wh
							</div>
						</div>
						-->
					</div>
				</div>
			</div>

		</div> <!-- End of Header Section -->

		<!-- Chart Section -->
		<div class="row">
			<div class="col">
				<div class="card border-light">
					<div class="card-header bg-light" data-toggle="collapse" data-target="#cardGraph">
						<i class="fas fa-chart-area"></i>
						Diagramm
						<span class="collPlus"></span>
					</div>
					<div id="cardGraph" class="card-body collapse show">
						<div id="legend-container" class="row justify-content-center hide" >
							<!-- will be shown by livechart.js when graph is displayed -->
							<div class="col-sm-12 mt-2">
								<div id="custom-legend-container"></div>
							</div>
						</div>
						<div class="row justify-content-center mb-2" id="theGraph">
							<!-- will be refreshed using MQTT (in livechart.js)-->
							<div class="col-sm-12 text-center smallTextSize">
								<div id="waitForGraphLoadingDiv">
									Diagramm lädt, bitte warten...
								</div>
								<canvas id="canvas"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Warning Section -->
		<div class="row text-center bg-darkgrey">
			<div class="col">
				<span id="lastregelungaktiv" class="regularTextSize text-red animate-alertPulsation"></span>
			</div>
		</div>

		<!-- charge point info header -->
		<div class="card text-grey">
			<div class="card-header bg-darkgrey font-weight-bold">
				<div class="form-row">
					<div class="col-3">
						Ladepunkt <span id="etProviderEnabledIcon" class="fa fa-chart-line hide"></span>
					</div>
					<div class="col-3">
						Lademodus
					</div>
					<div class="col-3">
						Parameter
					</div>
					<div class="col-3">
						geladen
					</div>
				</div>
				<div class="form-row">
					<div class="col-3">
					</div>
					<div class="col-3">
						Fahrzeug
					</div>
					<div class="col-3">
						SoC
					</div>
					<div class="col-3">
					</div>
				</div>
			</div>
		</div>

		<div class="accordion" id="chargePointAccordion">
			<div class="charge-point-card card border-dark text-grey charge-point-template hide" data-cp="T"
				data-charge-point-template="T" data-charge-template="T" data-ev-template="T">
				<div class="card-header bg-lightgrey collapsed" data-toggle="collapse"
					data-target="#collapseChargePoint0">
					<div class="form-row">
						<div class="col-3">
							<span class="fas fa-xs hide auto-lock-configured-cp"></span>
							<span class="font-weight-bold charge-point-name charge-point-state-enabled">--</span>
							<span
								class="fa fa-xs fa-plug text-orange hide charge-point-plug-state charge-point-charge-state"></span>
							<span class="fa fa-xs fa-flag-checkered hide targetChargingCp"></span>
							<span class="fa fa-xs fa-moon hide nightChargingCp"></span>
						</div>
						<div class="col-3">
							<span class="charge-point-vehicle-charge-mode">--</span>
							<span class="et-configured hide">
								<span class="charge-point-charge-mode-options">
									<span
										class="chargemode-options chargemode-option-instant_charging chargemode-option-scheduled_charging">
										<i class="charge-point-vehicle-et-active hide fas fa-xs fa-coins"></i>
									</span>
								</span>
							</span>
						</div>
						<div class="col-3">
							<span class="charge-point-power">--</span> <span class="charge-point-phases-in-use">-</span>
							<span class="charge-point-set-current">--</span>
						</div>
						<div class="col-3 collPlus">
							<span class="charge-point-energy-since-mode-switch">--</span><span
								class="charge-point-range-since-mode-switch"></span>
						</div>
					</div>
					<div class="form-row">
						<div class="col-3">
							<div class="charge-point-alert alert m-0 px-1 py-0">
								<!-- <i class="charge-point-fault-state fas fa-check-circle text-success hide" data-option="0"></i> -->
								<i class="charge-point-fault-state fas fa-exclamation-triangle text-warning hide"
									data-option="1"></i>
								<i class="charge-point-fault-state fas fa-times-circle text-danger hide"
									data-option="2"></i>
								<span class="charge-point-fault-str"></span>
							</div>
						</div>
						<div class="col-3 charge-point-vehicle-name">--</div>
						<div class="col-3">
							<div class="charge-point-soc-configured hide">
								<span class="charge-point-soc">--</span> %
								<i class="small charge-point-reload-soc-symbol fas fa-redo-alt"></i>
								<i class="charge-point-manual-soc-symbol fas fa-edit hide"></i>
							</div>
						</div>
					</div>
				</div>
				<div id="collapseChargePoint0" data-parent="#chargePointAccordion" class="card-body collapse">
					<div class="form-group">
						<!-- Meldungen -->
						<div class="form-row my-1 alert alert-info">
							<div class="col">
								<i class="fas fa-info-circle"></i>
								<span class="charge-point-state-str">--</span>
							</div>
						</div>
						<!-- Sperre -->
						<div class="form-row mb-1">
							<div class="col">
								<i class="fas fa-lock"></i>
								Ladepunkt sperren
							</div>
							<div class="col-md-8 text-right">
								<input class="charge-point-manual-lock" type="checkbox" data-toggle="toggle"
									data-topic="openWB/set/chargepoint/<cp>/set/manual_lock" data-on="Ja"
									data-off="Nein" data-onstyle="danger" data-offstyle="success" data-size="sm"
									data-style="w-100">
							</div>
						</div>
						<hr>
						<div class="charge-point-vehicle-data" data-ev="">
							<!-- Fahrzeugauswahl -->
							<div class="form-row mb-1">
								<label class="col col-form-label">
									<i class="fas fa-car-side"></i>
									Fahrzeug
								</label>
								<div class="col-md-8">
									<select name="charge-point-vehicle-select"
										class="form-control charge-point-vehicle-select"
										data-topic="openWB/set/chargepoint/<cp>/config/ev">
										<option value="0">-- Nicht ausgewählt --</option>
									</select>
								</div>
							</div>
							<!-- Lademodus -->
							<div class="form-row mb-1">
								<div class="col">
									<label class="col-form-label">
										<i class="fas fa-hexagon-nodes-bolt"></i>
										Lademodus
									</label>
								</div>
								<div class="col-md-8 btn-group btn-group-toggle charge-point-charge-mode"
									data-toggle="buttons" data-name="chargemode"
									data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
									data-object="chargeTemplate"
									data-object-path="chargemode.selected"
								>
									<label class="btn btn-outline-danger btn-toggle">
										<input type="radio" name="chargemode" data-option="instant_charging">Sofort
									</label>
									<label class="btn btn-outline-success btn-toggle">
										<input type="radio" name="chargemode" data-option="pv_charging">PV
									</label>
									<label class="btn btn-outline-primary btn-toggle">
										<input type="radio" name="chargemode" data-option="scheduled_charging">Ziel
									</label>
									<label class="btn btn-outline-secondary btn-toggle">
										<input type="radio" name="chargemode" data-option="eco_charging">Eco
									</label>
									<label class="btn btn-outline-dark btn-toggle">
										<input type="radio" name="chargemode" data-option="stop">Stop
									</label>
								</div>
							</div>
							<!-- Priorität -->
							<div class="form-row mb-1">
								<div class="col">
									<i class="fas fa-star"></i>
									Priorität
								</div>
								<div class="col-md-8 text-right">
									<input class="charge-point-vehicle-priority" type="checkbox" data-toggle="toggle"
										data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
										data-object="chargeTemplate"
										data-object-path="prio"
										data-on="Ja" data-off="Nein" data-onstyle="success" data-offstyle="danger" data-size="sm"
										data-style="w-100">
								</div>
							</div>
							<div class="charge-point-charge-mode-options mb-0 hide">
								<!-- Zeit -->
								<div class="chargemode-options chargemode-option-instant_charging chargemode-option-pv_charging chargemode-option-scheduled_charging chargemode-option-eco_charging">
									<div class="form-row mb-1">
										<div class="col">
											<i class="far fa-clock"></i>
											Zeitladen
										</div>
										<div class="col-md-8 text-right">
											<input class="charge-point-time-charging-active" type="checkbox" id="timeChargeCpT"
												data-toggle="toggle"
												data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
												data-object="chargeTemplate"
												data-object-path="time_charging.active"
												data-on="Ja" data-off="Nein" data-onstyle="success" data-offstyle="danger"
												data-size="sm" data-style="w-100">
										</div>
									</div>
									<div class="chargemode-option-time_charging">
										<div class="form-row vaRow mb-1">
											<div class="col">
												<h3 class="mb-0">Termine Zeitladen</h3>
											</div>
											<div class="col-2 text-right">
												<button type="button"
													class="time_charging-settings-link btn btn-sm btn-secondary">
													<i class="fas fa-cogs"></i>
												</button>
											</div>
										</div>
										<div
											class="form-row mb-1 col charge-point-time-charge-plan-missing alert alert-warning">
											Es wurden noch keine Zeitpläne eingerichtet!
										</div>
										<div class="form-row mb-1 charge-point-time-charge-plan charge-point-time-charge-plan-template hide"
											data-plan-type="time_charging"
											data-plan=""
											data-index=""
										>
											<div class="col">
												<span class="charge-point-time-charge-name">--</span>
											</div>
											<div class="col-lg-6 text-right">
												<span class="charge-point-time-charge-pill cursor-pointer border rounded p-1">
													<span class="charge-point-time-charge-frequency">
														<i class="fas fa-calendar-alt"></i>
														<span class="charge-point-time-charge-frequency-value">--</span>
													</span>
													<span class="charge-point-time-charge-date">
														<i class="fas fa-calendar-day"></i>
														<span class="charge-point-time-charge-date-value">--</span>
													</span>
													<i class="fas fa-clock"></i> <span
														class="charge-point-time-charge-time">--</span>
													<i class="charge-point-time-charge-limit-icon fas fa-car-battery"></i> <span
														class="charge-point-time-charge-limit">--</span>
												</span>
											</div>
										</div>
									</div>
								</div>
								<hr>
								<!-- Sofort -->
								<div class="chargemode-options chargemode-option-instant_charging">
									<h3>Einstellungen für "Sofort"</h3>
									<div class="form-row vaRow mb-0">
										<div class="col">
											Stromstärke
										</div>
										<div class="col-md-8">
											<div class="form-row form-group mb-1 vaRow">
												<div class="col">
													<input type="range"
														class="charge-point-instant-charge-current form-control-range rangeInput"
														id="currentInstantChargeCpT"
														data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
														data-object="chargeTemplate"
														data-object-path="chargemode.instant_charging.current"
														min="6" max="32" step="1">
												</div>
												<label for="currentInstantChargeCpT"
													class="col-2 col-form-label valueLabel text-right" data-suffix="A">
													-- A
												</label>
											</div>
										</div>
									</div>
									<div class="dc-charging-configured hide">
										<div class="form-row vaRow mb-0">
											<div class="col">
												DC-Sollleistung
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-instant-charge-dc-current form-control-range rangeInput"
															id="dcCurrentInstantChargeCpT"
															data-transformation='{ "in": "(<v> * 3 * 230) / 1000", "out": "(<v> * 1000) / 230 / 3" }'
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.instant_charging.dc_current"
															min="4" max="300" step="1">
													</div>
													<label for="dcCurrentInstantChargeCpT"
														class="col-2 col-form-label valueLabel text-right" data-suffix="kW">
														-- kW
													</label>
												</div>
											</div>
										</div>
									</div>
									<div class="form-row vaRow mb-1">
										<div class="col">
											<label class="col-form-label">Anzahl Phasen</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-instant-charge-phases"
											id="phasesInstantChargeCpT" data-name="phasesCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-type="number"
											data-object="chargeTemplate"
											data-object-path="chargemode.instant_charging.phases_to_use"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="1"> 1
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="3"> Maximum
											</label>
										</div>
									</div>
									<div class="form-row vaRow">
										<div class="col">
											<label class="col-form-label">Begrenzung</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-instant-charge-limit-selected"
											id="limitInstantChargeCpT" data-name="limitInstantCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-object="chargeTemplate"
											data-object-path="chargemode.instant_charging.limit.selected"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitInstantCp" data-option="none"> Aus
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitInstantCp" data-option="soc"> EV-SoC
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitInstantCp" data-option="amount"> Energie
											</label>
										</div>
									</div>
									<div class="chargemode-instant-limit-options">
										<div
											class="form-row form-group mb-1 vaRow regularTextSize chargemode-limit-option chargemode-limit-option-soc">
											<div class="col">
												SoC-Limit für das Fahrzeug
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-instant-charge-limit-soc form-control-range rangeInput"
															id="socLimitInstantCpT" min="5" max="100" step="5"
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.instant_charging.limit.soc">
													</div>
													<label for="socLimitInstantCpT"
														class="col-2 col-form-label valueLabel text-right"
														data-suffix="%">-- %</label>
												</div>
											</div>
										</div>
										<div
											class="form-row form-group mb-1 vaRow regularTextSize chargemode-limit-option chargemode-limit-option-amount">
											<div class="col">
												Energie-Limit
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-instant-charge-limit-amount form-control-range rangeInput"
															id="amountLimitInstantCpT" min="1" max="50" step="1"
															data-transformation='{ "in": "<v>/1000", "out": "<v>*1000" }'
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.instant_charging.limit.amount">
													</div>
													<label for="amountLimitInstantCpT"
														class="col-2 col-form-label valueLabel text-right"
														data-suffix="kWh">-- kWh</label>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- PV -->
								<div class="chargemode-options chargemode-option-pv_charging">
									<h3>Einstellungen für "PV"</h3>
									<div class="form-row vaRow mb-0">
										<div class="col">
											Minimaler Dauerstrom
										</div>
										<div class="col-md-8">
											<div class="form-row form-group mb-1 vaRow">
												<div class="col">
													<input type="range"
														class="charge-point-pv-charge-min-current form-control-range rangeInput"
														id="minCurrentPvCpT"
														data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
														data-object="chargeTemplate"
														data-object-path="chargemode.pv_charging.min_current"
														min="0" max="11" step="1"
														data-list='[[0,"Aus"],6,7,8,9,10,11,12,13,14,15,16]'>
												</div>
												<label for="minCurrentPvCpT"
													class="col-2 col-form-label valueLabel text-right"
													data-suffix="A">-- A</label>
											</div>
										</div>
									</div>
									<div class="dc-charging-configured hide">
										<div class="form-row vaRow mb-0">
											<div class="col">
												Minimale DC-Dauerleistung
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-pv-charge-dc-min-current form-control-range rangeInput"
															id="minDcCurrentPvCpT"
															data-transformation='{ "in": "(<v> * 3 * 230) / 1000", "out": "(<v> * 1000) / 230 / 3" }'
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.pv_charging.dc_min_current"
															min="0" max="300" step="1">
													</div>
													<label for="minDcCurrentPvCpT"
														class="col-2 col-form-label valueLabel text-right" data-suffix="kW">
														-- kW
													</label>
												</div>
											</div>
										</div>
									</div>
									<div class="form-row vaRow mb-1">
										<div class="col">
											<label class="col-form-label">Anzahl Phasen</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-pv-charge-phases"
											id="phasesPvChargeCpT" data-name="phasesCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-object="chargeTemplate"
											data-object-path="chargemode.pv_charging.phases_to_use"
											data-type="number"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="1"> 1
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="3"> Maximum
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="0"> Automatik
											</label>
										</div>
									</div>
									<div class="form-row vaRow mb-1">
										<div class="col">
											<label class="col-form-label">Begrenzung</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-pv-charge-limit-selected"
											id="limitPvChargeCpT" data-name="limitPvCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-object="chargeTemplate"
											data-object-path="chargemode.pv_charging.limit.selected"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitPvCp" data-option="none"> Aus
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitPvCp" data-option="soc"> EV-SoC
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitPvCp" data-option="amount"> Energie
											</label>
										</div>
									</div>
									<div class="chargemode-pv-limit-options">
										<div class="form-row form-group mb-1 vaRow regularTextSize chargemode-limit-option chargemode-limit-option-soc">
											<div class="col">
												SoC-Limit für das Fahrzeug
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-pv-charge-limit-soc form-control-range rangeInput"
															id="socLimitPvCpT" min="5" max="100" step="5"
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.pv_charging.limit.soc">
													</div>
													<label for="socLimitPvCpT"
														class="col-2 col-form-label valueLabel text-right"
														data-suffix="%">-- %</label>
												</div>
											</div>
										</div>
										<div
											class="form-row form-group mb-1 vaRow regularTextSize chargemode-limit-option chargemode-limit-option-amount">
											<div class="col">
												Energie-Limit
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-pv-charge-limit-amount form-control-range rangeInput"
															id="amountLimitPvCpT" min="1" max="50" step="1"
															data-transformation='{ "in": "<v>/1000", "out": "<v>*1000" }'
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
																data-object="chargeTemplate"
																data-object-path="chargemode.pv_charging.limit.amount">
													</div>
													<label for="amountLimitPvCpT"
														class="col-2 col-form-label valueLabel text-right"
														data-suffix="kWh">-- kWh</label>
												</div>
											</div>
										</div>
									</div>
									<div class="form-row vaRow mb-0">
										<div class="col">
											Mindest-SoC für das Fahrzeug
										</div>
										<div class="col-md-8">
											<div class="form-row form-group mb-1 vaRow">
												<div class="col">
													<input type="range"
														class="charge-point-pv-charge-min-soc form-control-range rangeInput"
														id="minSocPvCpT"
														data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
														data-object="chargeTemplate"
														data-object-path="chargemode.pv_charging.min_soc"
														min="0" max="19" step="1"
														data-list='[[0,"Aus"],5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95]'>
												</div>
												<label for="minSocPvCpT"
													class="col-2 col-form-label valueLabel text-right"
													data-suffix="%">-- %</label>
											</div>
										</div>
									</div>
									<div class="form-row vaRow mb-0">
										<div class="col">
											Mindest-SoC-Strom
										</div>
										<div class="col-md-8">
											<div class="form-row form-group mb-1 vaRow">
												<div class="col">
													<input type="range"
														class="charge-point-pv-charge-min-soc-current form-control-range rangeInput"
														id="minSocCurrentPvCpT"
														data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
														data-object="chargeTemplate"
														data-object-path="chargemode.pv_charging.min_soc_current"
														min="6" max="32" step="1">
												</div>
												<label for="minSocCurrentPvCpT"
													class="col-2 col-form-label valueLabel text-right"
													data-suffix="A">-- A</label>
											</div>
										</div>
									</div>
									<div class="dc-charging-configured hide">
										<div class="form-row vaRow mb-0">
											<div class="col">
												DC Mindest-SoC-Leistung
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-pv-charge-dc-min-soc-current form-control-range rangeInput"
															id="minSocDcCurrentPvCpT"
															data-transformation='{ "in": "(<v> * 3 * 230) / 1000", "out": "(<v> * 1000) / 230 / 3" }'
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.pv_charging.dc_min_soc_current"
															min="4" max="300" step="1">
													</div>
													<label for="minSocDcCurrentPvCpT"
														class="col-2 col-form-label valueLabel text-right" data-suffix="kW">
														-- kW
													</label>
												</div>
											</div>
										</div>
									</div>
									<div class="form-row vaRow mb-1">
										<div class="col">
											<label class="col-form-label">Anzahl Phasen Mindest-SoC</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-pv-charge-phases-min-soc"
											id="phasesMinSocPvChargeCpT" data-name="phasesMinSocCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-object="chargeTemplate"
											data-object-path="chargemode.pv_charging.phases_to_use_min_soc"
											data-type="number"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="1"> 1
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="3"> Maximum
											</label>
										</div>
									</div>
									<div class="form-row mb-1">
										<div class="col">
											Einspeisegrenze beachten
										</div>
										<div class="col-md-8 text-right">
											<input class="charge-point-pv-charge-feed-in-limit" type="checkbox"
												data-toggle="toggle"
												data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
												data-object="chargeTemplate"
												data-object-path="chargemode.pv_charging.feed_in_limit"
												data-on="Ja" data-off="Nein" data-onstyle="success"
												data-offstyle="danger" data-size="sm" data-style="w-100">
										</div>
									</div>
								</div>
								<!-- Ziel -->
								<div class="chargemode-options chargemode-option-scheduled_charging">
									<div class="form-row vaRow mb-1">
										<div class="col">
											<h3 class="mb-0">Einstellungen für "Ziel"</h3>
										</div>
										<div class="col-2 text-right">
											<button type="button"
												class="scheduled-charging-settings-link btn btn-sm btn-secondary">
												<i class="fas fa-cogs"></i>
											</button>
										</div>
									</div>
									<div class="charge-point-schedule-plan-missing alert alert-warning">
										Es wurden noch keine Zeitpläne eingerichtet!
									</div>
									<div class="form-row mb-1 charge-point-schedule-plan charge-point-schedule-plan-template hide"
										data-plan=""
										data-index=""
									>
										<div class="col">
											<span class="charge-point-schedule-name">--</span>
										</div>
										<div class="col-lg-6 text-right">
											<span class="charge-point-schedule-plan-pill cursor-pointer border rounded p-1">
												<i class="charge-point-schedule-frequency fas fa-calendar-alt"></i>
												<span class="charge-point-schedule-frequency-value">--</span>
												<i class="fas fa-clock"></i> <span
													class="charge-point-schedule-time">--</span>
												<i class="charge-point-schedule-limit-icon fas fa-car-battery"></i>
												<span class="charge-point-schedule-limit">--</span>
												<i class="charge-point-schedule-mode hide fas"></i>
												<span class="charge-point-schedule-soc-limit hide">--</span>
												<i class="charge-point-schedule-et-active-icon fas fa-coins hide"></i>
											</span>
										</div>
									</div>
								</div>
								<!-- Eco -->
								<div class="chargemode-options chargemode-option-eco_charging">
									<h3>Einstellungen für "Eco"</h3>
									<div class="et et-configured hide">
										<div class="charge-point-charge-mode-options mb-0 hide">
											<div class="form-row mb-1">
												<div class="col">
													<i class="fas fa-coins"></i>
													Preisgrenze für strompreisbasiertes Laden
												</div>
												<div class="col-md-8 text-right">
													<button type="button"
														class="charge-point-eco-charge-max_price-button btn btn-sm btn-secondary btn-block"
														data-max-price="">
														<span class="charge-point-eco-charge-max_price">
															--
														</span>&nbsp;ct/kWh
													</button>
												</div>
											</div>
										</div>
										<div class="form-row vaRow mb-0">
											<div class="col">
												Minimaler Dauerstrom unter der Preisgrenze
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-eco-charge-current form-control-range rangeInput"
															id="currentEcoChargeCpT"
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.eco_charging.current"
															min="6" max="32" step="1">
													</div>
													<label for="currentEcoChargeCpT"
														class="col-2 col-form-label valueLabel text-right" data-suffix="A">
														-- A
													</label>
												</div>
											</div>
										</div>
										<div class="dc-charging-configured hide">
											<div class="form-row vaRow mb-0">
												<div class="col">
													Minimale Dauerleistung unter der Preisgrenze
												</div>
												<div class="col-md-8">
													<div class="form-row form-group mb-1 vaRow">
														<div class="col">
															<input type="range"
																class="charge-point-eco-charge-dc-current form-control-range rangeInput"
																id="dcCurrentEcoChargeCpT"
																data-transformation='{ "in": "(<v> * 3 * 230) / 1000", "out": "(<v> * 1000) / 230 / 3" }'
																data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
																data-object="chargeTemplate"
																data-object-path="chargemode.eco_charging.dc_current"
																min="4" max="300" step="1">
														</div>
														<label for="dcCurrentEcoChargeCpT"
															class="col-2 col-form-label valueLabel text-right" data-suffix="kW">
															-- kW
														</label>
													</div>
												</div>
											</div>
										</div>
									</div>
									<div class="form-row vaRow mb-1">
										<div class="col">
											<label class="col-form-label">Anzahl Phasen bei Überschuss</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-eco-charge-phases"
											id="phasesEcoChargeCpT" data-name="phasesCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-object="chargeTemplate"
											data-object-path="chargemode.eco_charging.phases_to_use"
											data-type="number"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="1"> 1
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="3"> Maximum
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="phasesCp" data-option="0"> Automatik
											</label>
										</div>
									</div>
									<div class="form-row vaRow mb-1">
										<div class="col">
											<label class="col-form-label">Begrenzung</label>
										</div>
										<div class="col-md-8 btn-group btn-group-toggle charge-point-eco-charge-limit-selected"
											id="limitEcoChargeCpT" data-name="limitEcoCp" data-toggle="buttons"
											data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
											data-object="chargeTemplate"
											data-object-path="chargemode.eco_charging.limit.selected"
										>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitEcoCp" data-option="none"> Aus
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitEcoCp" data-option="soc"> EV-SoC
											</label>
											<label class="btn btn-outline-info btn-toggle">
												<input type="radio" name="limitEcoCp" data-option="amount"> Energie
											</label>
										</div>
									</div>
									<div class="chargemode-eco-limit-options">
										<div
											class="form-row form-group mb-1 vaRow regularTextSize chargemode-limit-option chargemode-limit-option-soc">
											<div class="col">
												SoC-Limit für das Fahrzeug
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-eco-charge-limit-soc form-control-range rangeInput"
															id="socLimitEcoCpT" min="5" max="100" step="5"
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.eco_charging.limit.soc">
													</div>
													<label for="socLimitEcoCpT"
														class="col-2 col-form-label valueLabel text-right"
														data-suffix="%">-- %</label>
												</div>
											</div>
										</div>
										<div
											class="form-row form-group mb-1 vaRow regularTextSize chargemode-limit-option chargemode-limit-option-amount">
											<div class="col">
												Energie-Limit
											</div>
											<div class="col-md-8">
												<div class="form-row form-group mb-1 vaRow">
													<div class="col">
														<input type="range"
															class="charge-point-eco-charge-limit-amount form-control-range rangeInput"
															id="amountLimitEcoCpT" min="1" max="50" step="1"
															data-transformation='{ "in": "<v>/1000", "out": "<v>*1000" }'
															data-topic="openWB/set/chargepoint/<cp>/set/charge_template"
															data-object="chargeTemplate"
															data-object-path="chargemode.eco_charging.limit.amount">
													</div>
													<label for="amountLimitEcoCpT"
														class="col-2 col-form-label valueLabel text-right"
														data-suffix="kWh">-- kWh</label>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- modal SoC-window -->
		<div class="modal fade" id="socModal">
			<div class="modal-dialog">
				<div class="modal-content">
					<!-- modal header -->
					<div class="modal-header bg-warning">
						<h4 class="modal-title text-dark">
							SoC-Eingabe - Fahrzeug <span class="charge-point-soc"></span>
						</h4>
					</div>
					<!-- modal body -->
					<div class="modal-body">
						<div class="row justify-content-center">
							<div class="col-2 px-1 py-1">
								<button type="button" id="manualSocDecrement"
									class="btn btn-block btn-secondary">-</button>
							</div>
							<div class="col-5 py-1">
								<div class="input-group input-group-lg">
									<input id="manualSocBox" type="number" min="0" max="100" step="1" value="0"
										name="socBox" class="form-control text-right">
									<div class="input-group-append">
										<div class="input-group-text">
											%
										</div>
									</div>
								</div>
							</div>
							<div class="col-2 px-1 py-1">
								<button type="button" id="manualSocIncrement"
									class="btn btn-block btn-secondary">+</button>
							</div>
						</div>
						<div class="row justify-content-center">
							<div class="col-sm-5 py-1">
								<button type="button" id="manualSocOk" class="btn btn-lg btn-block btn-success"
									data-dismiss="modal">Übernehmen</button>
							</div>
						</div>
						<div class="row justify-content-center">
							<div class="col-sm-5 py-1">
								<button type="button" id="manualSocCancel" class="btn btn-lg btn-block btn-secondary"
									data-dismiss="modal">Abbrechen</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<script>
				function clearSocForm() {
					$("#manualSocBox").val("0");
				}

				function submitSocForm() {
					var ev = $('#socModal').find('.charge-point-soc').text();
					var manualSoc = parseFloat($("#manualSocBox").val());
					publish(manualSoc, "openWB/set/vehicle/" + ev + "/soc_module/calculated_soc_state/manual_soc");
					// reset input after publishing
					clearSocForm();
				};

				$(document).ready(function () {

					$('#manualSocDecrement').click(function () {
						var currentValue = parseInt($('#manualSocBox').val());
						var newValue = 0;
						if (!isNaN(currentValue)) {
							newValue = Math.max(currentValue - 1, 0);
						}
						$('#manualSocBox').val(newValue);
					});

					$('#manualSocIncrement').click(function () {
						var currentValue = parseInt($('#manualSocBox').val());
						var newValue = 0;
						if (!isNaN(currentValue)) {
							newValue = Math.min(currentValue + 1, 100);
						}
						$('#manualSocBox').val(newValue);
					});

					$('#manualSocCancel').click(function () {
						clearSocForm();
					});

					$('#manualSocOk').click(function () {
						submitSocForm();
					});

				});
			</script>
		</div>

		<!-- modal et-price-window -->
		<div class="modal fade" id="maxPriceModal" data-charge-point="">
			<div class="modal-dialog">
				<div class="modal-content">
					<!-- modal header -->
					<div class="modal-header bg-secondary text-light">
						<h4 class="modal-title">
							Max. Preis - Fahrzeug
							"<span class="vehicle-name"></span>"
						</h4>
					</div>
					<!-- modal body -->
					<div class="modal-body">
						<div class="row justify-content-center my-2">
							<div id="electricityPriceChartCanvasDiv" class="col text-center">
								<canvas id="electricityPriceChartCanvas"></canvas>
							</div>
						</div>
						<div class="row vaRow justify-content-center">
							<div class="col-2 px-1 py-1">
								<button type="button" id="maxPriceDecrement"
									class="btn btn-block btn-secondary">-</button>
							</div>
							<div class="col py-1">
								<div class="input-group input-group-lg">
									<input id="maxPriceBox" type="number" step="0.01" name="maxPriceBox"
										class="form-control text-right">
									<div class="input-group-append">
										<div class="input-group-text">
											ct/kWh
										</div>
									</div>
								</div>
							</div>
							<div class="col-2 px-1 py-1">
								<button type="button" id="maxPriceIncrement"
									class="btn btn-block btn-secondary">+</button>
							</div>
						</div>
						<div class="row justify-content-center">
							<div class="col-sm-5 py-1">
								<button type="button" id="maxPriceOk" class="btn btn-lg btn-block btn-success"
									data-dismiss="modal">Übernehmen</button>
							</div>
							<div class="col-sm-5 py-1">
								<button type="button" id="maxPriceCancel" class="btn btn-lg btn-block btn-secondary"
									data-dismiss="modal">Abbrechen</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<script>
				function clearPriceForm() {
					$("#maxPriceBox").val(0);
					window.electricityPriceChart.destroy();
				}

				function updatePriceChart() {
					window.electricityPriceChart.destroy();
					loadElectricityPriceChart();
				}

				function submitPriceForm() {
					var chargePointIndex = $('#maxPriceModal').data('charge-point');
					var maxPrice = parseFloat(($("#maxPriceBox").val() / 100000).toFixed(7));
					const object = "chargeTemplate";
					const objectPath = "chargemode.eco_charging.max_price";
					const topic = "openWB/set/chargepoint/" + chargePointIndex + "/set/charge_template";
					if (typeof window[object] !== undefined && window[object][chargePointIndex] !== undefined) {
						let currentObjectState = JSON.parse(JSON.stringify(window[object][chargePointIndex]));
						currentObjectState = updateObject(currentObjectState, objectPath, maxPrice);
						publish(currentObjectState, topic);
					} else {
						console.warn('no variable '+ object + ' found for charge point ' + chargePointIndex);
					}
				};

				$(document).ready(function () {

					$('#maxPriceBox').change(function () {
						updatePriceChart();
					});

					$('#maxPriceDecrement').click(function () {
						$('#maxPriceBox')[0].stepDown();
						updatePriceChart();
					});

					$('#maxPriceIncrement').click(function () {
						$('#maxPriceBox')[0].stepUp();
						updatePriceChart();
					});

					$('#maxPriceOk').click(function () {
						submitPriceForm();
					});

					$('#electricityPriceChartCanvas').click((event) => {
						console.log('click on electricity price chart', event);
						// get the clicked point in the chart
						const points = window.electricityPriceChart.getElementsAtEventForMode(event, 'index', { intersect: false }, true);
						if (points.length > 0){
							$('#maxPriceBox').val(Math.ceil(points[0].element.$context.raw.price * 100) / 100);
							updatePriceChart();
						}
					});

					$('#maxPriceModal').on('hidden.bs.modal', function (event) {
						clearPriceForm();
					});

				});
			</script>
		</div>

	</div> <!-- container -->

	<script>

		// load navbar, be careful: it loads asynchronous
		$.get(
			{ url: "navbar.html", cache: false },
			function (data) {
				$("#nav-placeholder").replaceWith(data);
			}
		);

		var timeOfLastMqttMessage = 0;  // holds timestamp of last received message
		var landingPageShown = false;  // holds flag for landing page being shown

		function chargemodeOptionsShowHide(btnGrp, option) {
			// show/hide all option-parameters in form-rows for selected option
			var parent = btnGrp.closest('.charge-point-card[data-cp]');  // get parent div element for charge limitation options
			var chargeModeOptionsElement = $(parent).find('.charge-point-charge-mode-options');
			if (option == "stop") {
				chargeModeOptionsElement.addClass('hide');
			} else {
				chargeModeOptionsElement.removeClass('hide');
				$(chargeModeOptionsElement).find('.chargemode-options.chargemode-option-' + option).removeClass('hide');  // now show option elements for selected option
				$(chargeModeOptionsElement).find('.chargemode-options').not('.chargemode-option-' + option).addClass('hide');  // hide all other option elements
			}
		}

		function timeChargeOptionsShowHide(element, option) {
			var parent = element.closest('.charge-point-card[data-cp]');
			var timeChargeOptionsElement = $(parent).find('.chargemode-option-time_charging');
			if (option) {
				timeChargeOptionsElement.removeClass('hide');
			} else {
				timeChargeOptionsElement.addClass('hide');
			}
		}

		function chargemodeLimitOptionsShowHide(btnGrp, mode, option) {
			// show/hide all option-parameters in form-rows for selected option
			var parent = btnGrp.closest('.charge-point-card[data-cp]');  // get parent div element for charge limitation options
			var chargeModeLimitOptionsElement = $(parent).find(`.chargemode-${mode}-limit-options`);
			if (option == "none") {
				chargeModeLimitOptionsElement.addClass('hide');
			} else {
				chargeModeLimitOptionsElement.removeClass('hide');
				$(chargeModeLimitOptionsElement).find('.chargemode-limit-option.chargemode-limit-option-' + option).removeClass('hide');  // now show option elements for selected option
				$(chargeModeLimitOptionsElement).find('.chargemode-limit-option').not('.chargemode-limit-option-' + option).addClass('hide');  // hide all other option elements
			}
		}

		function processPreloader(mqttTopic) {
			// sets flag for topic received in topic-array
			// and updates the preloader progress bar
			if (!landingPageShown) {
				var countTopicsReceived = 0;
				for (var index = 0; index < topicsToSubscribeFirst.length; index++) {
					if (topicsToSubscribeFirst[index][0] == mqttTopic && topicsToSubscribeFirst[index][1] == 0) {
						// topic found in array
						topicsToSubscribeFirst[index][1] = 1;  // mark topic as received
					};
					if (topicsToSubscribeFirst[index][1] > 0) {
						countTopicsReceived++;
					}
				};
				for (var index = 0; index < topicsToSubscribe.length; index++) {
					if (topicsToSubscribe[index][0] == mqttTopic && topicsToSubscribe[index][1] == 0) {
						// topic found in array
						topicsToSubscribe[index][1] = 1;  // mark topic as received
					};
					if (topicsToSubscribe[index][1] > 0) {
						countTopicsReceived++;
					}
				};
				// countTopicsToBeReceived holds all topics flagged 1 and not only those for preloader
				countTopicsReceived = countTopicsReceived - countTopicsNotForPreloader;
				var countTopicsToBeReceived = topicsToSubscribeFirst.length + topicsToSubscribe.length - countTopicsNotForPreloader;
				var percentageReceived = (countTopicsReceived / countTopicsToBeReceived * 100).toFixed(0);
				var timeBetweenTwoMessages = Date.now() - timeOfLastMqttMessage;
				if (timeBetweenTwoMessages > 3000) {
					// latest after 3 sec without new messages
					percentageReceived = 100;
					// debug output
					topicsToSubscribeFirst.forEach((item, i) => {
						if (item[1] == 0) {
							console.warn('not received: ' + item[0]);
						}
					});
					topicsToSubscribe.forEach((item, i) => {
						if (item[1] == 0) {
							console.warn('not received: ' + item[0]);
						}
					});

				}
				timeOfLastMqttMessage = Date.now();
				$("#preloader-bar").width(percentageReceived + "%");
				$("#preloader-bar").text(percentageReceived + " %");
				if (percentageReceived == 100) {
					landingPageShown = true;
					setTimeout(function () {
						// delay a little bit
						$("#preloader").fadeOut(1000);
					}, 500);
				}
			}
		}

		var delayUserInput = (function () {
			// sets a timeout on call and resets timeout if called again for same id before timeout fires
			var timeoutHandles = {};
			return function (id, callback, ms) {
				if (timeoutHandles[id]) {
					clearTimeout(timeoutHandles[id]);
				};
				timeoutHandles[id] = setTimeout(function () {
					delete timeoutHandles[id];
					callback(id);
				}, ms);
			};
		})();

		function updateObject(object, objectPath, newValue) {
			console.debug('object: ' + JSON.stringify(object));
			// update "object" property with new value
			// objectPath is a string with the path to the property in the object separated by "."
			let path = objectPath.split('.');
			let obj = object;
			for (let i = 0; i < path.length - 1; i++) {
				if (!obj[path[i]]) {
					console.error('property ' + path[i] + ' not found in object' + JSON.stringify(obj));
					return;
				}
				obj = obj[path[i]];
			}
			obj[path[path.length - 1]] = newValue;
			console.debug('updated object: ' + JSON.stringify(object));
			return object;
		}

		$(document).ready(function () {

			// load scripts synchronously in order specified
			var scriptsToLoad = [
				// time/date library for chart.js
				'js/luxon/luxon.min.js',
				// load Chart.js library
				'js/chart.js-3.2.1/chart.min.js',
				// annotations plugin for price chart backgrounds
				'js/chartjs-plugin-annotation/chartjs-plugin-annotation.min.js',
				// adapter for time scales
				'js/chartjs-adapter-luxon/chartjs-adapter-luxon.min.js',
				// load mqtt library
				'js/mqttws31.js',
				// some helper functions
				'helperFunctions.js?ver=20250217',
				// functions for processing messages
				'processAllMqttMsg.js?ver=20250801',
				// respective Chart.js definition live
				'livechart.js?ver=20250404',
				// respective Chart.js definition price based charging
				'electricityPriceChart.js?ver=20250326',
				// functions performing mqtt and start mqtt-service
				'setupMqttServices.js?ver=20250326',
			];
			scriptsToLoad.forEach(function (src) {
				var script = document.createElement('script');
				script.src = src;
				script.async = false;
				document.body.appendChild(script);
			});

			$('.container').on('change', 'input[type=checkbox]', function (event) {
				// send mqtt set to enable/disable charge point after click
				const topic = getTopic($(this));
				if (topic !== undefined) {
					const newValue = $(this).prop('checked');
					const objectPath = $(this).data('object-path');
					if (objectPath === undefined) {
						publish(newValue, topic);
					} else {
						let chargePointIndex = $(this).closest('.charge-point-card').data('cp');
						const object = $(this).data('object');
						if (typeof window[object] !== undefined && window[object][chargePointIndex] !== undefined) {
							let currentObjectState = JSON.parse(JSON.stringify(window[object][chargePointIndex]));
							currentObjectState = updateObject(currentObjectState, objectPath, newValue);
							publish(currentObjectState, topic);
						} else {
							console.warn('no variable '+ object + ' found for charge point ' + chargePointIndex);
						}
					}
					if ($(this).hasClass('charge-point-time-charging-active')) {
						timeChargeOptionsShowHide(this, $(this).prop('checked'));
					}
				} else {
					console.warn("checkbox without topic changed");
				}
			});

			$('.container').on('change', '.charge-point-vehicle-select', function (event) {
				// update data in parent element
				$(this).closest('[data-ev]').attr('data-ev', $(this).val()).data('ev', $(this).val());
				// send update to broker
				const topic = getTopic($(this));
				if (topic !== undefined) {
					publish(parseInt($(this).val()), topic);
				}
			});

			$('.container').on('click', '.charge-point-soc-configured', function (event) {
				event.stopPropagation();
				var parentChargePoint = $(this).closest('[data-cp]');
				var cp = parseInt(parentChargePoint.data('cp'));  // get attribute cp-# of parent element
				var ev = parseInt(parentChargePoint.find('.charge-point-vehicle-data[data-ev]').data('ev'));
				if (!isNaN(cp) && cp > 0) {
					if ($(this).hasClass('manualSoC')) {
						var currentSoc = parseInt($(this).find('.charge-point-soc').text());
						if (isNaN(currentSoc)) {
							currentSoc = 0;
						}
						$('#socModal').find('.charge-point-soc').text(ev);
						$("#manualSocBox").val(currentSoc);
						$('#socModal').modal("show");
					} else {
						// send mqtt set to force reload of charge point SoC after click
						var spinner = $(this).find('.charge-point-reload-soc-symbol');
						var isRunning = spinner.hasClass("fa-spin");
						if (!isNaN(ev) && !isRunning) {
							spinner.addClass("fa-spin");
							publish(1, "openWB/set/vehicle/" + ev + "/get/force_soc_update");
						}
					}
				}
			});

			$('.container').on('click', '.charge-point-time-charge-pill', function (event) {
				event.stopPropagation();
				const parentChargePoint = $(this).closest('[data-cp]');
				const chargePointIndex = parseInt(parentChargePoint.data('cp'));
				const planId = parseInt($(this).closest('.charge-point-time-charge-plan').data('plan'));
				const planIndex = parseInt($(this).closest('.charge-point-time-charge-plan').data('plan-index'));
				if (!isNaN(chargePointIndex) && !isNaN(planId) && !isNaN(planIndex)) {
					const object = "chargeTemplate";
					const objectPath = "time_charging.plans." + planIndex + ".active";
					const topic = "openWB/set/chargepoint/" + chargePointIndex + "/set/charge_template";
					const option = !$(this).hasClass('charge-point-plan-pill-active');
					console.log('toggle time charge plan', chargePointIndex, planId, planIndex, option);
					if (typeof window[object] !== undefined && window[object][chargePointIndex] !== undefined) {
						let currentObjectState = JSON.parse(JSON.stringify(window[object][chargePointIndex]));
						currentObjectState = updateObject(currentObjectState, objectPath, option);
						console.log(
							'toggle time charge plan',
							'topic: ' + topic,
							currentObjectState,
						);
						publish(currentObjectState, topic);
					} else {
						console.warn('no variable '+ object + ' found for charge point ' + chargePointIndex);
					}
				}
			});

			$('.container').on('click', '.scheduled-charging-settings-link', function (event) {
				event.stopPropagation();
				var parentChargePoint = $(this).closest('[data-cp]');
				var chargeTemplate = parseInt(parentChargePoint.data('charge-template'));
				window.location.href = "../../settings/#/VehicleConfiguration/charge_template/" + chargeTemplate;
			});

			$('.container').on('click', '.charge-point-schedule-plan-pill', function (event) {
				event.stopPropagation();
				const parentChargePoint = $(this).closest('[data-cp]');
				const chargePointIndex = parseInt(parentChargePoint.data('cp'));
				const planId = parseInt($(this).closest('.charge-point-schedule-plan').data('plan'));
				const planIndex = parseInt($(this).closest('.charge-point-schedule-plan').data('plan-index'));
				if (!isNaN(chargePointIndex) && !isNaN(planId) && !isNaN(planIndex)) {
					const object = "chargeTemplate";
					const objectPath = "chargemode.scheduled_charging.plans." + planIndex + ".active";
					const topic = "openWB/set/chargepoint/" + chargePointIndex + "/set/charge_template";
					const option = !$(this).hasClass('charge-point-plan-pill-active');
					console.log('toggle schedule plan', chargePointIndex, planId, planIndex, option);
					if (typeof window[object] !== undefined && window[object][chargePointIndex] !== undefined) {
						let currentObjectState = JSON.parse(JSON.stringify(window[object][chargePointIndex]));
						currentObjectState = updateObject(currentObjectState, objectPath, option);
						console.log(
							'toggle schedule charge plan',
							'topic: ' + topic,
							currentObjectState,
						);
						publish(currentObjectState, topic);
					} else {
						console.warn('no variable '+ object + ' found for charge point ' + chargePointIndex);
					}
				}
			});

			$('.container').on('click', '.time_charging-settings-link', function (event) {
				event.stopPropagation();
				var parentChargePoint = $(this).closest('[data-cp]');
				var chargeTemplate = parseInt(parentChargePoint.data('charge-template'));
				window.location.href = "../../settings/#/VehicleConfiguration/charge_template/" + chargeTemplate;
			});

			$('.container').on('click', '.charge-point-eco-charge-max_price-button', function (event) {
				event.stopPropagation();
				var parentChargePoint = $(this).closest('[data-cp]');
				var chargePointIndex = parseInt(parentChargePoint.data('cp'));
				var chargeTemplate = parseInt(parentChargePoint.data('charge-template'));
				var vehicleName = parentChargePoint.find('.charge-point-vehicle-name').text();
				var currentMaxPrice = $(this).data('max-price');
				if (!isNaN(chargeTemplate)) {
					$('#maxPriceModal').find('.vehicle-name').text(vehicleName);
					$('#maxPriceModal').attr('data-charge-point', chargePointIndex).data('charge-point', chargePointIndex);
					$('#maxPriceModal').find('#maxPriceBox').val(currentMaxPrice);
					loadElectricityPriceChart();
					$('#maxPriceModal').modal("show");
				}
			});

			$('.container').on('change', '.btn-group-toggle', function (event) {
				const topic = getTopic($(this));
				let option = $(this).find('input[type="radio"]:checked').data('option').toString();
				if ($(this).data('type') == 'number') {
					option = parseFloat(option);
				}
				if (topic !== undefined) {
					const objectPath = $(this).data('object-path');
					if (objectPath === undefined) {
						publish(option, topic);
					} else {
						let chargePointIndex = $(this).closest('.charge-point-card').data('cp');
						const object = $(this).data('object');
						if (typeof window[object] !== undefined && window[object][chargePointIndex] !== undefined) {
							let currentObjectState = JSON.parse(JSON.stringify(window[object][chargePointIndex]));
							currentObjectState = updateObject(currentObjectState, objectPath, option);
							publish(currentObjectState, topic);
						} else {
							console.warn('no variable '+ object + ' found for charge point ' + chargePointIndex);
						}
					}
					// show/hide respective option-values and progress
					if ($(this).hasClass('charge-point-charge-mode')) {
						chargemodeOptionsShowHide(this, option);
					}
					if ($(this).hasClass('charge-point-instant-charge-limit-selected')) {
						chargemodeLimitOptionsShowHide(this, 'instant', option);
					}
					if ($(this).hasClass('charge-point-pv-charge-limit-selected')) {
						chargemodeLimitOptionsShowHide(this, 'pv', option);
					}
					if ($(this).hasClass('charge-point-eco-charge-limit-selected')) {
						chargemodeLimitOptionsShowHide(this, 'eco', option);
					}
				}
			});

			$('.container').on('input', '.rangeInput', function () {
				// show slider value in label of class valueLabel
				var elementId = $(this).attr('id');
				updateLabel(elementId);
				var element = $('#' + $.escapeSelector(elementId));
				var label = $('label[for="' + elementId + '"].valueLabel');
				label.addClass('text-danger');

				delayUserInput(elementId, function (id) {
					// gets executed on callback, 2000ms after last input-change
					// changes label color back to normal and sends input-value by mqtt
					var element = $('#' + $.escapeSelector(id));
					var value = parseFloat(element.val());
					if (list = $(element).attr('data-list')) {
						var jsonList = JSON.parse(list);
						if (Array.isArray(jsonList[parseInt(value)])) {
							value = jsonList[parseInt(value)][0];
						} else {
							value = jsonList[parseInt(value)];
						}
					} else if (formula = $(element).attr('data-transformation')) {
						formula = JSON.parse(formula);
						formula = formula.out.replace('<v>', value);
						value = transformRangeValue(formula);
					}
					const topic = getTopic(element);
					if (topic !== undefined) {
						const objectPath = element.data('object-path');
						if (objectPath === undefined) {
							publish(value, topic);
						} else {
							let chargePointIndex = element.closest('.charge-point-card').data('cp');
							const object = element.data('object');
							if (typeof window[object] !== undefined && window[object][chargePointIndex] !== undefined) {
								let currentObjectState = JSON.parse(JSON.stringify(window[object][chargePointIndex]));
								currentObjectState = updateObject(currentObjectState, objectPath, value);
								publish(currentObjectState, topic);
							} else {
								console.warn('no variable '+ object + ' found for charge point ' + chargePointIndex);
							}
						}
						$('label[for="' + id + '"].valueLabel').removeClass('text-danger');
					}
				}, 2000);
			});

			// register an event listener for changes in visibility
			let hidden;
			let visibilityChange;
			if (typeof document.hidden !== 'undefined') { // Opera 12.10 and Firefox 18 and later support
				hidden = 'hidden';
				visibilityChange = 'visibilitychange';
			} else if (typeof document.msHidden !== 'undefined') {
				hidden = 'msHidden';
				visibilityChange = 'msvisibilitychange';
			} else if (typeof document.webkitHidden !== 'undefined') {
				hidden = 'webkitHidden';
				visibilityChange = 'webkitvisibilitychange';
			}
			window.document.addEventListener(visibilityChange, () => {
				if (!document[hidden]) {
					// once page is unhidden... reload graph completely
					initialRead = 0;
					all1 = 0;
					all2 = 0;
					all3 = 0;
					all4 = 0;
					all5 = 0;
					all6 = 0;
					all7 = 0;
					all8 = 0;
					all9 = 0;
					all10 = 0;
					all11 = 0;
					all12 = 0;
					all13 = 0;
					all14 = 0;
					all15 = 0;
					all16 = 0;

					subscribeMqttGraphSegments();
				}
			});

		});  // end document ready
	</script>

</body>

</html>
