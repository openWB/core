var na=Object.defineProperty;var sa=(t,e,a)=>e in t?na(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var s=(t,e,a)=>sa(t,typeof e!="symbol"?e+"":e,a);import{m as ia,r as F,a as we,M as At,d as T,o as g,c as b,n as q,b as $,e as d,f as ue,g as ae,h as p,s as ge,i as Ke,j as ca,t as O,u as n,k as M,w as P,l as z,p as xe,q as Pe,v as Lt,x as Dt,y as la,z as E,F as Ie,A as Be,B as Ee,C as ut,D as Ce,E as Gt,G as gt,H as Re,I as Le,J as tt,K as kt,L as ua,N as He,O as da,P as ha,Q as pa,R as Fe,S as ga,T as Ye,U as at,V as ma}from"./vendor-DkUHBf2M.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();function Je(t,e=1){let a;if(t>=1e3&&e<4){switch(e){case 0:a=Math.round(t/1e3);break;case 1:a=Math.round(t/100)/10;break;case 2:a=Math.round(t/10)/100;break;case 3:a=Math.round(t)/1e3;break;default:a=Math.round(t/100)/10;break}return(a==null?void 0:a.toLocaleString(void 0,{minimumFractionDigits:e}))+" kW"}else return Math.round(t).toLocaleString(void 0)+" W"}function Vt(t,e=1,a=!1){let r;if(t>1e6&&(a=!0,t=t/1e3),t>=1e3&&e<4){switch(e){case 0:r=Math.round(t/1e3);break;case 1:r=(Math.round(t/100)/10).toFixed(1);break;case 2:r=(Math.round(t/10)/100).toFixed(2);break;case 3:r=(Math.round(t)/1e3).toFixed(3);break;default:r=Math.round(t/100)/10;break}return r.toLocaleString(void 0,{minimumFractionDigits:e})+(a?" MWh":" kWh")}else return Math.round(t).toLocaleString(void 0)+(a?" kWh":" Wh")}function fa(t){return t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function va(t,e){return["Jan","Feb","MÃ¤rz","April","Mai","Juni","Juli","Aug","Sep","Okt","Nov","Dez"][t]+" "+e}const ya=0,Et={host:location.hostname,port:location.protocol=="https:"?443:80,endpoint:"/ws",protocol:location.protocol=="https:"?"wss":"ws",connectTimeout:4e3,reconnectPeriod:4e3,clean:!1,clientId:Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,6)},Qe={topic:"",qos:ya};let se;const{host:_a,port:ba,endpoint:wa,...Wt}=Et,Sa=`${Wt.protocol}://${_a}:${ba}${wa}`;try{se=ia.connect(Sa,Wt),se.on("connect",()=>{console.info("MQTT connection successful.")}),se.on("disconnect",()=>{console.info("MQTT disconnected")}),se.on("error",t=>{console.error("MQTT connection failed: ",t)})}catch(t){console.error("MQTT connect error: ",t)}async function ka(t){await Nt(),se?se.on("message",t):console.error("MqttRegister: MQTT client not available")}async function $e(t){Qe.topic=t;const{topic:e,qos:a}=Qe;await Nt(),se.subscribe(e,{qos:a},r=>{if(r){console.error("MQTT Subscription error: "+r);return}})}function Oe(t){Qe.topic=t;const{topic:e}=Qe;se.unsubscribe(e,a=>{if(a){console.error("MQTT Unsubscribe from "+t+" failed: "+a);return}})}async function dt(t,e){let r=se.connected,o=0;for(;!r&&o<10;)console.warn("MQTT not connected. Waiting 0.1 seconds"),await jt(100),r=se.connected,o+=1;if(o<10)try{se.publish(t,e,{qos:0},i=>{i&&console.warn("MQTT publish error: ",i),console.info("MQTT publish: Message sent: ["+t+"]("+e+")")})}catch(i){console.warn("MQTT publish: caught error: "+i)}else console.error("MQTT publish: Lost connection to MQTT server. Please reload the page")}function mt(){return Et.clientId}const Mt=20;async function Nt(){let t=se.connected,e=0;for(;!t&&e<Mt;)console.warn("MQTT not connected. Waiting 0.1 seconds"),await jt(100),t=se.connected,e+=1;return new Promise((a,r)=>{e<Mt?a(!0):r(!1)})}function jt(t){return new Promise(e=>setTimeout(e,t))}class Ma{constructor(e){s(this,"id");s(this,"name","Ladepunkt");s(this,"icon","Ladepunkt");s(this,"type","");s(this,"ev",0);s(this,"template",0);s(this,"connectedPhases",0);s(this,"phase_1",0);s(this,"autoPhaseSwitchHw",!1);s(this,"controlPilotInterruptionHw",!1);s(this,"isEnabled",!0);s(this,"isPluggedIn",!1);s(this,"isCharging",!1);s(this,"_isLocked",!1);s(this,"_connectedVehicle",0);s(this,"chargeTemplate",0);s(this,"evTemplate",0);s(this,"_chargeMode","pv_charging");s(this,"_hasPriority",!1);s(this,"currentPlan","");s(this,"averageConsumption",0);s(this,"vehicleName","");s(this,"rangeCharged",0);s(this,"rangeUnit","");s(this,"counter",0);s(this,"dailyYield",0);s(this,"energyPv",0);s(this,"energyBat",0);s(this,"pvPercentage",0);s(this,"faultState",0);s(this,"faultStr","");s(this,"phasesInUse",0);s(this,"power",0);s(this,"chargedSincePlugged",0);s(this,"stateStr","");s(this,"current",0);s(this,"currents",[0,0,0]);s(this,"phasesToUse",0);s(this,"isSocConfigured",!0);s(this,"isSocManual",!1);s(this,"waitingForSoc",!1);s(this,"color","white");s(this,"_timedCharging",!1);s(this,"_instantChargeLimitMode","");s(this,"_instantTargetCurrent",0);s(this,"_instantTargetSoc",0);s(this,"_instantMaxEnergy",0);s(this,"_pvFeedInLimit",!1);s(this,"_pvMinCurrent",0);s(this,"_pvMaxSoc",0);s(this,"_pvMinSoc",0);s(this,"_pvMinSocCurrent",0);s(this,"_etActive",!1);s(this,"_etMaxPrice",20);this.id=e}get isLocked(){return this._isLocked}set isLocked(e){this._isLocked=e,H("cpLock",e,this.id)}updateIsLocked(e){this._isLocked=e}get connectedVehicle(){return this._connectedVehicle}set connectedVehicle(e){this._connectedVehicle=e,H("cpVehicle",e,this.id)}updateConnectedVehicle(e){this._connectedVehicle=e}get soc(){return j[this.connectedVehicle]?j[this.connectedVehicle].soc:0}set soc(e){j[this.connectedVehicle]&&(j[this.connectedVehicle].soc=e)}get chargeMode(){return this._chargeMode}set chargeMode(e){this._chargeMode=e,H("chargeMode",e,this.id)}updateChargeMode(e){this._chargeMode=e}get hasPriority(){return this._hasPriority}set hasPriority(e){this._hasPriority=e,H("cpPriority",e,this.id)}updateCpPriority(e){this._hasPriority=e}get timedCharging(){return ce[this.chargeTemplate]?ce[this.chargeTemplate].time_charging.active:!1}set timedCharging(e){ce[this.chargeTemplate].time_charging.active=e,H("cpTimedCharging",e,this.chargeTemplate)}get instantTargetCurrent(){return this._instantTargetCurrent}set instantTargetCurrent(e){this._instantTargetCurrent=e,H("cpInstantTargetCurrent",e,this.id)}updateInstantTargetCurrent(e){this._instantTargetCurrent=e}get instantChargeLimitMode(){return this._instantChargeLimitMode}set instantChargeLimitMode(e){this._instantChargeLimitMode=e,H("cpInstantChargeLimitMode",e,this.id)}updateInstantChargeLimitMode(e){this._instantChargeLimitMode=e}get instantTargetSoc(){return this._instantTargetSoc}set instantTargetSoc(e){this._instantTargetSoc=e,H("cpInstantTargetSoc",e,this.id)}updateInstantTargetSoc(e){this._instantTargetSoc=e}get instantMaxEnergy(){return this._instantMaxEnergy}set instantMaxEnergy(e){this._instantMaxEnergy=e,H("cpInstantMaxEnergy",e,this.id)}updateInstantMaxEnergy(e){this._instantMaxEnergy=e}get pvFeedInLimit(){return this._pvFeedInLimit}set pvFeedInLimit(e){this._pvFeedInLimit=e,H("cpPvFeedInLimit",e,this.id)}updatePvFeedInLimit(e){this._pvFeedInLimit=e}get pvMinCurrent(){return this._pvMinCurrent}set pvMinCurrent(e){this._pvMinCurrent=e,H("cpPvMinCurrent",e,this.id)}updatePvMinCurrent(e){this._pvMinCurrent=e}get pvMaxSoc(){return this._pvMaxSoc}set pvMaxSoc(e){this._pvMaxSoc=e,H("cpPvMaxSoc",e,this.id)}updatePvMaxSoc(e){this._pvMaxSoc=e}get pvMinSoc(){return this._pvMinSoc}set pvMinSoc(e){this._pvMinSoc=e,H("cpPvMinSoc",e,this.id)}updatePvMinSoc(e){this._pvMinSoc=e}get pvMinSocCurrent(){return this._pvMinSocCurrent}set pvMinSocCurrent(e){this._pvMinSocCurrent=e,H("cpPvMinSocCurrent",e,this.id)}updatePvMinSocCurrent(e){this._pvMinSocCurrent=e}get realCurrent(){switch(this.phasesInUse){case 0:return 0;case 1:return this.currents[0];case 2:return(this.currents[0]+this.currents[1])/2;case 3:return(this.currents[0]+this.currents[1]+this.currents[2])/3;default:return 0}}get etActive(){return j[this.connectedVehicle]?j[this.connectedVehicle].etActive:!1}set etActive(e){j[this.connectedVehicle]&&(j[this.connectedVehicle].etActive=e)}get etMaxPrice(){return j[this.connectedVehicle].etMaxPrice??0}set etMaxPrice(e){console.log("Setting et max price needs to be implemented"),H("cpEtMaxPrice",Math.round(e*10)/1e6,this.id)}toPowerItem(){return{name:this.name,power:this.power,energy:this.dailyYield,energyPv:this.energyPv,energyBat:this.energyBat,pvPercentage:this.pvPercentage,color:this.color,icon:this.icon}}}class xa{constructor(e){s(this,"id");s(this,"name","");s(this,"_chargeTemplateId",0);s(this,"_evTemplateId",0);s(this,"tags",[]);s(this,"config",{});s(this,"soc",0);s(this,"range",0);s(this,"_etActive",!1);s(this,"_etMaxPrice",20);this.id=e}get chargeTemplateId(){return this._chargeTemplateId}set chargeTemplateId(e){this._chargeTemplateId=e,H("vhChargeTemplateId",e,this.id)}updateChargeTemplateId(e){this._chargeTemplateId=e}get evTemplateId(){return this._evTemplateId}set evTemplateId(e){this._evTemplateId=e,H("vhEvTemplateId",e,this.id)}updateEvTemplateId(e){this._evTemplateId=e}get etActive(){return ce[this.chargeTemplateId]?ce[this.chargeTemplateId].et.active:!1}set etActive(e){ce[this.chargeTemplateId]&&H("priceCharging",e,this.chargeTemplateId)}get etMaxPrice(){if(ce[this.chargeTemplateId]&&ce[this.chargeTemplateId].et.active)return ce[this.chargeTemplateId].et.max_price*1e5}get chargepoint(){for(const e of Object.values(_))if(e.connectedVehicle==this.id)return e}}var de=(t=>(t.instant_charging="instant_charging",t.pv_charging="pv_charging",t.scheduled_charging="scheduled_charging",t.standby="standby",t.stop="stop",t))(de||{});const _=F({}),j=F({}),ce=F({}),rt=F({}),ot=F({}),Pa=F({});function Ia(t){t in _||(_[t]=new Ma(t),_[t].color="var(--color-cp"+(Object.values(_).length-1)+")")}function $a(){Object.keys(_).forEach(t=>{delete _[parseInt(t)]})}const Ca={cpLock:"openWB/set/chargepoint/%/set/manual_lock",chargeMode:"openWB/set/vehicle/template/charge_template/%/chargemode/selected",cpPriority:"openWB/set/vehicle/template/charge_template/%/prio",cpTimedCharging:"openWB/set/vehicle/template/charge_template/%/time_charging/active",pvBatteryPriority:"openWB/set/general/chargemode_config/pv_charging/bat_mode",cpVehicle:"openWB/set/chargepoint/%/config/ev",cpInstantChargeLimitMode:"openWB/set/vehicle/template/charge_template/%/chargemode/instant_charging/limit/selected",cpInstantTargetCurrent:"openWB/set/vehicle/template/charge_template/%/chargemode/instant_charging/current",cpInstantTargetSoc:"openWB/set/vehicle/template/charge_template/%/chargemode/instant_charging/limit/soc",cpInstantMaxEnergy:"openWB/set/vehicle/template/charge_template/%/chargemode/instant_charging/limit/amount",cpPvFeedInLimit:"openWB/set/vehicle/template/charge_template/%/chargemode/pv_charging/feed_in_limit",cpPvMinCurrent:"openWB/set/vehicle/template/charge_template/%/chargemode/pv_charging/min_current",cpPvMaxSoc:"openWB/set/vehicle/template/charge_template/%/chargemode/pv_charging/max_soc",cpPvMinSoc:"openWB/set/vehicle/template/charge_template/%/chargemode/pv_charging/min_soc",cpPvMinSocCurrent:"openWB/set/vehicle/template/charge_template/%/chargemode/pv_charging/min_soc_current",cpEtMaxPrice:"openWB/set/vehicle/template/charge_template/%/et/max_price",vhChargeTemplateId:"openWB/set/vehicle/%/charge_template",vhEvTemplateId:"openWB/set/vehicle/%/ev_template",shSetManual:"openWB/set/LegacySmartHome/config/set/Devices/%/mode",shSwitchOn:"openWB/set/LegacySmartHome/config/set/Devices/%/device_manual_control",socUpdate:"openWB/set/vehicle/%/get/force_soc_update",setSoc:"openWB/set/vehicle/%/soc_module/calculated_soc_state/manual_soc",priceCharging:"openWB/set/vehicle/template/charge_template/%/et/active"};function H(t,e,a=0){if(isNaN(a)){console.warn("Invalid index");return}let r=Ca[t];if(!r){console.warn("No topic for update type "+t);return}switch(t){case"chargeMode":case"cpPriority":case"cpScheduledCharging":case"cpInstantTargetCurrent":case"cpInstantChargeLimitMode":case"cpInstantTargetSoc":case"cpInstantMaxEnergy":case"cpPvFeedInLimit":case"cpPvMinCurrent":case"cpPvMaxSoc":case"cpPvMinSoc":case"cpEtMaxPrice":case"cpPvMinSocCurrent":r=r.replace("%",_[a].chargeTemplate.toString());break;default:r=r.replace("%",String(a))}switch(typeof e){case"number":dt(r,JSON.stringify(+e));break;default:dt(r,JSON.stringify(e))}}function ft(t){dt("openWB/set/command/"+mt()+"/todo",JSON.stringify(t))}class Oa{constructor(){s(this,"batterySoc",0);s(this,"isBatteryConfigured",!0);s(this,"chargeMode","0");s(this,"_pvBatteryPriority","ev_mode");s(this,"displayLiveGraph",!0);s(this,"isEtEnabled",!0);s(this,"etMaxPrice",0);s(this,"etCurrentPrice",0);s(this,"cpDailyExported",0);s(this,"evuId",0);s(this,"etProvider","");s(this,"ipAddress","");s(this,"systemTime","");s(this,"version","");s(this,"versionDetails","");s(this,"devBranch","")}get pvBatteryPriority(){return this._pvBatteryPriority}set pvBatteryPriority(e){this._pvBatteryPriority=e,H("pvBatteryPriority",e)}updatePvBatteryPriority(e){this._pvBatteryPriority=e}}const Ba=[["EV","ev_mode"],["Speicher","bat_mode"],["MinSoc","min_soc_bat_mode"]],ee=F({evuIn:{name:"Netz",color:"var(--color-evu)",icon:"ïµ"},pv:{name:"PV",color:"var(--color-pv",icon:"ïº"},batOut:{name:"Bat >",color:"var(--color-battery)",icon:"ïï¡"},evuOut:{name:"Export",color:"var(--color-export)",icon:"ï¡ï½"},charging:{name:"Laden",color:"var(--color-charging)",icon:"ï§"},devices:{name:"GerÃ¤te",color:"var(--color-devices)",icon:"ï¦"},batIn:{name:"> Bat",color:"var(--color-battery)",icon:"ï¡ï"},house:{name:"Haus",color:"var(--color-house)",icon:"ï"},cp1:{name:"Ladepunkt",color:"var(--color-cp1)",icon:"Ladepunkt"},cp2:{name:"Ladepunkt",color:"var(--color-cp2)",icon:"Ladepunkt"},cp3:{name:"Ladepunkt",color:"var(--color-cp3)",icon:"Ladepunkt"},cp4:{name:"Ladepunkt",color:"var(--color-cp4)",icon:"Ladepunkt"},cp5:{name:"Ladepunkt",color:"var(--color-cp5)",icon:"Ladepunkt"},cp6:{name:"Ladepunkt",color:"var(--color-cp6)",icon:"Ladepunkt"},cp7:{name:"Ladepunkt",color:"var(--color-cp7)",icon:"Ladepunkt"},cp8:{name:"Ladepunkt",color:"var(--color-cp8)",icon:"Ladepunkt"},sh1:{name:"GerÃ¤t",color:"var(--color-sh1)",icon:"GerÃ¤t"},sh2:{name:"GerÃ¤t",color:"var(--color-sh2)",icon:"GerÃ¤t"},sh3:{name:"GerÃ¤t",color:"var(--color-sh3)",icon:"GerÃ¤t"},sh4:{name:"GerÃ¤t",color:"var(--color-sh4)",icon:"GerÃ¤t"},sh5:{name:"GerÃ¤t",color:"var(--color-sh5)",icon:"GerÃ¤t"},sh6:{name:"GerÃ¤t",color:"var(--color-sh6)",icon:"GerÃ¤t"},sh7:{name:"GerÃ¤t",color:"var(--color-sh7)",icon:"GerÃ¤t"},sh8:{name:"GerÃ¤t",color:"var(--color-sh8)",icon:"GerÃ¤t"},sh9:{name:"GerÃ¤t",color:"var(--color-sh9)",icon:"GerÃ¤t"}});class zt{constructor(){s(this,"_items",{});this.addItem("evuIn"),this.addItem("pv"),this.addItem("batOut"),this.addItem("evuOut"),this.addItem("charging"),this.addItem("devices"),this.addItem("batIn"),this.addItem("house")}get items(){return this._items}keys(){return Object.keys(this._items)}values(){return Object.values(this._items)}addItem(e){this._items[e]=_e(e)}setEnergy(e,a){this.keys().includes(e)||this.addItem(e),this._items[e].energy=a}setEnergyPv(e,a){this.keys().includes(e)||this.addItem(e),this._items[e].energyPv=a}setEnergyBat(e,a){this.keys().includes(e)||this.addItem(e),this._items[e].energyBat=a}setPvPercentage(e,a){this.keys().includes(e)||this.addItem(e),this._items[e].pvPercentage=a}calculateHouseEnergy(){this._items.house.energy=this._items.evuIn.energy+this._items.pv.energy+this._items.batOut.energy-this._items.evuOut.energy-this._items.batIn.energy-this._items.charging.energy-this._items.devices.energy}}let k=new zt;function vt(){k=new zt}const G=F({evuIn:_e("evuIn"),pv:_e("pv"),batOut:_e("batOut")}),I=F({evuOut:_e("evuOut"),charging:_e("charging"),devices:_e("devices"),batIn:_e("batIn"),house:_e("house")}),U=F(new Oa);we("");const qe=we(!1);function _e(t){return{name:ee[t]?ee[t].name:"item",power:0,energy:0,energyPv:0,energyBat:0,pvPercentage:0,color:ee[t]?ee[t].color:"var(--color-charging)",icon:ee[t]?ee[t].icon:""}}const te=F({active:!1,locked:!0,usePin:!1,code:"",timeout:60,localCpOnly:!1});function ht(){te.usePin&&te.locked?new At("#numberpad").toggle():(te.locked=!1,setTimeout(()=>{te.locked=!0},te.timeout*1e3))}function Ta(t){return t==te.code}function Aa(){I.house.power=I.house.power-I.devices.power}const xt=we(new Date),La={class:"scaled"},Da=T({__name:"DisplayButton",props:{icon:{},bgcolor:{},color:{}},emits:["click"],setup(t,{emit:e}){const a=t,r=e;function o(){r("click",!0)}return(i,l)=>(g(),b("div",{style:ae({"background-color":a.bgcolor?a.bgcolor:"var(--color-bg)",color:a.color?a.color:"var(--color-title)"}),class:"displaybutton rounded-pill",type:"button",onClick:o},[a.icon?(g(),b("span",{key:0,class:q(["fas me-2 scaled",a.icon])},null,2)):$("",!0),d("span",La,[ue(i.$slots,"default",{},void 0,!0)])],4))}}),K=(t,e)=>{const a=t.__vccOpts||t;for(const[r,o]of e)a[r]=o;return a},ke=K(Da,[["__scopeId","data-v-d2ce91a5"]]);class Ga{constructor(e){s(this,"id");s(this,"name","GerÃ¤t");s(this,"power",0);s(this,"status","off");s(this,"energy",0);s(this,"runningTime",0);s(this,"configured",!1);s(this,"_showInGraph",!0);s(this,"color","white");s(this,"canSwitch",!1);s(this,"countAsHouse",!1);s(this,"energyPv",0);s(this,"energyBat",0);s(this,"pvPercentage",0);s(this,"tempConfigured",0);s(this,"temp",[300,300,300]);s(this,"on",!1);s(this,"isAutomatic",!0);s(this,"icon","");this.id=e}get showInGraph(){return this._showInGraph}set showInGraph(e){this._showInGraph=e,R()}setShowInGraph(e){this._showInGraph=e}}const A=F({});function Ut(t){t in A?console.info("Duplicate sh device message: "+t):(A[t]=new Ga(t),A[t].color="var(--color-sh"+Object.values(A).length+")")}class Va{constructor(){s(this,"graphToShow","powermeter");s(this,"cpToShow",0);s(this,"displayLocked",!0);s(this,"_showRelativeArcs",!1);s(this,"showTodayGraph",!0);s(this,"_graphPreference","live");s(this,"_usageStackOrder",0);s(this,"_displayMode","dark");s(this,"_showGrid",!1);s(this,"_smartHomeColors","normal");s(this,"_decimalPlaces",1);s(this,"_showQuickAccess",!0);s(this,"_simpleCpList",!1);s(this,"_shortCpList","no");s(this,"_showAnimations",!0);s(this,"_preferWideBoxes",!1);s(this,"_maxPower",4e3);s(this,"_fluidDisplay",!1);s(this,"_showClock","no");s(this,"_showButtonBar",!0);s(this,"_showCounters",!1);s(this,"_showVehicles",!1);s(this,"_showPrices",!1);s(this,"_debug",!1);s(this,"isEtEnabled",!1);s(this,"etPrice",20.5);s(this,"showRightButton",!0);s(this,"showLeftButton",!0);s(this,"animationDuration",300);s(this,"animationDelay",100);s(this,"zoomGraph",!1)}get showRelativeArcs(){return this._showRelativeArcs}set showRelativeArcs(e){this._showRelativeArcs=e,R()}setShowRelativeArcs(e){this._showRelativeArcs=e}get graphPreference(){return this._graphPreference}set graphPreference(e){this._graphPreference=e,R()}setGraphPreference(e){this._graphPreference=e}get usageStackOrder(){return this._usageStackOrder}set usageStackOrder(e){this._usageStackOrder=e,R()}setUsageStackOrder(e){this._usageStackOrder=e}get displayMode(){return this._displayMode}set displayMode(e){this._displayMode=e,Na(e)}setDisplayMode(e){this._displayMode=e}get showGrid(){return this._showGrid}set showGrid(e){this._showGrid=e,R()}setShowGrid(e){this._showGrid=e}get decimalPlaces(){return this._decimalPlaces}set decimalPlaces(e){this._decimalPlaces=e,R()}setDecimalPlaces(e){this._decimalPlaces=e}get smartHomeColors(){return this._smartHomeColors}set smartHomeColors(e){this._smartHomeColors=e,Pt(e),R()}setSmartHomeColors(e){this._smartHomeColors=e,Pt(e)}get showQuickAccess(){return this._showQuickAccess}set showQuickAccess(e){this._showQuickAccess=e,R()}setShowQuickAccess(e){this._showQuickAccess=e}get simpleCpList(){return this._simpleCpList}set simpleCpList(e){this._simpleCpList=e,R()}setSimpleCpList(e){this._simpleCpList=e}get shortCpList(){return this._shortCpList}set shortCpList(e){this._shortCpList=e,R()}setShortCpList(e){this._shortCpList=e}get showAnimations(){return this._showAnimations}set showAnimations(e){this._showAnimations=e,R()}setShowAnimations(e){this._showAnimations=e}get preferWideBoxes(){return this._preferWideBoxes}set preferWideBoxes(e){this._preferWideBoxes=e,R()}setPreferWideBoxes(e){this._preferWideBoxes=e}get maxPower(){return this._maxPower}set maxPower(e){this._maxPower=e,R()}setMaxPower(e){this._maxPower=e}get fluidDisplay(){return this._fluidDisplay}set fluidDisplay(e){this._fluidDisplay=e,R()}setFluidDisplay(e){this._fluidDisplay=e}get showClock(){return this._showClock}set showClock(e){this._showClock=e,R()}setShowClock(e){this._showClock=e}get debug(){return this._debug}set debug(e){this._debug=e,R()}setDebug(e){this._debug=e}get showButtonBar(){return this._showButtonBar}set showButtonBar(e){this._showButtonBar=e,R()}setShowButtonBar(e){this._showButtonBar=e}get showCounters(){return this._showCounters}set showCounters(e){this._showCounters=e,R()}setShowCounters(e){this._showCounters=e}get showVehicles(){return this._showVehicles}set showVehicles(e){this._showVehicles=e,R()}setShowVehicles(e){this._showVehicles=e}get showPrices(){return this._showPrices}set showPrices(e){this._showPrices=e,R()}setShowPrices(e){this._showPrices=e}}const m=F(new Va),Ea=992,pt=F({x:document.documentElement.clientWidth,y:document.documentElement.clientHeight});function Wa(){pt.x=document.documentElement.clientWidth,pt.y=document.documentElement.clientHeight}p(()=>pt.x>=Ea);const Te={stop:{mode:de.stop,name:"Stop",color:"var(--color-fg)",icon:"fa-power-off"},standby:{mode:de.standby,name:"Standby",color:"var(--color-axis",icon:"fa-pause"},pv_charging:{mode:de.pv_charging,name:"PV",color:"var(--color-pv",icon:"fa-solar-panel"},scheduled_charging:{mode:de.scheduled_charging,name:"Zielladen",color:"var(--color-battery)",icon:"fa-bullseye"},instant_charging:{mode:de.instant_charging,name:"Sofort",color:"var(--color-charging)",icon:"fa-bolt"}};function R(){ja()}function Na(t){const e=ge("html");e.classed("theme-dark",t=="dark"),e.classed("theme-light",t=="light"),e.classed("theme-blue",t=="blue"),R()}function Pt(t){const e=ge("html");e.classed("shcolors-normal",t=="normal"),e.classed("shcolors-standard",t=="standard"),e.classed("shcolors-advanced",t=="advanced")}function ja(){const t={};t.hideSH=Object.values(A).filter(e=>!e.showInGraph).map(e=>e.id),t.showLG=m.graphPreference=="live",t.displayM=m.displayMode,t.stackO=m.usageStackOrder,t.showGr=m.showGrid,t.decimalP=m.decimalPlaces,t.smartHomeC=m.smartHomeColors,t.relPM=m.showRelativeArcs,t.maxPow=m.maxPower,t.showQA=m.showQuickAccess,t.simpleCP=m.simpleCpList,t.shortCP=m.shortCpList,t.animation=m.showAnimations,t.wideB=m.preferWideBoxes,t.fluidD=m.fluidDisplay,t.clock=m.showClock,t.showButtonBar=m.showButtonBar,t.showCounters=m.showCounters,t.showVehicles=m.showVehicles,t.showPrices=m.showPrices,t.debug=m.debug,document.cookie="openWBColorTheme="+JSON.stringify(t)+";max-age=16000000;samesite=strict"}const We=t=>(xe("data-v-126005ae"),t=t(),Pe(),t),za={class:"navigation"},Ua={class:"graphbuttons"},Fa={class:"timedisplay"},Ja={class:"cpbuttons"},Ra=We(()=>d("span",{class:"fas fa-arrow-left px-2"},null,-1)),Ha=We(()=>d("span",{class:"fas fa-charging-station pe-2"},null,-1)),Ya=We(()=>d("span",{class:"fas fa-lock px-4"},null,-1)),Qa=We(()=>d("span",{class:"fas fa-charging-station px-2"},null,-1)),qa=We(()=>d("span",{class:"fas fa-arrow-right pe-2"},null,-1)),Xa=T({__name:"NavigationBar",setup(t){let e;function a(){let u=Object.values(_).length;m.cpToShow=(m.cpToShow+1)%u}function r(){let u=Object.values(_).length;m.cpToShow=((m.cpToShow-1)%u+u)%u}function o(){m.graphToShow="powermeter"}function i(){m.graphToShow="powergraph"}function l(){m.graphToShow="energymeter"}return Ke(()=>{e=setInterval(()=>{xt.value=new Date},1e3)}),ca(()=>{clearInterval(e)}),(u,h)=>(g(),b("div",za,[d("span",Ua,[d("span",Fa,O(n(fa)(n(xt))),1),M(ke,{icon:"fa-chart-pie",onClick:o},{default:P(()=>[z("Leistung")]),_:1}),M(ke,{icon:"fa-chart-line",onClick:i},{default:P(()=>[z("Verlauf")]),_:1}),M(ke,{icon:"fa-chart-column",onClick:l},{default:P(()=>[z("Energie")]),_:1})]),M(ke,{icon:"fa-rectangle-list","data-bs-toggle":"modal","data-bs-target":"#statuspage"},{default:P(()=>[z("Status")]),_:1}),d("span",Ja,[M(ke,{color:"var(--color-cp0)",onClick:r},{default:P(()=>[Ra,Ha]),_:1}),M(ke,{bgcolor:n(te).locked?"var(--color-evu)":"var(--color-pv)",onClick:n(ht)},{default:P(()=>[Ya]),_:1},8,["bgcolor","onClick"]),M(ke,{color:"var(--color-cp0)",onClick:a},{default:P(()=>[Qa,qa]),_:1})])]))}}),Za=K(Xa,[["__scopeId","data-v-126005ae"]]),Ka=["origin"],er=T({__name:"PMSourceArc",props:{radius:{},cornerRadius:{},circleGapSize:{},emptyPower:{}},setup(t){const e=t,a=p(()=>{let r={name:"",power:e.emptyPower,energy:0,energyPv:0,energyBat:0,pvPercentage:0,color:"var(--color-bg)",icon:""},o=G;o["zz-empty"]=r;const i=Object.values(G).length-1,l=Lt().value(f=>f.power).startAngle(-Math.PI/2+e.circleGapSize).endAngle(Math.PI/2-e.circleGapSize).sort(null),u=Dt().innerRadius(e.radius/6*5).outerRadius(e.radius).cornerRadius(e.cornerRadius).padAngle(0),h=ge("g#pmSourceArc");return h.selectAll("*").remove(),h.selectAll("sources").data(l(Object.values(o))).enter().append("path").attr("d",u).attr("fill",f=>f.data.color).attr("stroke",(f,v)=>v==i?f.data.power>0?"var(--color-scale)":"null":f.data.color),"pmSourceArc.vue"});return la(()=>{let r=G.pv.power+G.evuIn.power+G.batOut.power;r>m.maxPower&&(m.maxPower=r)}),(r,o)=>(g(),b("g",{id:"pmSourceArc",origin:a.value},null,8,Ka))}}),tr=["origin"],ar=T({__name:"PMUsageArc",props:{radius:{},cornerRadius:{},circleGapSize:{},emptyPower:{}},setup(t){const e=t,a=p(()=>{let r={name:"",power:e.emptyPower,energy:0,energyPv:0,energyBat:0,pvPercentage:0,color:"var(--color-bg)",icon:""};const o=[I.evuOut,I.charging].concat(Object.values(A).filter(f=>f.configured&&!f.countAsHouse).sort((f,v)=>v.power-f.power)).concat([I.batIn,I.house]).concat(r),i=o.length-1,l=Lt().value(f=>f.power).startAngle(Math.PI*1.5-e.circleGapSize).endAngle(Math.PI/2+e.circleGapSize).sort(null),u=Dt().innerRadius(e.radius/6*5).outerRadius(e.radius).cornerRadius(e.cornerRadius),h=ge("g#pmUsageArc");return h.selectAll("*").remove(),h.selectAll("consumers").data(l(o)).enter().append("path").attr("d",u).attr("fill",f=>f.data.color).attr("stroke",(f,v)=>v==i?f.data.power>0?"var(--color-scale)":"null":f.data.color),"pmUsageArc.vue"});return(r,o)=>(g(),b("g",{id:"pmUsageArc",origin:a.value},null,8,tr))}}),Ft=T({__name:"FormatWatt",props:{watt:{}},setup(t){const e=t,a=p(()=>Je(e.watt,m.decimalPlaces));return(r,o)=>O(a.value)}}),rr={key:0,id:"pmLabel"},or=["x","y","fill","text-anchor"],nr=22,he=T({__name:"PMLabel",props:{x:{},y:{},data:{},props:{},anchor:{},labeltext:{},labelicon:{},labelcolor:{}},setup(t){const e=t,a=p(()=>e.labeltext?e.labeltext:e.props?e.props.icon+" ":e.labelicon?e.labelicon+" ":""),r=p(()=>e.labelcolor?e.labelcolor:e.props?e.props.color:""),o=p(()=>!e.data||e.data.power>0),i=p(()=>e.labeltext?"":"fas");return(l,u)=>o.value?(g(),b("g",rr,[d("text",{x:l.x,y:l.y,fill:r.value,"text-anchor":l.anchor,"font-size":nr,class:"pmLabel"},[d("tspan",{class:q(i.value)},O(a.value),3),d("tspan",null,[l.data!==void 0?(g(),E(Ft,{key:0,watt:l.data.power},null,8,["watt"])):$("",!0)])],8,or)])):$("",!0)}}),sr={class:"wb-widget p-0 m-0 shadow"},ir={class:"d-flex justify-content-between"},cr={class:"m-4 me-0 mb-0"},lr=d("div",{class:"p-0"},"(title goes here)",-1),ur={class:"p-4 pb-0 ps-0 m-0",style:{"text-align":"right"}},dr={class:"px-4 pt-4 pb-2 wb-subwidget"},hr={class:"row"},pr={class:"col m-0 p-0"},gr={class:"container-fluid m-0 p-0"},mr={key:0},fr=d("hr",null,null,-1),vr={class:"px-4 py-2 wb-subwidget"},yr={class:"row"},_r={class:"col"},br={class:"container-fluid m-0 p-0"},et=T({__name:"WBWidget",props:{variableWidth:{type:Boolean},fullWidth:{type:Boolean}},setup(t){const e=t,a=p(()=>e.fullWidth?"col-12":e.variableWidth&&m.preferWideBoxes?"col-lg-6":"col-lg-4");return(r,o)=>(g(),b("div",{class:q(["p-2 m-0 d-flex",a.value])},[d("div",sr,[d("div",ir,[d("h3",cr,[ue(r.$slots,"title",{},()=>[lr]),ue(r.$slots,"subtitle")]),d("div",ur,[ue(r.$slots,"buttons")])]),d("div",dr,[d("div",hr,[d("div",pr,[d("div",gr,[ue(r.$slots,"default")])])])]),r.$slots.footer!=null?(g(),b("div",mr,[fr,d("div",vr,[d("div",yr,[d("div",_r,[d("div",br,[ue(r.$slots,"footer")])])])])])):$("",!0)])],2))}});class wr{constructor(){s(this,"active",!1);s(this,"etPriceList",new Map);s(this,"etProvider","");s(this,"etMaxPrice",0)}get etCurrentPriceString(){const[e]=re.etPriceList.values();return(Math.round(e*10)/10).toFixed(1)+" ct"}}const re=F(new wr),Sr={id:"powermeter",class:"p-0 m-0"},kr=["viewBox"],Mr=["transform"],xr={transform:"scale(0.9294,1)"},Pr=["x"],fe=500,ve=20,It=1,Ir=T({__name:"PowerMeter",setup(t){const e=fe,a=Math.PI/40,r=[[4],[4,6],[1,4,6],[0,2,4,6],[0,2,3,5,6]],o=[{x:-85,y:e/2*1/5},{x:0,y:e/2*1/5},{x:85,y:e/2*1/5},{x:-85,y:e/2*2/5},{x:0,y:e/2*2/5},{x:85,y:e/2*2/5},{x:0,y:e/2*3/5}],i=p(()=>fe/2-ve),l=p(()=>{let S="",N=Object.values(G).filter(V=>V.power>0);return N.length==1&&N[0].name=="PV"?S="Aktueller Verbrauch: ":S="Bezug/Verbrauch: ",S+Je(I.house.power+I.charging.power+I.devices.power+I.batIn.power,m.decimalPlaces)}),u=p(()=>{let S=G.pv.power+G.evuIn.power+G.batOut.power;return m.maxPower>S?Je(m.maxPower,m.decimalPlaces):Je(S,m.decimalPlaces)}),h=p(()=>Object.values(_)),f=p(()=>{let S=0;return m.showRelativeArcs&&(S=m.maxPower-(G.pv.power+G.evuIn.power+G.batOut.power)),S<0?0:S}),v=p(()=>[I.evuOut,I.charging,I.devices,I.batIn,I.house].filter(S=>S.power>0)),W=p(()=>r[v.value.length-1]);function w(S){return o[W.value[S]]}function Q(S){return Math.round(h.value[S].soc)}function Z(S){return S.length>12?S.slice(0,11)+".":S}const me=p(()=>{const[S]=re.etPriceList.values();return Math.round(S*10)/10});return(S,N)=>(g(),E(et,{"full-width":!0},{title:P(()=>[z(" Aktuelle Leistung ")]),default:P(()=>[d("figure",Sr,[(g(),b("svg",{viewBox:"0 0 "+fe+" "+n(e)},[d("g",{transform:"translate("+fe/2+","+n(e)/2+")"},[d("g",xr,[M(er,{radius:i.value,"corner-radius":It,"circle-gap-size":a,"empty-power":f.value},null,8,["radius","empty-power"]),M(ar,{"sh-device":n(A),radius:i.value,"corner-radius":It,"circle-gap-size":a,"empty-power":f.value},null,8,["sh-device","radius","empty-power"]),M(he,{x:0,y:-n(e)/10*2,data:n(G).pv,props:n(ee).pv,anchor:"middle",config:n(m)},null,8,["y","data","props","config"]),M(he,{x:0,y:-n(e)/10*3,data:n(G).evuIn,props:n(ee).evuIn,anchor:"middle",config:n(m)},null,8,["y","data","props","config"]),M(he,{x:0,y:-n(e)/10,data:n(G).batOut,props:n(ee).batOut,anchor:"middle",config:n(m)},null,8,["y","data","props","config"]),n(re).active?(g(),E(he,{key:0,x:0,y:-n(e)/10,data:n(G).batOut,props:n(ee).batOut,anchor:"middle",config:n(m)},null,8,["y","data","props","config"])):$("",!0),(g(!0),b(Ie,null,Be(v.value,(V,C)=>(g(),E(he,{key:C,x:w(C).x,y:w(C).y,data:V,labelicon:V.icon,labelcolor:V.color,anchor:"middle",config:n(m)},null,8,["x","y","data","labelicon","labelcolor","config"]))),128)),h.value.length>0&&n(j)[h.value[0].connectedVehicle]?(g(),E(he,{key:1,x:-fe/2-ve/4+10,y:-n(e)/2+ve+5,labeltext:Z(n(j)[h.value[0].connectedVehicle].name)+": "+Q(0)+"%",labelcolor:h.value[0].color,anchor:"start",config:n(m)},null,8,["x","y","labeltext","labelcolor","config"])):$("",!0),h.value.length>1&&n(j)[h.value[1].connectedVehicle]?(g(),E(he,{key:2,x:fe/2+ve/4-10,y:-n(e)/2+ve+5,labeltext:Z(n(j)[h.value[1].connectedVehicle].name)+": "+Q(1)+"%",labelcolor:h.value[1].color,anchor:"end",config:n(m)},null,8,["x","y","labeltext","labelcolor","config"])):$("",!0),n(U).batterySoc>0?(g(),E(he,{key:3,x:-fe/2-ve/4+10,y:n(e)/2-ve+15,labeltext:"Speicher: "+n(U).batterySoc+"%",labelcolor:n(I).batIn.color,anchor:"start",config:n(m)},null,8,["x","y","labeltext","labelcolor","config"])):$("",!0),n(re).active?(g(),E(he,{key:4,x:fe/2+ve/4-10,y:n(e)/2-ve+15,value:me.value,labeltext:n(re).etCurrentPriceString,labelcolor:"var(--color-charging)",anchor:"end",config:n(m)},null,8,["x","y","value","labeltext","config"])):$("",!0),M(he,{x:0,y:0,labeltext:l.value,labelcolor:"var(--color-fg)",anchor:"middle",config:n(m)},null,8,["labeltext","config"]),n(m).showRelativeArcs?(g(),b("text",{key:5,x:fe/2-44,y:"2","text-anchor":"middle",fill:"var(--color-axis)","font-size":"12"}," Peak: "+O(u.value),9,Pr)):$("",!0)])],8,Mr)],8,kr))])]),_:1}))}}),ye=500,Se=500,B={top:10,right:20,bottom:10,left:25},yt=["charging","house","batIn","devices"];class $r{constructor(){s(this,"data",[]);s(this,"_graphMode","")}get graphMode(){return this._graphMode}set graphMode(e){this._graphMode=e}}const c=F(new $r);let Xe=!0,Ve=!0;function $t(){Xe=!1}function Ct(){Ve=!1}function Cr(t){Ve=t}function Ne(t){c.data=t}const Y=F({refreshTopicPrefix:"openWB/graph/alllivevaluesJson",updateTopic:"openWB/graph/lastlivevaluesJson",configTopic:"openWB/graph/config/#",initialized:!1,initCounter:0,graphRefreshCounter:0,rawDataPacks:[],duration:0,activate(){c.data=[],this.unsubscribeUpdates(),this.subscribeRefresh(),$e(this.configTopic),this.initialized=!1,this.initCounter=0,this.graphRefreshCounter=0,this.rawDataPacks=[],Lr(),qe.value=!0},deactivate(){this.unsubscribeRefresh(),this.unsubscribeUpdates(),Oe(this.configTopic)},subscribeRefresh(){for(let t=1;t<17;t++)$e(this.refreshTopicPrefix+t)},unsubscribeRefresh(){for(let t=1;t<17;t++)Oe(this.refreshTopicPrefix+t)},subscribeUpdates(){$e(this.updateTopic)},unsubscribeUpdates(){Oe(this.updateTopic)}}),J=F({topic:"openWB/log/daily/#",date:new Date,activate(){if(c.graphMode=="day"||c.graphMode=="today"){c.graphMode=="today"&&(this.date=new Date);const t=this.date.getFullYear().toString()+(this.date.getMonth()+1).toString().padStart(2,"0")+this.date.getDate().toString().padStart(2,"0");$e(this.topic),ft({command:"getDailyLog",data:{day:t}})}},deactivate(){Oe(this.topic)},back(){this.date=new Date(this.date.setTime(this.date.getTime()-864e5))},forward(){this.date=new Date(this.date.setTime(this.date.getTime()+864e5))},setDate(t){this.date=t},getDate(){return this.date}}),be=F({topic:"openWB/log/monthly/#",month:new Date().getMonth()+1,year:new Date().getFullYear(),activate(){const t=this.year.toString()+this.month.toString().padStart(2,"0");c.data=[],$e(this.topic),ft({command:"getMonthlyLog",data:{month:t}})},deactivate(){Oe(this.topic)},back(){this.month-=1,this.month<1&&(this.month=12,this.year-=1),this.activate()},forward(){const t=new Date;t.getFullYear()==this.year?this.month-1<t.getMonth()&&(this.month=this.month+1):(this.month=this.month+1,this.month>12&&(this.month=1,this.year+=1)),this.activate()},getDate(){return new Date(this.year,this.month)}}),Me=F({topic:"openWB/log/yearly/#",month:new Date().getMonth()+1,year:new Date().getFullYear(),activate(){const t=this.year.toString();c.data=[],$e(this.topic),ft({command:"getYearlyLog",data:{year:t}})},deactivate(){Oe(this.topic)},back(){this.year-=1,this.activate()},forward(){this.year<new Date().getFullYear()&&(this.year=this.year+1,this.activate())},getDate(){return new Date(this.year,this.month)}});function X(t=!1){switch(c.graphMode==""?Or(m.graphPreference):c.graphMode=="live"?m.graphPreference="live":m.graphPreference="today",t||(Xe=!0,Ve=!0),c.graphMode){case"live":J.deactivate(),be.deactivate(),Me.deactivate(),Y.activate();break;case"today":Y.deactivate(),be.deactivate(),Me.deactivate(),J.activate();break;case"day":Y.deactivate(),be.deactivate(),Me.deactivate(),J.activate();break;case"month":Y.deactivate(),J.deactivate(),Me.deactivate(),be.activate();break;case"year":Y.deactivate(),J.deactivate(),be.deactivate(),Me.activate();break}}function Or(t){c.graphMode=t}function Br(t,e){e[t]>0&&(k.items[t].energyPv+=1e3/12*(e[t]*(e.pv-e.evuOut))/(e.pv-e.evuOut+e.evuIn+e.batOut),k.items[t].energyBat+=1e3/12*(e[t]*e.batOut)/(e.pv-e.evuOut+e.evuIn+e.batOut))}function Tr(t,e){e[t]>0&&(k.items[t].energyPv+=1e3*(e[t]*(e.pv-e.evuOut))/(e.pv-e.evuOut+e.evuIn+e.batOut),k.items[t].energyBat+=1e3*(e[t]*e.batOut)/(e.pv-e.evuOut+e.evuIn+e.batOut))}const Ar=["evuIn","pv","batIn","evuOut"],De=we(!1);function _t(t,e){Object.entries(t).length>0?(De.value=!1,Object.entries(t.counter).forEach(([a,r])=>{(e.length==0||e.includes(a))&&(k.items.evuIn.energy+=r.energy_imported,k.items.evuOut.energy+=r.energy_exported)}),k.items.pv.energy=t.pv.all.energy_exported,t.bat.all&&(k.items.batIn.energy=t.bat.all.energy_imported,k.items.batOut.energy=t.bat.all.energy_exported),Object.entries(t.cp).forEach(([a,r])=>{a=="all"?k.setEnergy("charging",r.energy_imported):k.setEnergy(a,r.energy_imported)}),k.setEnergy("devices",0),Object.entries(t.sh).forEach(([a,r])=>{k.setEnergy(a,r.energy_imported);const o=a.substring(2);A[+o].countAsHouse||(k.items.devices.energy+=r.energy_imported)}),t.hc&&t.hc.all?k.setEnergy("house",t.hc.all.energy_imported):k.calculateHouseEnergy(),k.keys().map(a=>{Ar.includes(a)||(k.setPvPercentage(a,Math.round((k.items[a].energyPv+k.items[a].energyBat)/k.items[a].energy*100)),yt.includes(a)&&(I[a].energy=k.items[a].energy,I[a].energyPv=k.items[a].energyPv,I[a].energyBat=k.items[a].energyBat,I[a].pvPercentage=k.items[a].pvPercentage))}),c.graphMode=="today"&&(Object.values(_).map(a=>{const r=k.items["cp"+a.id];r&&(a.energyPv=r.energyPv,a.energyBat=r.energyBat,a.pvPercentage=r.pvPercentage)}),Object.values(A).map(a=>{const r=k.items["sh"+a.id];r&&(a.energy=r.energy,a.energyPv=r.energyPv,a.energyBat=r.energyBat,a.pvPercentage=r.pvPercentage)}))):De.value=!0,qe.value=!0}function Lr(){k.keys().map(t=>{yt.includes(t)&&(I[t].energy=k.items[t].energy,I[t].energyPv=0,I[t].energyBat=0,I[t].pvPercentage=0)}),Object.values(_).map(t=>{t.energyPv=0,t.energyBat=0,t.pvPercentage=0}),Object.values(A).map(t=>{t.energyPv=0,t.energyBat=0,t.pvPercentage=0})}const pe=p(()=>{const t=Ee(c.data,e=>e.date);return t[1]?ut().domain(Array.from({length:t[1]},(e,a)=>a+1)).paddingInner(.4).range([0,ye-B.left-2]):ut().range([0,0])});function bt(){switch(c.graphMode){case"live":c.graphMode="today",m.showRightButton=!0,X();break;case"today":c.graphMode="day",J.date=new Date,J.back(),X();break;case"day":J.back(),X();break;case"month":be.back();break;case"year":Me.back();break}}function Jt(){const t=new Date;switch(c.graphMode){case"live":break;case"today":c.graphMode="live",m.showRightButton=!1,X();break;case"day":J.forward(),J.date.getDate()==t.getDate()&&J.date.getMonth()==t.getMonth()&&J.date.getFullYear()==t.getFullYear()&&(c.graphMode="today"),X();break;case"month":be.forward();break;case"year":Me.forward();break}}function Rt(){switch(c.graphMode){case"live":bt();break;case"day":case"today":c.graphMode="month",X();break;case"month":c.graphMode="year",X();break}}function Ht(){switch(c.graphMode){case"year":c.graphMode="month",X();break;case"month":c.graphMode="today",X();break;case"today":case"day":c.graphMode="live",X();break}}function Dr(t){if(c.graphMode=="day"||c.graphMode=="today"){J.setDate(t);const e=new Date;J.date.getDate()==e.getDate()&&J.date.getMonth()==e.getMonth()&&J.date.getFullYear()==e.getFullYear()?c.graphMode="today":c.graphMode="day",X()}}const Gr=["origin","transform"],Vr=T({__name:"PGSourceGraph",props:{width:{},height:{},margin:{}},setup(t){const e=t,a={house:"var(--color-house)",batIn:"var(--color-battery)",inverter:"var(--color-pv)",batOut:"var(--color-battery)",selfUsage:"var(--color-pv)",evuOut:"var(--color-export)",evuIn:"var(--color-evu)"};var r,o;const i=m.showAnimations?m.animationDuration:0,l=m.showAnimations?m.animationDelay:0,u=p(()=>{const y=ge("g#pgSourceGraph");c.graphMode=="month"||c.graphMode=="year"?C(y):V(y),y.selectAll(".axis").remove();const x=y.append("g").attr("class","axis");return x.call(me.value),x.selectAll(".tick").attr("font-size",12),x.selectAll(".tick line").attr("stroke",N.value).attr("stroke-width",S.value),x.select(".domain").attr("stroke","var(--color-bg)"),"pgSourceGraph.vue"}),h=p(()=>c.graphMode=="month"||c.graphMode=="year"?["evuIn","batOut","selfUsage","evuOut"]:["selfUsage","evuOut","batOut","evuIn"]),f=p(()=>Ce().domain([0,c.data.length-1]).range([0,e.width])),v=p(()=>Gt().keys(h.value)),W=p(()=>v.value(c.data)),w=p(()=>Ce().range([e.height-10,0]).domain(c.graphMode=="year"?[0,Math.ceil(Q.value[1]*10)/10]:[0,Math.ceil(Q.value[1])])),Q=p(()=>{let y=Ee(c.data,x=>Math.max(x.pv+x.evuIn+x.batOut,x.selfUsage+x.evuOut));return y[0]!=null&&y[1]!=null?(c.graphMode=="year"&&(y[0]=y[0]/1e3,y[1]=y[1]/1e3),y):[0,0]}),Z=p(()=>c.graphMode=="month"||c.graphMode=="year"?-e.width-e.margin.right-22:-e.width),me=p(()=>gt(w.value).tickSizeInner(Z.value).ticks(4).tickFormat(y=>(y==0?"":Math.round(y*10)/10).toLocaleString(void 0))),S=p(()=>m.showGrid?"0.5":"1"),N=p(()=>m.showGrid?"var(--color-grid)":"var(--color-bg)");function V(y){const x=Re().x((D,le)=>f.value(le)).y(w.value(0)),L=Re().x((D,le)=>f.value(le)).y0(D=>w.value(c.graphMode=="year"?D[0]/1e3:D[0])).y1(D=>w.value(c.graphMode=="year"?D[1]/1e3:D[1]));Xe?(y.selectAll("*").remove(),r=y.selectAll(".sourceareas").data(W.value).enter().append("path").attr("fill",(D,le)=>a[h.value[le]]).attr("d",D=>x(D)),r.transition().duration(i).delay(l).ease(Le).attr("d",D=>L(D)),$t()):r.data(W.value).transition().duration(0).ease(Le).attr("d",D=>L(D))}function C(y){Xe?(y.selectAll("*").remove(),o=y.selectAll(".sourcebar").data(W.value).enter().append("g").attr("fill",(x,L)=>a[h.value[L]]).selectAll("rect").data(x=>x).enter().append("rect").attr("x",(x,L)=>pe.value(c.data[L].date)??0).attr("y",()=>w.value(0)).attr("height",0).attr("width",pe.value.bandwidth()),o.transition().duration(i).delay(l).ease(Le).attr("height",x=>c.graphMode=="year"?w.value(x[0]/1e3)-w.value(x[1]/1e3):w.value(x[0])-w.value(x[1])).attr("y",x=>c.graphMode=="year"?w.value(x[1]/1e3):w.value(x[1])),$t()):(y.selectAll("*").remove(),o=y.selectAll(".sourcebar").data(W.value).enter().append("g").attr("fill",(x,L)=>a[h.value[L]]).selectAll("rect").data(x=>x).enter().append("rect").attr("x",(x,L)=>pe.value(c.data[L].date)??0).attr("y",x=>c.graphMode=="year"?w.value(x[1]/1e3):w.value(x[1])).attr("width",pe.value.bandwidth()).attr("height",x=>c.graphMode=="year"?w.value(x[0]/1e3)-w.value(x[1]/1e3):w.value(x[0])-w.value(x[1])))}return(y,x)=>(g(),b("g",{id:"pgSourceGraph",origin:u.value,transform:"translate("+y.margin.left+","+y.margin.top+")"},null,8,Gr))}}),Er=["origin","transform"],Wr=T({__name:"PGUsageGraph",props:{width:{},height:{},margin:{},stackOrder:{}},setup(t){const e=t,a=[["house","charging","devices","batIn"],["charging","devices","house","batIn"],["devices","charging","house","batIn"]],r={house:"var(--color-house)",charging:"var(--color-charging)",batIn:"var(--color-battery)",batOut:"var(--color-battery)",selfUsage:"var(--color-pv)",evuOut:"var(--color-export)",evuIn:"var(--color-evu)",cp0:"var(--color-cp0)",cp1:"var(--color-cp1)",cp2:"var(--color-cp2)",cp3:"var(--color-cp3)",sh1:"var(--color-sh1)",sh2:"var(--color-sh2)",sh3:"var(--color-sh3)",sh4:"var(--color-sh4)",devices:"var(--color-devices)"};var o,i;const l=m.showAnimations?m.animationDuration:0,u=m.showAnimations?m.animationDelay:0,h=p(()=>{const C=ge("g#pgUsageGraph");c.graphMode=="month"||c.graphMode=="year"?V(C):N(C),C.selectAll(".axis").remove();const y=C.append("g").attr("class","axis");return y.call(S.value),y.selectAll(".tick").attr("font-size",12).attr("color","var(--color-axis)"),m.showGrid?y.selectAll(".tick line").attr("stroke","var(--color-grid)").attr("stroke-width","0.5"):y.selectAll(".tick line").attr("stroke","var(--color-bg)"),y.select(".domain").attr("stroke","var(--color-bg)"),"pgUsageGraph.vue"}),f=p(()=>Gt().keys(Q.value)),v=p(()=>f.value(c.data)),W=p(()=>Ce().domain([0,c.data.length-1]).range([0,e.width])),w=p(()=>Ce().range([e.height+10,2*e.height]).domain(c.graphMode=="year"?[0,Math.ceil(Z.value[1]*10)/10]:[0,Math.ceil(Z.value[1])])),Q=p(()=>{if(c.graphMode!="today"&&c.graphMode!="day")return a[e.stackOrder];{const C=a[e.stackOrder].slice(),y=C.indexOf("charging");C.splice(y,1);const x=/cp\d+/;let L=[];return c.data.length>0&&(L=Object.keys(c.data[0]).reduce((D,le)=>(le.match(x)&&D.push(le),D),[])),L.map((D,le)=>{C.splice(y+le,0,D),r[D]="var(--color-cp"+le+")"}),C}}),Z=p(()=>{let C=Ee(c.data,y=>y.house+y.charging+y.batIn+y.devices);return C[0]!=null&&C[1]!=null?(c.graphMode=="year"&&(C[0]=C[0]/1e3,C[1]=C[1]/1e3),C):[0,0]}),me=p(()=>c.graphMode=="month"||c.graphMode=="year"?-e.width-e.margin.right-22:-e.width),S=p(()=>gt(w.value).tickSizeInner(me.value).ticks(4).tickFormat(C=>(C==0?"":Math.round(C*10)/10).toLocaleString(void 0)));function N(C){const y=Re().x((L,D)=>W.value(D)).y(w.value(0)),x=Re().x((L,D)=>W.value(D)).y0(L=>w.value(L[0])).y1(L=>w.value(L[1]));m.showAnimations?Ve?(C.selectAll("*").remove(),o=C.selectAll(".usageareas").data(v.value).enter().append("path").attr("d",L=>y(L)).attr("fill",(L,D)=>r[Q.value[D]]),o.transition().duration(300).delay(100).ease(Le).attr("d",L=>x(L)),Ct()):(C.selectAll("*").remove(),C.selectAll(".usageareas").data(v.value).enter().append("path").attr("d",L=>x(L)).attr("fill",(L,D)=>r[Q.value[D]])):(C.selectAll("*").remove(),C.selectAll(".usageareas").data(v.value).enter().append("path").attr("d",L=>x(L)).attr("fill",(L,D)=>r[Q.value[D]]))}function V(C){Ve?(C.selectAll("*").remove(),i=C.selectAll(".usagebar").data(v.value).enter().append("g").attr("fill",(y,x)=>r[a[e.stackOrder][x]]).selectAll("rect").data(y=>y).enter().append("rect").attr("x",(y,x)=>pe.value(c.data[x].date)??0).attr("y",()=>w.value(0)).attr("height",0).attr("width",pe.value.bandwidth()),i.transition().duration(l).delay(u).ease(Le).attr("y",y=>c.graphMode=="year"?w.value(y[0]/1e3):w.value(y[0])).attr("height",y=>c.graphMode=="year"?w.value(y[1]/1e3)-w.value(y[0]/1e3):w.value(y[1])-w.value(y[0])),Ct()):(C.selectAll("*").remove(),i=C.selectAll(".usagebar").data(v.value).enter().append("g").attr("fill",(y,x)=>r[a[e.stackOrder][x]]).selectAll("rect").data(y=>y).enter().append("rect").attr("x",(y,x)=>pe.value(c.data[x].date)??0).attr("y",y=>c.graphMode=="year"?w.value(y[0]/1e3):w.value(y[0])).attr("height",y=>c.graphMode=="year"?w.value(y[1]/1e3)-w.value(y[0]/1e3):w.value(y[1])-w.value(y[0])).attr("width",pe.value.bandwidth()))}return(C,y)=>(g(),b("g",{id:"pgUsageGraph",origin:h.value,transform:"translate("+C.margin.left+","+C.margin.top+")"},null,8,Er))}}),Nr=["transform"],jr=["origin","transform"],zr=["origin","transform"],Ur={key:0},Fr=["width","height"],Jr={key:1},Rr=["y","width","height"],nt=12,Hr=T({__name:"PGXAxis",props:{width:{},height:{},margin:{}},setup(t){const e=t,a=p(()=>tt(u.value).ticks(4).tickSizeInner(l.value).tickFormat(kt("%H:%M"))),r=p(()=>ua(u.value).ticks(4).tickSizeInner(l.value+3).tickFormat(kt(""))),o=p(()=>tt(pe.value).ticks(4).tickSizeInner(l.value).tickFormat(v=>v.toString())),i=p(()=>tt(pe.value).ticks(4).tickSizeInner(l.value).tickFormat(()=>"")),l=p(()=>c.graphMode!=="month"&&c.graphMode!=="year"?m.showGrid?-(e.height/2-7):-10:0),u=p(()=>{let v=Ee(c.data,W=>W.date);return v[0]&&v[1]?He().domain(v).range([0,e.width]):He().range([0,0])}),h=p(()=>{let v=ge("g#PGXAxis");return v.selectAll("*").remove(),c.graphMode=="month"||c.graphMode=="year"?v.call(o.value):v.call(a.value),v.selectAll(".tick > text").attr("fill",(W,w)=>w>0||c.graphMode=="month"||c.graphMode=="year"?"var(--color-axis)":"var(--color-bg)").attr("font-size",nt),m.showGrid?v.selectAll(".tick line").attr("stroke","var(--color-grid)").attr("stroke-width","0.5"):v.selectAll(".tick line").attr("stroke","var(--color-bg)"),v.select(".domain").attr("stroke","var(--color-bg)"),v.append("text").attr("x",-e.margin.left).attr("y",12).attr("fill","var(--color-axis)").attr("font-size",nt).text(c.graphMode=="year"?"MW":"kW").attr("text-anchor","start"),"PGXAxis.vue"}),f=p(()=>{let v=ge("g#PGXAxis2");return v.selectAll("*").remove(),c.graphMode=="month"||c.graphMode=="year"?v.call(i.value):v.call(r.value),v.selectAll(".tick > text").attr("fill",(W,w)=>w>0||c.graphMode=="month"||c.graphMode=="year"?"var(--color-axis)":"var(--color-bg)").attr("font-size",nt),m.showGrid?(v.selectAll(".tick line").attr("stroke","var(--color-grid)").attr("stroke-width","0.5"),v.select(".domain").attr("stroke","var(--color-bg)")):v.selectAll(".tick line").attr("stroke","var(--color-bg)"),v.select(".domain").attr("stroke","var(--color-bg)"),"PGXAxis2.vue"});return(v,W)=>(g(),b("g",{transform:"translate("+v.margin.left+","+v.margin.top+")"},[d("g",{id:"PGXAxis",class:"axis",origin:h.value,transform:"translate(0,"+(v.height/2-6)+")"},null,8,jr),d("g",{id:"PGXAxis2",class:"axis",origin:f.value,transform:"translate(0,"+(v.height/2+10)+")"},null,8,zr),n(m).showGrid?(g(),b("g",Ur,[d("rect",{x:"0",y:"0",width:v.width,height:v.height/2-10,fill:"none",stroke:"var(--color-grid)","stroke-width":"0.5"},null,8,Fr)])):$("",!0),n(m).showGrid?(g(),b("g",Jr,[d("rect",{x:"0",y:v.height/2+10,width:v.width,height:v.height/2-10,fill:"none",stroke:"var(--color-grid)","stroke-width":"0.5"},null,8,Rr)])):$("",!0)],8,Nr))}}),Yr=["d"],Qr=["d","stroke"],qr=["x","y","text-anchor"],st=T({__name:"PgSoc",props:{width:{},height:{},margin:{},order:{}},setup(t){const e=t,a=p(()=>{let w=Ee(c.data,Q=>Q.date);return w[0]&&w[1]?He().domain(w).range([0,e.width]):He().range([0,0])}),r=p(()=>Ce().range([e.height-10,0]).domain([0,100])),o=p(()=>da().x(Z=>a.value(Z.date)).y(Z=>r.value(e.order==2?Z.batSoc:Z["soc"+f.value.connectedVehicle])??r.value(0))(c.data)??""),i=p(()=>e.order==2?"Speicher":f.value.connectedVehicle),l=p(()=>e.order==2?"Speicher":f.value.vehicleName),u=p(()=>{switch(e.order){case 0:return"var(--color-cp1)";case 1:return"var(--color-cp2)";case 2:return"var(--color-battery)";default:return"red"}}),h=p(()=>{switch(e.order){case 0:return e.width-3;case 1:return 3;case 2:return e.width/2;default:return 0}}),f=p(()=>{const w=e.order==2?0:e.order;return Object.values(_)[w]}),v=p(()=>{if(c.data.length>0){let w;switch(e.order){case 0:return w=c.data.length-1,r.value(c.data[w]["soc"+i.value]+2);case 1:return w=0,r.value(c.data[w]["soc"+i.value]+2);case 2:return w=Math.round(c.data.length/2),r.value(c.data[w].batSoc+2);default:return 0}}else return 0}),W=p(()=>{switch(e.order){case 0:return"end";case 1:return"start";case 2:return"middle";default:return"middle"}});return(w,Q)=>(g(),b(Ie,null,[d("path",{class:"soc-baseline",d:o.value,stroke:"var(--color-bg)","stroke-width":"1",fill:"none"},null,8,Yr),d("path",{class:"soc-dashes",d:o.value,stroke:u.value,"stroke-width":"1",style:{strokeDasharray:"3,3"},fill:"none"},null,8,Qr),d("text",{class:"cpname",x:h.value,y:v.value,style:ae({fill:u.value,fontSize:10}),"text-anchor":W.value},O(l.value),13,qr)],64))}}),Xr=["transform"],Zr=T({__name:"PgSocAxis",props:{width:{},height:{},margin:{}},setup(t){const e=t,a=p(()=>Ce().range([e.height-10,0]).domain([0,100])),r=p(()=>ha(a.value).ticks(5).tickFormat(i=>i.toString()+"%"));function o(){let i=ge("g#PGSocAxis");i.call(r.value),i.selectAll(".tick").attr("font-size",12),i.selectAll(".tick line").attr("stroke","var(--color-bg)"),i.select(".domain").attr("stroke","var(--color-bg)")}return Ke(()=>{o()}),(i,l)=>(g(),b("g",{id:"PGSocAxis",class:"axis",transform:"translate("+(i.width-20)+",0)"},null,8,Xr))}}),Kr={class:"btn-group m-0",role:"group","aria-label":"radiobar"},eo=["id","value"],to=T({__name:"RadioBarInput",props:{options:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const a=t,r=e,o=p({get(){return a.modelValue},set(u){r("update:modelValue",u)}});function i(u){let h=a.options[u].color?a.options[u].color:"var(--color-fg)";return a.options[u].active?{color:"var(--color-bg)",background:h}:{color:h}}function l(u){let h=u.target;for(;h&&!h.value&&h.parentElement;)h=h.parentElement;h.value&&(o.value=h.value)}return(u,h)=>(g(),b("div",null,[d("div",Kr,[(g(!0),b(Ie,null,Be(u.options,(f,v)=>(g(),b("button",{id:"radio-"+f.value,key:v,class:q(["btn btn-outline-secondary btn-sm radiobutton mx-0 mb-0 px-2",f.value==o.value?"active":""]),value:f.value,style:ae(i(v)),onClick:l},[d("span",{style:ae(i(v)),class:"scaled"},[f.icon?(g(),b("i",{key:0,class:q(["fa-solid",f.icon])},null,2)):$("",!0),z(" "+O(f.text),1)],4)],14,eo))),128))])]))}}),Yt=K(to,[["__scopeId","data-v-60f5d4c2"]]),wt=t=>(xe("data-v-7fd067cd"),t=t(),Pe(),t),ao=wt(()=>d("i",{class:"fa-solid fa-xl fa-chevron-circle-up"},null,-1)),ro=[ao],oo=wt(()=>d("span",{class:"fa-solid fa-xl fa-chevron-circle-left arrowButton"},null,-1)),no=[oo],so={key:0,class:"fa-solid fa-xl fa-chevron-circle-down p-1",style:{color:"var(--color-bg)"}},io=wt(()=>d("span",{class:"fa-solid fa-xl fa-circle-check"},null,-1)),co=[io],lo=T({__name:"PgSelector",props:{widgetid:{},showLeftButton:{type:Boolean},showRightButton:{type:Boolean},ignoreLive:{type:Boolean}},emits:["shiftLeft","shiftRight","shiftUp","shiftDown"],setup(t){const e=t,a=we(0),r=p(()=>{switch(c.graphMode){case"live":return e.ignoreLive?"heute":`${Y.duration} min`;case"today":return"heute";case"day":return J.date.getDate()+"."+(J.date.getMonth()+1)+".";case"month":return va(be.month-1,be.year);case"year":return Me.year.toString();default:return"???"}}),o=["live","today","day","month","year"],i=["Live","Heute","Tag","Monat","Jahr"],l=p({get(){return c.graphMode},set(S){switch(S){case"day":f();break;case"today":v();break;case"live":h();break;case"month":W();break;case"year":w()}}});function u(){a.value+=1,a.value>1&&(a.value=0)}function h(){c.graphMode!="live"&&(c.graphMode="live",X())}function f(){c.graphMode!="day"&&c.graphMode!="today"&&(c.graphMode="day",X())}function v(){c.graphMode!="today"&&(c.graphMode="today",Dr(new Date),X())}function W(){c.graphMode!="month"&&(c.graphMode="month",X())}function w(){c.graphMode!="year"&&(c.graphMode="year",X())}const Q=p(()=>a.value>0?{border:"1px solid var(--color-frame)"}:""),Z=p(()=>a.value==1?"justify-content-between":"justify-content-end"),me=p(()=>a.value==1?"justify-content-between":"justify-content-center");return(S,N)=>(g(),b("div",{class:"d-flex flex-column justify-content-center pgselector rounded",style:ae(Q.value)},[a.value==2?(g(),E(Yt,{key:0,id:"pgm2",modelValue:l.value,"onUpdate:modelValue":N[0]||(N[0]=V=>l.value=V),class:"m-2",options:o.map((V,C)=>({text:i[C],value:V,color:"var(--color-menu)",active:V==n(c).graphMode}))},null,8,["modelValue","options"])):$("",!0),a.value==1?(g(),b("span",{key:1,type:"button",class:q(["arrowButton d-flex align-self-center mb-3 mt-3",{disabled:!e.showLeftButton}]),onClick:N[1]||(N[1]=V=>S.$emit("shiftUp"))},ro,2)):$("",!0),d("div",{class:q(["d-flex align-items-center",me.value])},[a.value==1?(g(),b("span",{key:0,type:"button",class:q(["p-1",{disabled:!e.showLeftButton}]),onClick:N[2]||(N[2]=V=>S.$emit("shiftLeft"))},no,2)):$("",!0),a.value<2?(g(),b("span",{key:1,type:"button",class:"btn-outline-secondary p-2 px-3 badge rounded-pill datebadge",onClick:u},O(r.value),1)):$("",!0),a.value==1?(g(),b("span",{key:2,id:"graphRightButton",type:"button",class:q(["arrowButton fa-solid fa-xl fa-chevron-circle-right p-1",{disabled:!e.showRightButton}]),onClick:N[3]||(N[3]=V=>S.$emit("shiftRight"))},null,2)):$("",!0)],2),d("div",{class:q(["d-flex align-items-center",Z.value])},[a.value==1?(g(),b("span",so)):$("",!0),a.value==1?(g(),b("span",{key:1,id:"graphLeftButton",type:"button",class:q(["arrowButton fa-solid fa-xl fa-chevron-circle-down p-1",{disabled:!e.showLeftButton}]),onClick:N[4]||(N[4]=V=>S.$emit("shiftDown"))},null,2)):$("",!0),a.value>0?(g(),b("span",{key:2,type:"button",class:"p-1",onClick:N[5]||(N[5]=V=>a.value=0)},co)):$("",!0)],2)],4))}}),Qt=K(lo,[["__scopeId","data-v-7fd067cd"]]),uo={class:"d-flex justify-content-end"},ho=["viewBox"],po=["transform"],go=2,mo="Leistung / Ladestand ",fo=T({__name:"PowerGraph",setup(t){function e(){let a=m.usageStackOrder+1;a>go&&(a=0),m.usageStackOrder=a,Cr(!0)}return(a,r)=>(g(),E(et,{"full-width":!0},{title:P(()=>[z(O(mo))]),buttons:P(()=>[d("div",uo,[M(Qt,{widgetid:"graphsettings","show-left-button":!0,"show-right-button":!0,"ignore-live":!1,onShiftLeft:n(bt),onShiftRight:n(Jt),onShiftUp:n(Rt),onShiftDown:n(Ht)},null,8,["onShiftLeft","onShiftRight","onShiftUp","onShiftDown"])])]),default:P(()=>[d("figure",{id:"powergraph",class:"p-0 m-0",onClick:e},[(g(),b("svg",{viewBox:"0 0 "+n(ye)+" "+n(Se)},[M(Vr,{width:n(ye)-n(B).left-2*n(B).right,height:(n(Se)-n(B).top-n(B).bottom)/2,margin:n(B)},null,8,["width","height","margin"]),M(Wr,{width:n(ye)-n(B).left-2*n(B).right,height:(n(Se)-n(B).top-n(B).bottom)/2,margin:n(B),"stack-order":n(m).usageStackOrder},null,8,["width","height","margin","stack-order"]),M(Hr,{width:n(ye)-n(B).left-2*n(B).right,height:n(Se)-n(B).top-n(B).bottom,margin:n(B),"graph-data":n(c)},null,8,["width","height","margin","graph-data"]),d("g",{transform:"translate("+n(B).left+","+n(B).top+")"},[(n(c).graphMode=="day"||n(c).graphMode=="today"||n(c).graphMode=="live")&&Object.values(n(_)).length>0?(g(),E(st,{key:0,width:n(ye)-n(B).left-2*n(B).right,height:(n(Se)-n(B).top-n(B).bottom)/2,margin:n(B),order:0},null,8,["width","height","margin"])):$("",!0),(n(c).graphMode=="day"||n(c).graphMode=="today"||n(c).graphMode=="live")&&Object.values(n(_)).length>1?(g(),E(st,{key:1,width:n(ye)-n(B).left-2*n(B).right,height:(n(Se)-n(B).top-n(B).bottom)/2,margin:n(B),order:1},null,8,["width","height","margin"])):$("",!0),["day","today","live"].includes(n(c).graphMode)&&n(U).isBatteryConfigured?(g(),E(st,{key:2,width:n(ye)-n(B).left-2*n(B).right,height:(n(Se)-n(B).top-n(B).bottom)/2,margin:n(B),order:2},null,8,["width","height","margin"])):$("",!0),["day","today","live"].includes(n(c).graphMode)?(g(),E(Zr,{key:3,width:n(ye)-n(B).left-n(B).right,height:(n(Se)-n(B).top-n(B).bottom)/2,margin:n(B)},null,8,["width","height","margin"])):$("",!0)],8,po)],8,ho))])]),_:1}))}}),vo=K(fo,[["__scopeId","data-v-c850f90a"]]),yo=["id"],_o=["x","width","height","fill"],bo=["x","width","height"],wo=["x","y","width","height"],So=T({__name:"EmBar",props:{item:{},xScale:{},yScale:{},margin:{},height:{},barcount:{},autarchy:{},autText:{}},setup(t){const e=t,a=p(()=>e.height-e.yScale(e.item.energy)-e.margin.top-e.margin.bottom),r=p(()=>e.item.energyPv>0?e.height-e.yScale(e.item.energyPv)-e.margin.top-e.margin.bottom:0),o=p(()=>e.item.energyPv>0?e.height-e.yScale(e.item.energyBat)-e.margin.top-e.margin.bottom:0);return(i,l)=>(g(),b("g",{id:"bar-"+e.item.name,transform:"scale(1,-1) translate (0,-445)"},[d("rect",{class:"bar",x:e.xScale(i.item.name),y:"0",width:e.xScale.bandwidth(),height:a.value,fill:i.item.color},null,8,_o),d("rect",{class:"bar",x:e.xScale(i.item.name)+e.xScale.bandwidth()/6,y:"0",width:e.xScale.bandwidth()*2/3,height:r.value,fill:"var(--color-pv)","fill-opacity":"66%"},null,8,bo),d("rect",{class:"bar",x:e.xScale(i.item.name)+e.xScale.bandwidth()/6,y:r.value,width:e.xScale.bandwidth()*2/3,height:o.value,fill:"var(--color-battery)","fill-opacity":"66%"},null,8,wo)],8,yo))}}),ko={id:"emBargraph"},Mo=d("animateTransform",{"attribute-name":"transform",type:"scale",from:"1 0",to:"1 1",begin:"0s",dur:"2s"},null,-1),xo=T({__name:"EMBarGraph",props:{plotdata:{},xScale:{},yScale:{},margin:{},height:{}},setup(t){const e=t;function a(o){if(o.name=="PV"){const i=c.graphMode=="live"||c.graphMode=="day"?G:k.items,u=(c.graphMode=="live"||c.graphMode=="day"?I:k.items).evuOut.energy,h=i.pv.energy;return Math.round((h-u)/h*100)}else if(o.name=="Netz"){const i=c.graphMode=="live"||c.graphMode=="day"?G:k.items,l=c.graphMode=="live"||c.graphMode=="day"?I:k.items,u=l.evuOut.energy,h=i.evuIn.energy,f=i.pv.energy,v=i.batOut.energy,W=l.batIn.energy;return Math.round((f+v-u-W)/(f+v+h-u-W)*100)}else return o.pvPercentage}function r(o){return o.name=="PV"?"Eigen":"Aut"}return(o,i)=>(g(),b("g",ko,[(g(!0),b(Ie,null,Be(e.plotdata,(l,u)=>(g(),b("g",{key:u},[M(So,{item:l,"x-scale":e.xScale,"y-scale":e.yScale,margin:e.margin,height:e.height,barcount:e.plotdata.length,"aut-text":r(l),autarchy:a(l)},null,8,["item","x-scale","y-scale","margin","height","barcount","aut-text","autarchy"])]))),128)),Mo]))}}),Po=["origin"],Io=T({__name:"EMYAxis",props:{yScale:{type:[Function,Object]},width:{},fontsize:{}},setup(t){const e=t,a=p(()=>gt(e.yScale).tickFormat(o=>o>0?(o/1e3).toString():"").ticks(6).tickSizeInner(-e.width)),r=p(()=>{const o=ge("g#emYAxis");return o.attr("class","axis").call(a.value),o.append("text").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("energy"),o.selectAll(".tick").attr("font-size",e.fontsize),m.showGrid?o.selectAll(".tick line").attr("stroke","var(--color-grid)").attr("stroke-width","0.5"):o.selectAll(".tick line").attr("stroke","var(--color-bg)"),o.select(".domain").attr("stroke","var(--color-bg)"),"emYAxis.vue"});return(o,i)=>(g(),b("g",{id:"emYAxis",class:"axis",origin:r.value},null,8,Po))}}),$o=["id"],Co=["x","y","font-size"],Oo=["x","y","font-size","fill"],Bo=["x","y","font-size","fill"],To=T({__name:"EmLabel",props:{item:{},xScale:{},yScale:{},margin:{},height:{},barcount:{},autarchy:{},autText:{}},setup(t){const e=t,a=p(()=>e.autarchy?e.yScale(e.item.energy)-25:e.yScale(e.item.energy)-10),r=p(()=>{let h=16,f=e.barcount;return f<=5?h=16:f==6?h=14:f>6&&f<=8?h=13:f==9?h=11:f==10?h=10:h=9,h}),o=p(()=>{let h=12,f=e.barcount;return f<=5?h=12:f==6?h=11:f>6&&f<=8||f==9?h=8:f==10?h=7:h=6,h});function i(h,f){return f.length>o.value?f.substring(0,o.value)+".":f}function l(){return e.autarchy?e.autText+": "+e.autarchy.toLocaleString(void 0)+" %":""}function u(){return"var(--color-pv)"}return(h,f)=>(g(),b("g",{id:"barlabel-"+e.item.name},[d("text",{x:e.xScale(h.item.name)+e.xScale.bandwidth()/2,y:a.value,"font-size":r.value,"text-anchor":"middle",fill:"var(--color-menu)"},O(n(Vt)(h.item.energy,n(m).decimalPlaces,!1)),9,Co),d("text",{x:e.xScale(h.item.name)+e.xScale.bandwidth()/2,y:e.yScale(h.item.energy)-10,"font-size":r.value-2,"text-anchor":"middle",fill:u()},O(l()),9,Oo),d("text",{x:e.xScale(h.item.name)+e.xScale.bandwidth()/2,y:e.height-e.margin.bottom-5,"font-size":r.value,"text-anchor":"middle",fill:h.item.color,class:q(h.item.icon.length<=2?"fas":"")},O(i(h.item.name,h.item.icon)),11,Bo)],8,$o))}}),Ao={id:"emBarLabels"},Lo=T({__name:"EMLabels",props:{plotdata:{},xScale:{},yScale:{},height:{},margin:{}},setup(t){const e=t;function a(o){if(o.name=="PV"){const i=c.graphMode=="live"||c.graphMode=="day"?G:k.items,u=(c.graphMode=="live"||c.graphMode=="day"?I:k.items).evuOut.energy,h=i.pv.energy;return Math.round((h-u)/h*100)}else if(o.name=="Netz"){const i=c.graphMode=="live"||c.graphMode=="day"?G:k.items,l=c.graphMode=="live"||c.graphMode=="day"?I:k.items,u=l.evuOut.energy,h=i.evuIn.energy,f=i.pv.energy,v=i.batOut.energy,W=l.batIn.energy;return f+v-u-W>0?Math.round((f+v-u-W)/(f+v+h-u-W)*100):0}else return o.pvPercentage}function r(o){return o.name=="PV"?"Eigen":"Aut"}return(o,i)=>(g(),b("g",Ao,[(g(!0),b(Ie,null,Be(e.plotdata,(l,u)=>(g(),b("g",{key:u},[M(To,{item:l,"x-scale":e.xScale,"y-scale":e.yScale,margin:e.margin,height:e.height,barcount:e.plotdata.length,"aut-text":r(l),autarchy:a(l)},null,8,["item","x-scale","y-scale","margin","height","barcount","aut-text","autarchy"])]))),128))]))}}),Do={id:"energymeter",class:"p-0 m-0"},Go={viewBox:"0 0 500 500"},Vo=["transform"],Eo=["x"],Wo={key:0},Ot=500,it=500,Bt=12,No="Energie",jo=T({__name:"EnergyMeter",setup(t){const e={top:25,bottom:30,left:25,right:0},a=p(()=>{let l=Object.values(G),u=i.value,h=k.values(),f=[];switch(m.debug&&(console.debug("----------------------- source summary -----------------"),console.debug(G),console.debug("----------------------- usage details ------------------"),console.debug(i.value),console.debug("----------------------- historic summary ---------------"),console.debug(k),console.debug("--------------------------------------------------------")),qe.value==!0&&(qe.value=!1),c.graphMode){default:case"live":case"today":f=l.concat(u).filter(v=>v.energy>0);break;case"day":case"month":case"year":h.length==0?De.value=!0:(De.value=!1,f=h.filter(v=>v.energy>0))}return f}),r=p(()=>ut().range([0,Ot-e.left-e.right]).domain(a.value.map(l=>l.name)).padding(.4)),o=p(()=>Ce().range([it-e.bottom-e.top,15]).domain([0,pa(a.value,l=>l.energy)])),i=p(()=>{const l=Object.values(_).length,u=Object.values(A).filter(h=>h.configured).length;return[I.evuOut,I.devices,I.charging].concat(l>1?Object.values(_).map(h=>h.toPowerItem()):[]).concat(u>1?Object.values(A).filter(h=>h.configured&&h.showInGraph):[]).concat([I.batIn,I.house])});return(l,u)=>(g(),E(et,{"full-width":!0},{title:P(()=>[z(O(No))]),buttons:P(()=>[M(Qt,{widgetid:"graphsettings","show-left-button":!0,"show-right-button":!0,"ignore-live":!0,onShiftLeft:n(bt),onShiftRight:n(Jt),onShiftUp:n(Rt),onShiftDown:n(Ht)},null,8,["onShiftLeft","onShiftRight","onShiftUp","onShiftDown"])]),default:P(()=>[d("figure",Do,[(g(),b("svg",Go,[d("g",{transform:"translate("+e.left+","+e.top+")"},[M(xo,{plotdata:a.value,"x-scale":r.value,"y-scale":o.value,height:it,margin:e},null,8,["plotdata","x-scale","y-scale"]),M(Io,{"y-scale":o.value,width:Ot,fontsize:Bt,config:n(m)},null,8,["y-scale","config"]),d("text",{x:-e.left,y:"-15",fill:"var(--color-axis)","font-size":Bt},O(n(c).graphMode=="year"?"MWh":"kWh"),9,Eo),M(Lo,{plotdata:a.value,"x-scale":r.value,"y-scale":o.value,height:it,margin:e,config:n(m)},null,8,["plotdata","x-scale","y-scale","config"])],8,Vo)]))]),n(De)?(g(),b("p",Wo,"No data")):$("",!0)]),_:1}))}}),qt=t=>(xe("data-v-07e94a61"),t=t(),Pe(),t),zo=["id"],Uo={class:"modal-dialog modal-lg modal-fullscreen-sm-down"},Fo={class:"modal-content"},Jo={class:"modal-header"},Ro={class:"modal-title scaled"},Ho=qt(()=>d("button",{type:"button",class:"btn-close buttonTextSize d-flex justify-content-center pt-3 pb-0","data-bs-dismiss":"modal"},[d("i",{class:"fa-solid fa-lg fa-circle-check m-0 p-0"})],-1)),Yo={class:"modal-body",style:{"background-color":"var(--color-fg)"}},Qo=qt(()=>d("div",{class:"modal-footer"},null,-1)),qo=T({__name:"ModalComponent",props:{modalId:{}},setup(t){const e=t;return Ke(()=>{}),(a,r)=>(g(),b("div",{id:e.modalId,class:"modal fade"},[d("div",Uo,[d("div",Fo,[d("div",Jo,[d("h3",Ro,[ue(a.$slots,"title",{},void 0,!0)]),Ho]),d("div",Yo,[ue(a.$slots,"default",{},void 0,!0)]),Qo])])],8,zo))}}),ct=K(qo,[["__scopeId","data-v-07e94a61"]]),Xo={class:"digit scaled",type:"button"},Zo=T({__name:"PadButton",props:{modelValue:{},color:{}},emits:["update:modelValue"],setup(t,{emit:e}){const a=t,r=we(!1);function o(){r.value=!0,l("update:modelValue",a.modelValue),setTimeout(()=>{r.value=!1},300)}const i=p(()=>r.value?{"background-color":"white",color:"black"}:{"background-color":a.color??"var(--color-axis)"}),l=e;return(u,h)=>(g(),b("div",{class:"padbutton",style:ae(i.value),onClick:o},[d("span",Xo,[ue(u.$slots,"default",{},void 0,!0)])],4))}}),ze=K(Zo,[["__scopeId","data-v-29589225"]]),Xt=t=>(xe("data-v-47b8fdb7"),t=t(),Pe(),t),Ko={class:"numberpad"},en={class:"codedisplay scaled"},tn={class:"numberentry"},an=Xt(()=>d("span",{class:"fas fa-delete-left"},null,-1)),rn=Xt(()=>d("span",{class:"fas fa-circle-check"},null,-1)),on=T({__name:"NumberPad",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const r=we(t.modelValue),o=e,i=p(()=>r.value.length==0?"Bitte geben Sie die PIN ein":"*".repeat(r.value.length));function l(u){u==-1?r.value=r.value.slice(0,-1):u==-2?(o("update:modelValue",r.value),r.value=""):r.value=r.value+u.toString()}return(u,h)=>(g(),b("div",Ko,[d("p",en,O(i.value),1),d("div",tn,[(g(),b(Ie,null,Be(9,f=>M(ze,{key:f,"model-value":f,"onUpdate:modelValue":l},{default:P(()=>[z(O(f),1)]),_:2},1032,["model-value"])),64)),M(ze,{"model-value":0,"onUpdate:modelValue":l},{default:P(()=>[z("0")]),_:1}),M(ze,{"model-value":-1,color:"var(--color-devices)","onUpdate:modelValue":l},{default:P(()=>[an]),_:1}),M(ze,{"model-value":-2,color:"var(--color-devices)","data-bs-dismiss":"modal","onUpdate:modelValue":l},{default:P(()=>[rn]),_:1})])]))}}),nn=K(on,[["__scopeId","data-v-47b8fdb7"]]),je=t=>(xe("data-v-ecac4e45"),t=t(),Pe(),t),sn={class:"statustable"},cn=je(()=>d("span",{class:"header"},"IP-Adresse:",-1)),ln=je(()=>d("span",{class:"header"},"Systemzeit:",-1)),un=je(()=>d("span",{class:"header"},"Version:",-1)),dn=je(()=>d("span",{class:"header"},"Version (Details):",-1)),hn=je(()=>d("span",{class:"header"},"Entwicklungszweig:",-1)),pn=T({__name:"StatusPage",setup(t){return(e,a)=>(g(),b("div",sn,[cn,d("span",null,O(n(U).ipAddress),1),ln,d("span",null,O(new Date(n(U).systemTime*1e3).toLocaleString(void 0)),1),un,d("span",null,O(n(U).version),1),dn,d("span",null,O(n(U).versionDetails),1),hn,d("span",null,O(n(U).devBranch),1)]))}}),gn=K(pn,[["__scopeId","data-v-ecac4e45"]]),mn={class:"configitem subgrid"},fn={class:"d-flex align-items-baseline m-0 p-0 grid-col-6 scaled"},vn={class:"ms-1 mb-2 p-0 pt-2 d-flex justify-content-stretch align-items-center grid-col-6"},yn={class:"justify-content-stretch d-flex"},_n=T({__name:"ConfigItem",props:{title:{},infotext:{},icon:{},iconcolor:{},fullwidth:{type:Boolean}},setup(t){const e=t;return(a,r)=>(g(),b("div",mn,[d("span",fn,[e.icon?(g(),b("i",{key:0,class:q(["fa-solid fa-sm m-0 p-0 me-2 item-icon",e.icon]),style:ae({color:e.iconcolor?e.iconcolor:"var(--color-charging)"})},null,6)):$("",!0),z(" "+O(a.title),1)]),d("div",vn,[d("span",yn,[ue(a.$slots,"default",{},void 0,!0)])])]))}}),Ae=K(_n,[["__scopeId","data-v-73b192d9"]]),bn=["id","value"],wn=T({__name:"RadioInput",props:{options:{},modelValue:{}},emits:["update:modelValue"],setup(t,{emit:e}){const a=t,r=e,o=p({get(){return a.modelValue},set(u){r("update:modelValue",u)}});function i(u){return a.options[u][2]?{color:a.options[u][2]}:{color:"var(--color-charging)"}}function l(u){let h=u.target;for(;h&&!h.value&&h.parentElement;)h=h.parentElement;h.value&&(o.value=h.value)}return(u,h)=>(g(),b("div",null,[(g(!0),b(Ie,null,Be(u.options,(f,v)=>(g(),b("button",{id:"radio-"+f[1],key:v,class:q(["btn btn-outline-secondary radiobutton me-2 mb-0 px-2",f[1]==o.value?"active":""]),value:f[1],style:ae(i(v)),onClick:l},[d("span",{style:ae(i(v)),class:"scaled"},[f[3]?(g(),b("i",{key:0,class:q(["fa-solid",f[3]])},null,2)):$("",!0),z(" "+O(f[0]),1)],4)],14,bn))),128))]))}}),lt=K(wn,[["__scopeId","data-v-18eb8489"]]),Sn={class:"form-check form-switch"},Tt=T({__name:"SwitchInput",props:{modelValue:{type:Boolean},onColor:{},offColor:{}},emits:["update:modelValue"],setup(t,{emit:e}){const a=t,r=e,o=p({get(){return a.modelValue},set(l){r("update:modelValue",l)}}),i=p(()=>o.value?{"background-color":"green","font-size":"20px"}:{"background-color":"white","font-size":"20px"});return(l,u)=>(g(),b("div",Sn,[Fe(d("input",{"onUpdate:modelValue":u[0]||(u[0]=h=>o.value=h),class:"form-check-input",type:"checkbox",role:"switch",style:ae(i.value)},null,4),[[ga,o.value]])]))}}),Zt=t=>(xe("data-v-52884c1a"),t=t(),Pe(),t),kn={class:"settingslist"},Mn=Zt(()=>d("hr",{class:"grid-col-12"},null,-1)),xn=Zt(()=>d("hr",{class:"grid-col-12"},null,-1)),Pn=T({__name:"SettingsPage",props:{chargepoint:{}},setup(t){const e=t,a=p({get:()=>e.chargepoint.etActive,set:i=>{_[e.chargepoint.id].etActive=i}}),r=p({get:()=>e.chargepoint.timedCharging,set:i=>{_[e.chargepoint.id].timedCharging=i}}),o=p({get:()=>e.chargepoint.connectedVehicle,set:i=>{_[e.chargepoint.id].connectedVehicle=i}});return(i,l)=>(g(),b("div",kn,[n(U).isBatteryConfigured?(g(),E(Ae,{key:0,title:"PV-PrioritÃ¤t (global)",icon:"fa-car-battery",iconcolor:"var(--color-battery)",infotext:"Priority during PV production",fullwidth:!0},{default:P(()=>[M(lt,{modelValue:n(U).pvBatteryPriority,"onUpdate:modelValue":l[0]||(l[0]=u=>n(U).pvBatteryPriority=u),options:n(Ba)},null,8,["modelValue","options"])]),_:1})):$("",!0),Mn,M(Ae,{title:"Fahrzeug wechseln",icon:"fa-car",fullwidth:!0},{default:P(()=>[M(lt,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=u=>o.value=u),modelModifiers:{number:!0},options:Object.values(n(j)).map(u=>[u.name,u.id])},null,8,["modelValue","options"])]),_:1}),xn,M(Ae,{title:"Strompreisbasiert laden",icon:"fa-coins",iconcolor:"var(--color-battery)",infotext:"Settings"},{default:P(()=>[M(Tt,{modelValue:a.value,"onUpdate:modelValue":l[2]||(l[2]=u=>a.value=u)},null,8,["modelValue"])]),_:1}),M(Ae,{title:"Zeitplan aktivieren",icon:"fa-clock",iconcolor:"var(--color-battery)"},{default:P(()=>[M(Tt,{modelValue:r.value,"onUpdate:modelValue":l[3]||(l[3]=u=>r.value=u)},null,8,["modelValue"])]),_:1}),M(Ae,{title:"Ladeprofil",icon:"fa-sliders",iconcolor:"var(--color-pv)"},{default:P(()=>[n(j)[o.value]?(g(),E(lt,{key:0,modelValue:n(j)[o.value].chargeTemplateId,"onUpdate:modelValue":l[4]||(l[4]=u=>n(j)[o.value].chargeTemplateId=u),modelModifiers:{number:!0},options:Object.keys(n(ce)).map(u=>[n(ce)[+u].name,u])},null,8,["modelValue","options"])):$("",!0)]),_:1})]))}}),In=K(Pn,[["__scopeId","data-v-52884c1a"]]);function $n(t,e){t=="openWB/graph/boolDisplayLiveGraph"?U.displayLiveGraph=+e==1:t.match(/^openwb\/graph\/alllivevaluesJson[1-9][0-9]*$/i)?Cn(t,e):t=="openWB/graph/lastlivevaluesJson"?On(t,e):t=="openWB/graph/config/duration"&&(Y.duration=JSON.parse(e))}function Cn(t,e){if(!Y.initialized){let a=[];const r=e.toString().split(`
`);r.length>1?a=r.map(l=>JSON.parse(l)):a=[];const o=t.match(/(\d+)$/g),i=o?o[0]:"";i!=""&&typeof Y.rawDataPacks[+i-1]>"u"&&(Y.rawDataPacks[+i-1]=a,Y.initCounter++)}if(Y.initCounter==16){const a=[];Y.unsubscribeRefresh(),Y.initialized=!0,Y.rawDataPacks.map(r=>{r.map(o=>{const i=Kt(o);a.push(i)})}),Ne(a),Y.subscribeUpdates()}}function On(t,e){const a=JSON.parse(e),r=Kt(a);Y.graphRefreshCounter++,Ne(c.data.concat(r)),Y.graphRefreshCounter>60&&Y.activate()}function Kt(t){const e=Object.values(_).length>0?Object.values(_)[0].connectedVehicle:0,a=Object.values(_).length>1?Object.values(_)[1].connectedVehicle:1,r="ev"+e+"-soc",o="ev"+a+"-soc",i={};i.date=Bn(t.time).valueOf(),+t.grid>0?(i.evuIn=+t.grid,i.evuOut=0):+t.grid<=0?(i.evuIn=0,i.evuOut=-t.grid):(i.evuIn=0,i.evuOut=0),+t["pv-all"]>=0?(i.pv=+t["pv-all"],i.inverter=0):(i.pv=0,i.inverter=-t["pv-all"]),i.house=+t["house-power"],+t["bat-all-power"]>0?(i.batOut=0,i.batIn=+t["bat-all-power"]):+t["bat-all-power"]<0?(i.batOut=-t["bat-all-power"],i.batIn=0):(i.batOut=0,i.batIn=0),t["bat-all-soc"]?i.batSoc=+t["bat-all-soc"]:i.batSoc=0,t[r]&&(i["soc"+e]=+t[r]),t[o]&&(i["soc"+a]=+t[o]),i.charging=+t["charging-all"];for(let l=0;l<10;l++){const u="cp"+l;i[u]=+(t[u+"-power"]??0)}return i.selfUsage=i.pv-i.evuOut,i.selfUsage<0&&(i.selfUsage=0),i.devices=0,i}function Bn(t){const e=new Date(Date.now()),a=864e5;let r=new Date;const o=Ye("%H:%M:%S")(t);return o&&(r=o,r.setDate(e.getDate()),r.setMonth(e.getMonth()),r.setFullYear(e.getFullYear()),r.getHours()>e.getHours()&&(r=new Date(r.getTime()-a))),r}const Tn=["evuIn","pv","batIn","evuOut"];let Ze=[];function An(t,e){const a=JSON.parse(e).entries,r=JSON.parse(e).totals;vt(),Ze=[],yt.map(i=>{k.setEnergyPv(i,0),k.setEnergyBat(i,0)});const o=Ln(a);Ne(o),_t(r,Ze),m.debug&&(console.debug("---------------------------------------- Graph Data ---------------------------"),console.debug("--- Incoming graph data:"),console.debug(a),console.debug("data to be displayed:"),console.debug(o),console.debug("-------------------------------------------------------------------------------")),c.graphMode=="today"&&setTimeout(()=>J.activate(),3e5)}function Ln(t){const e=[];let a={};return t.map(r=>{a=Dn(r);const o=a;e.push(o)}),e}function Dn(t){const e={};if(c.graphMode=="day"||c.graphMode=="today")if(typeof t.date=="number")e.date=new Date(+t.date*1e3).getTime();else{const r=Ye("%H:%M")(t.date);r&&(r.setMonth(J.date.getMonth()),r.setDate(J.date.getDate()),r.setFullYear(J.date.getFullYear()),e.date=r.getTime())}else if(typeof t.date=="string"){const r=Ye("%Y%m%d")(t.date);r&&(e.date=r.getDate())}return e.evuOut=0,e.evuIn=0,Object.entries(t.counter).forEach(([r,o])=>{o.grid&&(e.evuOut+=o.power_exported,e.evuIn+=o.power_imported,Ze.includes(r)||Ze.push(r))}),e.evuOut==0&&e.evuIn==0&&Object.entries(t.counter).forEach(r=>{e.evuOut+=r[1].power_exported,e.evuIn+=r[1].power_imported}),e.pv=t.pv.all.power_exported,Object.entries(t.bat).length>0?(e.batIn=t.bat.all.power_imported,e.batOut=t.bat.all.power_exported,e.batSoc=t.bat.all.soc??0):(e.batIn=0,e.batOut=0,e.batSoc=0),Object.entries(t.cp).forEach(([r,o])=>{r!="all"?(e[r]=o.power_imported,k.keys().includes(r)||k.addItem(r)):e.charging=o.power_imported}),Object.entries(t.ev).forEach(([r,o])=>{r!="all"&&(e["soc"+r.substring(2)]=o.soc)}),e.devices=0,Object.entries(t.sh).forEach(([r,o])=>{r!="all"&&(e[r]=o.power_imported??0,e.devices+=o.power_imported??0,k.keys().includes(r)||k.addItem(r))}),e.selfUsage=e.pv-e.evuOut,t.hc&&t.hc.all?e.house=t.hc.all.power_imported:e.house=e.evuIn+e.batOut+e.pv-e.evuOut-e.charging-e.devices-e.batOut,e.evuIn+e.batOut+e.pv>0?k.keys().filter(r=>!Tn.includes(r)).map(r=>{Br(r,e)}):Object.keys(e).map(r=>{e[r+"Pv"]=0,e[r+"Bat"]=0}),e}let Ue={};const St=["charging","house","batIn","devices"],Gn=["evuIn","pv","batIn","evuOut"];let Ge=[];function Vn(t,e){const a=JSON.parse(e).entries,r=JSON.parse(e).totals;vt(),Ge=[],St.map(o=>{k.items[o].energyPv=0,k.items[o].energyBat=0}),a.length>0&&Ne(ea(a)),_t(r,[])}function En(t,e){const a=JSON.parse(e).entries,r=JSON.parse(e).totals;vt(),Ge=[],St.forEach(o=>{k.items[o].energyPv=0,k.items[o].energyBat=0}),Ne(ea(a)),_t(r,[])}function ea(t){const e=[];let a={};return Ue={},t.map(r=>{a=Wn(r),e.push(a),Object.keys(a).forEach(o=>{o!="date"&&(a[o]<0&&(console.warn(`Negative energy value for ${o} in row ${a.date}. Ignoring the value.`),a[o]=0),Ue[o]?Ue[o]+=a[o]:Ue[o]=a[o])})}),e}function Wn(t){const e={},a=Ye("%Y%m%d")(t.date);a&&(e.date=c.graphMode=="month"?a.getDate():a.getMonth()+1),e.evuOut=0,e.evuIn=0;let r=0,o=0;return Object.entries(t.counter).forEach(([l,u])=>{r+=u.energy_exported,o+=u.energy_imported,u.grid&&(e.evuOut+=u.energy_exported,e.evuIn+=u.energy_imported,Ge.includes(l)||Ge.push(l))}),Ge.length==0&&(e.evuOut=r,e.evuIn=o),e.pv=t.pv.all.energy_exported,Object.entries(t.bat).length>0?(t.bat.all.energy_imported>=0?e.batIn=t.bat.all.energy_imported:(console.warn("ignoring negative value for batIn on day "+e.date),e.batIn=0),t.bat.all.energy_exported>=0?e.batOut=t.bat.all.energy_exported:(console.warn("ignoring negative value for batOut on day "+e.date),e.batOut=0)):(e.batIn=0,e.batOut=0),Object.entries(t.cp).forEach(([l,u])=>{l!="all"?(k.keys().includes(l)||k.addItem(l),e[l]=u.energy_imported):e.charging=u.energy_imported}),Object.entries(t.ev).forEach(([l,u])=>{l!="all"&&(e["soc-"+l]=u.soc)}),e.devices=Object.entries(t.sh).reduce((l,u)=>(k.keys().includes(u[0])||k.addItem(u[0]),u[1].energy_imported>=0?l+=u[1].energy_imported:console.warn(`Negative energy value for device ${u[0]} in row ${e.date}. Ignoring this value`),l),0),e.house=e.pv+e.evuIn+e.batOut-e.evuOut-e.batIn-e.charging,e.selfUsage=e.pv-e.evuOut,e.evuIn+e.batOut+e.pv>0?k.keys().filter(l=>!Gn.includes(l)).map(l=>{Tr(l,e)}):St.map(l=>{e[l+"Pv"]=0,e[l+"Bat"]=0}),e}class Nn{constructor(e){s(this,"id");s(this,"dailyYieldExport",0);s(this,"dailyYieldImport",0);s(this,"exported",0);s(this,"faultState",0);s(this,"faultStr","");s(this,"imported",0);s(this,"power",0);s(this,"soc",0);this.id=e}}class jn{constructor(){s(this,"dailyExport",0);s(this,"dailyImport",0);s(this,"exported",0);s(this,"imported",0);s(this,"power",0);s(this,"soc",0)}}const ne=F({});F(new jn);function zn(t){t in ne?console.info("Duplicate battery message: "+t):ne[t]=new Nn(t)}function Un(){Object.keys(ne).forEach(t=>{delete ne[parseInt(t)]})}function Fn(t,e){const a=Jn(t);if(a&&!(a in ne)){console.warn("Invalid battery index received: "+a);return}t=="openWB/bat/config/configured"?U.isBatteryConfigured=e=="true":t=="openWB/bat/get/power"?+e>0?(I.batIn.power=+e,G.batOut.power=0):(I.batIn.power=0,G.batOut.power=-e):t=="openWB/bat/get/soc"?U.batterySoc=+e:t=="openWB/bat/get/daily_exported"?G.batOut.energy=+e:t=="openWB/bat/get/daily_imported"?I.batIn.energy=+e:a&&(t.match(/^openwb\/bat\/[0-9]+\/get\/daily_yield_export$/i)?ne[a].dailyYieldExport=+e:t.match(/^openwb\/bat\/[0-9]+\/get\/daily_yield_import$/i)?ne[a].dailyYieldImport=+e:t.match(/^openwb\/bat\/[0-9]+\/get\/exported$/i)?ne[a].exported=+e:t.match(/^openwb\/bat\/[0-9]+\/get\/fault_state$/i)?ne[a].faultState=+e:t.match(/^openwb\/bat\/[0-9]+\/get\/fault_str$/i)?ne[a].faultStr=e:t.match(/^openwb\/bat\/[0-9]+\/get\/imported$/i)?ne[a].imported=+e:t.match(/^openwb\/bat\/[0-9]+\/get\/power$/i)?ne[a].power=+e:t.match(/^openwb\/bat\/[0-9]+\/get\/soc$/i)&&(ne[a].soc=+e))}function Jn(t){let e=0;try{const a=t.match(/(?:\/)([0-9]+)(?=\/)/g);return a?(e=+a[0].replace(/[^0-9]+/g,""),e):void 0}catch{console.warn("Parser error in getIndex for topic "+t)}}function Rn(t,e){if(t=="openWB/optional/et/provider")JSON.parse(e).type==null?re.active=!1:(re.active=!0,re.etProvider=JSON.parse(e).name);else if(t=="openWB/optional/et/get/prices"){const a=JSON.parse(e);re.etPriceList=new Map,Object.keys(a).map(r=>{re.etPriceList.set(new Date(+r*1e3),a[r]*1e5)})}}function Hn(t,e){const a=ta(t);if(a&&!(a in _)){console.warn("Invalid chargepoint id received: "+a);return}if(t=="openWB/chargepoint/get/power"?I.charging.power=+e:t=="openWB/chargepoint/get/daily_imported"&&(I.charging.energy=+e),t=="openWB/chargepoint/get/daily_exported")U.cpDailyExported=+e;else if(a){if(t.match(/^openwb\/chargepoint\/[0-9]+\/config$/i))if(_[a]){const r=JSON.parse(e);_[a].name=r.name,_[a].icon=r.name,ee["cp"+a]?(ee["cp"+a].name=r.name,ee["cp"+a].icon=r.name):ee["cp"+a]={name:r.name,icon:r.name,color:"var(--color-charging)"}}else console.warn("invalid chargepoint index: "+a);else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/state_str$/i))_[a].stateStr=JSON.parse(e);else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/fault_str$/i))_[a].faultStr=JSON.parse(e);else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/fault_state$/i))_[a].faultState=+e;else if(t.match(/^openWB\/chargepoint\/[0-9]+\/get\/power$/i))_[a].power=+e;else if(t.match(/^openWB\/chargepoint\/[0-9]+\/get\/daily_imported$/i))_[a].dailyYield=+e;else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/plug_state$/i))_[a].isPluggedIn=e=="true";else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/charge_state$/i))_[a].isCharging=e=="true";else if(t.match(/^openwb\/chargepoint\/[0-9]+\/set\/manual_lock$/i))_[a].updateIsLocked(e=="true");else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/enabled$/i))_[a].isEnabled=e=="1";else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/phases_in_use/i))_[a].phasesInUse=+e;else if(t.match(/^openwb\/chargepoint\/[0-9]+\/set\/current/i))_[a].current=+e;else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/currents/i))_[a].currents=JSON.parse(e);else if(t.match(/^openwb\/chargepoint\/[0-9]+\/set\/log/i)){const r=JSON.parse(e);_[a].chargedSincePlugged=r.imported_since_plugged}else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/connected_vehicle\/soc$/i)){const r=JSON.parse(e);_[a].soc=r.soc,_[a].waitingForSoc=!1,_[a].rangeCharged=r.range_charged,_[a].rangeUnit=r.range_unit}else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/connected_vehicle\/info$/i)){const r=JSON.parse(e);_[a].vehicleName=String(r.name),_[a].updateConnectedVehicle(+r.id)}else if(t.match(/^openwb\/chargepoint\/[0-9]+\/get\/connected_vehicle\/config$/i)){const r=JSON.parse(e);switch(r.chargemode){case"instant_charging":_[a].updateChargeMode(de.instant_charging);break;case"pv_charging":_[a].updateChargeMode(de.pv_charging);break;case"scheduled_charging":_[a].updateChargeMode(de.scheduled_charging);break;case"standby":_[a].updateChargeMode(de.standby);break;case"stop":_[a].updateChargeMode(de.stop);break}_[a].chargeTemplate=r.charge_template,_[a].averageConsumption=r.average_consumption}}}function Yn(t,e){const a=ta(t);if(a!=null){if(!(a in j)){const r=new xa(a);j[a]=r}if(t.match(/^openwb\/vehicle\/[0-9]+\/name$/i))Object.values(_).forEach(r=>{r.connectedVehicle==a&&(r.vehicleName=JSON.parse(e))}),j[a].name=JSON.parse(e);else if(t.match(/^openwb\/vehicle\/[0-9]+\/get\/soc$/i))j[a].soc=JSON.parse(e);else if(t.match(/^openwb\/vehicle\/[0-9]+\/get\/range$/i))isNaN(+e)?j[a].range=0:j[a].range=+e;else if(t.match(/^openwb\/vehicle\/[0-9]+\/charge_template$/i))j[a].updateChargeTemplateId(+e);else if(t.match(/^openwb\/vehicle\/[0-9]+\/ev_template$/i))j[a].updateEvTemplateId(+e);else if(t.match(/^openwb\/vehicle\/[0-9]+\/soc_module\/config$/i)){const r=JSON.parse(e);Object.values(_).forEach(o=>{o.connectedVehicle==a&&(o.isSocConfigured=r.type!==null,o.isSocManual=r.type=="manual")})}}}function Qn(t,e){if(t.match(/^openwb\/vehicle\/template\/charge_template\/[0-9]+$/i)){const a=t.match(/[0-9]+$/i);if(a){const r=+a[0],o=JSON.parse(e);ce[r]=o,qn(r,o)}}else if(t.match(/^openwb\/vehicle\/template\/charge_template\/[0-9]+\/time_charging\/plans\/[0-9]+$/i)){const a=t.match(/(?:\/)([0-9]+)(?:\/)/g),r=t.match(/[0-9]+$/i);if(a&&r){const o=+a[0].replace(/[^0-9]+/g,""),i=+r[0],l=JSON.parse(e);o in ot||(ot[o]=[]),ot[o][i]=l}}else if(t.match(/^openwb\/vehicle\/template\/charge_template\/[0-9]+\/chargemode\/scheduled_charging\/plans\/[0-9]+$/i)){const a=t.match(/(?:\/)([0-9]+)(?:\/)/g),r=t.match(/[0-9]+$/i);if(a&&r){const o=+a[0].replace(/[^0-9]+/g,""),i=+r[0],l=JSON.parse(e);o in rt||(rt[o]=[]),rt[o][i]=l}}else if(t.match(/^openwb\/vehicle\/template\/ev_template\/[0-9]+$/i)){const a=t.match(/[0-9]+$/i);if(a){const r=+a[0],o=JSON.parse(e);Pa[r]=o}}}function qn(t,e){Object.values(_).forEach(a=>{a.chargeTemplate==t&&(a.updateCpPriority(e.prio),a.updateInstantChargeLimitMode(e.chargemode.instant_charging.limit.selected),a.updateInstantTargetCurrent(e.chargemode.instant_charging.current),a.updateInstantTargetSoc(e.chargemode.instant_charging.limit.soc),a.updateInstantMaxEnergy(e.chargemode.instant_charging.limit.amount),a.updatePvFeedInLimit(e.chargemode.pv_charging.feed_in_limit),a.updatePvMinCurrent(e.chargemode.pv_charging.min_current),a.updatePvMaxSoc(e.chargemode.pv_charging.max_soc),a.updatePvMinSoc(e.chargemode.pv_charging.min_soc),a.updatePvMinSocCurrent(e.chargemode.pv_charging.min_soc_current))})}function ta(t){let e=0;try{const a=t.match(/(?:\/)([0-9]+)(?=\/)/g);return a?(e=+a[0].replace(/[^0-9]+/g,""),e):void 0}catch{console.warn("Parser error in getIndex for topic "+t)}}function Xn(t,e){t.match(/^openWB\/LegacySmarthome\/config\//i)?Zn(t,e):t.match(/^openWB\/LegacySmarthome\/Devices\//i)&&Kn(t,e)}function Zn(t,e){const a=aa(t);a!=null&&(a in A||Ut(a),t.match(/^openWB\/LegacySmarthome\/config\/get\/Devices\/[0-9]+\/device_configured$/i)?A[a].configured=e!="0":t.match(/^openWB\/LegacySmarthome\/config\/get\/Devices\/[0-9]+\/device_name$/i)?(A[a].name=e.toString(),A[a].icon=e.toString(),ee["sh"+a].name=e.toString(),ee["sh"+a].icon=e.toString()):t.match(/^openWB\/LegacySmarthome\/config\/set\/Devices\/[0-9]+\/mode$/i)?A[a].isAutomatic=e=="0":t.match(/^openWB\/LegacySmarthome\/config\/get\/Devices\/[0-9]+\/device_canSwitch$/i)?A[a].canSwitch=e=="1":t.match(/^openWB\/LegacySmarthome\/config\/get\/Devices\/[0-9]+\/device_homeConsumtion$/i)?A[a].countAsHouse=e=="1":t.match(/^openWB\/LegacySmarthome\/config\/get\/Devices\/[0-9]+\/device_temperatur_configured$/i)&&(A[a].tempConfigured=+e))}function Kn(t,e){const a=aa(t);if(a==null){console.warn("Smarthome: Missing index in "+t);return}if(a in A||Ut(a),t.match(/^openWB\/LegacySmarthome\/Devices\/[0-9]+\/Watt$/i))A[a].power=+e,es("power");else if(!t.match(/^openWB\/LegacySmarthome\/Devices\/[0-9]+\/Wh$/i)){if(t.match(/^openWB\/LegacySmarthome\/Devices\/[0-9]+\/RunningTimeToday$/i))A[a].runningTime=+e;else if(t.match(/^openWB\/LegacySmarthome\/Devices\/[0-9]+\/TemperatureSensor0$/i))A[a].temp[0]=+e;else if(t.match(/^openWB\/LegacySmarthome\/Devices\/[0-9]+\/TemperatureSensor1$/i))A[a].temp[1]=+e;else if(t.match(/^openWB\/LegacySmarthome\/Devices\/[0-9]+\/TemperatureSensor2$/i))A[a].temp[2]=+e;else if(t.match(/^openWB\/LegacySmartHome\/Devices\/[0-9]+\/Status$/i))switch(+e){case 10:A[a].status="off";break;case 11:A[a].status="on";break;case 20:A[a].status="detection";break;case 30:A[a].status="timeout";break;default:A[a].status="off"}}}function es(t){switch(t){case"power":I.devices.power=Object.values(A).filter(e=>e.configured&&!e.countAsHouse).reduce((e,a)=>e+a.power,0);break;case"energy":I.devices.energy=Object.values(A).filter(e=>e.configured&&!e.countAsHouse).reduce((e,a)=>e+a.energy,0);break;default:console.error("Unknown category")}}function aa(t){let e=0;try{const a=t.match(/(?:\/)([0-9]+)(?=\/)/g);return a?(e=+a[0].replace(/[^0-9]+/g,""),e):void 0}catch{console.warn("Parser error in getIndex for topic "+t)}}class ts{constructor(e){s(this,"id");s(this,"name","ZÃ¤hler");s(this,"power",0);s(this,"energy_imported",0);s(this,"energy_exported",0);s(this,"grid",!1);s(this,"type","counter");s(this,"color","var(--color-evu)");s(this,"energyPv",0);s(this,"energyBat",0);s(this,"pvPercentage",0);s(this,"icon","");this.id=e}}const ie=F({});function as(t,e){if(t in ie)console.info("Duplicate counter message: "+t);else switch(ie[t]=new ts(t),ie[t].type=e,e){case"counter":ie[t].color="var(--color-evu)";break;case"inverter":ie[t].color="var(--color-pv)";break;case"cp":ie[t].color="var(--color-charging)";break;case"bat":ie[t].color="var(--color-bat)";break}}const rs=["openWB/counter/#","openWB/bat/#","openWB/pv/get/#","openWB/chargepoint/#","openWB/vehicle/#","openWB/general/chargemode_config/pv_charging/#","openWB/optional/et/#","openWB/system/#","openWB/LegacySmartHome/#","openWB/command/"+mt()+"/#","openWB/optional/int_display/#"];function os(){ka(ns),rs.forEach(t=>{$e(t)}),X()}function ns(t,e){const a=e.toString();t.match(/^openwb\/counter\/[0-9]+\//i)?ss(t,a):t.match(/^openwb\/counter\//i)?is(t,a):t.match(/^openwb\/bat\//i)?Fn(t,a):t.match(/^openwb\/pv\//i)?cs(t,a):t.match(/^openwb\/chargepoint\//i)?Hn(t,a):t.match(/^openwb\/vehicle\/template\//i)?Qn(t,a):t.match(/^openwb\/vehicle\//i)?Yn(t,a):t.match(/^openwb\/general\/chargemode_config\/pv_charging\//i)?ls(t,a):t.match(/^openwb\/graph\//i)?$n(t,a):t.match(/^openwb\/log\/daily\//i)?An(t,a):t.match(/^openwb\/log\/monthly\//i)?Vn(t,a):t.match(/^openwb\/log\/yearly\//i)?En(t,a):t.match(/^openwb\/optional\/et\//i)?Rn(t,a):t.match(/^openwb\/system\//i)?ds(t,a):t.match(/^openwb\/LegacySmartHome\//i)?Xn(t,a):t.match(/^openwb\/command\//i)?hs(t,a):t.match(/^openwb\/optional\//i)&&ps(t,a)}function ss(t,e){const a=t.split("/"),r=+a[2];if(r==U.evuId?us(t,e):a[3]=="config",a[3]=="get"&&r in ie)switch(a[4]){case"power":ie[r].power=+e;break;case"config":break;case"fault_str":break;case"fault_state":break;case"power_factors":break;case"imported":break;case"exported":break;case"frequency":break;case"daily_imported":ie[r].energy_imported=+e;break;case"daily_exported":ie[r].energy_exported=+e;break}}function is(t,e){if(t.match(/^openwb\/counter\/get\/hierarchy$/i)){const a=JSON.parse(e);if(a.length){$a(),Un();for(const r of a)r.type=="counter"&&(U.evuId=r.id);ra(a[0])}}else t.match(/^openwb\/counter\/set\/home_consumption$/i)?(I.house.power=+e,Aa()):t.match(/^openwb\/counter\/set\/daily_yield_home_consumption$/i)&&(I.house.energy=+e)}function ra(t){switch(t.type){case"counter":as(t.id,t.type);break;case"cp":Ia(t.id);break;case"bat":zn(t.id);break}t.children.forEach(e=>ra(e))}function cs(t,e){switch(t){case"openWB/pv/get/power":G.pv.power=-e;break;case"openWB/pv/get/daily_exported":G.pv.energy=+e;break}}function ls(t,e){const a=t.split("/");if(a.length>0)switch(a[4]){case"bat_mode":U.updatePvBatteryPriority(JSON.parse(e));break}}function us(t,e){switch(t.split("/")[4]){case"power":+e>0?(G.evuIn.power=+e,I.evuOut.power=0):(G.evuIn.power=0,I.evuOut.power=-e);break;case"daily_imported":G.evuIn.energy=+e;break;case"daily_exported":I.evuOut.energy=+e;break}}function ds(t,e){if(t.match(/^openWB\/system\/device\/[0-9]+\/component\/[0-9]+\/config$/i)){const a=JSON.parse(e);a.type=="counter"&&(ie[a.id].name=a.name)}else t.match(/^openWB\/system\/ip_address$/i)?U.ipAddress=JSON.parse(e):t.match(/^openWB\/system\/time$/i)?U.systemTime=JSON.parse(e):t.match(/^openWB\/system\/version$/i)?U.version=JSON.parse(e):t.match(/^openWB\/system\/current_commit$/i)?U.versionDetails=JSON.parse(e):t.match(/^openWB\/system\/current_branch$/i)&&(U.devBranch=JSON.parse(e))}function hs(t,e){const a=t.split("/");if(t.match(/^openWB\/command\/[a-z]+\/error$/i)&&a[2]==mt()){const r=JSON.parse(e);console.error(`Error message from openWB: 
Command: ${r.command}
Data: JSON.stringify(err.data)
Error:
 ${r.error}`)}}function ps(t,e){if(t.match(/^openwb\/optional\/int_display\/active$/i))te.active=JSON.parse(e);else if(t.match(/^openwb\/optional\/int_display\/only_local_charge_points$/i))te.localCpOnly=JSON.parse(e);else if(t.match(/^openwb\/optional\/int_display\/theme$/i)){const a=JSON.parse(e);te.usePin=a.configuration.lock_changes,te.code=a.configuration.lock_changes_code}}const gs={class:"d-flex flex-column align-items-center justify-content-start infoitem"},ms=T({__name:"InfoItem",props:{heading:{},small:{type:Boolean}},setup(t){const e=t,a=p(()=>e.small?{"font-size":"var(--font-small)"}:{"font-size":"var(--font-small)"}),r=p(()=>e.small?{"font-size":"var(--font-small)"}:{"font-size":"var(--font-normal)"}),o=p(()=>e.small?"mt-0":"mt-1");return(i,l)=>(g(),b("span",gs,[d("span",{class:q(["d-flex heading scaled",o.value]),style:ae(a.value)},O(e.heading),7),d("span",{class:"d-flex my-0 me-0 align-items-center content scaled",style:ae(r.value)},[ue(i.$slots,"default",{},void 0,!0)],4)]))}}),oe=K(ms,[["__scopeId","data-v-9215fd9b"]]),fs=T({__name:"BatterySymbol",props:{soc:{}},setup(t){const e=t,a=p(()=>e.soc<=12?"fa-battery-empty":e.soc<38?"fa-battery-quarter":e.soc<63?"fa-battery-half":e.soc<89?"fa-battery-three-quarters":"fa-battery-full");return(r,o)=>(g(),b("span",null,[d("i",{class:q(["fa batIcon",a.value])},null,2),z(" "+O(Math.round(r.soc)+"%"),1)]))}}),vs=K(fs,[["__scopeId","data-v-fc156cd3"]]),ys=T({__name:"FormatWattH",props:{wattH:{}},setup(t){const e=t,a=p(()=>Vt(e.wattH,m.decimalPlaces));return(r,o)=>(g(),b("span",null,O(a.value),1))}}),oa=t=>(xe("data-v-b29cca06"),t=t(),Pe(),t),_s=oa(()=>d("span",{class:"fa-solid fa-charging-station"},"Â ",-1)),bs={class:"grid12"},ws={class:"targetCurrent"},Ss={class:"d-flex justify-content-left align-items-center"},ks=oa(()=>d("i",{class:"fa-solid fa-sm fa-car me-3"},null,-1)),Ms={key:0,class:"ms-2 me-0 fa-solid fa-xs fa-star ps-1"},xs={key:1,class:"ms-2 me-0 fa-solid fa-xs fa-coins ps-0"},Ps={class:"grid12"},Is={key:0,class:"me-1 fa-solid fa-xs fa-clock ps-1"},$s={type:"button"},Cs=T({__name:"CPChargePoint",props:{chargepoint:{}},setup(t){const e=t,a=we(e.chargepoint),r=p({get(){return e.chargepoint.chargeMode},set(S){te.locked?ht():_[e.chargepoint.id].chargeMode=S}}),o=p(()=>(Math.round(e.chargepoint.current*10)/10).toLocaleString(void 0)+" A"),i=p(()=>(Math.round(e.chargepoint.realCurrent*10)/10).toLocaleString(void 0)+" A"),l=p(()=>{const S=e.chargepoint.rangeCharged,N=e.chargepoint.chargedSincePlugged,V=e.chargepoint.dailyYield;return N>0?Math.round(S/N*V).toString()+" "+e.chargepoint.rangeUnit:"0 km"}),u=p(()=>e.chargepoint.isLocked?"Gesperrt":e.chargepoint.isCharging?"LÃ¤dt":e.chargepoint.isPluggedIn?"Bereit":"Frei"),h=p(()=>e.chargepoint.isLocked?"var(--color-evu)":e.chargepoint.isCharging?"var(--color-charging)":e.chargepoint.isPluggedIn?"var(--color-battery)":"var(--color-axis)"),f=p(()=>{let S="";return e.chargepoint.isLocked?S="fa-lock":e.chargepoint.isCharging?S=" fa-bolt":e.chargepoint.isPluggedIn&&(S="fa-plug"),"fa "+S}),v=p(()=>e.chargepoint.soc),W=p(()=>({color:e.chargepoint.color})),w=p(()=>e.chargepoint.etMaxPrice>=+Z.value?{color:"var(--color-charging)"}:{color:"var(--color-menu)"}),Q=we(!1),Z=p(()=>{const[S]=re.etPriceList.values();return(Math.round(S*10)/10).toFixed(1)});function me(){te.locked?ht():new At("#settingspage").toggle()}return(S,N)=>Q.value?$("",!0):(g(),E(et,{key:0,"variable-width":!0},{title:P(()=>[d("span",{style:ae(W.value)},[_s,z(" "+O(e.chargepoint.name),1)],4)]),buttons:P(()=>[M(ke,{color:"var(--color-cp0)",icon:"fa-edit",onClick:me},{default:P(()=>[z(" Einstellungen")]),_:1})]),footer:P(()=>[d("h3",Ss,[ks,z(" "+O(S.chargepoint.vehicleName)+" ",1),S.chargepoint.hasPriority?(g(),b("span",Ms)):$("",!0),S.chargepoint.etActive?(g(),b("span",xs)):$("",!0)]),d("div",Ps,[S.chargepoint.isSocConfigured?(g(),E(oe,{key:0,heading:"Ladestand:",class:"grid-col-4 grid-left"},{default:P(()=>[M(vs,{soc:v.value,class:"me-2"},null,8,["soc"])]),_:1})):$("",!0),S.chargepoint.isSocConfigured?(g(),E(oe,{key:1,heading:"Reichweite:",class:"grid-col-4"},{default:P(()=>[z(O(n(j)[e.chargepoint.connectedVehicle]?Math.round(n(j)[e.chargepoint.connectedVehicle].range):0)+" km ",1)]),_:1})):$("",!0),M(oe,{heading:"Zeitplan:",class:"grid-col-4 grid-right"},{default:P(()=>[S.chargepoint.timedCharging?(g(),b("span",Is)):$("",!0),z(" "+O(e.chargepoint.timedCharging?"Ja":"Nein"),1)]),_:1}),n(re).active?(g(),E(oe,{key:2,heading:"Preisladen:",class:"grid-col-4 grid-left"},{default:P(()=>[z(O(a.value.etActive?"Ja":"Nein"),1)]),_:1})):$("",!0),n(re).active?(g(),E(oe,{key:3,heading:"max. Preis:",class:"grid-col-4"},{default:P(()=>[d("span",$s,O(e.chargepoint.etActive?(Math.round(e.chargepoint.etMaxPrice*10)/10).toFixed(1)+" ct":"-"),1)]),_:1})):$("",!0),n(re).active?(g(),E(oe,{key:4,heading:"akt. Preis:",class:"grid-col-4 grid-right"},{default:P(()=>[d("span",{style:ae(w.value)},O(Z.value)+" ct ",5)]),_:1})):$("",!0),M(Yt,{id:"chargemode-"+S.chargepoint.name,modelValue:r.value,"onUpdate:modelValue":N[0]||(N[0]=V=>r.value=V),class:"chargemodes mt-3 mb-3",options:Object.keys(n(Te)).map(V=>({text:n(Te)[V].name,value:V,color:n(Te)[V].color,icon:n(Te)[V].icon,active:n(Te)[V].mode==S.chargepoint.chargeMode}))},null,8,["id","modelValue","options"])])]),default:P(()=>[d("div",bs,[M(oe,{heading:"Status:",class:"grid-col-4 grid-left"},{default:P(()=>[d("span",{style:ae({color:h.value})},[d("i",{class:q(f.value)},null,2),z(" "+O(u.value),1)],4)]),_:1}),M(oe,{heading:"Geladen:",class:"grid-col-4"},{default:P(()=>[M(ys,{"watt-h":S.chargepoint.dailyYield},null,8,["watt-h"])]),_:1}),M(oe,{heading:"gel. Reichw.:",class:"grid-col-4 grid-right"},{default:P(()=>[z(O(l.value),1)]),_:1}),e.chargepoint.power>0?(g(),E(oe,{key:0,heading:"Leistung:",class:"grid-col-3 grid-left"},{default:P(()=>[M(Ft,{watt:e.chargepoint.power},null,8,["watt"])]),_:1})):$("",!0),e.chargepoint.power>0?(g(),E(oe,{key:1,heading:"Strom:",class:"grid-col-3"},{default:P(()=>[z(O(i.value),1)]),_:1})):$("",!0),e.chargepoint.power>0?(g(),E(oe,{key:2,heading:"Phasen:",class:"grid-col-3"},{default:P(()=>[z(O(e.chargepoint.phasesInUse),1)]),_:1})):$("",!0),e.chargepoint.power>0?(g(),E(oe,{key:3,heading:"Sollstrom:",class:"grid-col-3 grid-right"},{default:P(()=>[d("span",ws,O(o.value),1)]),_:1})):$("",!0)])]),_:1}))}}),Os=K(Cs,[["__scopeId","data-v-b29cca06"]]),Bs=t=>(xe("data-v-afcf5c89"),t=t(),Pe(),t),Ts={class:"content"},As={class:"leftside"},Ls={class:"rightside"},Ds=Bs(()=>d("span",{class:"statustitle"},"Systemstatus",-1)),Gs={class:"settingstitle"},Vs=T({__name:"DisplayTheme",setup(t){function e(r){Ta(r)&&(te.locked=!1,setTimeout(()=>{te.locked=!0},te.timeout*1e3))}Ke(()=>{window.addEventListener("resize",Wa),window.addEventListener("focus",a),os()});function a(){document.hasFocus()&&X()}return(r,o)=>(g(),b(Ie,null,[d("div",Ts,[d("div",As,[Fe(d("div",null,[M(Ir)],512),[[at,n(m).graphToShow=="powermeter"]]),Fe(d("div",null,[M(vo)],512),[[at,n(m).graphToShow=="powergraph"]]),Fe(d("div",null,[M(jo)],512),[[at,n(m).graphToShow=="energymeter"]])]),d("div",Ls,[Object.values(n(_)).length>n(m).cpToShow?(g(),E(Os,{key:0,chargepoint:Object.values(n(_))[n(m).cpToShow],"full-width":!0},null,8,["chargepoint"])):$("",!0)])]),M(ct,{"modal-id":"numberpad"},{title:P(()=>[z("Code")]),default:P(()=>[M(nn,{"model-value":"","onUpdate:modelValue":e})]),_:1}),M(ct,{"modal-id":"statuspage"},{title:P(()=>[Ds]),default:P(()=>[M(gn)]),_:1}),Object.values(n(_)).length>n(m).cpToShow?(g(),E(ct,{key:0,"modal-id":"settingspage"},{title:P(()=>[d("span",Gs,"Einstellungen fÃ¼r "+O(Object.values(n(_))[n(m).cpToShow].name)+" ("+O(Object.values(n(_))[n(m).cpToShow].vehicleName)+") ",1)]),default:P(()=>[M(In,{chargepoint:Object.values(n(_))[n(m).cpToShow]},null,8,["chargepoint"])]),_:1})):$("",!0)],64))}}),Es=K(Vs,[["__scopeId","data-v-afcf5c89"]]),Ws={class:"fixeddisplay"},Ns=T({__name:"App",setup(t){return(e,a)=>(g(),b("div",Ws,[M(Es),M(Za)]))}}),js=K(Ns,[["__scopeId","data-v-75d14554"]]),zs=ma(js);zs.mount("#app");
