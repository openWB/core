import{u as M}from"./index-eQC3cueh.js";import{D as k}from"./DashboardCard-pcIkvsmC.js";import{C as B}from"./ChargeModeModal-DO5rm1i6.js";import{l as c,n as y,q as g,o as n,s as d,e as h,F as C,A as f,k as S,x as p,j as o,z as v,i as P,O as q}from"./vendor-CaYz-T9J.js";import{_ as V}from"./vendor-inkline-3BqkX03P.js";import"./vendor-fortawesome-BuReuC6N.js";const W={name:"BatteryModeModal",props:{modelValue:{required:!0,type:Boolean}},emits:["update:modelValue"],data(){return{mqttStore:M(),batteryModes:[{value:"ev_mode",label:"Fahrzeuge",color:"primary"},{value:"bat_mode",label:"Speicher",color:"primary"},{value:"min_soc_bat_mode",label:"Mindest-SoC",color:"primary"}]}},methods:{setBatteryMode(t){t!==this.mqttStore.getBatteryMode&&(this.mqttStore.updateState("openWB/general/chargemode_config/pv_charging/bat_mode",t),this.$root.sendTopicToBroker("openWB/general/chargemode_config/pv_charging/bat_mode",t))}}};function L(t,s,a,u,e,r){const m=c("i-button"),b=c("i-button-group"),_=c("i-form-group"),w=c("i-form"),i=c("i-modal");return n(),y(i,{"model-value":a.modelValue,size:"lg","onUpdate:modelValue":s[0]||(s[0]=l=>t.$emit("update:modelValue",l))},{header:g(()=>[...s[1]||(s[1]=[S(" Speicher-Beachtung: Überschuss primär für ",-1)])]),default:g(()=>[d(w,null,{default:g(()=>[d(_,null,{default:g(()=>[d(b,{block:"",vertical:""},{default:g(()=>[(n(!0),h(C,null,f(e.batteryModes,l=>(n(),y(m,{key:l.value,size:"lg",class:"large-button",outline:"",color:l.color!="dark"?l.color:"light",active:l.value===e.mqttStore.getBatteryMode,onClick:ce=>r.setBatteryMode(l.value)},{default:g(()=>[S(p(l.label),1)]),_:2},1032,["color","active","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}const N=V(W,[["render",L],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/Battery/BatteryModeModal.vue"]]),x={name:"DashboardFlowCard",components:{DashboardCard:k,ChargeModeModal:B,BatteryModeModal:N},props:{changesLocked:{required:!1,type:Boolean,default:!1}},data(){return{mqttStore:M(),svgSize:{xMin:0,xMax:150,yMin:0,yMax:105,circleRadius:10,strokeWidth:.5,textSize:5,numRows:4,numColumns:3},modalChargeModeSettingsVisible:!1,modalBatteryModeSettingsVisible:!1,modalChargePointId:0}},computed:{svgViewBox(){return`${this.svgSize.xMin} ${this.svgSize.yMin} ${this.svgSize.xMax} ${this.svgSize.yMax}`},svgFontSize(){return`${this.svgSize.textSize}px`},svgRectWidth(){return(this.svgSize.xMax-this.svgSize.xMin-this.svgSize.strokeWidth-this.svgSize.numColumns)/this.svgSize.numColumns},svgStrokeWidth(){return this.svgSize.strokeWidth},svgIconWidth(){return this.svgSize.circleRadius},svgIconHeight(){return this.svgSize.circleRadius},gridPower(){return this.mqttStore.getGridPower("object")},showGridPower(){return this.gridPower.value!==void 0},pvPower(){return this.mqttStore.getPvPower("object")},homePower(){return this.mqttStore.getHomePower("object")},showHomePower(){return this.homePower.value!==void 0},batteryPower(){return this.mqttStore.getBatteryPower("object")},batterySoc(){return this.mqttStore.getBatterySoc("object").value/100},connectedChargePoints(){return this.mqttStore.getChargePointIds},chargePointSumPower(){return this.mqttStore.getChargePointSumPower("object")},chargePoint1Power(){return this.connectedChargePoints.length>0?this.mqttStore.getChargePointPower(this.connectedChargePoints[0],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint2Power(){return this.connectedChargePoints.length>1?this.mqttStore.getChargePointPower(this.connectedChargePoints[1],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint3Power(){return this.connectedChargePoints.length>2?this.mqttStore.getChargePointPower(this.connectedChargePoints[2],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint1Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[0])},chargePoint2Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[1])},chargePoint3Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[2])},chargePoint1VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[0])},chargePoint2VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[1])},chargePoint3VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[0])},chargePoint2ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[1])},chargePoint3ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[0])},chargePoint2ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[1])},chargePoint3ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[0]).soc/100},chargePoint2ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[1]).soc/100},chargePoint3ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[2]).soc/100},gridConsumption(){return this.gridPower.value>0},gridFeedIn(){return this.gridPower.value<0},homeConsumption(){return this.homePower.value>0},homeProduction(){return this.homePower.value<0},pvProduction(){return this.pvPower.value<0},pvConsumption(){return this.pvPower.value>0},batteryDischarging(){return this.batteryPower.value<0},batteryCharging(){return this.batteryPower.value>0},chargePointSumCharging(){return this.chargePointSumPower.value>0},chargePointSumDischarging(){return this.chargePointSumPower.value<0},chargePoint1Charging(){return this.chargePoint1Power.value>0},chargePoint1Discharging(){return this.chargePoint1Power.value<0},chargePoint2Charging(){return this.chargePoint2Power.value>0},chargePoint2Discharging(){return this.chargePoint2Power.value<0},chargePoint3Charging(){return this.chargePoint3Power.value>0},chargePoint3Discharging(){return this.chargePoint3Power.value<0},batteryModeIcon(){switch(this.mqttStore.getBatteryMode){case"ev_mode":return"icons/owbVehicle.svg";case"bat_mode":return"icons/owbBattery.svg";case"min_soc_bat_mode":return"icons/owbBattery40.svg";default:return"---"}},svgComponents(){var t=[];return this.showGridPower&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_grid&&t.push({id:"grid",class:{base:"grid",valueLabel:this.gridFeedIn?"fill-success":this.gridConsumption?"fill-danger":"",animated:this.gridConsumption,animatedReverse:this.gridFeedIn},position:{row:0,column:0},label:["EVU",this.absoluteValue(this.gridPower).textValue],icon:"icons/owbGrid.svg"}),this.showHomePower&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_home_consumption&&t.push({id:"home",class:{base:"home",valueLabel:"",animated:this.homeProduction,animatedReverse:this.homeConsumption},position:{row:0,column:2},label:["Haus",this.absoluteValue(this.homePower).textValue],icon:"icons/owbHouse.svg"}),this.mqttStore.getPvConfigured&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_inverter_sum&&t.push({id:"pv",class:{base:"pv",valueLabel:this.pvProduction||this.pvConsumption?"fill-success":"",animated:this.pvProduction,animatedReverse:this.pvConsumption},position:{row:1,column:0},label:["PV",this.absoluteValue(this.pvPower).textValue],icon:"icons/owbPV.svg"}),this.mqttStore.getBatteryConfigured&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_battery_sum&&t.push({id:"battery",class:{base:"battery",valueLabel:"",animated:this.batteryDischarging,animatedReverse:this.batteryCharging},position:{row:1,column:2},label:["Speicher",this.absoluteValue(this.batteryPower).textValue],soc:this.batterySoc,icon:"icons/owbBattery.svg",clicked:()=>{this.selectBatteryMode()}}),this.connectedChargePoints.length>0&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_charge_point_sum&&(this.connectedChargePoints.length<=3?(t.push({id:"charge-point-1",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint1Discharging,animatedReverse:this.chargePoint1Charging},position:{row:2,column:this.connectedChargePoints.length>1?0:1},label:[this.chargePoint1Name,this.absoluteValue(this.chargePoint1Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint1VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&t.push({id:"vehicle-1",class:{base:"vehicle",valueLabel:"fill-"+this.chargePoint1ConnectedVehicleChargeMode?.class,animated:this.chargePoint1Discharging,animatedReverse:this.chargePoint1Charging},position:{row:3,column:this.connectedChargePoints.length>1?0:1},label:[this.chargePoint1ConnectedVehicleName||"---",this.chargePoint1ConnectedVehicleChargeMode?.label||"---"],soc:this.chargePoint1ConnectedVehicleSoc,icon:"icons/owbVehicle.svg",clicked:()=>{this.selectChargeMode(this.connectedChargePoints[0])}}),this.connectedChargePoints.length>1&&(t.push({id:"charge-point-2",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint2Discharging,animatedReverse:this.chargePoint2Charging},position:{row:2,column:this.connectedChargePoints.length>2?1:2},label:[this.chargePoint2Name,this.absoluteValue(this.chargePoint2Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint2VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&t.push({id:"vehicle-2",class:{base:"vehicle",valueLabel:"fill-"+this.chargePoint2ConnectedVehicleChargeMode?.class,animated:this.chargePoint2Discharging,animatedReverse:this.chargePoint2Charging},position:{row:3,column:this.connectedChargePoints.length>2?1:2},label:[this.chargePoint2ConnectedVehicleName||"---",this.chargePoint2ConnectedVehicleChargeMode?.label||"---"],soc:this.chargePoint2ConnectedVehicleSoc,icon:"icons/owbVehicle.svg"}),this.connectedChargePoints.length>2&&(t.push({id:"charge-point-3",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint3Discharging,animatedReverse:this.chargePoint3Charging},position:{row:2,column:2},label:[this.chargePoint3Name,this.absoluteValue(this.chargePoint3Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint3VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&t.push({id:"vehicle-3",class:{base:"vehicle",valueLabel:"fill-"+this.chargePoint3ConnectedVehicleChargeMode?.class,animated:this.chargePoint3Discharging,animatedReverse:this.chargePoint3Charging},position:{row:3,column:2},label:[this.chargePoint3ConnectedVehicleName||"---",this.chargePoint3ConnectedVehicleChargeMode?.label||"---"],soc:this.chargePoint3ConnectedVehicleSoc,icon:"icons/owbVehicle.svg"})))):this.chargePointSumPower.value!==void 0&&t.push({id:"charge-point-sum",class:{base:"charge-point",valueLabel:"",animated:this.chargePointSumDischarging,animatedReverse:this.chargePointSumCharging},position:{row:2,column:1},label:["Ladepunkte",this.absoluteValue(this.chargePointSumPower).textValue],icon:"icons/owbChargePoint.svg"})),(!this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles||this.connectedChargePoints.length===0||this.connectedChargePoints.length>3)&&this.setSvgNumRows(3),t}},watch:{changesLocked(t,s){s!==!0&&t===!0&&(this.modalChargeModeSettingsVisible=!1,this.modalBatteryModeSettingsVisible=!1)}},methods:{absoluteValue(t){let s={...t};return s.textValue&&(s.textValue=s.textValue.replace("-","")),s.value&&(s.value=Math.abs(s.value)),s.scaledValue&&(s.scaledValue=Math.abs(s.scaledValue)),s},setSvgNumRows(t){this.svgSize.numRows=t},calcRowY(t){let s=this.svgSize.yMin+this.svgSize.strokeWidth+this.svgSize.circleRadius,u=this.svgSize.yMax-this.svgSize.strokeWidth-this.svgSize.circleRadius-s;return t*(u/(this.svgSize.numRows-1))+s},calcColumnX(t){let s=this.svgSize.xMin+this.svgSize.strokeWidth+this.svgRectWidth/2,u=this.svgSize.xMax-this.svgSize.strokeWidth-this.svgRectWidth/2-s;return t*(u/(this.svgSize.numColumns-1))+s},calcFlowLineAnchorX(t){let s=this.calcColumnX(t);return t<(this.svgSize.numColumns-1)/2?s+this.svgRectWidth/2-this.svgSize.circleRadius:t>(this.svgSize.numColumns-1)/2?s-this.svgRectWidth/2+this.svgSize.circleRadius:s},calcSvgElementBoundingBox(t){let s=document.getElementById(t);if(s==null)return{x:0,y:0,width:0,height:0};let a=s.getBBox();return{x:a.x,y:a.y,width:a.width,height:a.height}},beginAnimation(t){this.$refs[t]!=null&&this.$refs[t][0]?.beginElement()},selectChargeMode(t){this.changesLocked||(this.modalChargePointId=t,this.modalChargeModeSettingsVisible=!0)},selectBatteryMode(){this.changesLocked||(this.modalBatteryModeSettingsVisible=!0)}}},z=()=>{q(t=>({"a442a908-svgStrokeWidth":t.svgStrokeWidth,"a442a908-svgFontSize":t.svgFontSize}))},R=x.setup;x.setup=R?(t,s)=>(z(),R(t,s)):z;const F={class:"svg-container"},D=["viewBox"],I={id:"layer1",style:{display:"inline"}},j=["d"],T={id:"layer2",style:{display:"inline"}},E=["cx","cy","r"],A=["transform","onClick"],X=["id"],H=["x","y","width","height"],Y=["id"],G=["x","y","width","height","rx","ry"],U=["x","y","width","height","rx","ry"],O=["clip-path"],J=["id","x","y"],K=["values"],Q=["id","x","y"],Z=["transform"],$=["r"],ee=["r","clip-path"],te=["href","x","y","height","width"],ie={key:0},se=["x","y","width","height","rx","ry"],re=["href","x","y","height","width"];function oe(t,s,a,u,e,r){const m=c("charge-mode-modal"),b=c("battery-mode-modal"),_=c("i-container"),w=c("dashboard-card");return n(),h(C,null,[d(m,{modelValue:e.modalChargeModeSettingsVisible,"onUpdate:modelValue":s[0]||(s[0]=i=>e.modalChargeModeSettingsVisible=i),"charge-point-id":e.modalChargePointId},null,8,["modelValue","charge-point-id"]),d(b,{modelValue:e.modalBatteryModeSettingsVisible,"onUpdate:modelValue":s[1]||(s[1]=i=>e.modalBatteryModeSettingsVisible=i)},null,8,["modelValue"]),d(w,{color:"primary"},{headerLeft:g(()=>[...s[2]||(s[2]=[S(" Übersicht - Energiefluss ",-1)])]),default:g(()=>[d(_,null,{default:g(()=>[o("div",F,[(n(),h("svg",{viewBox:r.svgViewBox,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg"},[o("g",I,[(n(!0),h(C,null,f(r.svgComponents,i=>(n(),h("path",{key:i.id,class:v([i.class.base,{animated:i.class.animated},{animatedReverse:i.class.animatedReverse}]),d:i.class.base!=="vehicle"?`M ${r.calcFlowLineAnchorX(i.position.column)}, ${r.calcRowY(i.position.row)} ${r.calcColumnX(1)}, ${r.calcRowY(1)}`:`M ${r.calcFlowLineAnchorX(i.position.column)}, ${r.calcRowY(i.position.row)} ${r.calcFlowLineAnchorX(i.position.column)}, ${r.calcRowY(i.position.row-1)}`},null,10,j))),128))]),o("g",T,[o("circle",{id:"center",cx:r.calcColumnX(1),cy:r.calcRowY(1),r:e.svgSize.circleRadius/3},null,8,E),(n(!0),h(C,null,f(r.svgComponents,i=>(n(),h("g",{key:i.id,class:v(i.class.base),transform:`translate(${r.calcColumnX(i.position.column)}, ${r.calcRowY(i.position.row)})`,onClick:l=>{r.beginAnimation(`animate-label-${i.id}`),i.clicked&&i.clicked()}},[o("defs",null,[i.soc?(n(),h("clipPath",{key:0,id:`clip-soc-${i.id}`},[o("rect",{x:-e.svgSize.circleRadius-e.svgSize.strokeWidth,y:(e.svgSize.circleRadius+e.svgSize.strokeWidth)*(1-2*i.soc),width:(e.svgSize.circleRadius+e.svgSize.strokeWidth)*2,height:(e.svgSize.circleRadius+e.svgSize.strokeWidth)*2*i.soc},null,8,H)],8,X)):P("",!0),o("clipPath",{id:`clip-label-${i.id}`},[o("rect",{x:-r.svgRectWidth/2,y:-e.svgSize.circleRadius,width:r.svgRectWidth,height:e.svgSize.circleRadius*2,rx:e.svgSize.circleRadius,ry:e.svgSize.circleRadius},null,8,G)],8,Y)]),o("rect",{x:-r.svgRectWidth/2,y:-e.svgSize.circleRadius,width:r.svgRectWidth,height:e.svgSize.circleRadius*2,rx:e.svgSize.circleRadius,ry:e.svgSize.circleRadius},null,8,U),o("text",{"clip-path":`url(#clip-label-${i.id})`},[o("tspan",{id:`label-${i.id}`,"text-anchor":"start",x:-r.svgRectWidth/2+2*e.svgSize.circleRadius+e.svgSize.strokeWidth,y:-e.svgSize.textSize/2},[r.calcSvgElementBoundingBox(`label-${i.id}`).width>r.svgRectWidth-2*e.svgSize.circleRadius-2*e.svgSize.strokeWidth?(n(),h("animate",{key:0,ref_for:!0,ref:`animate-label-${i.id}`,xmlns:"http://www.w3.org/2000/svg",attributeName:"x",dur:"5s",values:"0; "+(-r.calcSvgElementBoundingBox(`label-${i.id}`).width+r.svgRectWidth-2.5*e.svgSize.circleRadius-2*e.svgSize.strokeWidth)+"; 0;",repeatCount:"0",begin:"2s",additive:"sum"},null,8,K)):P("",!0),S(" "+p(i.label[0]),1)],8,J),o("tspan",{id:`value-${i.id}`,class:v(i.class.valueLabel),"text-anchor":"end",x:2*e.svgSize.circleRadius+e.svgSize.strokeWidth,y:e.svgSize.textSize},p(i.label[1]),11,Q)],8,O),o("g",{transform:`translate(${e.svgSize.circleRadius-r.svgRectWidth/2}, 0)`},[o("circle",{cx:"0",cy:"0",r:e.svgSize.circleRadius,class:v({soc:i.soc})},null,10,$),i.soc?(n(),h("circle",{key:0,cx:"0",cy:"0",r:e.svgSize.circleRadius,"clip-path":`url(#clip-soc-${i.id})`},null,8,ee)):P("",!0),o("image",{href:i.icon,x:-r.svgIconWidth/2,y:-r.svgIconHeight/2,height:r.svgIconHeight,width:r.svgIconWidth},null,8,te)],8,Z),i.id==="battery"?(n(),h("g",ie,[o("rect",{x:e.svgSize.circleRadius*1.2,y:-e.svgSize.circleRadius*1.4,width:e.svgSize.circleRadius*1.1,height:e.svgSize.circleRadius*.7,rx:e.svgSize.circleRadius*.3,ry:e.svgSize.circleRadius*.55,class:"battery-mode-button",opacity:"1"},null,8,se),o("image",{href:r.batteryModeIcon,x:e.svgSize.circleRadius*1.45,y:-e.svgSize.circleRadius*1.35,height:e.svgSize.circleRadius*.6,width:e.svgSize.circleRadius*.6},null,8,re)])):P("",!0)],10,A))),128))])],8,D))])]),_:1})]),_:1})],64)}const ne=V(x,[["render",oe],["__scopeId","data-v-a442a908"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/Dashboard/FlowCard.vue"]]),ae={name:"EnergyFlowView",components:{FlowCard:ne},props:{changesLocked:{required:!1,type:Boolean,default:!1}}};function he(t,s,a,u,e,r){const m=c("FlowCard");return n(),y(m,{"changes-locked":a.changesLocked},null,8,["changes-locked"])}const Pe=V(ae,[["render",he],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/views/EnergyFlowView.vue"]]);export{Pe as default};
