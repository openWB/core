const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashBoardView-BJO8O7Y4.js","assets/DashBoardCard-BterAPyf.js","assets/vendor-inkline-Ce5aFAnW.js","assets/vendor-CZ1MGz7j.js","assets/vendor-inkline-BDgt6n8h.css","assets/DashBoardCard-DKbC8x2S.css","assets/ChargePointPlugBadge-Bsi0zWop.js","assets/vendor-fortawesome-C68yAli-.js","assets/ChargePointPlugBadge-DqNX7D_z.css","assets/DashBoardView-CrVFeUF-.css","assets/EnergyFlowView-CAd9Xlbe.js","assets/EnergyFlowView-C3xLYKue.css","assets/ChargePointsView-CaYX8Nkl.js","assets/ChargePointsView-DPrjgv0h.css","assets/StatusView-DclrRcZL.js"])))=>i.map(i=>d[i]);
import{o as p,e as B,k as _,x as W,f as y,j as V,F as P,H as j,q as u,l as m,n as s,i as w,A as D,s as l,I,y as A,R,J as U,K as H,L as z,M as G,N as K}from"./vendor-CZ1MGz7j.js";import{_ as v,I as J,c as Z}from"./vendor-inkline-Ce5aFAnW.js";import{l as E,f as L,a as q,F as O,b as Y,c as Q}from"./vendor-fortawesome-C68yAli-.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const X={name:"DateTime",data(){return{dateTimeInterval:"",date:"",time:""}},mounted(){this.update(),this.dateTimeInterval=setInterval(this.update,1e3)},beforeUnmount(){clearInterval(this.dateTimeInterval)},methods:{update(){const e=new Date,t={weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"},n={hour:"2-digit",minute:"2-digit",second:"2-digit"};this.date=e.toLocaleDateString(void 0,t),this.time=e.toLocaleTimeString(void 0,n)}}};function ee(e,t,n,r,o,i){return p(),B(P,null,[_(W(o.time),1),y(e.$slots,"default",{},()=>[t[0]||(t[0]=V("br",null,null,-1))]),_(W(o.date),1)],64)}const te=v(X,[["render",ee]]),S=j("mqtt",{state:()=>({settings:{localIp:void 0,localBranch:void 0,localCommit:void 0,localVersion:void 0,parentChargePoint1:void 0,parentChargePoint2:void 0},topics:{},chartData:{}}),getters:{getChargePointFilter:e=>{let t=[];return e.settings.parentChargePoint1!==void 0&&t.push(e.settings.parentChargePoint1),e.settings.parentChargePoint2!==void 0&&t.push(e.settings.parentChargePoint2),t},getWildcardIndexList:e=>(t,n=!1)=>{let r=t;n||(r="^"+t.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$");let o=Object.keys(e.topics).filter(i=>i.match(r));return o.forEach((i,a,c)=>{c[a]=parseInt(i.match(/(?:\/)([0-9]+)(?=\/)*/g)[0].replace(/[^0-9]+/g,""))}),o},getWildcardTopics:e=>(t,n=!1)=>{let r=t;return n||(r="^"+t.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$"),Object.keys(e.topics).filter(o=>o.match(r)).reduce((o,i)=>({...o,[i]:e.topics[i]}),{})},getObjectIds:e=>t=>{function n(r){let o=[];return r!==void 0&&r.forEach(i=>{i.type==t&&o.push(i.id),o=[...o,...n(i.children)]}),o}return n(e.topics["openWB/counter/get/hierarchy"])},getValueBool:e=>(t,n=!1)=>{let r=e.topics[t];return r!==void 0?r:(console.warn("topic not found! using default",t,n),n)},getValueString:e=>(t,n="W",r="",o=!0,i=!1,a="---",c=void 0)=>{var d=!1,g=e.topics[t];if(g===void 0||c!==void 0&&g[c]===void 0)console.warn("topic not found! using default",t,a),C=a;else{c!==void 0&&(g=g[c]),i&&(g*=-1);for(var C=g.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}),h=g;o&&(h>999||h<-999);)switch(h=h/1e3,d=!0,r){case"":r="k";break;case"k":r="M";break;case"M":r="G";break}C=h.toLocaleString(void 0,{minimumFractionDigits:d?2:0,maximumFractionDigits:d?2:0})}return{textValue:`${C} ${r}${n}`,value:g,unit:n,scaledValue:h,scaledUnit:`${r}${n}`}},getChartData:e=>t=>e.chartData[t]===void 0?[]:e.chartData[t],getDisplayStandby:e=>e.topics["openWB/optional/int_display/standby"],getThemeConfiguration:e=>{if("openWB/optional/int_display/theme"in e.topics&&e.topics["openWB/optional/int_display/theme"]!==void 0&&"configuration"in e.topics["openWB/optional/int_display/theme"])return e.topics["openWB/optional/int_display/theme"].configuration},getDashBoardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_view:!0},getEnergyFlowEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_energy_flow_view:!0},getChargePointsEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_charge_points_view:!0},getStateEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_status_view:!0},getGridCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_grid:!0},getHomeCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_home_consumption:!0},getBatteryCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_battery_sum:!0},getChargePointsCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_charge_point_sum:!0},getPvCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_inverter_sum:!0},getLockChanges(e){return e.getThemeConfiguration?e.getThemeConfiguration.lock_changes:!0},getSimpleChargePointView(e){return e.getThemeConfiguration?e.getThemeConfiguration.simple_charge_point_view:!1},getGridId(e){let t=e.topics["openWB/counter/get/hierarchy"];if(t!==void 0&&Object.keys(t).length>0){let n=Object.keys(e.topics["openWB/counter/get/hierarchy"])[0];if(console.debug("getGridId",n,e.topics["openWB/counter/get/hierarchy"][n]),e.topics["openWB/counter/get/hierarchy"][n].type=="counter")return e.topics["openWB/counter/get/hierarchy"][n].id}},getGridPower(e){return(t="textValue")=>{let n=e.getGridId;if(n===void 0)return"---";let r=e.getValueString(`openWB/counter/${n}/get/power`,"W");if(Object.hasOwnProperty.call(r,t))return r[t];if(t=="object")return r;console.error("returnType not found!",t,r)}},getGridPowerChartData(e){let t=e.getGridId;return t===void 0?[]:e.getChartData(`openWB/counter/${t}/get/power`)},getHomePower(e){return(t="textValue")=>{let n=e.getValueString("openWB/counter/set/home_consumption","W");if(Object.hasOwnProperty.call(n,t))return n[t];if(t=="object")return n;console.error("returnType not found!",t,n)}},getHomePowerChartData(e){return e.getChartData("openWB/counter/set/home_consumption")},getBatteryConfigured(e){return e.getValueBool("openWB/bat/config/configured")},getBatteryPower(e){return(t="textValue")=>{let n=e.getValueString("openWB/bat/get/power","W");if(Object.hasOwnProperty.call(n,t))return n[t];if(t=="object")return n;console.error("returnType not found!",t,n)}},getBatteryPowerChartData(e){return e.getChartData("openWB/bat/get/power")},getBatterySoc(e){return(t="textValue")=>{let n=e.getValueString("openWB/bat/get/soc","%","",!1);if(Object.hasOwnProperty.call(n,t))return n[t];if(t=="object")return n;console.error("returnType not found!",t,n)}},getBatterySocChartData(e){return e.getChartData("openWB/bat/get/soc")},getPvConfigured(e){return e.getValueBool("openWB/pv/config/configured")},getPvPower(e){return(t="textValue")=>{var n=e.getValueString("openWB/pv/get/power","W","",!0,!0);if(Object.hasOwnProperty.call(n,t))return n[t];if(t=="object")return n;console.error("returnType not found!",t,n)}},getPvPowerChartData(e){return e.getChartData("openWB/pv/get/power").map(t=>t*-1)},getChargePointSumPower(e){return(t="textValue")=>{var n=e.getValueString("openWB/chargepoint/get/power","W");if(Object.hasOwnProperty.call(n,t))return n[t];if(t=="object")return n;console.error("returnType not found!",t,n)}},getChargePointSumPowerChartData(e){return e.getChartData("openWB/chargepoint/get/power")},getChargePointIds(e){let t=e.getObjectIds("cp"),n=this.getChargePointFilter;return n.length>0?(console.debug("charge points are filtered!",t,n),t.filter(r=>n.includes(r))):t},getChargePointName(e){return t=>e.topics[`openWB/chargepoint/${t}/config`]!==void 0?e.topics[`openWB/chargepoint/${t}/config`].name:"---"},getChargePointPower(e){return(t,n="textValue")=>{var r=e.getValueString(`openWB/chargepoint/${t}/get/power`,"W");if(Object.hasOwnProperty.call(r,n))return r[n];if(n=="object")return r;console.error("returnType not found!",n,r)}},getChargePointImportedSincePlugged(e){return t=>({energy:e.getValueString(`openWB/chargepoint/${t}/set/log`,"Wh","",!0,!1,"---","imported_since_plugged").textValue,range:e.getValueString(`openWB/chargepoint/${t}/set/log`,"m","k",!1,!1,"---","range_charged").textValue})},getChargePointPowerChartData(e){return t=>e.getChartData(`openWB/chargepoint/${t}/get/power`)},getChargePointSetCurrent(e){return(t,n="textValue")=>{let r=e.getValueString(`openWB/chargepoint/${t}/set/current`,"A");if(Object.hasOwnProperty.call(r,n))return r[n];if(n=="object")return r;console.error("returnType not found!",n,r)}},getChargePointPhasesInUse(e){return t=>{const n=["/","①","②","③"],r=e.topics[`openWB/chargepoint/${t}/get/phases_in_use`];return r!==void 0&&r>=0&&r<n.length?n[e.topics[`openWB/chargepoint/${t}/get/phases_in_use`]]:(console.warn("topic not found!",`openWB/chargepoint/${t}/get/phases_in_use`),"?")}},getChargePointPlugState(e){return t=>e.getValueBool(`openWB/chargepoint/${t}/get/plug_state`)},getChargePointChargeState(e){return t=>e.getValueBool(`openWB/chargepoint/${t}/get/charge_state`)},getChargePointManualLock(e){return t=>e.getValueBool(`openWB/chargepoint/${t}/set/manual_lock`)},getChargepointTagState(e){return t=>{if([void 0,null,""].includes(e.topics[`openWB/chargepoint/${t}/set/rfid`])){if(![void 0,null,""].includes(e.topics[`openWB/chargepoint/${t}/get/rfid`]))return 1}else return 2;return 0}},getChargePointConnectedVehicleConfig(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/config`]},getChargePointConnectedVehicleChargeMode(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.translateChargeMode(e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.selected)}},getChargePointConnectedVehiclePriority(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).prio}},getChargePointConnectedVehicleInfo(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/info`]},getChargePointConnectedVehicleId(e){return t=>{if(e.getChargePointConnectedVehicleInfo(t))return e.getChargePointConnectedVehicleInfo(t).id}},getChargePointConnectedVehicleChargeTemplateIndex(e){return t=>{if(e.getChargePointConnectedVehicleConfig(t))return e.getChargePointConnectedVehicleConfig(t).charge_template}},getChargePointConnectedVehicleChargeTemplate(e){return t=>{let n=e.getChargePointConnectedVehicleChargeTemplateIndex(t);return e.topics[`openWB/vehicle/template/charge_template/${n}`]}},getChargePointConnectedVehicleEvTemplate(e){return t=>{if(e.getChargePointConnectedVehicleConfig(t))return e.getChargePointConnectedVehicleConfig(t).ev_template}},getChargePointConnectedVehicleName(e){return t=>{if(e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/info`])return e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/info`].name}},getChargePointConnectedVehicleSoc(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/soc`]},getChargePointConnectedVehicleTimeChargingActive(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).time_charging.active}},getChargePointConnectedVehicleTimeChargingRunning(e){return t=>{let n=e.getChargePointConnectedVehicleConfig(t).time_charging_in_use;return n!==void 0?n:!1}},getChargePointConnectedVehicleInstantChargingCurrent(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.instant_charging.current}},getChargePointConnectedVehicleInstantChargingLimit(e){return t=>e.getChargePointConnectedVehicleChargeTemplate(t)?e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.instant_charging.limit:{selected:void 0}},getChargePointConnectedVehiclePvChargingFeedInLimit(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.pv_charging.feed_in_limit}},getChargePointConnectedVehiclePvChargingMinCurrent(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.pv_charging.min_current}},getChargePointConnectedVehiclePvChargingMinSoc(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.pv_charging.min_soc}},getChargePointConnectedVehiclePvChargingMinSocCurrent(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.pv_charging.min_soc_current}},getChargePointConnectedVehiclePvChargingMaxSoc(e){return t=>{if(e.getChargePointConnectedVehicleChargeTemplate(t))return e.getChargePointConnectedVehicleChargeTemplate(t).chargemode.pv_charging.max_soc}},getChargePointConnectedVehicleScheduledChargingPlans(e){return t=>{let n=e.getChargePointConnectedVehicleChargeTemplateIndex(t);return e.getWildcardTopics(`openWB/vehicle/template/charge_template/${n}/chargemode/scheduled_charging/plans/+`)}},getChargePointConnectedVehicleTimeChargingPlans(e){return t=>{let n=e.getChargePointConnectedVehicleChargeTemplateIndex(t);return e.getWildcardTopics(`openWB/vehicle/template/charge_template/${n}/time_charging/plans/+`)}},getVehicleList(e){return e.getWildcardTopics("openWB/vehicle/+/name")},getVehicleName(e){return t=>e.topics[`openWB/vehicle/${t}/name`]},getVehicleSocConfigured(e){return t=>e.topics[`openWB/vehicle/${t}/soc_module/config`].type!=null},getVehicleSocIsManual(e){return t=>e.topics[`openWB/vehicle/${t}/soc_module/config`].type=="manual"},getVehicleFaultState(e){return t=>e.topics[`openWB/vehicle/${t}/get/fault_state`]?e.topics[`openWB/vehicle/${t}/get/fault_state`]:0},getSystemTime(e){if(e.topics["openWB/system/time"])return new Date(e.topics["openWB/system/time"]*1e3).toLocaleString()},getSystemIp(e){if(e.settings.localIp!==void 0)return e.settings.localIp;if(e.topics["openWB/system/ip_address"])return e.topics["openWB/system/ip_address"]},getSystemVersion(e){if(e.settings.localVersion!==void 0)return e.settings.localVersion;if(e.topics["openWB/system/version"])return e.topics["openWB/system/version"]},getSystemBranch(e){if(e.settings.localBranch!==void 0)return e.settings.localBranch;if(e.topics["openWB/system/current_branch"])return e.topics["openWB/system/current_branch"]},getSystemCurrentCommit(e){if(e.settings.localCommit!==void 0)return e.settings.localCommit;if(e.topics["openWB/system/current_commit"])return e.topics["openWB/system/current_commit"]},getRfidEnabled(){return this.getValueBool("openWB/optional/rfid/active")}},actions:{updateSetting(e,t){e in this.settings&&(this.settings[e]=t)},initTopic(e,t=void 0){e.includes("#")||e.includes("+")?console.debug("skipping init of wildcard topic:",e):this.addTopic(e,t)},addTopic(e,t){console.debug("addTopic",e,t),this.topics[e]=t},removeTopic(e){e.includes("#")||e.includes("+")?(console.debug("expanding wildcard topic for removal:",e),Object.keys(this.getWildcardTopics(e)).forEach(t=>{console.debug("removing wildcardTopic:",t),delete this.topics[t]})):delete this.topics[e]},updateTopic(e,t,n=void 0){const r=(o,i,a)=>i.split(".").reduce((c,d,g)=>c[d]=i.split(".").length===++g?a:c[d]||{},o);e in this.topics?n!=null?r(this.topics[e],n,t):this.topics[e]=t:console.debug("topic not found: ",e)},updateChartData(){for(const[e,t]of Object.entries(this.topics))(e.endsWith("home_consumption")||e.endsWith("power")||e.endsWith("soc"))&&(this.chartData[e]===void 0&&(this.chartData[e]=[]),t!=null&&(this.chartData[e].push(t),this.chartData[e].slice(-128)))},updateState(e,t,n=void 0){console.debug("updateState:",e,t,n),this.updateTopic(e,t,n)},chargeModeList(){var e=[{id:"instant_charging"},{id:"pv_charging"},{id:"scheduled_charging"},{id:"standby"},{id:"stop"}];return e.forEach(t=>{t.label=this.translateChargeMode(t.id).label,t.class=this.translateChargeMode(t.id).class}),e},translateChargeMode(e){switch(e){case"instant_charging":return{mode:e,label:"Sofort",class:"danger"};case"pv_charging":return{mode:e,label:"PV",class:"success"};case"scheduled_charging":return{mode:e,label:"Zielladen",class:"primary"};case"time_charging":return{mode:e,label:"Zeitladen",class:"warning"};case"standby":return{mode:e,label:"Standby",class:"secondary"};case"stop":return{mode:e,label:"Stop",class:"dark"};default:return console.warn("unknown charge mode:",e),{mode:e,label:e,class:e}}},checkChangesLockCode(e){return!!(this.getThemeConfiguration&&this.getThemeConfiguration.lock_changes_code==e)},formatDate(e,t={year:"numeric",month:"2-digit",day:"2-digit"}){return new Date(e).toLocaleDateString(void 0,t)},formatDateRange(e,t="-"){const n={year:"numeric",month:"2-digit",day:"2-digit"};let r={day:"2-digit"};const o=new Date(e[0]),i=new Date(e[1]);return o.getFullYear()==i.getFullYear()?o.getMonth()!=i.getMonth()&&(r.month=n.month):r=n,`${this.formatDate(e[0],r)}${t}${this.formatDate(e[1],n)}`},formatWeeklyScheduleDays(e){const t=["Mo","Di","Mi","Do","Fr","Sa","So"];let n=[];return e.forEach(function(r,o){r==!0&&n.push(t[o])}),n.join(",")}}}),ne={name:"NavItem",props:{to:{type:Object,required:!0}}};function oe(e,t,n,r,o,i){const a=u("i-nav-item");return p(),m(a,{to:n.to,"active-class":"-active",class:"_border _border-color:primary _text-align:center"},{default:s(()=>[y(e.$slots,"default",{},void 0,!0)]),_:3},8,["to"])}const re=v(ne,[["render",oe],["__scopeId","data-v-1db6ae73"]]),ie={name:"NavBar",components:{NavItem:re},data(){return{mqttStore:S()}}};function ae(e,t,n,r,o,i){const a=u("nav-item"),c=u("i-nav");return p(),m(c,{vertical:"",class:"_align-items:stretch",size:"lg"},{default:s(()=>[o.mqttStore.getDashBoardEnabled?(p(),m(a,{key:0,to:{name:"dash-board"}},{default:s(()=>t[0]||(t[0]=[_(" Übersicht ")])),_:1})):w("",!0),o.mqttStore.getEnergyFlowEnabled?(p(),m(a,{key:1,to:{name:"energy-flow"}},{default:s(()=>t[1]||(t[1]=[_(" Energiefluss ")])),_:1})):w("",!0),o.mqttStore.getChargePointsEnabled&&o.mqttStore.getChargePointIds.length>0?(p(),m(a,{key:2,to:{name:"charge-points"}},{default:s(()=>t[2]||(t[2]=[_(" Ladepunkte ")])),_:1})):w("",!0),o.mqttStore.getStateEnabled?(p(),m(a,{key:3,to:{name:"status"}},{default:s(()=>t[3]||(t[3]=[_(" Status ")])),_:1})):w("",!0)]),_:1})}const ce=v(ie,[["render",ae]]);E.add(L,q);const se={name:"NumberPad",components:{FontAwesomeIcon:O},emits:["key:digit","key:clear","key:delete"],data(){return{buttonRows:[[{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"}],[{value:4,label:"4"},{value:5,label:"5"},{value:6,label:"6"}],[{value:7,label:"7"},{value:8,label:"8"},{value:9,label:"9"}]]}},methods:{emitDigit(e){this.$emit("key:digit",e)},emitClear(){this.$emit("key:clear")},emitDelete(){this.$emit("key:delete")}}};function le(e,t,n,r,o,i){const a=u("i-button"),c=u("i-column"),d=u("i-row"),g=u("FontAwesomeIcon"),C=u("i-container");return p(),m(C,null,{default:s(()=>[(p(!0),B(P,null,D(o.buttonRows,h=>(p(),m(d,{key:h,center:"",class:"_padding-bottom:1"},{default:s(()=>[(p(!0),B(P,null,D(h,b=>(p(),m(c,{key:b.value,class:"pin-button-column"},{default:s(()=>[l(a,{size:"lg",class:"pin-button",onClick:f=>i.emitDigit(b.value)},{default:s(()=>[_(W(b.label),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024))),128)),l(d,{center:""},{default:s(()=>[l(c,{class:"pin-button-column"},{default:s(()=>[l(a,{size:"lg",class:"pin-button",onClick:t[0]||(t[0]=h=>i.emitClear())},{default:s(()=>[l(g,{"fixed-width":"",icon:["fas","fa-eraser"]})]),_:1})]),_:1}),l(c,{class:"pin-button-column"},{default:s(()=>[l(a,{size:"lg",class:"pin-button",onClick:t[1]||(t[1]=h=>i.emitDigit("0"))},{default:s(()=>t[3]||(t[3]=[_(" 0 ")])),_:1})]),_:1}),l(c,{class:"pin-button-column"},{default:s(()=>[l(a,{size:"lg",class:"pin-button",onClick:t[2]||(t[2]=h=>i.emitDelete())},{default:s(()=>[l(g,{"fixed-width":"",icon:["fas","fa-delete-left"]})]),_:1})]),_:1})]),_:1})]),_:1})}const ue=v(se,[["render",le],["__scopeId","data-v-4e2103db"]]),de={name:"CodeInputModal",components:{NumberPad:ue},props:{modelValue:{type:Boolean,required:!0},backgroundColor:{type:String,default:"warning"},placeholderCharacter:{type:String,default:"*",validator(e){return e.length==1}},inputVisible:{type:Boolean,default:!1},minLength:{type:Number,default:4},maxLength:{type:Number,default:4}},emits:["update:modelValue","update:inputValue"],data(){return{number:"",modalBackground:this.backgroundColor}},computed:{placeholder(){return this.placeholderCharacter.repeat(this.minLength)},enableSubmit(){return this.number.length>=this.minLength&&this.number.length<=this.maxLength}},watch:{modelValue(e,t){e===!1&&t===!0&&this.clear()}},methods:{abort(){this.$emit("update:modelValue",!1)},addDigit(e){this.number.length<this.maxLength&&(this.number+=e)},removeDigit(){this.number=this.number.slice(0,-1)},clear(){this.number=""},submit(){this.$emit("update:inputValue",this.number)},success(e="success"){this.modalBackground=e,setTimeout(()=>{this.$emit("update:modelValue",!1),this.modalBackground=this.backgroundColor},500)},error(e="danger"){this.modalBackground=e,setTimeout(()=>{this.clear(),this.modalBackground=this.backgroundColor},2e3)}}};function ge(e,t,n,r,o,i){const a=u("i-input"),c=u("i-column"),d=u("i-row"),g=u("NumberPad"),C=u("i-container"),h=u("i-button"),b=u("i-modal");return p(),m(I,{to:"body"},[l(b,{"model-value":n.modelValue,color:o.modalBackground,"onUpdate:modelValue":t[4]||(t[4]=f=>e.$emit("update:modelValue",f))},{header:s(()=>[y(e.$slots,"header",{},()=>[t[5]||(t[5]=_(" **HEADER** "))])]),footer:s(()=>[l(C,null,{default:s(()=>[l(d,null,{default:s(()=>[l(c,null,{default:s(()=>[l(h,{color:"danger",onClick:i.abort},{default:s(()=>[y(e.$slots,"abort",{},()=>[t[6]||(t[6]=_(" Zurück "))])]),_:3},8,["onClick"])]),_:3}),l(c,{class:"_text-align:right"},{default:s(()=>[i.enableSubmit?(p(),m(h,{key:0,color:"success",onClick:i.submit},{default:s(()=>[y(e.$slots,"submit",{},()=>[t[7]||(t[7]=_(" OK "))])]),_:3},8,["onClick"])):w("",!0)]),_:3})]),_:3})]),_:3})]),default:s(()=>[l(C,null,{default:s(()=>[l(d,{center:"",class:"_padding-bottom:1"},{default:s(()=>[l(c,null,{default:s(()=>[l(a,{modelValue:o.number,"onUpdate:modelValue":t[0]||(t[0]=f=>o.number=f),placeholder:i.placeholder,readonly:"",size:"lg",type:n.inputVisible?"text":"password",class:"_text-align:center"},null,8,["modelValue","placeholder","type"])]),_:1})]),_:1}),l(g,{"onKey:digit":t[1]||(t[1]=f=>i.addDigit(f)),"onKey:clear":t[2]||(t[2]=f=>i.clear()),"onKey:delete":t[3]||(t[3]=f=>i.removeDigit(f))})]),_:1})]),_:3},8,["model-value","color"])])}const he=v(de,[["render",ge]]);E.add(Y,Q,L,q);const pe={name:"LockNavItem",components:{FontAwesomeIcon:O,CodeInputModal:he},props:{},data(){return{mqttStore:S(),modalPinEntryVisible:!1,modalPinEntryColor:"warning",code:"",countdown:0,countdownInterval:void 0,events:["mousemove","touchmove","wheel","click"]}},computed:{changesLocked:{get(){return this.mqttStore.settings.changesLocked},set(e){this.mqttStore.settings.changesLocked=e}},timer(){return Math.trunc(this.countdown/60).toString()+":"+(this.countdown%60).toString().padStart(2,"0")}},mounted(){this.changesLocked=!0},methods:{toggleChangesLock(){this.changesLocked?this.unlockChanges():this.lockChanges()},unlockChanges(){this.modalPinEntryVisible=!0},checkUnlockCode(e){this.mqttStore.checkChangesLockCode(e)?(this.$refs.lockInput.success("success"),this.changesLocked=!1,this.mqttStore.getDisplayStandby>0&&(this.countdown=this.mqttStore.getDisplayStandby,this.countdownInterval=setInterval(this.updateCountdown,1e3),this.events.forEach(t=>{document.addEventListener(t,this.handleDocumentEvent,{passive:!0})}))):(console.warn("check unlock code failed!"),this.$refs.lockInput.error("danger"))},lockChanges(){this.changesLocked=!0,this.events.forEach(e=>{document.removeEventListener(e,this.handleDocumentEvent,{passive:!0})}),this.countdownInterval!==void 0&&(clearInterval(this.countdownInterval),this.countdownInterval=void 0)},updateCountdown(){this.countdown-=1,this.countdown<1&&this.lockChanges()},handleDocumentEvent(){this.countdown=this.mqttStore.getDisplayStandby}}},me={key:0,class:"_padding-left:1"};function fe(e,t,n,r,o,i){const a=u("FontAwesomeIcon"),c=u("i-button"),d=u("CodeInputModal");return p(),B(P,null,[o.mqttStore.getLockChanges?(p(),m(c,{key:0,class:"_padding-left:0 _padding-right:0 _margin-bottom:1",size:"lg",block:"",color:i.changesLocked?"danger":"success",onClick:t[0]||(t[0]=g=>i.toggleChangesLock())},{default:s(()=>[l(a,{"fixed-width":"",icon:i.changesLocked?["fas","fa-lock"]:["fas","fa-lock-open"],class:A(i.changesLocked?"_color:danger-80":"_color:success-80")},null,8,["icon","class"]),!i.changesLocked&&o.countdownInterval?(p(),B("span",me,W(i.timer),1)):w("",!0)]),_:1},8,["color"])):w("",!0),l(d,{ref:"lockInput",modelValue:o.modalPinEntryVisible,"onUpdate:modelValue":t[1]||(t[1]=g=>o.modalPinEntryVisible=g),"min-length":4,"max-length":10,"onUpdate:inputValue":i.checkUnlockCode},{header:s(()=>t[2]||(t[2]=[_(" Bitte den PIN zur Freigabe von Änderungen eingeben. ")])),_:1},8,["modelValue","onUpdate:inputValue"])],64)}const _e=v(pe,[["render",fe]]),x="/openWB/web/display/themes/cards/openWB_logo_dark.png",Ce={name:"TouchBlocker",data(){return{mqttStore:S(),show:!1,countdown:void 0,countdownInterval:void 0,events:["mousemove","touchmove","wheel","click"],eventHandlerSetup:!1}},computed:{configuredDisplayStandby(){if(!(this.mqttStore.getDisplayStandby===0||this.mqttStore.getDisplayStandby===void 0))return this.mqttStore.getDisplayStandby},touchBlockerTimeout(){return Math.max(this.configuredDisplayStandby-3,1)}},mounted(){this.setupEventHandler(),this.setupTimeout()},unmounted(){this.clearEventHandler(),this.clearTimeout()},methods:{handleTouchBlockerClick(e){e===!1&&(this.show=!1,this.setupEventHandler(),this.setupTimeout())},setupEventHandler(){this.eventHandlerSetup||(this.events.forEach(e=>{document.addEventListener(e,this.handleDocumentEvent,{passive:!0})}),this.eventHandlerSetup=!0)},clearEventHandler(){this.eventHandlerSetup&&(this.events.forEach(e=>{document.removeEventListener(e,this.handleDocumentEvent,{passive:!0})}),this.eventHandlerSetup=!1)},setupTimeout(){this.countdownInterval===void 0&&(this.countdownInterval=setInterval(this.updateCountdown,1e3))},clearTimeout(){this.countdownInterval!==void 0&&(clearInterval(this.countdownInterval),this.countdownInterval=void 0)},updateCountdown(){this.countdown===void 0?this.countdown=this.touchBlockerTimeout:(this.countdown-=1,this.countdown<1&&this.showTouchBlocker())},handleDocumentEvent(){this.countdown=this.touchBlockerTimeout,this.show=!1},showTouchBlocker(){this.show=!0,this.clearTimeout()}}};function be(e,t,n,r,o,i){const a=u("IModal");return p(),m(I,{to:"body"},[l(a,{class:"touch-blocker",size:"sm",color:"dark","model-value":o.show,"onUpdate:modelValue":t[0]||(t[0]=c=>i.handleTouchBlockerClick(c))},{default:s(()=>t[1]||(t[1]=[V("img",{class:"logo",src:x},null,-1),V("p",null," Bitte das Display berühren. ",-1)])),_:1},8,["model-value"])])}const ve=v(Ce,[["render",be],["__scopeId","data-v-e4e632d4"]]),we={name:"OpenwbDisplayCardsApp",components:{RouterView:R,DateTime:te,NavBar:ce,LockNavItem:_e,TouchBlocker:ve},data(){return{client:{connected:!1},connection:{protocol:location.protocol=="https:"?"wss":"ws",host:location.hostname,port:parseInt(location.port)||(location.protocol=="https:"?443:80),endpoint:"/ws",connectTimeout:4e3,reconnectPeriod:4e3},mqttTopicsToSubscribe:["openWB/bat/config/configured","openWB/bat/get/power","openWB/bat/get/soc","openWB/chargepoint/+/config","openWB/chargepoint/+/get/charge_state","openWB/chargepoint/+/get/connected_vehicle/+","openWB/chargepoint/+/get/phases_in_use","openWB/chargepoint/+/get/plug_state","openWB/chargepoint/+/get/power","openWB/chargepoint/+/get/rfid","openWB/chargepoint/+/set/current","openWB/chargepoint/+/set/manual_lock","openWB/chargepoint/+/set/log","openWB/chargepoint/+/set/rfid","openWB/chargepoint/get/power","openWB/counter/+/get/power","openWB/counter/get/hierarchy","openWB/counter/set/home_consumption","openWB/optional/int_display/theme","openWB/optional/int_display/standby","openWB/optional/rfid/active","openWB/pv/config/configured","openWB/pv/get/power","openWB/system/current_branch","openWB/system/current_commit","openWB/system/ip_address","openWB/system/time","openWB/system/version","openWB/vehicle/+/get/fault_state","openWB/vehicle/+/name","openWB/vehicle/+/soc_module/config","openWB/vehicle/template/charge_template/#"],mqttStore:S(),chartInterval:""}},computed:{changesLocked(){return this.mqttStore.getLockChanges&&this.mqttStore.settings.changesLocked}},created(){this.createConnection()},mounted(){let e=window.location.search;if(e!=""){console.debug("search",e);let t=new URLSearchParams(e);if(t.has("data")){let n=JSON.parse(t.get("data"));Object.entries(n).forEach(([r,o])=>{console.log("updateSetting",r,o),r.startsWith("parentChargePoint")?this.mqttStore.updateSetting(r,parseInt(o)):this.mqttStore.updateSetting(r,o)})}}this.doSubscribe(this.mqttTopicsToSubscribe),this.chartInterval=setInterval(this.mqttStore.updateChartData,5e3)},beforeUnmount(){this.doUnsubscribe(this.mqttTopicsToSubscribe),clearInterval(this.chartInterval)},methods:{createConnection(){const{protocol:e,host:t,port:n,endpoint:r,...o}=this.connection,i=`${e}://${t}:${n}${r}`;console.debug("connecting to broker:",i);try{this.client=U.connect(i,o)}catch(a){console.error("mqtt.connect error",a)}this.client.on("connect",()=>{console.debug("Connection succeeded! ClientId: ",this.client.options.clientId)}),this.client.on("error",a=>{console.error("Connection failed",a)}),this.client.on("message",(a,c)=>{if(console.debug(`Received message "${c}" from topic "${a}"`),c.toString().length>0){let d;try{d=JSON.parse(c.toString())}catch(g){console.debug("Json parsing failed, fallback to string: ",a,g),d=c.toString()}this.mqttStore.addTopic(a,d)}else this.mqttStore.removeTopic(a)})},doSubscribe(e){e.forEach(t=>{this.mqttStore.initTopic(t)}),this.client.subscribe(e,{},t=>{if(t){console.error("Subscribe to topics error",t);return}})},doUnsubscribe(e){e.forEach(t=>{this.mqttStore.removeTopic(t)}),this.client.unsubscribe(e,t=>{t&&console.error("Unsubscribe error",t)})},doPublish(e,t,n=!0,r=2){console.debug("doPublish",e,t);let o={qos:r,retain:n};this.client.publish(e,JSON.stringify(t),o,i=>{i&&console.error("Publish error",i)})},sendTopicToBroker(e,t=void 0){let n=e.replace("openWB/","openWB/set/");t===void 0&&(t=this.mqttStore.topics[e]),this.doPublish(n,t)},sendCommand(e){this.doPublish("openWB/set/command/"+this.client.options.clientId+"/todo",e,!1)},sendSystemCommand(e,t={}){this.sendCommand({command:e,data:t})}}};function ye(e,t,n,r,o,i){const a=u("DateTime"),c=u("i-column"),d=u("i-row"),g=u("i-container"),C=u("LockNavItem"),h=u("NavBar"),b=u("TouchBlocker"),f=u("i-layout-aside"),N=u("RouterView"),F=u("i-layout-content"),M=u("i-layout");return p(),m(M,{vertical:""},{default:s(()=>[l(f,{class:"_position:fixed"},{default:s(()=>[l(g,{fluid:"",class:"_margin-bottom:1"},{default:s(()=>[l(d,{center:""},{default:s(()=>[l(c,null,{default:s(()=>[l(a)]),_:1})]),_:1})]),_:1}),l(C),l(h,{"changes-locked":i.changesLocked},null,8,["changes-locked"]),l(b)]),_:1}),l(F,null,{default:s(()=>[l(N,{"changes-locked":i.changesLocked},null,8,["changes-locked"])]),_:1})]),_:1})}const Be=v(we,[["render",ye],["__scopeId","data-v-ca2dbc73"]]),Se="modulepreload",ke=function(e){return"/openWB/web/display/themes/cards/"+e},$={},k=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(n.map(d=>{if(d=ke(d),d in $)return;$[d]=!0;const g=d.endsWith(".css"),C=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${C}`))return;const h=document.createElement("link");if(h.rel=g?"stylesheet":Se,g||(h.as="script"),h.crossOrigin="",h.href=d,c&&h.setAttribute("nonce",c),document.head.appendChild(h),g)return new Promise((b,f)=>{h.addEventListener("load",b),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return o.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return t().catch(i)})},We={name:"WelcomeView",data(){return{mqttStore:S()}},computed:{firstView(){if(this.mqttStore.getThemeConfiguration){if(this.mqttStore.getThemeConfiguration.enable_dashboard_view)return"dash-board";if(this.mqttStore.getThemeConfiguration.enable_energy_flow_view)return"energy-flow";if(this.mqttStore.getThemeConfiguration.enable_charge_points_view)return"charge-points";if(this.mqttStore.getThemeConfiguration.enable_status_view)return"status"}}},mounted(){setTimeout(this.selectFirstRoute,3e3)},methods:{selectFirstRoute(){this.firstView?this.$router.push({name:this.firstView}):console.warn("no router view enabled, check your configuration!")}}};function Ve(e,t,n,r,o,i){const a=u("i-card"),c=u("i-column"),d=u("i-row"),g=u("i-container");return p(),m(g,null,{default:s(()=>[l(d,{center:"",middle:""},{default:s(()=>[l(c,null,{default:s(()=>[l(a,{color:"primary"},{header:s(()=>t[0]||(t[0]=[_(" Cards Theme ")])),default:s(()=>[t[1]||(t[1]=V("img",{class:"logo",src:x},null,-1))]),_:1})]),_:1})]),_:1})]),_:1})}const Pe=v(We,[["render",Ve],["__scopeId","data-v-16686e30"]]),Te=H({history:z("/openWB/web/display/themes/cards/"),routes:[{path:"/",name:"welcome",component:Pe},{path:"/DashBoard",name:"dash-board",component:()=>k(()=>import("./DashBoardView-BJO8O7Y4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))},{path:"/EnergyFlow",name:"energy-flow",component:()=>k(()=>import("./EnergyFlowView-CAd9Xlbe.js"),__vite__mapDeps([10,1,2,3,4,5,7,11]))},{path:"/ChargePoints",name:"charge-points",component:()=>k(()=>import("./ChargePointsView-CaYX8Nkl.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,13]))},{path:"/Status",name:"status",component:()=>k(()=>import("./StatusView-DclrRcZL.js"),__vite__mapDeps([14,7,3,2,4,1,5]))}]}),T=G(Be);T.use(K());T.use(Te);T.use(J,{colorMode:"dark",components:Z});T.mount("#app");export{he as C,ue as N,S as u};
