import{u as f}from"./index-CHUZ9as_.js";import{D as q}from"./DashboardCard-DS7AgUYm.js";import{C as k}from"./ChargeModeModal-DQYfhprg.js";import{_ as y}from"./vendor-inkline-S9CBmrTS.js";import{l as V,q as g,p as h,o as r,s as u,e as c,F as S,A as x,k as b,x as z,i as n,z as v,f as P,O as B}from"./vendor-Bzn5cd2Y.js";import"./vendor-fortawesome-C1Wk2aFl.js";const R={name:"DashboardFlowCard",components:{DashboardCard:q,ChargeModeModal:k,BatteryModeModal:y({name:"BatteryModeModal",props:{modelValue:{required:!0,type:Boolean}},emits:["update:modelValue"],data:()=>({mqttStore:f(),batteryModes:[{value:"ev_mode",label:"Fahrzeuge",color:"primary"},{value:"bat_mode",label:"Speicher",color:"primary"},{value:"min_soc_bat_mode",label:"Mindest-SoC",color:"primary"}]}),methods:{setBatteryMode(t){t!==this.mqttStore.getBatteryMode&&(this.mqttStore.updateState("openWB/general/chargemode_config/pv_charging/bat_mode",t),this.$root.sendTopicToBroker("openWB/general/chargemode_config/pv_charging/bat_mode",t))}}},[["render",function(t,i,a,m,e,s){const d=h("i-button"),C=h("i-button-group"),p=h("i-form-group"),w=h("i-form"),o=h("i-modal");return r(),V(o,{"model-value":a.modelValue,size:"lg","onUpdate:modelValue":i[0]||(i[0]=l=>t.$emit("update:modelValue",l))},{header:g(()=>i[1]||(i[1]=[b(" Speicher-Beachtung: Überschuss primär für ",-1)])),default:g(()=>[u(w,null,{default:g(()=>[u(p,null,{default:g(()=>[u(C,{block:"",vertical:""},{default:g(()=>[(r(!0),c(S,null,x(e.batteryModes,l=>(r(),V(d,{key:l.value,size:"lg",class:"large-button",outline:"",color:l.color!="dark"?l.color:"light",active:l.value===e.mqttStore.getBatteryMode,onClick:ie=>s.setBatteryMode(l.value)},{default:g(()=>[b(z(l.label),1)]),_:2},1032,["color","active","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}]])},props:{changesLocked:{required:!1,type:Boolean,default:!1}},data:()=>({mqttStore:f(),svgSize:{xMin:0,xMax:150,yMin:0,yMax:105,circleRadius:10,strokeWidth:.5,textSize:5,numRows:4,numColumns:3},modalChargeModeSettingsVisible:!1,modalBatteryModeSettingsVisible:!1,modalChargePointId:0}),computed:{svgViewBox(){return`${this.svgSize.xMin} ${this.svgSize.yMin} ${this.svgSize.xMax} ${this.svgSize.yMax}`},svgFontSize(){return`${this.svgSize.textSize}px`},svgRectWidth(){return(this.svgSize.xMax-this.svgSize.xMin-this.svgSize.strokeWidth-this.svgSize.numColumns)/this.svgSize.numColumns},svgStrokeWidth(){return this.svgSize.strokeWidth},svgIconWidth(){return this.svgSize.circleRadius},svgIconHeight(){return this.svgSize.circleRadius},gridPower(){return this.mqttStore.getGridPower("object")},pvPower(){return this.mqttStore.getPvPower("object")},homePower(){return this.mqttStore.getHomePower("object")},batteryPower(){return this.mqttStore.getBatteryPower("object")},batterySoc(){return this.mqttStore.getBatterySoc("object").value/100},connectedChargePoints(){return this.mqttStore.getChargePointIds},chargePointSumPower(){return this.mqttStore.getChargePointSumPower("object")},chargePoint1Power(){return this.connectedChargePoints.length>0?this.mqttStore.getChargePointPower(this.connectedChargePoints[0],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint2Power(){return this.connectedChargePoints.length>1?this.mqttStore.getChargePointPower(this.connectedChargePoints[1],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint3Power(){return this.connectedChargePoints.length>2?this.mqttStore.getChargePointPower(this.connectedChargePoints[2],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint1Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[0])},chargePoint2Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[1])},chargePoint3Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[2])},chargePoint1VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[0])},chargePoint2VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[1])},chargePoint3VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[0])},chargePoint2ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[1])},chargePoint3ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[0])},chargePoint2ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[1])},chargePoint3ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[0]).soc/100},chargePoint2ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[1]).soc/100},chargePoint3ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[2]).soc/100},gridConsumption(){return this.gridPower.value>0},gridFeedIn(){return this.gridPower.value<0},homeConsumption(){return this.homePower.value>0},homeProduction(){return this.homePower.value<0},pvProduction(){return this.pvPower.value<0},pvConsumption(){return this.pvPower.value>0},batteryDischarging(){return this.batteryPower.value<0},batteryCharging(){return this.batteryPower.value>0},chargePointSumCharging(){return this.chargePointSumPower.value>0},chargePointSumDischarging(){return this.chargePointSumPower.value<0},chargePoint1Charging(){return this.chargePoint1Power.value>0},chargePoint1Discharging(){return this.chargePoint1Power.value<0},chargePoint2Charging(){return this.chargePoint2Power.value>0},chargePoint2Discharging(){return this.chargePoint2Power.value<0},chargePoint3Charging(){return this.chargePoint3Power.value>0},chargePoint3Discharging(){return this.chargePoint3Power.value<0},batteryModeIcon(){switch(this.mqttStore.getBatteryMode){case"ev_mode":return"icons/owbVehicle.svg";case"bat_mode":return"icons/owbBattery.svg";case"min_soc_bat_mode":return"icons/owbBattery40.svg";default:return"---"}},svgComponents(){var i,a,m,e,s,d;var t=[];return this.mqttStore.getThemeConfiguration.enable_dashboard_card_grid&&t.push({id:"grid",class:{base:"grid",valueLabel:this.gridFeedIn?"fill-success":this.gridConsumption?"fill-danger":"",animated:this.gridConsumption,animatedReverse:this.gridFeedIn},position:{row:0,column:0},label:["EVU",this.absoluteValue(this.gridPower).textValue],icon:"icons/owbGrid.svg"}),this.mqttStore.getThemeConfiguration.enable_dashboard_card_home_consumption&&t.push({id:"home",class:{base:"home",valueLabel:"",animated:this.homeProduction,animatedReverse:this.homeConsumption},position:{row:0,column:2},label:["Haus",this.absoluteValue(this.homePower).textValue],icon:"icons/owbHouse.svg"}),this.mqttStore.getPvConfigured&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_inverter_sum&&t.push({id:"pv",class:{base:"pv",valueLabel:this.pvProduction||this.pvConsumption?"fill-success":"",animated:this.pvProduction,animatedReverse:this.pvConsumption},position:{row:1,column:0},label:["PV",this.absoluteValue(this.pvPower).textValue],icon:"icons/owbPV.svg"}),this.mqttStore.getBatteryConfigured&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_battery_sum&&t.push({id:"battery",class:{base:"battery",valueLabel:"",animated:this.batteryDischarging,animatedReverse:this.batteryCharging},position:{row:1,column:2},label:["Speicher",this.absoluteValue(this.batteryPower).textValue],soc:this.batterySoc,icon:"icons/owbBattery.svg",clicked:()=>{this.selectBatteryMode()}}),this.connectedChargePoints.length>0&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_charge_point_sum&&(this.connectedChargePoints.length<=3?(t.push({id:"charge-point-1",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint1Discharging,animatedReverse:this.chargePoint1Charging},position:{row:2,column:this.connectedChargePoints.length>1?0:1},label:[this.chargePoint1Name,this.absoluteValue(this.chargePoint1Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint1VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&t.push({id:"vehicle-1",class:{base:"vehicle",valueLabel:"fill-"+((i=this.chargePoint1ConnectedVehicleChargeMode)==null?void 0:i.class),animated:this.chargePoint1Discharging,animatedReverse:this.chargePoint1Charging},position:{row:3,column:this.connectedChargePoints.length>1?0:1},label:[this.chargePoint1ConnectedVehicleName||"---",((a=this.chargePoint1ConnectedVehicleChargeMode)==null?void 0:a.label)||"---"],soc:this.chargePoint1ConnectedVehicleSoc,icon:"icons/owbVehicle.svg",clicked:()=>{this.selectChargeMode(this.connectedChargePoints[0])}}),this.connectedChargePoints.length>1&&(t.push({id:"charge-point-2",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint2Discharging,animatedReverse:this.chargePoint2Charging},position:{row:2,column:this.connectedChargePoints.length>2?1:2},label:[this.chargePoint2Name,this.absoluteValue(this.chargePoint2Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint2VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&t.push({id:"vehicle-2",class:{base:"vehicle",valueLabel:"fill-"+((m=this.chargePoint2ConnectedVehicleChargeMode)==null?void 0:m.class),animated:this.chargePoint2Discharging,animatedReverse:this.chargePoint2Charging},position:{row:3,column:this.connectedChargePoints.length>2?1:2},label:[this.chargePoint2ConnectedVehicleName||"---",((e=this.chargePoint2ConnectedVehicleChargeMode)==null?void 0:e.label)||"---"],soc:this.chargePoint2ConnectedVehicleSoc,icon:"icons/owbVehicle.svg"}),this.connectedChargePoints.length>2&&(t.push({id:"charge-point-3",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint3Discharging,animatedReverse:this.chargePoint3Charging},position:{row:2,column:2},label:[this.chargePoint3Name,this.absoluteValue(this.chargePoint3Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint3VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&t.push({id:"vehicle-3",class:{base:"vehicle",valueLabel:"fill-"+((s=this.chargePoint3ConnectedVehicleChargeMode)==null?void 0:s.class),animated:this.chargePoint3Discharging,animatedReverse:this.chargePoint3Charging},position:{row:3,column:2},label:[this.chargePoint3ConnectedVehicleName||"---",((d=this.chargePoint3ConnectedVehicleChargeMode)==null?void 0:d.label)||"---"],soc:this.chargePoint3ConnectedVehicleSoc,icon:"icons/owbVehicle.svg"})))):t.push({id:"charge-point-sum",class:{base:"charge-point",valueLabel:"",animated:this.chargePointSumDischarging,animatedReverse:this.chargePointSumCharging},position:{row:2,column:1},label:["Ladepunkte",this.absoluteValue(this.chargePointSumPower).textValue],icon:"icons/owbChargePoint.svg"})),(!this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles||this.connectedChargePoints.length===0||this.connectedChargePoints.length>3)&&this.setSvgNumRows(3),t}},watch:{changesLocked(t,i){i!==!0&&t===!0&&(this.modalChargeModeSettingsVisible=!1,this.modalBatteryModeSettingsVisible=!1)}},methods:{absoluteValue(t){let i={...t};return i.textValue&&(i.textValue=i.textValue.replace("-","")),i.value&&(i.value=Math.abs(i.value)),i.scaledValue&&(i.scaledValue=Math.abs(i.scaledValue)),i},setSvgNumRows(t){this.svgSize.numRows=t},calcRowY(t){let i=this.svgSize.yMin+this.svgSize.strokeWidth+this.svgSize.circleRadius;return t*((this.svgSize.yMax-this.svgSize.strokeWidth-this.svgSize.circleRadius-i)/(this.svgSize.numRows-1))+i},calcColumnX(t){let i=this.svgSize.xMin+this.svgSize.strokeWidth+this.svgRectWidth/2;return t*((this.svgSize.xMax-this.svgSize.strokeWidth-this.svgRectWidth/2-i)/(this.svgSize.numColumns-1))+i},calcFlowLineAnchorX(t){let i=this.calcColumnX(t);return t<(this.svgSize.numColumns-1)/2?i+this.svgRectWidth/2-this.svgSize.circleRadius:t>(this.svgSize.numColumns-1)/2?i-this.svgRectWidth/2+this.svgSize.circleRadius:i},calcSvgElementBoundingBox(t){let i=document.getElementById(t);if(i==null)return{x:0,y:0,width:0,height:0};let a=i.getBBox();return{x:a.x,y:a.y,width:a.width,height:a.height}},beginAnimation(t){var i;this.$refs[t]!=null&&((i=this.$refs[t][0])==null||i.beginElement())},selectChargeMode(t){this.changesLocked||(this.modalChargePointId=t,this.modalChargeModeSettingsVisible=!0)},selectBatteryMode(){this.changesLocked||(this.modalBatteryModeSettingsVisible=!0)}}},M=()=>{B(t=>({"1396ac8d":t.svgStrokeWidth,f3c7a99e:t.svgFontSize}))},_=R.setup;R.setup=_?(t,i)=>(M(),_(t,i)):M;const W={class:"svg-container"},$=["viewBox"],L={id:"layer1",style:{display:"inline"}},N=["d"],I={id:"layer2",style:{display:"inline"}},D=["cx","cy","r"],F=["transform","onClick"],T=["id"],A=["x","y","width","height"],j=["id"],E=["x","y","width","height","rx","ry"],X=["x","y","width","height","rx","ry"],Y=["clip-path"],H=["id","x","y"],U=["values"],G=["id","x","y"],O=["transform"],J=["r"],K=["r","clip-path"],Q=["href","x","y","height","width"],Z={key:0},ee=["x","y","width","height","rx","ry"],te=["href","x","y","height","width"],he=y({name:"EnergyFlowView",components:{FlowCard:y(R,[["render",function(t,i,a,m,e,s){const d=h("charge-mode-modal"),C=h("battery-mode-modal"),p=h("i-container"),w=h("dashboard-card");return r(),c(S,null,[u(d,{modelValue:e.modalChargeModeSettingsVisible,"onUpdate:modelValue":i[0]||(i[0]=o=>e.modalChargeModeSettingsVisible=o),"charge-point-id":e.modalChargePointId},null,8,["modelValue","charge-point-id"]),u(C,{modelValue:e.modalBatteryModeSettingsVisible,"onUpdate:modelValue":i[1]||(i[1]=o=>e.modalBatteryModeSettingsVisible=o)},null,8,["modelValue"]),u(w,{color:"primary"},{headerLeft:g(()=>i[2]||(i[2]=[b(" Übersicht - Energiefluss ",-1)])),default:g(()=>[u(p,null,{default:g(()=>[n("div",W,[(r(),c("svg",{viewBox:s.svgViewBox,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg"},[n("g",L,[(r(!0),c(S,null,x(s.svgComponents,o=>(r(),c("path",{key:o.id,class:v([o.class.base,{animated:o.class.animated},{animatedReverse:o.class.animatedReverse}]),d:o.class.base!=="vehicle"?`M ${s.calcFlowLineAnchorX(o.position.column)}, ${s.calcRowY(o.position.row)} ${s.calcColumnX(1)}, ${s.calcRowY(1)}`:`M ${s.calcFlowLineAnchorX(o.position.column)}, ${s.calcRowY(o.position.row)} ${s.calcFlowLineAnchorX(o.position.column)}, ${s.calcRowY(o.position.row-1)}`},null,10,N))),128))]),n("g",I,[n("circle",{id:"center",cx:s.calcColumnX(1),cy:s.calcRowY(1),r:e.svgSize.circleRadius/3},null,8,D),(r(!0),c(S,null,x(s.svgComponents,o=>(r(),c("g",{key:o.id,class:v(o.class.base),transform:`translate(${s.calcColumnX(o.position.column)}, ${s.calcRowY(o.position.row)})`,onClick:l=>{s.beginAnimation(`animate-label-${o.id}`),o.clicked&&o.clicked()}},[n("defs",null,[o.soc?(r(),c("clipPath",{key:0,id:`clip-soc-${o.id}`},[n("rect",{x:-e.svgSize.circleRadius-e.svgSize.strokeWidth,y:(e.svgSize.circleRadius+e.svgSize.strokeWidth)*(1-2*o.soc),width:2*(e.svgSize.circleRadius+e.svgSize.strokeWidth),height:2*(e.svgSize.circleRadius+e.svgSize.strokeWidth)*o.soc},null,8,A)],8,T)):P("",!0),n("clipPath",{id:`clip-label-${o.id}`},[n("rect",{x:-s.svgRectWidth/2,y:-e.svgSize.circleRadius,width:s.svgRectWidth,height:2*e.svgSize.circleRadius,rx:e.svgSize.circleRadius,ry:e.svgSize.circleRadius},null,8,E)],8,j)]),n("rect",{x:-s.svgRectWidth/2,y:-e.svgSize.circleRadius,width:s.svgRectWidth,height:2*e.svgSize.circleRadius,rx:e.svgSize.circleRadius,ry:e.svgSize.circleRadius},null,8,X),n("text",{"clip-path":`url(#clip-label-${o.id})`},[n("tspan",{id:`label-${o.id}`,"text-anchor":"start",x:-s.svgRectWidth/2+2*e.svgSize.circleRadius+e.svgSize.strokeWidth,y:-e.svgSize.textSize/2},[s.calcSvgElementBoundingBox(`label-${o.id}`).width>s.svgRectWidth-2*e.svgSize.circleRadius-2*e.svgSize.strokeWidth?(r(),c("animate",{key:0,ref_for:!0,ref:`animate-label-${o.id}`,xmlns:"http://www.w3.org/2000/svg",attributeName:"x",dur:"5s",values:"0; "+(-s.calcSvgElementBoundingBox(`label-${o.id}`).width+s.svgRectWidth-2.5*e.svgSize.circleRadius-2*e.svgSize.strokeWidth)+"; 0;",repeatCount:"0",begin:"2s",additive:"sum"},null,8,U)):P("",!0),b(" "+z(o.label[0]),1)],8,H),n("tspan",{id:`value-${o.id}`,class:v(o.class.valueLabel),"text-anchor":"end",x:2*e.svgSize.circleRadius+e.svgSize.strokeWidth,y:e.svgSize.textSize},z(o.label[1]),11,G)],8,Y),n("g",{transform:`translate(${e.svgSize.circleRadius-s.svgRectWidth/2}, 0)`},[n("circle",{cx:"0",cy:"0",r:e.svgSize.circleRadius,class:v({soc:o.soc})},null,10,J),o.soc?(r(),c("circle",{key:0,cx:"0",cy:"0",r:e.svgSize.circleRadius,"clip-path":`url(#clip-soc-${o.id})`},null,8,K)):P("",!0),n("image",{href:o.icon,x:-s.svgIconWidth/2,y:-s.svgIconHeight/2,height:s.svgIconHeight,width:s.svgIconWidth},null,8,Q)],8,O),o.id==="battery"?(r(),c("g",Z,[n("rect",{x:1.2*e.svgSize.circleRadius,y:1.4*-e.svgSize.circleRadius,width:1.1*e.svgSize.circleRadius,height:.7*e.svgSize.circleRadius,rx:.3*e.svgSize.circleRadius,ry:.55*e.svgSize.circleRadius,class:"battery-mode-button",opacity:"1"},null,8,ee),n("image",{href:s.batteryModeIcon,x:1.45*e.svgSize.circleRadius,y:1.35*-e.svgSize.circleRadius,height:.6*e.svgSize.circleRadius,width:.6*e.svgSize.circleRadius},null,8,te)])):P("",!0)],10,F))),128))])],8,$))])]),_:1})]),_:1})],64)}],["__scopeId","data-v-7762bd7f"]])},props:{changesLocked:{required:!1,type:Boolean,default:!1}}},[["render",function(t,i,a,m,e,s){const d=h("FlowCard");return r(),V(d,{"changes-locked":a.changesLocked},null,8,["changes-locked"])}]]);export{he as default};
