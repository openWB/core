import{o as p,e as y,k as l,y as m,j as C,F as k,l as u,p as g,q as a,f as w,t as d,G as N,R as V,H as R,i as S,A as E,n as A,I as O,J as M,K as H,L as F,M as U}from"./vendor-0154dd84.js";import{_ as v,I as z,c as j}from"./vendor-inkline-03425daf.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerpolicy&&(t.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?t.credentials="include":n.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(n){if(n.ep)return;n.ep=!0;const t=i(n);fetch(n.href,t)}})();const G={name:"DateTime",props:{separator:{String,default:"<br />"}},data(){return{dateTimeInterval:"",date:"",time:""}},methods:{update(){const e=new Date,r={weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"},i={hour:"2-digit",minute:"2-digit",second:"2-digit"};this.date=e.toLocaleDateString(void 0,r),this.time=e.toLocaleTimeString(void 0,i)}},mounted(){this.update(),this.dateTimeInterval=setInterval(this.update,1e3)},beforeUnmount(){clearInterval(this.dateTimeInterval)}},J=["innerHTML"];function K(e,r,i,s,n,t){return p(),y(k,null,[l(m(n.time),1),C("span",{innerHTML:i.separator},null,8,J),l(m(n.date),1)],64)}const Y=v(G,[["render",K]]);const Z={name:"NavItem",props:{to:{type:Object,required:!0}}};function Q(e,r,i,s,n,t){const o=u("i-nav-item");return p(),g(o,{to:i.to,"active-class":"-active",class:"_border _border-color:primary _text-align:center"},{default:a(()=>[w(e.$slots,"default",{},void 0,!0)]),_:3},8,["to"])}const X=v(Z,[["render",Q],["__scopeId","data-v-1db6ae73"]]),ee={name:"NavBar",components:{NavItem:X}};function te(e,r,i,s,n,t){const o=u("nav-item"),c=u("i-nav");return p(),g(c,{vertical:"",class:"_align-items:stretch"},{default:a(()=>[d(o,{to:{name:"dash-board"}},{default:a(()=>[l(" DashBoard ")]),_:1}),d(o,{to:{name:"charge-points"}},{default:a(()=>[l(" Ladepunkte ")]),_:1}),d(o,{to:{name:"status"}},{default:a(()=>[l(" Status ")]),_:1})]),_:1})}const re=v(ee,[["render",te]]),T=N("mqtt",{state:()=>({topics:{},chartData:{}}),getters:{getWildcardIndexList:e=>(r,i=!1)=>{let s=r;i||(s="^"+r.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$");let n=Object.keys(e.topics).filter(t=>t.match(s));return n.forEach((t,o,c)=>{c[o]=parseInt(t.match(/(?:\/)([0-9]+)(?=\/)*/g)[0].replace(/[^0-9]+/g,""))}),n},getWildcardTopics:e=>(r,i=!1)=>{let s=r;return i||(s="^"+r.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$"),Object.keys(e.topics).filter(n=>n.match(s)).reduce((n,t)=>({...n,[t]:e.topics[t]}),{})},getObjectIds:e=>r=>{function i(s){let n=[];return s!==void 0&&s.forEach(t=>{t.type==r&&n.push(t.id),n=[...n,...i(t.children)]}),n}return i(e.topics["openWB/counter/get/hierarchy"])},getGridId(e){let r=e.topics["openWB/counter/get/hierarchy"];if(r!==void 0&&Object.keys(r).length>0){let i=Object.keys(e.topics["openWB/counter/get/hierarchy"])[0];if(console.debug("getGridId",i,e.topics["openWB/counter/get/hierarchy"][i]),e.topics["openWB/counter/get/hierarchy"][i].type=="counter")return e.topics["openWB/counter/get/hierarchy"][i].id}},getValueBool:e=>r=>{let i=e.topics[r];return i!==void 0?i:!1},getValueString:e=>(r,i="W",s=!1)=>{var n="",t=e.topics[r];if(t===void 0)return`--- ${n}${i}`;s&&(t*=-1);var o=t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0});return(t>999||t<-999)&&(o=(t/1e3).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),n="k",(t>999999||t<-999999)&&(o=(t/1e6).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),n="M")),`${o} ${n}${i}`}},actions:{initTopic(e,r=void 0){e.includes("#")||e.includes("+")?console.debug("skipping init of wildcard topic:",e):this.addTopic(e,r)},addTopic(e,r){console.debug("addTopic",e,r),this.topics[e]=r,(e.endsWith("home_consumption")||e.endsWith("power")||e.endsWith("soc"))&&r!==void 0&&(this.chartData[e]===void 0&&(this.chartData[e]=[]),this.chartData[e].push(r),this.chartData[e].slice(-128))},removeTopic(e){e.includes("#")||e.includes("+")?(console.debug("expanding wildcard topic for removal:",e),Object.keys(this.getWildcardTopics(e)).forEach(r=>{console.debug("removing wildcardTopic:",r),delete this.topics[r]})):delete this.topics[e]},updateTopic(e,r,i=void 0){const s=(n,t,o)=>t.split(".").reduce((c,_,h)=>c[_]=t.split(".").length===++h?o:c[_]||{},n);e in this.topics?i!=null?s(this.topics[e],i,r):this.topics[e]=r:console.debug("topic not found: ",e)},updateState(e,r,i=void 0){console.debug("updateState:",e,r,i),this.updateTopic(e,r,i)}}});const oe={name:"openwbDisplayCardsApp",components:{RouterView:V,DateTime:Y,NavBar:re},data(){return{client:{connected:!1},connection:{protocol:location.protocol=="https:"?"wss":"ws",host:location.hostname,port:parseInt(location.port)||(location.protocol=="https:"?443:80),endpoint:"/ws",connectTimeout:4e3,reconnectPeriod:4e3},mqttTopicsToSubscribe:["openWB/counter/get/hierarchy","openWB/counter/set/home_consumption","openWB/counter/+/get/power","openWB/bat/config/configured","openWB/bat/get/power","openWB/bat/get/soc","openWB/chargepoint/get/power","openWB/pv/config/configured","openWB/pv/get/power","openWB/chargepoint/+/get/power","openWB/chargepoint/+/get/plug_state","openWB/chargepoint/+/get/charge_state","openWB/chargepoint/+/get/phases_in_use","openWB/chargepoint/+/set/current","openWB/chargepoint/+/config"],mqttStore:T()}},methods:{createConnection(){const{protocol:e,host:r,port:i,endpoint:s,...n}=this.connection,t=`${e}://${r}:${i}${s}`;console.debug("connecting to broker:",t);try{this.client=R.connect(t,n)}catch(o){console.error("mqtt.connect error",o)}this.client.on("connect",()=>{console.debug("Connection succeeded! ClientId: ",this.client.options.clientId)}),this.client.on("error",o=>{console.error("Connection failed",o)}),this.client.on("message",(o,c)=>{if(console.debug(`Received message "${c}" from topic "${o}"`),c.toString().length>0){let _;try{_=JSON.parse(c.toString())}catch{console.debug("Json parsing failed, fallback to string: ",o),_=c.toString()}this.mqttStore.addTopic(o,_)}else this.mqttStore.removeTopic(o)})},doSubscribe(e){e.forEach(r=>{this.mqttStore.initTopic(r)}),this.client.subscribe(e,{},r=>{if(r){console.error("Subscribe to topics error",r);return}})},doUnsubscribe(e){e.forEach(r=>{this.mqttStore.removeTopic(r)}),this.client.unsubscribe(e,r=>{r&&console.error("Unsubscribe error",r)})}},created(){this.createConnection()},mounted(){this.doSubscribe(this.mqttTopicsToSubscribe)},beforeUnmount(){this.doUnsubscribe(this.mqttTopicsToSubscribe)}};function ne(e,r,i,s,n,t){const o=u("DateTime"),c=u("i-column"),_=u("i-row"),h=u("i-container"),f=u("NavBar"),b=u("i-layout-aside"),q=u("RouterView"),L=u("i-layout-content"),I=u("i-layout");return p(),g(I,{vertical:""},{default:a(()=>[d(b,{class:"_position:fixed"},{default:a(()=>[d(h,{fluid:"",class:"_margin-bottom:1"},{default:a(()=>[d(_,{center:""},{default:a(()=>[d(c,null,{default:a(()=>[d(o)]),_:1})]),_:1})]),_:1}),d(f)]),_:1}),d(L,null,{default:a(()=>[d(q)]),_:1})]),_:1})}const ie=v(oe,[["render",ne],["__scopeId","data-v-6502e541"]]),ae="modulepreload",se=function(e){return"/openWB/web/display/themes/cards/"+e},W={},P=function(r,i,s){if(!i||i.length===0)return r();const n=document.getElementsByTagName("link");return Promise.all(i.map(t=>{if(t=se(t),t in W)return;W[t]=!0;const o=t.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(!!s)for(let f=n.length-1;f>=0;f--){const b=n[f];if(b.href===t&&(!o||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${c}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":ae,o||(h.as="script",h.crossOrigin=""),h.href=t,document.head.appendChild(h),o)return new Promise((f,b)=>{h.addEventListener("load",f),h.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>r())};const ce={name:"DashBoardCard",props:{color:String}};function de(e,r,i,s,n,t){const o=u("i-column"),c=u("i-row"),_=u("i-container"),h=u("i-card");return p(),g(h,{color:i.color},{header:a(()=>[d(_,null,{default:a(()=>[d(c,null,{default:a(()=>[d(o,null,{default:a(()=>[w(e.$slots,"headerLeft",{},void 0,!0)]),_:3}),e.$slots.headerRight?(p(),g(o,{key:0,class:"_text-align:right"},{default:a(()=>[w(e.$slots,"headerRight",{},void 0,!0)]),_:3})):S("",!0)]),_:3})]),_:3})]),default:a(()=>[w(e.$slots,"default",{},void 0,!0)]),_:3},8,["color"])}const ue=v(ce,[["render",de],["__scopeId","data-v-82b77f72"]]);const D={props:{data:{required:!0,type:Array,default(){return[]}},width:{Number,default:250},height:{Number,default:70},gap:{Number,default:2},stroke:{Number,default:3},min:{Number,default:0},max:{Number,default:1},color:{String,default:"var(--color--primary)"},colorNegative:{String,default:void 0}},computed:{highestPoint(){return Math.max(1,this.max,...this.slicedData)},lowestPoint(){return Math.min(0,this.min,...this.slicedData)},maxPoints(){return Math.floor(this.width/(this.stroke+this.gap))},slicedData(){return this.data.slice(-this.maxPoints)},zeroHeight(){return this.height-(0-this.lowestPoint)/(this.highestPoint-this.lowestPoint)*this.height},coordinates(){const e=[];return this.slicedData.forEach((r,i)=>{const s=i*this.width/this.maxPoints,n=this.height-(r-this.lowestPoint)/(this.highestPoint-this.lowestPoint)*this.height;e.push({x:s,y:n})}),e},bars(){const e=[];return this.coordinates.forEach(r=>{const i=r.x,s=r.y,n=this.stroke,t=Math.min(s,this.zeroHeight),o=Math.abs(s-this.zeroHeight),c=s>this.zeroHeight;e.push({x:i,y:t,width:n,height:o,negative:c})}),e},fillEndPath(){return`V ${this.height} L 4 ${this.height} Z`}}},$=()=>{O(e=>({"1b1ce0b4":e.color,c9c745ee:e.colorNegative}))},x=D.setup;D.setup=x?(e,r)=>($(),x(e,r)):$;const le=D,he=["viewBox"],pe=["x","y","width","height"],_e=["d"];function me(e,r,i,s,n,t){return p(),y("svg",{class:"spark-line",viewBox:`0 0 ${i.width} ${i.height}`,width:"100%",preserveAspectRatio:"xMinYMin"},[(p(!0),y(k,null,E(t.bars,o=>(p(),y("rect",{key:o.x,x:o.x,y:o.y,width:o.width,height:o.height,class:A(i.colorNegative&&o.negative?"negative":"")},null,10,pe))),128)),C("path",{class:"zero-line",d:`M 0 ${t.zeroHeight} L ${i.width} ${t.zeroHeight}`},null,8,_e)],8,he)}const ge=v(le,[["render",me],["__scopeId","data-v-301df054"]]);const fe={name:"DashBoard",data(){return{mqttStore:T()}},components:{DashBoardCard:ue,SparkLine:ge},computed:{gridPower(){let e=0;return e=this.mqttStore.getGridId,e===void 0?"---":this.mqttStore.getValueString(`openWB/counter/${e}/get/power`,"W")},gridPowerChartData(){let e=0;return e=this.mqttStore.getGridId,e===void 0?[]:this.mqttStore.chartData[`openWB/counter/${e}/get/power`]},homePower(){return this.mqttStore.getValueString("openWB/counter/set/home_consumption","W")},homePowerChartData(){return this.mqttStore.chartData["openWB/counter/set/home_consumption"]},batteryConfigured(){return this.mqttStore.getValueBool("openWB/bat/config/configured")},batteryPower(){return this.mqttStore.getValueString("openWB/bat/get/power","W")},batteryPowerChartData(){return this.mqttStore.chartData["openWB/bat/get/power"]},batterySoc(){return this.mqttStore.getValueString("openWB/bat/get/soc","%")},batterySocChartData(){return this.mqttStore.chartData["openWB/bat/get/soc"]},chargePointSumPower(){return this.mqttStore.getValueString("openWB/chargepoint/get/power","W")},chargePointSumPowerChartData(){return this.mqttStore.chartData["openWB/chargepoint/get/power"]},pvConfigured(){return this.mqttStore.getValueBool("openWB/pv/config/configured")},pvPower(){return this.mqttStore.getValueString("openWB/pv/get/power","W",!0)},pvPowerChartData(){return this.mqttStore.chartData["openWB/pv/get/power"].map(e=>e*-1)}}},ve={class:"dash-board-card-wrapper"};function be(e,r,i,s,n,t){const o=u("spark-line"),c=u("dash-board-card");return p(),y("div",ve,[d(c,{color:"danger"},{headerLeft:a(()=>[l(" EVU ")]),headerRight:a(()=>[l(m(t.gridPower),1)]),default:a(()=>[d(o,{color:"var(--color--danger)",colorNegative:"var(--color--success)",data:t.gridPowerChartData},null,8,["data"])]),_:1}),d(c,{color:"light"},{headerLeft:a(()=>[l(" Hausverbrauch ")]),headerRight:a(()=>[l(m(t.homePower),1)]),default:a(()=>[d(o,{color:"var(--color--light)",data:t.homePowerChartData},null,8,["data"])]),_:1}),t.batteryConfigured?(p(),g(c,{key:0,color:"warning"},{headerLeft:a(()=>[l(" Speicher ")]),headerRight:a(()=>[l(m(t.batteryPower),1)]),default:a(()=>[d(o,{color:"var(--color--warning)",data:t.batteryPowerChartData},null,8,["data"])]),_:1})):S("",!0),t.batteryConfigured?(p(),g(c,{key:1,color:"warning"},{headerLeft:a(()=>[l(" Speicher SoC ")]),headerRight:a(()=>[l(m(t.batterySoc),1)]),default:a(()=>[d(o,{color:"var(--color--warning)",data:t.batterySocChartData,min:0,max:100},null,8,["data"])]),_:1})):S("",!0),d(c,{color:"primary"},{headerLeft:a(()=>[l(" Ladepunkte ")]),headerRight:a(()=>[l(m(t.chargePointSumPower),1)]),default:a(()=>[d(o,{color:"var(--color--primary)",data:t.chargePointSumPowerChartData},null,8,["data"])]),_:1}),t.pvConfigured?(p(),g(c,{key:2,color:"success"},{headerLeft:a(()=>[l(" PV ")]),headerRight:a(()=>[l(m(t.pvPower),1)]),default:a(()=>[d(o,{color:"var(--color--success)",data:t.pvPowerChartData,inverted:!0},null,8,["data"])]),_:1})):S("",!0)])}const ye=v(fe,[["render",be],["__scopeId","data-v-e65edafd"]]),we=M({history:H("/openWB/web/display/themes/cards/"),routes:[{path:"/",alias:"/DashBoard",name:"dash-board",component:ye},{path:"/ChargePoints",name:"charge-points",component:()=>P(()=>import("./ChargePointsView-5343bf94.js"),["assets/ChargePointsView-5343bf94.js","assets/vendor-fortawesome-fb1f377a.js","assets/vendor-0154dd84.js","assets/vendor-inkline-03425daf.js","assets/vendor-inkline-f6027a3e.css","assets/ChargePointsView-7c7369f9.css"])},{path:"/Status",name:"status",component:()=>P(()=>import("./StatusView-5b763ca4.js"),["assets/StatusView-5b763ca4.js","assets/vendor-inkline-03425daf.js","assets/vendor-0154dd84.js","assets/vendor-inkline-f6027a3e.css"])}]});const B=F(ie);B.use(U());B.use(we);B.use(z,{colorMode:"dark",components:j});B.mount("#app");export{ue as D,ge as S,T as u};
