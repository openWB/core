import{u as y}from"./index-DAUHX-z6.js";import{D as f}from"./DashboardCard-DS7AgUYm.js";import{C as q}from"./ChargeModeModal-D1UJpAHo.js";import{e as h,s as u,p as l,q as m,F as v,o as r,i as s,A as C,z as d,f as P,k as b,x as w,O as M,l as _}from"./vendor-Bzn5cd2Y.js";import{_ as p}from"./vendor-inkline-S9CBmrTS.js";import"./vendor-fortawesome-CfiBAnfT.js";const S={name:"DashboardFlowCard",components:{DashboardCard:f,ChargeModeModal:q},props:{changesLocked:{required:!1,type:Boolean,default:!1}},data:()=>({mqttStore:y(),svgSize:{xMin:0,xMax:150,yMin:0,yMax:105,circleRadius:10,strokeWidth:.5,textSize:5,numRows:4,numColumns:3},modalChargeModeSettingsVisible:!1,modalChargePointId:0}),computed:{svgViewBox(){return`${this.svgSize.xMin} ${this.svgSize.yMin} ${this.svgSize.xMax} ${this.svgSize.yMax}`},svgFontSize(){return`${this.svgSize.textSize}px`},svgRectWidth(){return(this.svgSize.xMax-this.svgSize.xMin-this.svgSize.strokeWidth-this.svgSize.numColumns)/this.svgSize.numColumns},svgStrokeWidth(){return this.svgSize.strokeWidth},svgIconWidth(){return this.svgSize.circleRadius},svgIconHeight(){return this.svgSize.circleRadius},gridPower(){return this.mqttStore.getGridPower("object")},pvPower(){return this.mqttStore.getPvPower("object")},homePower(){return this.mqttStore.getHomePower("object")},batteryPower(){return this.mqttStore.getBatteryPower("object")},batterySoc(){return this.mqttStore.getBatterySoc("object").value/100},connectedChargePoints(){return this.mqttStore.getChargePointIds},chargePointSumPower(){return this.mqttStore.getChargePointSumPower("object")},chargePoint1Power(){return this.connectedChargePoints.length>0?this.mqttStore.getChargePointPower(this.connectedChargePoints[0],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint2Power(){return this.connectedChargePoints.length>1?this.mqttStore.getChargePointPower(this.connectedChargePoints[1],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint3Power(){return this.connectedChargePoints.length>2?this.mqttStore.getChargePointPower(this.connectedChargePoints[2],"object")||{textValue:"Loading..."}:{textValue:"N/A"}},chargePoint1Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[0])},chargePoint2Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[1])},chargePoint3Name(){return this.mqttStore.getChargePointName(this.connectedChargePoints[2])},chargePoint1VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[0])},chargePoint2VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[1])},chargePoint3VehicleConnected(){return this.mqttStore.getChargePointPlugState(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[0])},chargePoint2ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[1])},chargePoint3ConnectedVehicleName(){return this.mqttStore.getChargePointConnectedVehicleName(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[0])},chargePoint2ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[1])},chargePoint3ConnectedVehicleChargeMode(){return this.mqttStore.getChargePointConnectedVehicleChargeMode(this.connectedChargePoints[2])},chargePoint1ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[0]).soc/100},chargePoint2ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[1]).soc/100},chargePoint3ConnectedVehicleSoc(){return this.mqttStore.getChargePointConnectedVehicleSoc(this.connectedChargePoints[2]).soc/100},gridConsumption(){return this.gridPower.value>0},gridFeedIn(){return this.gridPower.value<0},homeConsumption(){return this.homePower.value>0},homeProduction(){return this.homePower.value<0},pvProduction(){return this.pvPower.value>0},batteryDischarging(){return this.batteryPower.value<0},batteryCharging(){return this.batteryPower.value>0},chargePointSumCharging(){return this.chargePointSumPower.value>0},chargePointSumDischarging(){return this.chargePointSumPower.value<0},chargePoint1Charging(){return this.chargePoint1Power.value>0},chargePoint1Discharging(){return this.chargePoint1Power.value<0},chargePoint2Charging(){return this.chargePoint2Power.value>0},chargePoint2Discharging(){return this.chargePoint2Power.value<0},chargePoint3Charging(){return this.chargePoint3Power.value>0},chargePoint3Discharging(){return this.chargePoint3Power.value<0},svgComponents(){var t,a,g,o,n,c;var e=[];return this.mqttStore.getThemeConfiguration.enable_dashboard_card_grid&&e.push({id:"grid",class:{base:"grid",valueLabel:this.gridFeedIn?"fill-success":this.gridConsumption?"fill-danger":"",animated:this.gridConsumption,animatedReverse:this.gridFeedIn},position:{row:0,column:0},label:["EVU",this.absoluteValue(this.gridPower).textValue],icon:"icons/owbGrid.svg"}),this.mqttStore.getThemeConfiguration.enable_dashboard_card_home_consumption&&e.push({id:"home",class:{base:"home",valueLabel:"",animated:this.homeProduction,animatedReverse:this.homeConsumption},position:{row:0,column:2},label:["Haus",this.absoluteValue(this.homePower).textValue],icon:"icons/owbHouse.svg"}),this.mqttStore.getPvConfigured&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_inverter_sum&&e.push({id:"pv",class:{base:"pv",valueLabel:this.pvProduction?"fill-success":"",animated:this.pvProduction,animatedReverse:!1},position:{row:1,column:0},label:["PV",this.absoluteValue(this.pvPower).textValue],icon:"icons/owbPV.svg"}),this.mqttStore.getBatteryConfigured&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_battery_sum&&e.push({id:"battery",class:{base:"battery",valueLabel:"",animated:this.batteryDischarging,animatedReverse:this.batteryCharging},position:{row:1,column:2},label:["Speicher",this.absoluteValue(this.batteryPower).textValue],soc:this.batterySoc,icon:"icons/owbBattery.svg"}),this.connectedChargePoints.length>0&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_charge_point_sum&&(this.connectedChargePoints.length<=3?(e.push({id:"charge-point-1",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint1Discharging,animatedReverse:this.chargePoint1Charging},position:{row:2,column:this.connectedChargePoints.length>1?0:1},label:[this.chargePoint1Name,this.absoluteValue(this.chargePoint1Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint1VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&e.push({id:"vehicle-1",class:{base:"vehicle",valueLabel:"fill-"+((t=this.chargePoint1ConnectedVehicleChargeMode)==null?void 0:t.class),animated:this.chargePoint1Discharging,animatedReverse:this.chargePoint1Charging},position:{row:3,column:this.connectedChargePoints.length>1?0:1},label:[this.chargePoint1ConnectedVehicleName||"---",((a=this.chargePoint1ConnectedVehicleChargeMode)==null?void 0:a.label)||"---"],soc:this.chargePoint1ConnectedVehicleSoc,icon:"icons/owbVehicle.svg",clicked:()=>{this.selectChargeMode(this.connectedChargePoints[0])}}),this.connectedChargePoints.length>1&&(e.push({id:"charge-point-2",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint2Discharging,animatedReverse:this.chargePoint2Charging},position:{row:2,column:this.connectedChargePoints.length>2?1:2},label:[this.chargePoint2Name,this.absoluteValue(this.chargePoint2Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint2VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&e.push({id:"vehicle-2",class:{base:"vehicle",valueLabel:"fill-"+((g=this.chargePoint2ConnectedVehicleChargeMode)==null?void 0:g.class),animated:this.chargePoint2Discharging,animatedReverse:this.chargePoint2Charging},position:{row:3,column:this.connectedChargePoints.length>2?1:2},label:[this.chargePoint2ConnectedVehicleName||"---",((o=this.chargePoint2ConnectedVehicleChargeMode)==null?void 0:o.label)||"---"],soc:this.chargePoint2ConnectedVehicleSoc,icon:"icons/owbVehicle.svg"}),this.connectedChargePoints.length>2&&(e.push({id:"charge-point-3",class:{base:"charge-point",valueLabel:"",animated:this.chargePoint3Discharging,animatedReverse:this.chargePoint3Charging},position:{row:2,column:2},label:[this.chargePoint3Name,this.absoluteValue(this.chargePoint3Power).textValue],icon:"icons/owbChargePoint.svg"}),this.chargePoint3VehicleConnected&&this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles&&e.push({id:"vehicle-3",class:{base:"vehicle",valueLabel:"fill-"+((n=this.chargePoint3ConnectedVehicleChargeMode)==null?void 0:n.class),animated:this.chargePoint3Discharging,animatedReverse:this.chargePoint3Charging},position:{row:3,column:2},label:[this.chargePoint3ConnectedVehicleName||"---",((c=this.chargePoint3ConnectedVehicleChargeMode)==null?void 0:c.label)||"---"],soc:this.chargePoint3ConnectedVehicleSoc,icon:"icons/owbVehicle.svg"})))):e.push({id:"charge-point-sum",class:{base:"charge-point",valueLabel:"",animated:this.chargePointSumDischarging,animatedReverse:this.chargePointSumCharging},position:{row:2,column:1},label:["Ladepunkte",this.absoluteValue(this.chargePointSumPower).textValue],icon:"icons/owbChargePoint.svg"})),(!this.mqttStore.getThemeConfiguration.enable_dashboard_card_vehicles||this.connectedChargePoints.length===0||this.connectedChargePoints.length>3)&&this.setSvgNumRows(3),e}},watch:{changesLocked(e,t){t!==!0&&e===!0&&(this.modalChargeModeSettingsVisible=!1)}},methods:{absoluteValue(e){let t={...e};return t.textValue&&(t.textValue=t.textValue.replace("-","")),t.value&&(t.value=Math.abs(t.value)),t.scaledValue&&(t.scaledValue=Math.abs(t.scaledValue)),t},setSvgNumRows(e){this.svgSize.numRows=e},calcRowY(e){let t=this.svgSize.yMin+this.svgSize.strokeWidth+this.svgSize.circleRadius;return e*((this.svgSize.yMax-this.svgSize.strokeWidth-this.svgSize.circleRadius-t)/(this.svgSize.numRows-1))+t},calcColumnX(e){let t=this.svgSize.xMin+this.svgSize.strokeWidth+this.svgRectWidth/2;return e*((this.svgSize.xMax-this.svgSize.strokeWidth-this.svgRectWidth/2-t)/(this.svgSize.numColumns-1))+t},calcFlowLineAnchorX(e){let t=this.calcColumnX(e);return e<(this.svgSize.numColumns-1)/2?t+this.svgRectWidth/2-this.svgSize.circleRadius:e>(this.svgSize.numColumns-1)/2?t-this.svgRectWidth/2+this.svgSize.circleRadius:t},calcSvgElementBoundingBox(e){let t=document.getElementById(e);if(t==null)return{x:0,y:0,width:0,height:0};let a=t.getBBox();return{x:a.x,y:a.y,width:a.width,height:a.height}},beginAnimation(e){var t;this.$refs[e]!=null&&((t=this.$refs[e][0])==null||t.beginElement())},selectChargeMode(e){this.changesLocked||(this.modalChargePointId=e,this.modalChargeModeSettingsVisible=!0)}}},V=()=>{M(e=>({"4830d832":e.svgStrokeWidth,"4cb129ac":e.svgFontSize}))},x=S.setup;S.setup=x?(e,t)=>(V(),x(e,t)):V;const k={class:"svg-container"},W=["viewBox"],$={id:"layer1",style:{display:"inline"}},L=["d"],N={id:"layer2",style:{display:"inline"}},B=["cx","cy","r"],D=["transform","onClick"],I=["id"],F=["x","y","width","height"],A=["id"],j=["x","y","width","height","rx","ry"],T=["x","y","width","height","rx","ry"],X=["clip-path"],E=["id","x","y"],Y=["values"],H=["id","x","y"],G=["transform"],U=["r"],O=["r","clip-path"],J=["href","x","y","height","width"],ne=p({name:"EnergyFlowView",components:{FlowCard:p(S,[["render",function(e,t,a,g,o,n){const c=l("charge-mode-modal"),z=l("i-container"),R=l("dashboard-card");return r(),h(v,null,[u(c,{modelValue:o.modalChargeModeSettingsVisible,"onUpdate:modelValue":t[0]||(t[0]=i=>o.modalChargeModeSettingsVisible=i),"charge-point-id":o.modalChargePointId},null,8,["modelValue","charge-point-id"]),u(R,{color:"primary"},{headerLeft:m(()=>t[1]||(t[1]=[b(" Übersicht - Energiefluss ",-1)])),default:m(()=>[u(z,null,{default:m(()=>[s("div",k,[(r(),h("svg",{viewBox:n.svgViewBox,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg"},[s("g",$,[(r(!0),h(v,null,C(n.svgComponents,i=>(r(),h("path",{key:i.id,class:d([i.class.base,{animated:i.class.animated},{animatedReverse:i.class.animatedReverse}]),d:i.class.base!=="vehicle"?`M ${n.calcFlowLineAnchorX(i.position.column)}, ${n.calcRowY(i.position.row)} ${n.calcColumnX(1)}, ${n.calcRowY(1)}`:`M ${n.calcFlowLineAnchorX(i.position.column)}, ${n.calcRowY(i.position.row)} ${n.calcFlowLineAnchorX(i.position.column)}, ${n.calcRowY(i.position.row-1)}`},null,10,L))),128))]),s("g",N,[s("circle",{id:"center",cx:n.calcColumnX(1),cy:n.calcRowY(1),r:o.svgSize.circleRadius/3},null,8,B),(r(!0),h(v,null,C(n.svgComponents,i=>(r(),h("g",{key:i.id,class:d(i.class.base),transform:`translate(${n.calcColumnX(i.position.column)}, ${n.calcRowY(i.position.row)})`,onClick:K=>{n.beginAnimation(`animate-label-${i.id}`),i.clicked&&i.clicked()}},[s("defs",null,[i.soc?(r(),h("clipPath",{key:0,id:`clip-soc-${i.id}`},[s("rect",{x:-o.svgSize.circleRadius-o.svgSize.strokeWidth,y:(o.svgSize.circleRadius+o.svgSize.strokeWidth)*(1-2*i.soc),width:2*(o.svgSize.circleRadius+o.svgSize.strokeWidth),height:2*(o.svgSize.circleRadius+o.svgSize.strokeWidth)*i.soc},null,8,F)],8,I)):P("",!0),s("clipPath",{id:`clip-label-${i.id}`},[s("rect",{x:-n.svgRectWidth/2,y:-o.svgSize.circleRadius,width:n.svgRectWidth,height:2*o.svgSize.circleRadius,rx:o.svgSize.circleRadius,ry:o.svgSize.circleRadius},null,8,j)],8,A)]),s("rect",{x:-n.svgRectWidth/2,y:-o.svgSize.circleRadius,width:n.svgRectWidth,height:2*o.svgSize.circleRadius,rx:o.svgSize.circleRadius,ry:o.svgSize.circleRadius},null,8,T),s("text",{"clip-path":`url(#clip-label-${i.id})`},[s("tspan",{id:`label-${i.id}`,"text-anchor":"start",x:-n.svgRectWidth/2+2*o.svgSize.circleRadius+o.svgSize.strokeWidth,y:-o.svgSize.textSize/2},[n.calcSvgElementBoundingBox(`label-${i.id}`).width>n.svgRectWidth-2*o.svgSize.circleRadius-2*o.svgSize.strokeWidth?(r(),h("animate",{key:0,ref_for:!0,ref:`animate-label-${i.id}`,xmlns:"http://www.w3.org/2000/svg",attributeName:"x",dur:"5s",values:"0; "+(-n.calcSvgElementBoundingBox(`label-${i.id}`).width+n.svgRectWidth-2.5*o.svgSize.circleRadius-2*o.svgSize.strokeWidth)+"; 0;",repeatCount:"0",begin:"2s",additive:"sum"},null,8,Y)):P("",!0),b(" "+w(i.label[0]),1)],8,E),s("tspan",{id:`value-${i.id}`,class:d(i.class.valueLabel),"text-anchor":"end",x:2*o.svgSize.circleRadius+o.svgSize.strokeWidth,y:o.svgSize.textSize},w(i.label[1]),11,H)],8,X),s("g",{transform:`translate(${o.svgSize.circleRadius-n.svgRectWidth/2}, 0)`},[s("circle",{cx:"0",cy:"0",r:o.svgSize.circleRadius,class:d({soc:i.soc})},null,10,U),i.soc?(r(),h("circle",{key:0,cx:"0",cy:"0",r:o.svgSize.circleRadius,"clip-path":`url(#clip-soc-${i.id})`},null,8,O)):P("",!0),s("image",{href:i.icon,x:-n.svgIconWidth/2,y:-n.svgIconHeight/2,height:n.svgIconHeight,width:n.svgIconWidth},null,8,J)],8,G)],10,D))),128))])],8,W))])]),_:1})]),_:1})],64)}],["__scopeId","data-v-e1dd1722"]])},props:{changesLocked:{required:!1,type:Boolean,default:!1}}},[["render",function(e,t,a,g,o,n){const c=l("FlowCard");return r(),_(c,{"changes-locked":a.changesLocked},null,8,["changes-locked"])}]]);export{ne as default};
