import{o as m,e as y,k as h,y as _,j as k,F as C,l,p as g,q as s,f as b,t as d,G as N,R as V,H as R,i as S,A as E,n as A,I as O,J as M,K as H,L as F,M as U}from"./vendor-e00930f8.js";import{_ as v,I as z,c as j}from"./vendor-inkline-f379467b.js";import{l as G,f as J,a as K,b as Y,c as Z,d as Q,F as X}from"./vendor-fortawesome-1943bb08.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function r(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerpolicy&&(t.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?t.credentials="include":a.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(a){if(a.ep)return;a.ep=!0;const t=r(a);fetch(a.href,t)}})();const ee={name:"DateTime",props:{separator:{String,default:"<br />"}},data(){return{dateTimeInterval:"",date:"",time:""}},methods:{update(){const e=new Date,o={weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"},r={hour:"2-digit",minute:"2-digit",second:"2-digit"};this.date=e.toLocaleDateString(void 0,o),this.time=e.toLocaleTimeString(void 0,r)}},mounted(){this.update(),this.dateTimeInterval=setInterval(this.update,1e3)},beforeUnmount(){clearInterval(this.dateTimeInterval)}},te=["innerHTML"];function oe(e,o,r,i,a,t){return m(),y(C,null,[h(_(a.time),1),k("span",{innerHTML:r.separator},null,8,te),h(_(a.date),1)],64)}const re=v(ee,[["render",oe],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/DateTime.vue"]]);const ne={name:"NavItem",props:{to:{type:Object,required:!0}}};function ae(e,o,r,i,a,t){const n=l("i-nav-item");return m(),g(n,{to:r.to,"active-class":"-active",class:"_border _border-color:primary _text-align:center"},{default:s(()=>[b(e.$slots,"default",{},void 0,!0)]),_:3},8,["to"])}const ie=v(ne,[["render",ae],["__scopeId","data-v-079bc5e0"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/NavItem.vue"]]),se={name:"NavBar",components:{NavItem:ie}};function ce(e,o,r,i,a,t){const n=l("nav-item"),c=l("i-nav");return m(),g(c,{vertical:"",class:"_align-items:stretch"},{default:s(()=>[d(n,{to:{name:"dash-board"}},{default:s(()=>[h(" DashBoard ")]),_:1}),d(n,{to:{name:"charge-points"}},{default:s(()=>[h(" Ladepunkte ")]),_:1}),d(n,{to:{name:"status"}},{default:s(()=>[h(" Status ")]),_:1})]),_:1})}const de=v(se,[["render",ce],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/NavBar.vue"]]),T=N("mqtt",{state:()=>({topics:{},chartData:{}}),getters:{getWildcardIndexList:e=>(o,r=!1)=>{let i=o;r||(i="^"+o.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$");let a=Object.keys(e.topics).filter(t=>t.match(i));return a.forEach((t,n,c)=>{c[n]=parseInt(t.match(/(?:\/)([0-9]+)(?=\/)*/g)[0].replace(/[^0-9]+/g,""))}),a},getWildcardTopics:e=>(o,r=!1)=>{let i=o;return r||(i="^"+o.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$"),Object.keys(e.topics).filter(a=>a.match(i)).reduce((a,t)=>({...a,[t]:e.topics[t]}),{})},getObjectIds:e=>o=>{function r(i){let a=[];return i!==void 0&&i.forEach(t=>{t.type==o&&a.push(t.id),a=[...a,...r(t.children)]}),a}return r(e.topics["openWB/counter/get/hierarchy"])},getGridId(e){let o=e.topics["openWB/counter/get/hierarchy"];if(o!==void 0&&Object.keys(o).length>0){let r=Object.keys(e.topics["openWB/counter/get/hierarchy"])[0];if(console.debug("getGridId",r,e.topics["openWB/counter/get/hierarchy"][r]),e.topics["openWB/counter/get/hierarchy"][r].type=="counter")return e.topics["openWB/counter/get/hierarchy"][r].id}},getValueBool:e=>o=>{let r=e.topics[o];return r!==void 0?r:!1},getValueString:e=>(o,r="W",i=!1)=>{var a="",t=e.topics[o];if(t===void 0)return`--- ${a}${r}`;i&&(t*=-1);var n=t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0});return(t>999||t<-999)&&(n=(t/1e3).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),a="k",(t>999999||t<-999999)&&(n=(t/1e6).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),a="M")),`${n} ${a}${r}`}},actions:{initTopic(e,o=void 0){e.includes("#")||e.includes("+")?console.debug("skipping init of wildcard topic:",e):this.addTopic(e,o)},addTopic(e,o){console.debug("addTopic",e,o),this.topics[e]=o,(e.endsWith("home_consumption")||e.endsWith("power")||e.endsWith("soc"))&&o!==void 0&&(this.chartData[e]===void 0&&(this.chartData[e]=[]),this.chartData[e].push(o),this.chartData[e].slice(-128))},removeTopic(e){e.includes("#")||e.includes("+")?(console.debug("expanding wildcard topic for removal:",e),Object.keys(this.getWildcardTopics(e)).forEach(o=>{console.debug("removing wildcardTopic:",o),delete this.topics[o]})):delete this.topics[e]},updateTopic(e,o,r=void 0){const i=(a,t,n)=>t.split(".").reduce((c,u,p)=>c[u]=t.split(".").length===++p?n:c[u]||{},a);e in this.topics?r!=null?i(this.topics[e],r,o):this.topics[e]=o:console.debug("topic not found: ",e)},updateState(e,o,r=void 0){console.debug("updateState:",e,o,r),this.updateTopic(e,o,r)}}});const le={name:"openwbDisplayCardsApp",components:{RouterView:V,DateTime:re,NavBar:de},data(){return{client:{connected:!1},connection:{protocol:location.protocol=="https:"?"wss":"ws",host:location.hostname,port:parseInt(location.port)||(location.protocol=="https:"?443:80),endpoint:"/ws",connectTimeout:4e3,reconnectPeriod:4e3},mqttTopicsToSubscribe:["openWB/counter/get/hierarchy","openWB/counter/set/home_consumption","openWB/counter/+/get/power","openWB/bat/config/configured","openWB/bat/get/power","openWB/bat/get/soc","openWB/chargepoint/get/power","openWB/pv/config/configured","openWB/pv/get/power","openWB/chargepoint/+/get/power","openWB/chargepoint/+/get/plug_state","openWB/chargepoint/+/get/charge_state","openWB/chargepoint/+/get/phases_in_use","openWB/chargepoint/+/set/current","openWB/chargepoint/+/config"],mqttStore:T()}},methods:{createConnection(){const{protocol:e,host:o,port:r,endpoint:i,...a}=this.connection,t=`${e}://${o}:${r}${i}`;console.debug("connecting to broker:",t);try{this.client=R.connect(t,a)}catch(n){console.error("mqtt.connect error",n)}this.client.on("connect",()=>{console.debug("Connection succeeded! ClientId: ",this.client.options.clientId)}),this.client.on("error",n=>{console.error("Connection failed",n)}),this.client.on("message",(n,c)=>{if(console.debug(`Received message "${c}" from topic "${n}"`),c.toString().length>0){let u;try{u=JSON.parse(c.toString())}catch{console.debug("Json parsing failed, fallback to string: ",n),u=c.toString()}this.mqttStore.addTopic(n,u)}else this.mqttStore.removeTopic(n)})},doSubscribe(e){e.forEach(o=>{this.mqttStore.initTopic(o)}),this.client.subscribe(e,{},o=>{if(o){console.error("Subscribe to topics error",o);return}})},doUnsubscribe(e){e.forEach(o=>{this.mqttStore.removeTopic(o)}),this.client.unsubscribe(e,o=>{o&&console.error("Unsubscribe error",o)})}},created(){this.createConnection()},mounted(){this.doSubscribe(this.mqttTopicsToSubscribe)},beforeUnmount(){this.doUnsubscribe(this.mqttTopicsToSubscribe)}};function ue(e,o,r,i,a,t){const n=l("DateTime"),c=l("i-column"),u=l("i-row"),p=l("i-container"),f=l("NavBar"),w=l("i-layout-aside"),L=l("RouterView"),q=l("i-layout-content"),I=l("i-layout");return m(),g(I,{vertical:""},{default:s(()=>[d(w,{class:"_position:fixed"},{default:s(()=>[d(p,{fluid:"",class:"_margin-bottom:1"},{default:s(()=>[d(u,{center:""},{default:s(()=>[d(c,null,{default:s(()=>[d(n)]),_:1})]),_:1})]),_:1}),d(f)]),_:1}),d(q,null,{default:s(()=>[d(L)]),_:1})]),_:1})}const he=v(le,[["render",ue],["__scopeId","data-v-7a7a37b1"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/App.vue"]]),pe="modulepreload",me=function(e){return"/openWB/web/display/themes/cards/"+e},W={},x=function(o,r,i){if(!r||r.length===0)return o();const a=document.getElementsByTagName("link");return Promise.all(r.map(t=>{if(t=me(t),t in W)return;W[t]=!0;const n=t.endsWith(".css"),c=n?'[rel="stylesheet"]':"";if(!!i)for(let f=a.length-1;f>=0;f--){const w=a[f];if(w.href===t&&(!n||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${c}`))return;const p=document.createElement("link");if(p.rel=n?"stylesheet":pe,n||(p.as="script",p.crossOrigin=""),p.href=t,document.head.appendChild(p),n)return new Promise((f,w)=>{p.addEventListener("load",f),p.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>o())};const _e={name:"DashBoardCard",props:{color:String}};function fe(e,o,r,i,a,t){const n=l("i-column"),c=l("i-row"),u=l("i-container"),p=l("i-card");return m(),g(p,{color:r.color},{header:s(()=>[d(u,null,{default:s(()=>[d(c,null,{default:s(()=>[d(n,null,{default:s(()=>[b(e.$slots,"headerLeft",{},void 0,!0)]),_:3}),e.$slots.headerRight?(m(),g(n,{key:0,class:"_text-align:right"},{default:s(()=>[b(e.$slots,"headerRight",{},void 0,!0)]),_:3})):S("v-if",!0)]),_:3})]),_:3})]),default:s(()=>[b(e.$slots,"default",{},void 0,!0)]),_:3},8,["color"])}const ge=v(_e,[["render",fe],["__scopeId","data-v-aa92abad"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/DashBoardCard.vue"]]);const D={props:{data:{required:!0,type:Array,default(){return[]}},socData:{required:!1,type:Array},width:{Number,default:250},height:{Number,default:70},gap:{Number,default:3},stroke:{Number,default:3},min:{Number,default:0},max:{Number,default:1},color:{String,default:"var(--color--primary)"},colorNegative:{String,default:void 0}},computed:{highestPoint(){return Math.max(1,this.max,...this.slicedData)},lowestPoint(){return Math.min(0,this.min,...this.slicedData)},maxPoints(){return Math.floor(this.width/(this.stroke+this.gap))},slicedData(){return this.data.slice(-this.maxPoints)},slicedSocData(){if(this.socData)return this.socData.slice(-this.maxPoints)},zeroHeight(){return this.height-(0-this.lowestPoint)/(this.highestPoint-this.lowestPoint)*this.height},coordinates(){return this.calculateCoordinates(this.slicedData,this.lowestPoint,this.highestPoint)},socCoordinates(){if(this.socData)return this.calculateCoordinates(this.slicedSocData,0,100)},bars(){const e=[];return this.coordinates.forEach(o=>{const r=o.x,i=o.y,a=this.stroke,t=Math.min(i,this.zeroHeight),n=Math.abs(i-this.zeroHeight),c=i>this.zeroHeight;e.push({x:r,y:t,width:a,height:n,negative:c})}),e},socPath(){if(this.socCoordinates){let o=this.socCoordinates.slice(0,1)[0],r=this.socCoordinates.slice(-1)[0];var e=`M 0,${this.height}`;return e+=` L 0,${o.y}`,this.socCoordinates.forEach((i,a)=>{e+=` L ${i.x+this.stroke/2},${i.y}`}),e+=` L ${r.x+this.stroke},${r.y} L ${r.x+this.stroke},${this.height} Z`,e}}},methods:{calculateCoordinates(e,o,r){const i=[];return e.forEach((a,t)=>{const n=t*this.width/this.maxPoints,c=this.height-(a-o)/(r-o)*this.height;i.push({x:n,y:c})}),i}}},P=()=>{O(e=>({"fc7172b1-color":e.color,"fc7172b1-colorNegative":e.colorNegative}))},$=D.setup;D.setup=$?(e,o)=>(P(),$(e,o)):P;const ve=D,we=["viewBox"],ye=["d"],be=["x","y","width","height"],Se=["y1","x2","y2"];function Be(e,o,r,i,a,t){return m(),y("svg",{class:"spark-line",viewBox:`0 0 ${r.width} ${r.height}`,width:"100%",preserveAspectRatio:"xMinYMin"},[r.socData?(m(),y("path",{key:0,class:"soc-path",d:t.socPath},null,8,ye)):S("v-if",!0),(m(!0),y(C,null,E(t.bars,n=>(m(),y("rect",{key:n.x,x:n.x,y:n.y,width:n.width,height:n.height,class:A(r.colorNegative&&n.negative?"negative":"")},null,10,be))),128)),k("line",{class:"zero-line",x1:0,y1:t.zeroHeight,x2:r.width,y2:t.zeroHeight},null,8,Se)],8,we)}const De=v(ve,[["render",Be],["__scopeId","data-v-fc7172b1"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/SparkLine.vue"]]);G.add(J,K,Y,Z,Q);const We={name:"DashBoard",data(){return{mqttStore:T()}},components:{DashBoardCard:ge,SparkLine:De,FontAwesomeIcon:X},computed:{gridPower(){let e=0;return e=this.mqttStore.getGridId,e===void 0?"---":this.mqttStore.getValueString(`openWB/counter/${e}/get/power`,"W")},gridPowerChartData(){let e=0;return e=this.mqttStore.getGridId,e===void 0?[]:this.mqttStore.chartData[`openWB/counter/${e}/get/power`]},homePower(){return this.mqttStore.getValueString("openWB/counter/set/home_consumption","W")},homePowerChartData(){return this.mqttStore.chartData["openWB/counter/set/home_consumption"]},batteryConfigured(){return this.mqttStore.getValueBool("openWB/bat/config/configured")},batteryPower(){return this.mqttStore.getValueString("openWB/bat/get/power","W")},batteryPowerChartData(){return this.mqttStore.chartData["openWB/bat/get/power"]},batterySoc(){return this.mqttStore.getValueString("openWB/bat/get/soc","%")},batterySocChartData(){return this.mqttStore.chartData["openWB/bat/get/soc"]},chargePointSumPower(){return this.mqttStore.getValueString("openWB/chargepoint/get/power","W")},chargePointSumPowerChartData(){return this.mqttStore.chartData["openWB/chargepoint/get/power"]},pvConfigured(){return this.mqttStore.getValueBool("openWB/pv/config/configured")},pvPower(){return this.mqttStore.getValueString("openWB/pv/get/power","W",!0)},pvPowerChartData(){return this.mqttStore.chartData["openWB/pv/get/power"].map(e=>e*-1)}}},xe={class:"dash-board-card-wrapper"};function Pe(e,o,r,i,a,t){const n=l("font-awesome-icon"),c=l("spark-line"),u=l("dash-board-card");return m(),y("div",xe,[d(u,{color:"danger"},{headerLeft:s(()=>[d(n,{"fixed-width":"",icon:["fas","fa-gauge-high"]}),h(" EVU ")]),headerRight:s(()=>[h(_(t.gridPower),1)]),default:s(()=>[d(c,{color:"var(--color--danger)",colorNegative:"var(--color--success)",data:t.gridPowerChartData},null,8,["data"])]),_:1}),d(u,{color:"light"},{headerLeft:s(()=>[d(n,{"fixed-width":"",icon:["fas","fa-home"]}),h(" Hausverbrauch ")]),headerRight:s(()=>[h(_(t.homePower),1)]),default:s(()=>[d(c,{color:"var(--color--light)",data:t.homePowerChartData},null,8,["data"])]),_:1}),t.batteryConfigured?(m(),g(u,{key:0,color:"warning"},{headerLeft:s(()=>[d(n,{"fixed-width":"",icon:["fas","fa-car-battery"]}),h(" Speicher ")]),headerRight:s(()=>[h(_(t.batterySoc)+" / "+_(t.batteryPower),1)]),default:s(()=>[d(c,{color:"var(--color--warning)",data:t.batteryPowerChartData,socData:t.batterySocChartData},null,8,["data","socData"])]),_:1})):S("v-if",!0),d(u,{color:"primary"},{headerLeft:s(()=>[d(n,{"fixed-width":"",icon:["fas","fa-charging-station"]}),h(" Ladepunkte ")]),headerRight:s(()=>[h(_(t.chargePointSumPower),1)]),default:s(()=>[d(c,{color:"var(--color--primary)",data:t.chargePointSumPowerChartData},null,8,["data"])]),_:1}),t.pvConfigured?(m(),g(u,{key:1,color:"success"},{headerLeft:s(()=>[d(n,{"fixed-width":"",icon:["fas","fa-solar-panel"]}),h(" PV ")]),headerRight:s(()=>[h(_(t.pvPower),1)]),default:s(()=>[d(c,{color:"var(--color--success)",data:t.pvPowerChartData,inverted:!0},null,8,["data"])]),_:1})):S("v-if",!0)])}const $e=v(We,[["render",Pe],["__scopeId","data-v-4e1e3ea5"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/views/DashBoardView.vue"]]),ke=M({history:H("/openWB/web/display/themes/cards/"),routes:[{path:"/",alias:"/DashBoard",name:"dash-board",component:$e},{path:"/ChargePoints",name:"charge-points",component:()=>x(()=>import("./ChargePointsView-947bdc3f.js"),["assets/ChargePointsView-947bdc3f.js","assets/vendor-fortawesome-1943bb08.js","assets/vendor-e00930f8.js","assets/vendor-inkline-f379467b.js","assets/vendor-inkline-7b5371f4.css","assets/ChargePointsView-79233e53.css"])},{path:"/Status",name:"status",component:()=>x(()=>import("./StatusView-57ca9c55.js"),["assets/StatusView-57ca9c55.js","assets/vendor-inkline-f379467b.js","assets/vendor-e00930f8.js","assets/vendor-inkline-7b5371f4.css"])}]});const B=F(he);B.use(U());B.use(ke);B.use(z,{colorMode:"dark",components:j});B.mount("#app");export{ge as D,De as S,T as u};
