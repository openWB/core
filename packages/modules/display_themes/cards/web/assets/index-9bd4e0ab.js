import{o as h,e as I,k as _,x as W,j as P,F as L,H as D,l as s,n as p,p as u,f as E,i as b,R as q,I as x,s as g,z as N,J as O,K as A,L as R,M as F,N as U,O as M}from"./vendor-ff8c19ec.js";import{l as j,f as G,a as H,F as J}from"./vendor-fortawesome-55766d27.js";import{_ as C,I as z,c as K}from"./vendor-inkline-44401e4a.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const Z={name:"DateTime",props:{separator:{String,default:"<br />"}},data(){return{dateTimeInterval:"",date:"",time:""}},methods:{update(){const e=new Date,t={weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"},n={hour:"2-digit",minute:"2-digit",second:"2-digit"};this.date=e.toLocaleDateString(void 0,t),this.time=e.toLocaleTimeString(void 0,n)}},mounted(){this.update(),this.dateTimeInterval=setInterval(this.update,1e3)},beforeUnmount(){clearInterval(this.dateTimeInterval)}},Q=["innerHTML"];function X(e,t,n,a,r,o){return h(),I(L,null,[_(W(r.time),1),P("span",{innerHTML:n.separator},null,8,Q),_(W(r.date),1)],64)}const Y=C(Z,[["render",X],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/DateTime.vue"]]),w=D("mqtt",{state:()=>({settings:{parentChargePoint1:void 0,parentChargePoint2:void 0},topics:{},chartData:{}}),getters:{getChargePointFilter:e=>{let t=[];return e.settings.parentChargePoint1!==void 0&&t.push(e.settings.parentChargePoint1),e.settings.parentChargePoint2!==void 0&&t.push(e.settings.parentChargePoint2),t},getWildcardIndexList:e=>(t,n=!1)=>{let a=t;n||(a="^"+t.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$");let r=Object.keys(e.topics).filter(o=>o.match(a));return r.forEach((o,i,c)=>{c[i]=parseInt(o.match(/(?:\/)([0-9]+)(?=\/)*/g)[0].replace(/[^0-9]+/g,""))}),r},getWildcardTopics:e=>(t,n=!1)=>{let a=t;return n||(a="^"+t.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$"),Object.keys(e.topics).filter(r=>r.match(a)).reduce((r,o)=>({...r,[o]:e.topics[o]}),{})},getObjectIds:e=>t=>{function n(a){let r=[];return a!==void 0&&a.forEach(o=>{o.type==t&&r.push(o.id),r=[...r,...n(o.children)]}),r}return n(e.topics["openWB/counter/get/hierarchy"])},getValueBool:e=>(t,n=!1)=>{let a=e.topics[t];return a!==void 0?a:n},getValueString:e=>(t,n="W",a=!1,r="---")=>{var o="",i=e.topics[t];if(i===void 0)return`${r} ${o}${n}`;a&&(i*=-1);var c=i.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0});return(i>999||i<-999)&&(c=(i/1e3).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),o="k",(i>999999||i<-999999)&&(c=(i/1e6).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),o="M")),`${c} ${o}${n}`},getThemeConfiguration:e=>{if("openWB/optional/int_display/theme"in e.topics&&e.topics["openWB/optional/int_display/theme"]!==void 0&&"configuration"in e.topics["openWB/optional/int_display/theme"])return e.topics["openWB/optional/int_display/theme"].configuration},getDashBoardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_view:!0},getChargePointsEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_charge_points_view:!0},getStateEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_status_view:!0},getGridCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_grid:!0},getHomeCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_home_consumption:!0},getBatteryCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_battery_sum:!0},getChargePointsCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_charge_point_sum:!0},getPvCardEnabled(e){return e.getThemeConfiguration?e.getThemeConfiguration.enable_dashboard_card_inverter_sum:!0},getLockChanges(e){return e.getThemeConfiguration?e.getThemeConfiguration.lock_changes:!0},getGridId(e){let t=e.topics["openWB/counter/get/hierarchy"];if(t!==void 0&&Object.keys(t).length>0){let n=Object.keys(e.topics["openWB/counter/get/hierarchy"])[0];if(console.debug("getGridId",n,e.topics["openWB/counter/get/hierarchy"][n]),e.topics["openWB/counter/get/hierarchy"][n].type=="counter")return e.topics["openWB/counter/get/hierarchy"][n].id}},getGridPower(e){let t=e.getGridId;return t===void 0?"---":e.getValueString(`openWB/counter/${t}/get/power`,"W")},getGridPowerChartData(e){let t=e.getGridId;return t===void 0?[]:e.chartData[`openWB/counter/${t}/get/power`]},getHomePower(e){return e.getValueString("openWB/counter/set/home_consumption","W")},getHomePowerChartData(e){return e.chartData["openWB/counter/set/home_consumption"]},getBatteryConfigured(e){return e.getValueBool("openWB/bat/config/configured")},getBatteryPower(e){return e.getValueString("openWB/bat/get/power","W")},getBatteryPowerChartData(e){return e.chartData["openWB/bat/get/power"]},getBatterySoc(e){return e.getValueString("openWB/bat/get/soc","%")},getBatterySocChartData(e){return e.chartData["openWB/bat/get/soc"]},getPvConfigured(e){return e.getValueBool("openWB/pv/config/configured")},getPvPower(e){return e.getValueString("openWB/pv/get/power","W",!0)},getPvPowerChartData(e){return e.chartData["openWB/pv/get/power"].map(t=>t*-1)},getChargePointSumPower(e){return e.getValueString("openWB/chargepoint/get/power","W")},getChargePointSumPowerChartData(e){return e.chartData["openWB/chargepoint/get/power"]},getChargePointIds(e){let t=e.getObjectIds("cp"),n=this.getChargePointFilter;return n.length>0?(console.debug("charge points are filtered!",t,n),t.filter(a=>n.includes(a))):t},getChargePointName(e){return t=>e.topics[`openWB/chargepoint/${t}/config`]!==void 0?e.topics[`openWB/chargepoint/${t}/config`].name:"---"},getChargePointPower(e){return t=>e.getValueString(`openWB/chargepoint/${t}/get/power`)},getChargePointPowerChartData(e){return t=>e.chartData[`openWB/chargepoint/${t}/get/power`]},getChargePointConnectedVehicleConfig(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/config`]},getChargePointConnectedVehicleChargeMode(e){return t=>e.translateChargeMode(e.getChargePointConnectedVehicleConfig(t).chargemode)},getChargePointConnectedVehiclePriority(e){return t=>e.getChargePointConnectedVehicleConfig(t).priority},getChargePointSetCurrent(e){return t=>e.getValueString(`openWB/chargepoint/${t}/set/current`,"A")},getChargePointPhasesInUse(e){return t=>{const n=["/","①","②","③"],a=e.topics[`openWB/chargepoint/${t}/get/phases_in_use`];return a!==void 0&&a>=0&&a<n.length?n[e.topics[`openWB/chargepoint/${t}/get/phases_in_use`]]:"?"}},getChargePointPlugState(e){return t=>e.getValueBool(`openWB/chargepoint/${t}/get/plug_state`)},getChargePointChargeState(e){return t=>e.getValueBool(`openWB/chargepoint/${t}/get/charge_state`)},getChargePointManualLock(e){return t=>e.getValueBool(`openWB/chargepoint/${t}/set/manual_lock`)},getChargePointConnectedVehicleInfo(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/info`]},getChargePointConnectedVehicleId(e){return t=>e.getChargePointConnectedVehicleInfo(t).id},getChargePointConnectedVehicleChargeTemplateIndex(e){return t=>e.getChargePointConnectedVehicleConfig(t).charge_template},getChargePointConnectedVehicleChargeTemplate(e){return t=>{let n=e.getChargePointConnectedVehicleChargeTemplateIndex(t);return e.topics[`openWB/vehicle/template/charge_template/${n}`]}},getChargePointConnectedVehicleEvTemplate(e){return t=>e.getChargePointConnectedVehicleConfig(t).ev_template},getChargePointConnectedVehicleName(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/info`].name},getChargePointConnectedVehicleSoc(e){return t=>e.topics[`openWB/chargepoint/${t}/get/connected_vehicle/soc`]},getChargePointConnectedVehicleTimeChargingActive(e){return t=>e.getChargePointConnectedVehicleChargeTemplate(t).time_charging.active},getChargePointConnectedVehicleTimeChargingRunning(e){return t=>{let n=e.getChargePointConnectedVehicleConfig(t).time_charging_in_use;return n!==void 0?n:!1}},getVehicleList(e){return e.getWildcardTopics("openWB/vehicle/+/name")},getVehicleSocConfigured(e){return t=>e.topics[`openWB/vehicle/${t}/soc_module/config`].type!=null},getVehicleFaultState(e){return t=>e.topics[`openWB/vehicle/${t}/get/fault_state`]}},actions:{updateSetting(e,t){e in this.settings&&(this.settings[e]=t)},initTopic(e,t=void 0){e.includes("#")||e.includes("+")?console.debug("skipping init of wildcard topic:",e):this.addTopic(e,t)},addTopic(e,t){console.debug("addTopic",e,t),this.topics[e]=t,(e.endsWith("home_consumption")||e.endsWith("power")||e.endsWith("soc"))&&t!==void 0&&t!==null&&(this.chartData[e]===void 0&&(this.chartData[e]=[]),this.chartData[e].push(t),this.chartData[e].slice(-128))},removeTopic(e){e.includes("#")||e.includes("+")?(console.debug("expanding wildcard topic for removal:",e),Object.keys(this.getWildcardTopics(e)).forEach(t=>{console.debug("removing wildcardTopic:",t),delete this.topics[t]})):delete this.topics[e]},updateTopic(e,t,n=void 0){const a=(r,o,i)=>o.split(".").reduce((c,d,l)=>c[d]=o.split(".").length===++l?i:c[d]||{},r);e in this.topics?n!=null?a(this.topics[e],n,t):this.topics[e]=t:console.debug("topic not found: ",e)},updateState(e,t,n=void 0){console.debug("updateState:",e,t,n),this.updateTopic(e,t,n)},translateChargeMode(e){switch(e){case"instant_charging":return{mode:e,name:"Sofort",class:"danger"};case"pv_charging":return{mode:e,name:"PV",class:"success"};case"scheduled_charging":return{mode:e,name:"Zielladen",class:"primary"};case"time_charging":return{mode:e,name:"Zeitladen",class:"warning"};case"standby":return{mode:e,name:"Standby",class:"secondary"};case"stop":return{mode:e,name:"Stop",class:"dark"};default:return console.warn("unknown charge mode:",e),e}}}});const ee={name:"NavItem",props:{to:{type:Object,required:!0}}};function te(e,t,n,a,r,o){const i=s("i-nav-item");return h(),p(i,{to:n.to,"active-class":"-active",class:"_border _border-color:primary _text-align:center"},{default:u(()=>[E(e.$slots,"default",{},void 0,!0)]),_:3},8,["to"])}const ne=C(ee,[["render",te],["__scopeId","data-v-079bc5e0"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/NavItem.vue"]]),oe={name:"NavBar",components:{NavItem:ne},data(){return{mqttStore:w()}}};function re(e,t,n,a,r,o){const i=s("nav-item"),c=s("i-nav");return h(),p(c,{vertical:"",class:"_align-items:stretch"},{default:u(()=>[r.mqttStore.getDashBoardEnabled?(h(),p(i,{key:0,to:{name:"dash-board"}},{default:u(()=>[_(" DashBoard ")]),_:1})):b("v-if",!0),r.mqttStore.getChargePointsEnabled?(h(),p(i,{key:1,to:{name:"charge-points"}},{default:u(()=>[_(" Ladepunkte ")]),_:1})):b("v-if",!0),r.mqttStore.getStateEnabled?(h(),p(i,{key:2,to:{name:"status"}},{default:u(()=>[_(" Status ")]),_:1})):b("v-if",!0)]),_:1})}const ie=C(oe,[["render",re],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/NavBar.vue"]]);j.add(G,H);const ae={name:"openwbDisplayCardsApp",components:{RouterView:q,DateTime:Y,NavBar:ie,FontAwesomeIcon:J},data(){return{client:{connected:!1},connection:{protocol:location.protocol=="https:"?"wss":"ws",host:location.hostname,port:parseInt(location.port)||(location.protocol=="https:"?443:80),endpoint:"/ws",connectTimeout:4e3,reconnectPeriod:4e3},mqttTopicsToSubscribe:["openWB/optional/int_display/theme","openWB/counter/get/hierarchy","openWB/counter/set/home_consumption","openWB/counter/+/get/power","openWB/bat/config/configured","openWB/bat/get/power","openWB/bat/get/soc","openWB/chargepoint/get/power","openWB/pv/config/configured","openWB/pv/get/power","openWB/chargepoint/+/get/power","openWB/chargepoint/+/get/plug_state","openWB/chargepoint/+/get/charge_state","openWB/chargepoint/+/get/phases_in_use","openWB/chargepoint/+/set/current","openWB/chargepoint/+/set/manual_lock","openWB/chargepoint/+/config","openWB/chargepoint/+/get/connected_vehicle/+","openWB/vehicle/+/name","openWB/vehicle/+/soc_module/config","openWB/vehicle/+/get/fault_state","openWB/vehicle/template/charge_template/#"],mqttStore:w(),changesLocked:!1}},methods:{createConnection(){const{protocol:e,host:t,port:n,endpoint:a,...r}=this.connection,o=`${e}://${t}:${n}${a}`;console.debug("connecting to broker:",o);try{this.client=x.connect(o,r)}catch(i){console.error("mqtt.connect error",i)}this.client.on("connect",()=>{console.debug("Connection succeeded! ClientId: ",this.client.options.clientId)}),this.client.on("error",i=>{console.error("Connection failed",i)}),this.client.on("message",(i,c)=>{if(console.debug(`Received message "${c}" from topic "${i}"`),c.toString().length>0){let d;try{d=JSON.parse(c.toString())}catch{console.debug("Json parsing failed, fallback to string: ",i),d=c.toString()}this.mqttStore.addTopic(i,d)}else this.mqttStore.removeTopic(i)})},doSubscribe(e){e.forEach(t=>{this.mqttStore.initTopic(t)}),this.client.subscribe(e,{},t=>{if(t){console.error("Subscribe to topics error",t);return}})},doUnsubscribe(e){e.forEach(t=>{this.mqttStore.removeTopic(t)}),this.client.unsubscribe(e,t=>{t&&console.error("Unsubscribe error",t)})},doPublish(e,t,n=!0,a=2){console.debug("doPublish",e,t);let r={qos:a,retain:n};this.client.publish(e,JSON.stringify(t),r,o=>{o&&console.error("Publish error",o)})},sendTopicToBroker(e,t=void 0){let n=e.replace("openWB/","openWB/set/");t===void 0&&(t=this.mqttStore.topics[e]),this.doPublish(n,t)},toggleChangesLock(){console.log("toggleChangesLock"),this.changesLocked=!this.changesLocked}},created(){this.createConnection()},mounted(){let e=window.location.search;console.log("search",e),new URLSearchParams(e).forEach((n,a)=>{this.mqttStore.updateSetting(a,parseInt(n))}),this.doSubscribe(this.mqttTopicsToSubscribe)},beforeUnmount(){this.doUnsubscribe(this.mqttTopicsToSubscribe)}};function ce(e,t,n,a,r,o){const i=s("DateTime"),c=s("i-column"),d=s("i-row"),l=s("i-container"),m=s("FontAwesomeIcon"),f=s("i-button"),S=s("NavBar"),T=s("i-layout-aside"),k=s("RouterView"),V=s("i-layout-content"),$=s("i-layout");return h(),p($,{vertical:""},{default:u(()=>[g(T,{class:"_position:fixed"},{default:u(()=>[g(l,{fluid:"",class:"_margin-bottom:1"},{default:u(()=>[g(d,{center:""},{default:u(()=>[g(c,null,{default:u(()=>[g(i)]),_:1})]),_:1})]),_:1}),r.mqttStore.getLockChanges?(h(),p(f,{key:0,onClick:o.toggleChangesLock,class:"_padding-left:0 _padding-right:0 _margin-bottom:1",size:"lg",block:""},{default:u(()=>[g(m,{icon:this.changesLocked?["fas","fa-lock"]:["fas","fa-lock-open"],class:N(this.changesLocked?["_color:danger"]:"_color:success")},null,8,["icon","class"])]),_:1},8,["onClick"])):b("v-if",!0),g(S,{changesLocked:r.changesLocked,onToggleChangesLock:o.toggleChangesLock},null,8,["changesLocked","onToggleChangesLock"])]),_:1}),g(V,null,{default:u(()=>[g(k,{changesLocked:r.changesLocked},null,8,["changesLocked"])]),_:1})]),_:1})}const se=C(ae,[["render",ce],["__scopeId","data-v-7a7a37b1"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/App.vue"]]),ue="modulepreload",le=function(e){return"/openWB/web/display/themes/cards/"+e},y={},B=function(t,n,a){if(!n||n.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=le(o),o in y)return;y[o]=!0;const i=o.endsWith(".css"),c=i?'[rel="stylesheet"]':"";if(!!a)for(let m=r.length-1;m>=0;m--){const f=r[m];if(f.href===o&&(!i||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const l=document.createElement("link");if(l.rel=i?"stylesheet":ue,i||(l.as="script",l.crossOrigin=""),l.href=o,document.head.appendChild(l),i)return new Promise((m,f)=>{l.addEventListener("load",m),l.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t())},ge="/openWB/web/display/themes/cards/openWB_logo_dark.png";const de={name:"WelcomeView",data(){return{mqttStore:w()}},computed:{firstView(){if(this.mqttStore.getThemeConfiguration){if(this.mqttStore.getThemeConfiguration.enable_dashboard_view)return"dash-board";if(this.mqttStore.getThemeConfiguration.enable_charge_points_view)return"charge-points";if(this.mqttStore.getThemeConfiguration.enable_status_view)return"status"}}},methods:{selectFirstRoute(){this.firstView?this.$router.push({name:this.firstView}):console.warn("no router view enabled, check your configuration!")}},mounted(){setTimeout(this.selectFirstRoute,3e3)}},he=e=>(O("data-v-0939a750"),e=e(),A(),e),pe=he(()=>P("img",{class:"logo",src:ge},null,-1));function me(e,t,n,a,r,o){const i=s("i-card"),c=s("i-column"),d=s("i-row"),l=s("i-container");return h(),p(l,null,{default:u(()=>[g(d,{center:"",middle:""},{default:u(()=>[g(c,null,{default:u(()=>[g(i,{color:"primary"},{header:u(()=>[_(" Cards Theme ")]),default:u(()=>[pe]),_:1})]),_:1})]),_:1})]),_:1})}const fe=C(de,[["render",me],["__scopeId","data-v-0939a750"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/views/WelcomeView.vue"]]),_e=R({history:F("/openWB/web/display/themes/cards/"),routes:[{path:"/",name:"welcome",component:fe},{path:"/DashBoard",name:"dash-board",component:()=>B(()=>import("./DashBoardView-1b72088b.js"),["assets/DashBoardView-1b72088b.js","assets/SparkLine-163dd578.js","assets/vendor-ff8c19ec.js","assets/vendor-inkline-44401e4a.js","assets/vendor-inkline-e6abf403.css","assets/SparkLine-36150265.css","assets/vendor-fortawesome-55766d27.js","assets/DashBoardView-1e9018f7.css"])},{path:"/ChargePoints",name:"charge-points",component:()=>B(()=>import("./ChargePointsView-428e77cd.js"),["assets/ChargePointsView-428e77cd.js","assets/SparkLine-163dd578.js","assets/vendor-ff8c19ec.js","assets/vendor-inkline-44401e4a.js","assets/vendor-inkline-e6abf403.css","assets/SparkLine-36150265.css","assets/vendor-fortawesome-55766d27.js","assets/ChargePointsView-aaf159c1.css"])},{path:"/Status",name:"status",component:()=>B(()=>import("./StatusView-1513e481.js"),["assets/StatusView-1513e481.js","assets/vendor-inkline-44401e4a.js","assets/vendor-ff8c19ec.js","assets/vendor-inkline-e6abf403.css","assets/vendor-fortawesome-55766d27.js"])}]});const v=U(se);v.use(M());v.use(_e);v.use(z,{colorMode:"dark",components:K});v.mount("#app");export{w as u};
