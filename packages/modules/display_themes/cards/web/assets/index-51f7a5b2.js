import{o as m,e as q,k as g,x as W,j as S,F as x,H as C,l as a,n as _,p as l,f as D,i as y,R as E,I as L,s as p,J as N,K as O,L as V,M as P,N as R,O as A}from"./vendor-2c584962.js";import{_ as b,I as F,c as U}from"./vendor-inkline-54d7246b.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();const j={name:"DateTime",props:{separator:{String,default:"<br />"}},data(){return{dateTimeInterval:"",date:"",time:""}},methods:{update(){const e=new Date,t={weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"},i={hour:"2-digit",minute:"2-digit",second:"2-digit"};this.date=e.toLocaleDateString(void 0,t),this.time=e.toLocaleTimeString(void 0,i)}},mounted(){this.update(),this.dateTimeInterval=setInterval(this.update,1e3)},beforeUnmount(){clearInterval(this.dateTimeInterval)}},M=["innerHTML"];function H(e,t,i,s,o,n){return m(),q(x,null,[g(W(o.time),1),S("span",{innerHTML:i.separator},null,8,M),g(W(o.date),1)],64)}const J=b(j,[["render",H],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/DateTime.vue"]]),B=C("mqtt",{state:()=>({topics:{},chartData:{}}),getters:{getThemeConfiguration:e=>{if("openWB/optional/int_display/theme"in e.topics&&e.topics["openWB/optional/int_display/theme"]!==void 0&&"configuration"in e.topics["openWB/optional/int_display/theme"])return e.topics["openWB/optional/int_display/theme"].configuration},getWildcardIndexList:e=>(t,i=!1)=>{let s=t;i||(s="^"+t.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$");let o=Object.keys(e.topics).filter(n=>n.match(s));return o.forEach((n,r,c)=>{c[r]=parseInt(n.match(/(?:\/)([0-9]+)(?=\/)*/g)[0].replace(/[^0-9]+/g,""))}),o},getWildcardTopics:e=>(t,i=!1)=>{let s=t;return i||(s="^"+t.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$"),Object.keys(e.topics).filter(o=>o.match(s)).reduce((o,n)=>({...o,[n]:e.topics[n]}),{})},getObjectIds:e=>t=>{function i(s){let o=[];return s!==void 0&&s.forEach(n=>{n.type==t&&o.push(n.id),o=[...o,...i(n.children)]}),o}return i(e.topics["openWB/counter/get/hierarchy"])},getGridId(e){let t=e.topics["openWB/counter/get/hierarchy"];if(t!==void 0&&Object.keys(t).length>0){let i=Object.keys(e.topics["openWB/counter/get/hierarchy"])[0];if(console.debug("getGridId",i,e.topics["openWB/counter/get/hierarchy"][i]),e.topics["openWB/counter/get/hierarchy"][i].type=="counter")return e.topics["openWB/counter/get/hierarchy"][i].id}},getValueBool:e=>t=>{let i=e.topics[t];return i!==void 0?i:!1},getValueString:e=>(t,i="W",s=!1)=>{var o="",n=e.topics[t];if(n===void 0)return`--- ${o}${i}`;s&&(n*=-1);var r=n.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0});return(n>999||n<-999)&&(r=(n/1e3).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),o="k",(n>999999||n<-999999)&&(r=(n/1e6).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),o="M")),`${r} ${o}${i}`}},actions:{initTopic(e,t=void 0){e.includes("#")||e.includes("+")?console.debug("skipping init of wildcard topic:",e):this.addTopic(e,t)},addTopic(e,t){console.debug("addTopic",e,t),this.topics[e]=t,(e.endsWith("home_consumption")||e.endsWith("power")||e.endsWith("soc"))&&t!==void 0&&(this.chartData[e]===void 0&&(this.chartData[e]=[]),this.chartData[e].push(t),this.chartData[e].slice(-128))},removeTopic(e){e.includes("#")||e.includes("+")?(console.debug("expanding wildcard topic for removal:",e),Object.keys(this.getWildcardTopics(e)).forEach(t=>{console.debug("removing wildcardTopic:",t),delete this.topics[t]})):delete this.topics[e]},updateTopic(e,t,i=void 0){const s=(o,n,r)=>n.split(".").reduce((c,d,u)=>c[d]=n.split(".").length===++u?r:c[d]||{},o);e in this.topics?i!=null?s(this.topics[e],i,t):this.topics[e]=t:console.debug("topic not found: ",e)},updateState(e,t,i=void 0){console.debug("updateState:",e,t,i),this.updateTopic(e,t,i)}}});const G={name:"NavItem",props:{to:{type:Object,required:!0}}};function K(e,t,i,s,o,n){const r=a("i-nav-item");return m(),_(r,{to:i.to,"active-class":"-active",class:"_border _border-color:primary _text-align:center"},{default:l(()=>[D(e.$slots,"default",{},void 0,!0)]),_:3},8,["to"])}const z=b(G,[["render",K],["__scopeId","data-v-079bc5e0"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/NavItem.vue"]]),Q={name:"NavBar",components:{NavItem:z},data(){return{mqttStore:B()}},computed:{dashBoardEnabled(){return this.mqttStore.getThemeConfiguration?this.mqttStore.getThemeConfiguration.enable_dashboard_view:!0},chargePointsEnabled(){return this.mqttStore.getThemeConfiguration?this.mqttStore.getThemeConfiguration.enable_charge_points_view:!0},stateEnabled(){return this.mqttStore.getThemeConfiguration?this.mqttStore.getThemeConfiguration.enable_status_view:!0}}};function X(e,t,i,s,o,n){const r=a("nav-item"),c=a("i-nav");return m(),_(c,{vertical:"",class:"_align-items:stretch"},{default:l(()=>[n.dashBoardEnabled?(m(),_(r,{key:0,to:{name:"dash-board"}},{default:l(()=>[g(" DashBoard ")]),_:1})):y("v-if",!0),n.chargePointsEnabled?(m(),_(r,{key:1,to:{name:"charge-points"}},{default:l(()=>[g(" Ladepunkte ")]),_:1})):y("v-if",!0),n.stateEnabled?(m(),_(r,{key:2,to:{name:"status"}},{default:l(()=>[g(" Status ")]),_:1})):y("v-if",!0)]),_:1})}const Y=b(Q,[["render",X],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/components/NavBar.vue"]]);const Z={name:"openwbDisplayCardsApp",components:{RouterView:E,DateTime:J,NavBar:Y},data(){return{client:{connected:!1},connection:{protocol:location.protocol=="https:"?"wss":"ws",host:location.hostname,port:parseInt(location.port)||(location.protocol=="https:"?443:80),endpoint:"/ws",connectTimeout:4e3,reconnectPeriod:4e3},mqttTopicsToSubscribe:["openWB/optional/int_display/theme","openWB/counter/get/hierarchy","openWB/counter/set/home_consumption","openWB/counter/+/get/power","openWB/bat/config/configured","openWB/bat/get/power","openWB/bat/get/soc","openWB/chargepoint/get/power","openWB/pv/config/configured","openWB/pv/get/power","openWB/chargepoint/+/get/power","openWB/chargepoint/+/get/plug_state","openWB/chargepoint/+/get/charge_state","openWB/chargepoint/+/get/phases_in_use","openWB/chargepoint/+/set/current","openWB/chargepoint/+/set/manual_lock","openWB/chargepoint/+/config","openWB/chargepoint/+/get/connected_vehicle/+","openWB/vehicle/+/name","openWB/vehicle/+/soc_module/config","openWB/vehicle/+/get/fault_state","openWB/vehicle/+/get/soc"],mqttStore:B()}},methods:{createConnection(){const{protocol:e,host:t,port:i,endpoint:s,...o}=this.connection,n=`${e}://${t}:${i}${s}`;console.debug("connecting to broker:",n);try{this.client=L.connect(n,o)}catch(r){console.error("mqtt.connect error",r)}this.client.on("connect",()=>{console.debug("Connection succeeded! ClientId: ",this.client.options.clientId)}),this.client.on("error",r=>{console.error("Connection failed",r)}),this.client.on("message",(r,c)=>{if(console.debug(`Received message "${c}" from topic "${r}"`),c.toString().length>0){let d;try{d=JSON.parse(c.toString())}catch{console.debug("Json parsing failed, fallback to string: ",r),d=c.toString()}this.mqttStore.addTopic(r,d)}else this.mqttStore.removeTopic(r)})},doSubscribe(e){e.forEach(t=>{this.mqttStore.initTopic(t)}),this.client.subscribe(e,{},t=>{if(t){console.error("Subscribe to topics error",t);return}})},doUnsubscribe(e){e.forEach(t=>{this.mqttStore.removeTopic(t)}),this.client.unsubscribe(e,t=>{t&&console.error("Unsubscribe error",t)})},doPublish(e,t,i=!0,s=2){console.debug("doPublish",e,t);let o={qos:s,retain:i};this.client.publish(e,JSON.stringify(t),o,n=>{n&&console.error("Publish error",n)})},sendTopicToBroker(e,t=void 0){let i=e.replace("openWB/","openWB/set/");t===void 0&&(t=this.mqttStore.topics[e]),this.doPublish(i,t)}},created(){this.createConnection()},mounted(){this.doSubscribe(this.mqttTopicsToSubscribe)},beforeUnmount(){this.doUnsubscribe(this.mqttTopicsToSubscribe)}};function ee(e,t,i,s,o,n){const r=a("DateTime"),c=a("i-column"),d=a("i-row"),u=a("i-container"),h=a("NavBar"),f=a("i-layout-aside"),$=a("RouterView"),k=a("i-layout-content"),I=a("i-layout");return m(),_(I,{vertical:""},{default:l(()=>[p(f,{class:"_position:fixed"},{default:l(()=>[p(u,{fluid:"",class:"_margin-bottom:1"},{default:l(()=>[p(d,{center:""},{default:l(()=>[p(c,null,{default:l(()=>[p(r)]),_:1})]),_:1})]),_:1}),p(h)]),_:1}),p(k,null,{default:l(()=>[p($)]),_:1})]),_:1})}const te=b(Z,[["render",ee],["__scopeId","data-v-7a7a37b1"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/App.vue"]]),ne="modulepreload",oe=function(e){return"/openWB/web/display/themes/cards/"+e},T={},w=function(t,i,s){if(!i||i.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(i.map(n=>{if(n=oe(n),n in T)return;T[n]=!0;const r=n.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let h=o.length-1;h>=0;h--){const f=o[h];if(f.href===n&&(!r||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${c}`))return;const u=document.createElement("link");if(u.rel=r?"stylesheet":ne,r||(u.as="script",u.crossOrigin=""),u.href=n,document.head.appendChild(u),r)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())},ie="/openWB/web/display/themes/cards/openWB_logo_dark.png";const re={name:"WelcomeView",data(){return{mqttStore:B()}},computed:{firstView(){if(this.mqttStore.getThemeConfiguration){if(this.mqttStore.getThemeConfiguration.enable_dashboard_view)return"dash-board";if(this.mqttStore.getThemeConfiguration.enable_charge_points_view)return"charge-points";if(this.mqttStore.getThemeConfiguration.enable_status_view)return"status"}}},methods:{selectFirstRoute(){this.firstView?this.$router.push({name:this.firstView}):console.warn("no router view enabled, check your configuration!")}},mounted(){setTimeout(this.selectFirstRoute,3e3)}},se=e=>(N("data-v-0939a750"),e=e(),O(),e),ce=se(()=>S("img",{class:"logo",src:ie},null,-1));function ae(e,t,i,s,o,n){const r=a("i-card"),c=a("i-column"),d=a("i-row"),u=a("i-container");return m(),_(u,null,{default:l(()=>[p(d,{center:"",middle:""},{default:l(()=>[p(c,null,{default:l(()=>[p(r,{color:"primary"},{header:l(()=>[g(" Cards Theme ")]),default:l(()=>[ce]),_:1})]),_:1})]),_:1})]),_:1})}const le=b(re,[["render",ae],["__scopeId","data-v-0939a750"],["__file","/var/www/html/openWB/packages/modules/display_themes/cards/source/src/views/WelcomeView.vue"]]),ue=V({history:P("/openWB/web/display/themes/cards/"),routes:[{path:"/",name:"welcome",component:le},{path:"/DashBoard",name:"dash-board",component:()=>w(()=>import("./DashBoardView-64de1af5.js"),["assets/DashBoardView-64de1af5.js","assets/SparkLine-4c793aa2.js","assets/vendor-2c584962.js","assets/vendor-inkline-54d7246b.js","assets/vendor-inkline-7b5371f4.css","assets/SparkLine-36150265.css","assets/vendor-fortawesome-07b2e57a.js","assets/DashBoardView-1e9018f7.css"])},{path:"/ChargePoints",name:"charge-points",component:()=>w(()=>import("./ChargePointsView-e4712d22.js"),["assets/ChargePointsView-e4712d22.js","assets/SparkLine-4c793aa2.js","assets/vendor-2c584962.js","assets/vendor-inkline-54d7246b.js","assets/vendor-inkline-7b5371f4.css","assets/SparkLine-36150265.css","assets/vendor-fortawesome-07b2e57a.js","assets/ChargePointsView-e99d2845.css"])},{path:"/Status",name:"status",component:()=>w(()=>import("./StatusView-c00ffcec.js"),["assets/StatusView-c00ffcec.js","assets/vendor-inkline-54d7246b.js","assets/vendor-2c584962.js","assets/vendor-inkline-7b5371f4.css"])}]});const v=R(te);v.use(A());v.use(ue);v.use(F,{colorMode:"dark",components:U});v.mount("#app");export{B as u};
