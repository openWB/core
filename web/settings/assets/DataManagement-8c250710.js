import{l as z,a0 as V,a1 as j,a2 as H,a3 as A,a4 as R,F as P}from"./vendor-fortawesome-ad83e535.js";import{_ as S,C as N}from"./index-ac0c3335.js";import{_ as U}from"./dynamic-import-helper-be004503.js";import{_ as C,p as d,k as p,l as h,y as B,L as u,u as s,x as y,A as o,q as n,a0 as E,a1 as q,z as T,n as v,G as F,I as W,a2 as G}from"./vendor-94ac8c48.js";import"./vendor-bootstrap-9f620114.js";import"./vendor-jquery-f7104ff8.js";import"./vendor-axios-dc63434e.js";import"./vendor-sortablejs-dbc23470.js";const I={name:"BackupCloudConfigFallback",emits:["update:configuration"],props:{configuration:{type:Object,required:!0},backupCloudType:String},methods:{updateConfiguration(t,e=void 0){this.$emit("update:configuration",{value:t,object:e})}}},Z={class:"backup-cloud-fallback"},K={key:1};function $(t,e,r,m,a,i){const c=d("openwb-base-alert"),g=d("openwb-base-textarea");return p(),h("div",Z,[Object.keys(r.configuration).length==0?(p(),B(c,{key:0,subtype:"info"},{default:u(()=>[s(' Der Backup-Cloud-Typ "'+y(r.backupCloudType)+'" bietet keine Einstellungen. ',1)]),_:1})):(p(),h("div",K,[o(c,{subtype:"warning"},{default:u(()=>[s(' Es wurde keine Konfigurationsseite für den Backup-Cloud-Typ "'+y(r.backupCloudType)+'" gefunden. Die Einstellungen können als JSON direkt bearbeitet werden. ',1)]),_:1}),o(g,{title:"Konfiguration",subtype:"json","model-value":r.configuration,"onUpdate:modelValue":e[0]||(e[0]=b=>i.updateConfiguration(b,"configuration"))},{help:u(()=>[s(" Bitte prüfen Sie, ob die Eingaben richtig interpretiert werden. ")]),_:1},8,["model-value"]),o(c,{subtype:"info"},{default:u(()=>[n("pre",null,y(JSON.stringify(r.configuration,void 0,2)),1)]),_:1})]))])}const J=C(I,[["render",$],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/backup_clouds/OpenwbBackupCloudConfigFallback.vue"]]),Q={name:"OpenwbBackupCloudProxy",emits:["update:configuration"],props:{backupCloudType:{type:String,required:!0},configuration:{type:Object,required:!0}},computed:{myComponent(){return console.debug(`loading backup cloud: ${this.backupCloudType}`),E({loader:()=>U(Object.assign({"./nextcloud/backup_cloud.vue":()=>S(()=>import("./backup_cloud-e0f3013d.js"),["assets/backup_cloud-e0f3013d.js","assets/vendor-94ac8c48.js","assets/vendor-sortablejs-dbc23470.js","assets/vendor-7b9e30aa.css"]),"./onedrive/backup_cloud.vue":()=>S(()=>import("./backup_cloud-f1ce5010.js"),["assets/backup_cloud-f1ce5010.js","assets/vendor-94ac8c48.js","assets/vendor-sortablejs-dbc23470.js","assets/vendor-7b9e30aa.css"])}),`./${this.backupCloudType}/backup_cloud.vue`),errorComponent:J})}},methods:{updateConfiguration(t){this.$emit("update:configuration",t)}}};function X(t,e,r,m,a,i){return p(),B(q(i.myComponent),{configuration:r.configuration,backupCloudType:r.backupCloudType,"onUpdate:configuration":e[0]||(e[0]=c=>i.updateConfiguration(c))},null,40,["configuration","backupCloudType"])}const Y=C(Q,[["render",X],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/backup_clouds/OpenwbBackupCloudProxy.vue"]]);z.add(V,j,H,A,R);const ee={name:"OpenwbSystem",mixins:[N],emits:["sendCommand"],components:{FontAwesomeIcon:P,OpenwbBackupCloudProxy:Y},data(){return{mqttTopicsToSubscribe:["openWB/system/configurable/backup_clouds","openWB/system/backup_cloud/config","openWB/system/device/+/component/+/config","openWB/chargepoint/+/config","openWB/vehicle/+/name","openWB/LegacySmartHome/config/get/Devices/+/device_configured","openWB/LegacySmartHome/config/get/Devices/+/device_name"],warningAcknowledged:!1,selectedRestoreFile:void 0,restoreUploadDone:!1,selectedDataMigrationFile:void 0,dataMigrationUploadDone:!1,dataMigrationConfig:[{sectionName:"Ladepunkte",sectionComponents:[{key:"cp1",label:"Ladepunkt 1",validTypes:["chargePoint"]},{key:"cp2",label:"Ladepunkt 2",validTypes:["chargePoint"]},{key:"cp3",label:"Ladepunkt 3",validTypes:["chargePoint"]},{key:"cp4",label:"Ladepunkt 4",validTypes:["chargePoint"]},{key:"cp5",label:"Ladepunkt 5",validTypes:["chargePoint"]},{key:"cp6",label:"Ladepunkt 6",validTypes:["chargePoint"]},{key:"cp7",label:"Ladepunkt 7",validTypes:["chargePoint"]},{key:"cp8",label:"Ladepunkt 8",validTypes:["chargePoint"]}]},{sectionName:"Zähler",sectionComponents:[{key:"evu",label:"EVU",validTypes:["counter"]},{key:"consumer1",label:"Verbraucher 1",validTypes:["counter"]},{key:"consumer2",label:"Verbraucher 2",validTypes:["counter"]},{key:"consumer3",label:"Verbraucher 3",validTypes:["counter"]}]},{sectionName:"Wechselrichter",sectionComponents:[{key:"pvAll",label:"Wechselrichter (Summe)",validTypes:["inverter"],help:"Die 1.9er Version von openWB speichert lediglich die Summen-Leistung aller Wechselrichter."}]},{sectionName:"Batteriespeicher",sectionComponents:[{key:"bat",label:"Speicher 1",validTypes:["battery"]}]},{sectionName:"Fahrzeuge",sectionComponents:[{key:"ev1",label:"Fahrzeug von Ladepunkt 1",validTypes:["vehicle"]},{key:"ev2",label:"Fahrzeug von Ladepunkt 2",validTypes:["vehicle"]}]},{sectionName:"SmartHome 2.0",sectionComponents:[{key:"sh1",label:"Gerät 1",validTypes:["smartHome"]},{key:"sh2",label:"Gerät 2",validTypes:["smartHome"]},{key:"sh3",label:"Gerät 3",validTypes:["smartHome"]},{key:"sh4",label:"Gerät 4",validTypes:["smartHome"]},{key:"sh5",label:"Gerät 5",validTypes:["smartHome"]},{key:"sh6",label:"Gerät 6",validTypes:["smartHome"]},{key:"sh7",label:"Gerät 7",validTypes:["smartHome"]},{key:"sh8",label:"Gerät 8",validTypes:["smartHome"]},{key:"sh9",label:"Gerät 9",validTypes:["smartHome"]},{key:"sh10",label:"Gerät 10",validTypes:["smartHome"]}]}],dataMigrationMapping:{cp1:void 0,cp2:void 0,cp3:void 0,cp4:void 0,cp5:void 0,cp6:void 0,cp7:void 0,cp8:void 0,evu:void 0,pvAll:void 0,bat:void 0,consumer1:void 0,consumer2:void 0,consumer3:void 0,sh1:void 0,sh2:void 0,sh3:void 0,sh4:void 0,sh5:void 0,sh6:void 0,sh7:void 0,sh8:void 0,sh9:void 0,sh10:void 0,ev1:void 0,ev2:void 0}}},computed:{backupCloudList(){return this.$store.state.mqtt["openWB/system/configurable/backup_clouds"]},componentConfigurations(){return this.getWildcardTopics("openWB/system/device/+/component/+/config")},chargePointOptions(){let t=this.getWildcardTopics("openWB/chargepoint/+/config");var e=[];for(const r of Object.values(t))e.push({value:r.id,text:r.name});return e},counterOptions(){var t=[];for(const e of Object.values(this.componentConfigurations))this.isComponentType(e.type,"counter")&&t.push({value:e.id,text:e.name});return t},inverterOptions(){var t=[];for(const e of Object.values(this.componentConfigurations))this.isComponentType(e.type,"inverter")&&t.push({value:e.id,text:e.name});return t},batteryOptions(){var t=[];for(const e of Object.values(this.componentConfigurations))this.isComponentType(e.type,"bat")&&t.push({value:e.id,text:e.name});return t},vehicleOptions(){let t=this.getWildcardTopics("openWB/vehicle/+/name");var e=[];for(const[r,m]of Object.entries(t)){let a=parseInt(r.match(/\/(\d\d?)\//)[1]);e.push({value:a,text:m})}return e},smartHomeOptions(){let t=this.getWildcardTopics("openWB/LegacySmartHome/config/get/Devices/+/device_configured");var e=[];for(const[r,m]of Object.entries(t))if(m==1){let a=parseInt(r.match(/\/(\d\d?)\//)[1]);e.push({value:a,text:this.$store.state.mqtt[`openWB/LegacySmartHome/config/get/Devices/${a}/device_name`]})}return e}},methods:{isComponentType(t,e){return t.split("_").includes(e)},getBackupCloudDefaultConfiguration(t){const e=this.backupCloudList.find(r=>r.value==t);return Object.prototype.hasOwnProperty.call(e,"defaults")?{...e.defaults}:(console.warn("no default configuration found for backup cloud type!",t),{})},sendSystemCommand(t,e={}){this.$emit("sendCommand",{command:t,data:e})},getMigrationOptions(t){var e=[{value:void 0,text:"-- nicht übernehmen --"}];return t.includes("chargePoint")&&e.push(...this.chargePointOptions),t.includes("counter")&&e.push(...this.counterOptions),t.includes("inverter")&&e.push(...this.inverterOptions),t.includes("battery")&&e.push(...this.batteryOptions),t.includes("vehicle")&&e.push(...this.vehicleOptions),t.includes("smartHome")&&e.push(...this.smartHomeOptions),e},updateConfiguration(t,e){console.debug("updateConfiguration",t,e),this.updateState(t,e.value,e.object)},updateSelectedBackupCloud(t){this.updateState("openWB/system/backup_cloud/config",t,"type"),this.updateState("openWB/system/backup_cloud/config",this.getBackupCloudDefaultConfiguration(t))},updateSelectedRestoreFile(t){this.selectedRestoreFile=t.target.files[0]},updateSelectedDataMigrationFile(t){this.selectedDataMigrationFile=t.target.files[0]},uploadFile(t,e,r){return new Promise(m=>{if(e!==void 0){let a=new FormData;a.append("file",e),a.append("target",t),this.axios.post(location.protocol+"//"+location.host+"/openWB/web/settings/uploadFile.php",a,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.$root.postClientMessage(r,"success"),m(!0)}).catch(i=>{if(i.response){console.error(i.response.status,i.response.data);var c="Hochladen der Datei fehlgeschlagen!<br />"+i.response.status+": "+i.response.data}else i.request?(console.error(i.request),c+="Es wurde keine Antwort vom Server empfangen."):(console.error("Error",i.message),c+="Es ist ein unbekannter Fehler aufgetreten.");this.$root.postClientMessage(c,"danger"),m(!1)})}else console.error("no file selected for upload"),m(!1)})},async uploadRestoreFile(){const t="Die Sicherungsdatei wurde erfolgreich hochgeladen. Sie können die Wiederherstellung jetzt starten.";this.restoreUploadDone=await this.uploadFile("restore",this.selectedRestoreFile,t)},async uploadDataMigrationFile(){const t="Die Sicherungsdatei wurde erfolgreich hochgeladen. Sie können den Import jetzt starten.";this.dataMigrationUploadDone=await this.uploadFile("migrate",this.selectedDataMigrationFile,t)},restoreBackup(){this.sendSystemCommand("restoreBackup"),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})},dataMigration(){this.sendSystemCommand("dataMigration",this.dataMigrationMapping)},factoryReset(){this.sendSystemCommand("factoryReset",{}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})}}},te={class:"system"},ne=n("h2",null,"Achtung!",-1),oe=n("p",null," Vor allen Aktionen auf dieser Seite ist sicherzustellen, dass kein Ladevorgang aktiv ist! Zur Sicherheit bitte zusätzlich alle Fahrzeuge von der Ladestation / den Ladestationen abstecken! ",-1),ie={key:0},se={name:"backupForm"},ae=n("a",{href:"/openWB/data/backup/",target:"_blank"},"hier",-1),le={class:"row justify-content-center"},ue={class:"col-md-4 d-flex py-1 justify-content-center"},re=n("hr",null,null,-1),de={name:"restoreForm"},ce=n("br",null,null,-1),pe={class:"input-group"},me={class:"input-group-prepend"},ge={class:"input-group-text"},fe={class:"custom-file"},he={id:"input-file-label",class:"custom-file-label",for:"input-file","data-browse":"Suchen"},be={class:"input-group-append"},_e=["disabled"],ye={class:"row justify-content-center"},ke={class:"col-md-4 d-flex py-1 justify-content-center"},ve=n("hr",null,null,-1),we={name:"cloudBackupForm"},Ce=n("br",null,null,-1),Be=n("a",{href:"https://github.com/openWB/core/wiki/Cloud-Sicherung",target:"_blank",rel:"noopener noreferrer"}," hier ",-1),De={key:0},Se={name:"dataMigrationForm"},Te=n("br",null,null,-1),Fe=n("br",null,null,-1),We={class:"input-group"},Oe={class:"input-group-prepend"},xe={class:"input-group-text"},Me={class:"custom-file"},Le={id:"data-migration-file-label",class:"custom-file-label",for:"data-migration-file","data-browse":"Suchen"},ze={class:"input-group-append"},Ve=["disabled"],je={class:"row justify-content-center"},He={class:"col-md-4 d-flex py-1 justify-content-center"},Ae={name:"resetForm"},Re={class:"row justify-content-center"},Pe={class:"col-md-4 d-flex py-1 justify-content-center"};function Ne(t,e,r,m,a,i){const c=d("openwb-base-button-group-input"),g=d("openwb-base-alert"),b=d("openwb-base-heading"),f=d("font-awesome-icon"),k=d("openwb-base-click-button"),D=d("openwb-base-select-input"),O=d("openwb-base-button-input"),x=d("openwb-backup-cloud-proxy"),M=d("openwb-base-submit-buttons"),w=d("openwb-base-card");return p(),h("div",te,[o(g,{subtype:"danger"},{default:u(()=>[ne,oe,o(c,{title:"Ich habe die Warnung verstanden",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}],modelValue:this.warningAcknowledged,"onUpdate:modelValue":e[0]||(e[0]=l=>this.warningAcknowledged=l)},null,8,["modelValue"])]),_:1}),a.warningAcknowledged?(p(),h("div",ie,[o(w,{title:"Sicherung / Wiederherstellung",subtype:"success",collapsible:!0,collapsed:!0},{default:u(()=>[n("form",se,[o(b,null,{default:u(()=>[s("Sicherung")]),_:1}),o(g,{subtype:"danger"},{default:u(()=>[s(' Aktuell können nur Sicherungen wiederhergestellt werden, die in den Entwicklungszweigen "master", "Beta" oder "Release" erstellt wurden! ')]),_:1}),o(g,{subtype:"info"},{default:u(()=>[s(" Nachdem die Sicherung abgeschlossen ist, kann die erstellte Datei über den Link in der Benachrichtigung oder "),ae,s(" heruntergeladen werden. ")]),_:1}),n("div",le,[n("div",ue,[o(k,{class:"btn-success clickable",onButtonClicked:e[1]||(e[1]=l=>i.sendSystemCommand("createBackup",{use_extended_filename:!0}))},{default:u(()=>[s(" Sicherung erstellen "),o(f,{"fixed-width":"",icon:["fas","archive"]})]),_:1})])])]),re,n("form",de,[o(b,null,{default:u(()=>[s("Wiederherstellung")]),_:1}),o(g,{subtype:"danger"},{default:u(()=>[s(" Für die Wiederherstellung wird eine aktive Internetverbindung benötigt."),ce,s(' Aktuell können nur Sicherungen wiederhergestellt werden, die in den Entwicklungszweigen "master", "Beta" oder "Release" erstellt wurden! ')]),_:1}),n("div",pe,[n("div",me,[n("div",ge,[o(f,{"fixed-width":"",icon:["fas","file-archive"]})])]),n("div",fe,[n("input",{id:"input-file",type:"file",class:"custom-file-input",accept:".tar.gz,application/gzip,application/tar+gzip",onChange:e[2]||(e[2]=l=>i.updateSelectedRestoreFile(l))},null,32),n("label",he,y(a.selectedRestoreFile?a.selectedRestoreFile.name:"Bitte eine Datei auswählen"),1)]),n("div",be,[n("button",{class:v(["btn",a.selectedRestoreFile?"btn-success clickable":"btn-outline-success"]),disabled:!a.selectedRestoreFile,type:"button",onClick:e[3]||(e[3]=l=>i.uploadRestoreFile())},[s(" Hochladen "),o(f,{"fixed-width":"",icon:["fas","upload"]})],10,_e)])]),n("div",ye,[n("div",ke,[o(k,{class:v(a.restoreUploadDone?"btn-success clickable":"btn-outline-success"),disabled:!a.restoreUploadDone,onButtonClicked:e[4]||(e[4]=l=>i.restoreBackup())},{default:u(()=>[s(" Wiederherstellung starten "),o(f,{"fixed-width":"",icon:["fas","box-open"]})]),_:1},8,["class","disabled"])])])]),ve,n("form",we,[o(b,null,{default:u(()=>[s(" Automatische Sicherung in einen Cloud-Dienst ")]),_:1}),o(g,{subtype:"info"},{default:u(()=>[s(" Zwischen Mitternacht und 5:00 Uhr wird automatisch eine Sicherung erstellt und in den angegebenen Cloud-Dienst (nicht openWB Cloud!) hochgeladen. Ist kein Cloud-Dienst konfiguriert, wird keine automatische Sicherung erstellt. Die automatische Sicherung kann unabhängig von der openWB Cloud genutzt werden."),Ce,s(" Die Anleitung zur Konfiguration des Cloud-Dienstes findest Du "),Be,s(" . ")]),_:1}),o(D,{class:"mb-2",title:"Backup-Cloud",options:i.backupCloudList,"model-value":t.$store.state.mqtt["openWB/system/backup_cloud/config"].type,"onUpdate:modelValue":e[5]||(e[5]=l=>i.updateSelectedBackupCloud(l))},null,8,["options","model-value"]),t.$store.state.mqtt["openWB/system/backup_cloud/config"].type?(p(),h("div",De,[o(O,{title:"Manuelle Cloud-Sicherung",buttonText:"Sicherung erstellen und hochladen",subtype:"success",onButtonClicked:e[6]||(e[6]=l=>i.sendSystemCommand("createCloudBackup",{}))}),o(x,{backupCloudType:t.$store.state.mqtt["openWB/system/backup_cloud/config"].type,configuration:t.$store.state.mqtt["openWB/system/backup_cloud/config"].configuration,"onUpdate:configuration":e[7]||(e[7]=l=>i.updateConfiguration("openWB/system/backup_cloud/config",l)),onSendCommand:e[8]||(e[8]=l=>i.sendSystemCommand(l.command,l.args))},null,8,["backupCloudType","configuration"])])):T("v-if",!0),o(M,{formName:"cloudBackupForm",hideReset:!0,hideDefaults:!0,onSave:e[9]||(e[9]=l=>t.$emit("save")),onReset:e[10]||(e[10]=l=>t.$emit("reset")),onDefaults:e[11]||(e[11]=l=>t.$emit("defaults"))})])]),_:1}),o(w,{title:"Datenübernahme",subtype:"success",collapsible:!0,collapsed:!0},{default:u(()=>[n("form",Se,[o(g,{subtype:"info"},{default:u(()=>[s(" Hier kann die Sicherung einer älteren 1.9er Version hochgeladen werden, um vorhandene historische Daten (Diagramme und Ladeprotokolle) sowie Cloud-Daten und Seriennummer in diese Installation zu importieren. Die Zuordnung zwischen den alten und neuen Komponenten muss manuell durchgeführt werden."),Te,s(" Die Portierung kann einige Minuten dauern. Du erhältst eine Meldung, wenn die Datenübernahme abgeschlossen ist. ")]),_:1}),o(g,{subtype:"danger"},{default:u(()=>[s(" Vor der Datenübernahme unbedingt eine Sicherung erstellen."),Fe,s(" Die Datenübernahme kann nur durch Einspielen einer Sicherung rückgängig gemacht werden! ")]),_:1}),n("div",We,[n("div",Oe,[n("div",xe,[o(f,{"fixed-width":"",icon:["fas","file-archive"]})])]),n("div",Me,[n("input",{id:"data-migration-file",type:"file",class:"custom-file-input",accept:".tar.gz,application/gzip,application/tar+gzip",onChange:e[12]||(e[12]=l=>i.updateSelectedDataMigrationFile(l))},null,32),n("label",Le,y(a.selectedDataMigrationFile?a.selectedDataMigrationFile.name:"Bitte eine Datei auswählen"),1)]),n("div",ze,[n("button",{class:v(["btn",a.selectedDataMigrationFile?"btn-success clickable":"btn-outline-success"]),disabled:!a.selectedDataMigrationFile,type:"button",onClick:e[13]||(e[13]=l=>i.uploadDataMigrationFile())},[s(" Hochladen "),o(f,{"fixed-width":"",icon:["fas","upload"]})],10,Ve)])]),o(b,null,{default:u(()=>[s("Zuordnung der Komponenten")]),_:1}),(p(!0),h(F,null,W(a.dataMigrationConfig,l=>(p(),h("div",{key:l.sectionName},[o(b,null,{default:u(()=>[s(y(l.sectionName),1)]),_:2},1024),(p(!0),h(F,null,W(l.sectionComponents,_=>(p(),B(D,{key:_.key,title:_.label,options:i.getMigrationOptions(_.validTypes),modelValue:a.dataMigrationMapping[_.key],"onUpdate:modelValue":L=>a.dataMigrationMapping[_.key]=L},G({_:2},[_.help?{name:"help",fn:u(()=>[s(y(_.help),1)]),key:"0"}:void 0]),1032,["title","options","modelValue","onUpdate:modelValue"]))),128))]))),128)),n("div",je,[n("div",He,[o(k,{class:v(a.dataMigrationUploadDone?"btn-success clickable":"btn-outline-success"),disabled:!a.dataMigrationUploadDone,onButtonClicked:e[14]||(e[14]=l=>i.dataMigration())},{default:u(()=>[s(" Datenübernahme starten "),o(f,{"fixed-width":"",icon:["fas","box-open"]})]),_:1},8,["class","disabled"])])])])]),_:1}),n("form",Ae,[o(w,{title:"Zurücksetzen",subtype:"danger",collapsible:!0,collapsed:!0},{footer:u(()=>[n("div",Re,[n("div",Pe,[o(k,{class:"btn-danger clickable",onButtonClicked:e[15]||(e[15]=l=>i.factoryReset())},{default:u(()=>[o(f,{"fixed-width":"",icon:["fas","skull-crossbones"]}),s(" Zurücksetzen "),o(f,{"fixed-width":"",icon:["fas","skull-crossbones"]})]),_:1})])])]),default:u(()=>[o(g,{subtype:"danger"},{default:u(()=>[s(" Alle Einstellungen, angelegte Geräte/Komponenten, Ladepunkte und Fahrzeuge, etc, Tages-, Monats- und Jahresauswertungen sowie das Ladeprotokoll werden unwiederbringlich gelöscht. Auch die Vorkonfiguration im Auslieferungszustand wird gelöscht. Die openWB muss danach komplett neu eingerichtet werden. Die openWB wird hierfür automatisch neu gestartet. Bitte erstelle vor dem Zurücksetzen eine Sicherung! ")]),_:1})]),_:1})])])):T("v-if",!0)])}const Je=C(ee,[["render",Ne],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/DataManagement.vue"]]);export{Je as default};
