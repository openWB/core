import{F as W,l as x,A as q,ak as L,B as T,al as Z,d as E,af as O}from"./vendor-fortawesome-CaZSeuAc.js";import{C as I}from"./index-BFYuTgoH.js";import{_ as M,m as c,f as p,x as a,u,y as l,D as o,z as g,L as _,M as A,q as D,A as G,k as P,K as C,l as d}from"./vendor-BoRpwYSS.js";import"./vendor-bootstrap-C_iHcwa3.js";import"./vendor-jquery-CEMonh9Y.js";import"./vendor-axios-B0SCfrz2.js";import"./vendor-sortablejs-B7wL87hN.js";x.add(q,L,T,Z,E,O);const F={name:"OpenwbSecurityView",components:{FontAwesomeIcon:W},mixins:[I],props:{installAssistantActive:{type:Boolean,required:!1,default:!1}},emits:["save","reset","defaults","sendCommand"],data(){return{mqttTopicsToSubscribe:["openWB/general/allow_unencrypted_access","openWB/system/security/user_management_active","openWB/system/device/+/component/+/config","openWB/chargepoint/+/config","openWB/system/io/+/config","openWB/io/action/+/config","openWB/vehicle/+/name","$CONTROL/dynamic-security/v1/response"],mqttTopicsToPublish:["openWB/general/allow_unencrypted_access","openWB/system/security/user_management_active"],activeControlCommand:null,controlCommandsQueue:[],clients:[],clientDetails:{},groups:[],groupDetails:{},rawRoles:[],roleDetails:{},rolesVersion:null,newClientName:null,newGroupName:null,anonymousGroupName:null,userGroupName:"user",defaultAclAccess:[],showResetModal:!1}},computed:{dynSecResponse(){return this.$store.state.mqtt["$CONTROL/dynamic-security/v1/response"]},loggedInUser(){return this.$store.state.local.username||null},readableAcls(){return n=>!n||!Array.isArray(n)?"":n.sort((e,i)=>e.topic<i.topic?-1:e.topic>i.topic?1:0).map(e=>{const f={publishClientSend:"Veröffentlichen",publishClientReceive:"Empfangen",subscribe:"Abonnieren",unsubscribe:"Abonnement aufheben",subscribeLiteral:"Abonnieren (exakt)",unsubscribeLiteral:"Abonnement aufheben (exakt)",subscribePattern:"Abonnieren (Muster)",unsubscribePattern:"Abonnement aufheben (Muster)"}[e.acltype]||e.acltype,s=e.allow===!0?"erlaubt":e.allow===!1?"verboten":"unbekannt";return`${e.topic?'"'+e.topic+'"':"<alle Topics>"} -> ${f} ${s}`}).join(`
`)},componentName(){return n=>{const e=`openWB/system/device/+/component/${n}/config`;return Object.values(this.getWildcardTopics(e))[0]?.name||void 0}},chargePointName(){return n=>{const e=`openWB/chargepoint/${n}/config`;return this.$store.state.mqtt[e]?.name||void 0}},vehicleName(){return n=>{const e=`openWB/vehicle/${n}/name`;return this.$store.state.mqtt[e]||void 0}},ioDeviceName(){return n=>{const e=`openWB/system/io/${n}/config`;return this.$store.state.mqtt[e]?.name||void 0}},ioActionName(){return n=>{const e=`openWB/io/action/${n}/config`;return this.$store.state.mqtt[e]?.name||void 0}},routes(){const n=this.$router.getRoutes();return console.debug("All route names:",n.map(e=>e.name).sort()),n},routeName(){return n=>{const e=n.split("-").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(""),i=this.routes.find(f=>f.name===e);if(i===void 0){console.warn("No route found for view:",n,"(searched for route name:",e+")");return}return i.meta.heading}},friendlyRoleName(){return n=>{let e=null;switch(n){case"charge-log-access":case"install-assistant-access":case"data-management-access":case"legal-settings-access":e=n.replace("-access","");break;case"settings-access":return"Einstellungen: Zugang ermöglichen";case"legacy-smart-home-configuration-access":return"Einstellungen: Konfiguration - SmartHome";case"full-access":return"Voller Zugang";case"dynsec-admin":return"Sicherheits-Administrator";case"basic-display-data":return"Basisdaten: Display";case"basic-system-data":return"Basisdaten: System";case"basic-theme-data":return"Basisdaten: Hauptseite/Theme";case"basic-user-data":return"Basisdaten: Benutzer";case"electricity-price-access":return"Daten: Strompreise (lesen)";case"graph-access":return"Daten: Verlaufsdiagramm (lesen)";case"home-consumption-access":return"Daten: Hausverbrauch (lesen)"}const i=n.split("-");if((n.endsWith("-configuration-access")||n.endsWith("-installation-access")||n.endsWith("-access")&&i.length==2)&&(e=n.replace("-access","")),e!==null){const f=this.routeName(e);if(f!==void 0)return`Einstellungen: ${f}`}switch(i[0]){case"counter":if(!isNaN(i[1]))return`Daten: Zähler '${this.componentName(i[1])||i[1]}' (${i[1]})`;break;case"inverter":if(!isNaN(i[1]))return`Daten: Wechselrichter '${this.componentName(i[1])||i[1]}' (${i[1]})`;if(i[1]=="sum")return"Daten: Wechselrichter Summendaten";break;case"bat":if(!isNaN(i[1]))return`Daten: Speicher '${this.componentName(i[1])||i[1]}' (${i[1]})`;if(i[1]=="sum")return"Daten: Speicher Summendaten";break;case"chargepoint":if(!isNaN(i[1]))return`Daten: Ladepunkt '${this.chargePointName(i[1])||i[1]}' (${i[1]})`;if(i[1]==="sum")return"Daten: Ladepunkt Summendaten";break;case"vehicle":if(!isNaN(i[1]))return`Daten: Fahrzeug '${this.vehicleName(i[1])||i[1]}' (${i[1]})`;if(i[1]==="configuration")return"Einstellungen: Fahrzeuge";break;case"io":switch(i[1]){case"configuration":return"Einstellungen: Ein-/Ausgänge";case"device":return`Daten: Ein-/Ausgangs-Gerät '${this.ioDeviceName(i[2])||i[2]}' (${i[2]})`;case"action":return`Daten: Ein-/Ausgangs-Aktion '${this.ioActionName(i[2])||i[2]}' (${i[2]})`}break}return`*${n}*`}},rolesList(){return this.roles.map(n=>({name:n,friendlyName:this.friendlyRoleName(n)})).sort((n,e)=>n.friendlyName<e.friendlyName?-1:n.friendlyName>e.friendlyName?1:0)}},watch:{dynSecResponse(n){n&&n.responses&&n.responses.forEach(e=>{switch(e.command){case"listClients":this.clients=JSON.parse(JSON.stringify(e.data.clients));break;case"getClient":this.clientDetails[e.data.client.username]=JSON.parse(JSON.stringify(e.data.client));break;case"createClient":case"disableClient":case"enableClient":this.getClientList();break;case"modifyClient":case"deleteClient":this.getClientList(),this.getGroupsDetails();break;case"listGroups":this.groups=JSON.parse(JSON.stringify(e.data.groups));break;case"getAnonymousGroup":this.anonymousGroupName=e.data.group.groupname;break;case"getGroup":this.groupDetails[e.data.group.groupname]=JSON.parse(JSON.stringify(e.data.group));break;case"createGroup":this.getGroupList();break;case"modifyGroup":case"deleteGroup":this.getGroupList(),this.getClientsDetails();break;case"listRoles":this.roles=JSON.parse(JSON.stringify(e.data.roles)).filter(i=>i.startsWith("openwb-version:")?(this.rolesVersion=i.split(":")[1],!1):!0);break;case"getRole":this.roleDetails[e.data.role.rolename]=JSON.parse(JSON.stringify(e.data.role));break;case"getDefaultACLAccess":this.defaultAclAccess=JSON.parse(JSON.stringify(e.data.acls));break;default:console.warn("Unhandled dynamic security response:",e);break}}),this.activeControlCommand=null,this.processControlCommandQueue()},loggedInUser(n,e){n!==e&&this.$router.go()}},mounted(){this.init()},methods:{init(){this.clients=[],this.clientDetails={},this.groups=[],this.groupDetails={},this.roles=[],this.roleDetails={},this.$store.state.mqtt["openWB/system/security/user_management_active"]===!0&&(console.debug("Initializing Security view for user:",this.loggedInUser),this.getAnonymousGroupName(),this.getDefaultAclAccess(),this.getClientList(),this.getGroupList(),this.getRoleList())},handleResetModal(n){this.showResetModal=!1,n==="confirm"&&(console.info("Resetting user management!"),this.$emit("sendCommand",{command:"resetUserManagement"}))},saveSecuritySettings(){this.$store.state.mqtt["openWB/system/security/user_management_active"]===!1&&(console.info("User management deactivated, removing mqtt cookie."),this.$cookies.remove("mqtt")),this.$emit("save",this.mqttTopicsToPublish)},sendControlCommand(n,e={}){if(this.activeControlCommand!==null){console.warn("Control command already running, please wait.");return}this.activeControlCommand=n;const i={commands:[{command:n,...e}]};console.debug("$CONTROL command:",i),this.$root.doPublish("$CONTROL/dynamic-security/v1",i)},queueControlCommand(n,e={}){this.controlCommandsQueue.push({command:n,payload:e}),this.processControlCommandQueue()},processControlCommandQueue(){if(this.activeControlCommand!==null||this.controlCommandsQueue.length===0)return;const{command:n,payload:e}=this.controlCommandsQueue.shift();this.sendControlCommand(n,e)},getClientList(){this.queueControlCommand("listClients")},getClientsDetails(){this.clients.forEach(n=>{this.queueControlCommand("getClient",{username:n})})},getClient(n){this.queueControlCommand("getClient",{username:n})},createClient(){console.debug("Creating new client:",this.newClientName),this.queueControlCommand("createClient",{username:this.newClientName}),this.newClientName=null},deleteClient(n){if(n===this.loggedInUser){console.error("Cannot delete currently logged in user:",n),this.$root.postClientMessage("Der aktuell angemeldete Benutzer kann nicht gelöscht werden.","danger");return}console.debug("Deleting client:",n),this.queueControlCommand("deleteClient",{username:n})},toggleClientDisabled(n){const e=this.clientDetails[n]?.disabled||!1;if(n===this.loggedInUser&&e===!1){console.error("Cannot disable currently logged in user:",n),this.$root.postClientMessage("Der aktuell angemeldete Benutzer kann nicht deaktiviert werden.","danger");return}this.queueControlCommand(e?"enableClient":"disableClient",{username:n}),this.queueControlCommand("getClient",{username:n})},modifyClient(n){console.debug("Modifying client:",n),[null,void 0,""].includes(this.clientDetails[n].password)?delete this.clientDetails[n].password:this.clientDetails[n].username==="admin"&&(console.debug("Updating password for client:",n),this.$emit("sendCommand",{command:"updateAdminPassword",data:{newPassword:this.clientDetails[n].password}})),this.queueControlCommand("modifyClient",{username:n,...this.clientDetails[n]})},getGroupList(){this.queueControlCommand("listGroups")},getAnonymousGroupName(){this.queueControlCommand("getAnonymousGroup")},getGroupsDetails(){this.groups.forEach(n=>{this.queueControlCommand("getGroup",{groupname:n})})},getGroup(n){this.queueControlCommand("getGroup",{groupname:n})},createGroup(){console.debug("Creating new group:",this.newGroupName),this.queueControlCommand("createGroup",{groupname:this.newGroupName}),this.newGroupName=null},deleteGroup(n){console.debug("Deleting group:",n),this.queueControlCommand("deleteGroup",{groupname:n})},modifyGroup(n){console.debug("Modifying group:",n),this.queueControlCommand("modifyGroup",{groupname:n,...this.groupDetails[n]})},getRoleList(){this.queueControlCommand("listRoles")},getRole(n){this.queueControlCommand("getRole",{rolename:n})},getDefaultAclAccess(){this.queueControlCommand("getDefaultACLAccess")}}},H={class:"security"},J={name:"accessForm"},Q={key:0},j={key:1},K=["title","onClick"],X={key:0},Y=["name"],$={key:1},ee={key:1},ne={key:0},te=["name"],se={key:1},re={key:1},le={key:0},ie=["name"],ae={key:1},oe={key:1};function ue(n,e,i,f,s,m){const S=c("openwb-base-modal-dialog"),V=c("openwb-base-button-group-input"),U=c("openwb-base-button-input"),N=c("openwb-base-submit-buttons"),y=c("openwb-base-card"),k=c("FontAwesomeIcon"),w=c("openwb-base-alert"),b=c("openwb-base-text-input"),h=c("font-awesome-icon"),R=c("openwb-base-avatar"),z=c("openwb-base-array-input"),B=c("openwb-base-textarea");return d(),p("div",H,[a(S,{show:s.showResetModal,title:"Benutzerverwaltung zurücksetzten",subtype:"danger",buttons:[{text:"Alles zurücksetzen!",event:"confirm",subtype:"danger"}],onModalResult:e[0]||(e[0]=t=>m.handleResetModal(t))},{default:l(()=>[...e[11]||(e[11]=[u("p",null," Bist Du sicher, dass Du die openWB Benutzerverwaltung zurücksetzen möchtest? Hiermit werden alle Benutzer, Gruppen und Rollen gelöscht und auf die Werkseinstellungen zurückgesetzt. Diese Aktion ist irreversibel! ",-1),u("p",null,[o(" Standard-Admin-Benutzer nach dem Zurücksetzen: Benutzername: "),u("strong",null,"admin"),o(" Passwort: "),u("strong",null,"openwb")],-1)])]),_:1},8,["show"]),u("form",J,[a(y,{title:"Allgemein"},{footer:l(()=>[a(N,{"form-name":"accessForm",onSave:m.saveSecuritySettings,onReset:e[4]||(e[4]=t=>n.$emit("reset")),onDefaults:e[5]||(e[5]=t=>n.$emit("defaults"))},null,8,["onSave"])]),default:l(()=>[a(V,{title:"Unverschlüsselten Zugang erlauben","model-value":n.$store.state.mqtt["openWB/general/allow_unencrypted_access"],disabled:n.$store.state.mqtt["openWB/system/security/user_management_active"]===!0,buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"onUpdate:modelValue":e[1]||(e[1]=t=>n.updateState("openWB/general/allow_unencrypted_access",t))},{help:l(()=>[...e[12]||(e[12]=[u("p",null," Hier kann eingestellt werden, ob unverschlüsselter Zugang zu openWB erlaubt ist. Dies betrifft sowohl den Zugriff über MQTT (Ports 1883 und 9001) als auch über HTTP (Port 80) (Weboberfläche). ",-1),u("p",null,[u("strong",null,"Hinweis:"),o(" Aus Sicherheitsgründen sollte der unverschlüsselte Zugang nur in geschützten Netzwerken aktiviert werden. Für die integrierten Benutzerverwaltung muss der unverschlüsselte Zugang zuerst deaktiviert werden. ")],-1)])]),_:1},8,["model-value","disabled"]),a(V,{title:"Benutzerverwaltung","model-value":n.$store.state.mqtt["openWB/system/security/user_management_active"],disabled:n.$store.state.mqtt["openWB/general/allow_unencrypted_access"]===!0,buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"onUpdate:modelValue":e[2]||(e[2]=t=>n.updateState("openWB/system/security/user_management_active",t))},{help:l(()=>[...e[13]||(e[13]=[u("p",null," Hier kann die integrierte Benutzerverwaltung von openWB aktiviert oder deaktiviert werden. Mit aktivierter Benutzerverwaltung ist der Zugriff auf den Mosquitto Broker (MQTT) und davon abhängige Dienste (Weboberfläche, API) nur mit einem gültigen Benutzerkonto (oder anonym ohne Anmeldung, falls erlaubt) möglich. ",-1),u("p",null,[o(" Standard-Admin-Benutzer nach der ersten Aktivierung: Benutzername: "),u("strong",null,"admin"),o(" Passwort: "),u("strong",null,"openwb")],-1),u("p",null,[u("strong",null,"Hinweis:"),o(" Die Benutzerverwaltung erfordert zwingend die Abschaltung des unverschlüsselten Zugangs. ")],-1)])]),_:1},8,["model-value","disabled"]),e[15]||(e[15]=u("hr",null,null,-1)),a(U,{title:"Benutzerverwaltung zurücksetzen","button-text":"Zurücksetzen",subtype:"danger",disabled:n.$store.state.mqtt["openWB/system/security/user_management_active"]===!0||m.loggedInUser!==null,onButtonClicked:e[3]||(e[3]=t=>s.showResetModal=!0)},{help:l(()=>[...e[14]||(e[14]=[o(" Hiermit werden alle Benutzer, Gruppen und Rollen der openWB Benutzerverwaltung gelöscht und auf die Werkseinstellungen zurückgesetzt. Diese Aktion ist irreversibel!",-1),u("br",null,null,-1),u("strong",null,"Hinweis:",-1),o(" Die Benutzerverwaltung muss deaktiviert sein und es darf kein Benutzer angemeldet sein, um die Benutzerverwaltung zurücksetzen zu können.",-1),u("br",null,null,-1),o(" Standard-Admin-Benutzer nach dem Zurücksetzen: Benutzername: ",-1),u("strong",null,"admin",-1),o(" Passwort: ",-1),u("strong",null,"openwb",-1)])]),_:1},8,["disabled"])]),_:1})]),n.$store.state.mqtt["openWB/system/security/user_management_active"]===!0?(d(),p("div",Q,[a(y,{collapsible:!0,collapsed:!0,onExpanded:e[8]||(e[8]=t=>m.getClientsDetails())},{header:l(()=>[a(k,{icon:["fas","user"]}),e[16]||(e[16]=o(" Benutzer ",-1))]),default:l(()=>[s.clients.length===0?(d(),g(w,{key:0,subtype:"info"},{default:l(()=>[...e[17]||(e[17]=[o(" Es sind noch keine Benutzer angelegt oder Du hast nicht die benötigten Rechte, Daten anzuzeigen. ",-1)])]),_:1})):(d(),p("div",j,[a(b,{modelValue:s.newClientName,"onUpdate:modelValue":e[6]||(e[6]=t=>s.newClientName=t),title:"Neuen Benutzer erstellen",subtype:"user","add-button":"","onInput:add":e[7]||(e[7]=t=>m.createClient())},{help:l(()=>[...e[18]||(e[18]=[o(" Hier kann ein neuer Benutzer für die openWB Benutzerverwaltung angelegt werden. Der Benutzername kann nicht mehr geändert werden! ",-1)])]),_:1},8,["modelValue"]),e[21]||(e[21]=u("hr",null,null,-1)),(d(!0),p(_,null,A(s.clients,t=>(d(),g(y,{key:t,collapsible:!0,collapsed:!0,onExpanded:r=>m.getClient(t)},{header:l(()=>[a(k,{icon:["fas",s.clientDetails[t]?.disabled?"user-slash":"user"]},null,8,["icon"]),o(" "+C(t),1)]),actions:l(r=>[r.collapsed?D("",!0):(d(),p("span",{key:0,class:P(["pill mr-2",[s.clientDetails[t]?.disabled?"bg-danger":"bg-success",{clickable:m.loggedInUser!==t}]]),title:m.loggedInUser!==t?`Benutzer ${s.clientDetails[t]?.disabled?"aktivieren":"deaktivieren"}`:"Der aktuell angemeldete Benutzer kann nicht deaktiviert werden.",onClick:G(v=>{m.loggedInUser!==t&&m.toggleClientDisabled(t)},["stop"])},C(s.clientDetails[t]?.disabled?"Deaktiviert":"Aktiv"),11,K)),!r.collapsed&&m.loggedInUser!==t?(d(),g(R,{key:1,class:"bg-danger clickable",title:"Benutzer löschen",onClick:G(v=>{m.loggedInUser!==t&&m.deleteClient(t)},["stop"])},{default:l(()=>[a(h,{icon:["fas","trash"]})]),_:1},8,["onClick"])):D("",!0)]),footer:l(()=>[a(N,{"form-name":`clientForm-${t}`,"save-id":`saveClientBtn-${t}`,"hide-reset":!0,"hide-defaults":!0,onSave:r=>m.modifyClient(t)},null,8,["form-name","save-id","onSave"])]),default:l(()=>[s.clientDetails[t]?(d(),p("div",X,[u("form",{name:`clientForm-${t}`},[a(b,{modelValue:s.clientDetails[t].username,"onUpdate:modelValue":r=>s.clientDetails[t].username=r,title:"Benutzername",subtype:"user",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),a(b,{modelValue:s.clientDetails[t].textname,"onUpdate:modelValue":r=>s.clientDetails[t].textname=r,title:"E-Mail",subtype:"email",required:""},null,8,["modelValue","onUpdate:modelValue"]),a(b,{modelValue:s.clientDetails[t].password,"onUpdate:modelValue":r=>s.clientDetails[t].password=r,title:"Passwort",subtype:"password"},{help:l(()=>[...e[19]||(e[19]=[o(" Bereits festgelegte Passwörter werden nicht angezeigt!",-1),u("br",null,null,-1),o(" Um das Passwort zu ändern, bitte ein neues Passwort eingeben und speichern, andernfalls das Feld leer lassen. ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"]),a(z,{title:"Zugewiesene Gruppen","valid-elements":s.groups,"model-value":s.clientDetails[t].groups.map(r=>r.groupname),"onUpdate:modelValue":r=>{s.clientDetails[t].groups=r.map(v=>({groupname:v}))}},{"input-prefix":l(()=>[a(h,{icon:["fas","users"]})]),"element-prefix":l(()=>[a(h,{icon:["fas","users"]})]),_:1},8,["valid-elements","model-value","onUpdate:modelValue"]),a(z,{title:"Zugewiesene Rollen","valid-elements":m.rolesList.map(r=>({value:r.name,label:r.friendlyName})),"model-value":s.clientDetails[t].roles.map(r=>r.rolename),"onUpdate:modelValue":r=>{s.clientDetails[t].roles=r.map(v=>({rolename:v}))}},{"input-prefix":l(()=>[a(h,{icon:["fas","file-shield"]})]),"element-prefix":l(()=>[a(h,{icon:["fas","file-shield"]})]),_:1},8,["valid-elements","model-value","onUpdate:modelValue"]),a(B,{modelValue:s.clientDetails[t].textdescription,"onUpdate:modelValue":r=>s.clientDetails[t].textdescription=r,title:"Zusatzinformationen",subtype:"text"},{help:l(()=>[...e[20]||(e[20]=[o(" Hier können zusätzliche Informationen zum Benutzer hinterlegt werden. ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"])],8,Y)])):(d(),p("div",$,"Lade Benutzerdetails..."))]),_:2},1032,["onExpanded"]))),128))]))]),_:1}),a(y,{collapsible:!0,collapsed:!0},{header:l(()=>[a(k,{icon:["fas","users"]}),e[22]||(e[22]=o(" Gruppen ",-1))]),default:l(()=>[s.groups.length===0?(d(),g(w,{key:0,subtype:"info"},{default:l(()=>[...e[23]||(e[23]=[o(" Es sind noch keine Gruppen angelegt oder Du hast nicht die benötigten Rechte, Daten anzuzeigen. ",-1)])]),_:1})):(d(),p("div",ee,[a(b,{modelValue:s.newGroupName,"onUpdate:modelValue":e[9]||(e[9]=t=>s.newGroupName=t),title:"Neue Gruppe erstellen",subtype:"group","add-button":"","onInput:add":e[10]||(e[10]=t=>m.createGroup())},{help:l(()=>[...e[24]||(e[24]=[o(" Hier kann eine neue Gruppe für die openWB Benutzerverwaltung angelegt werden. Der Gruppenname kann nicht mehr geändert werden! ",-1)])]),_:1},8,["modelValue"]),e[26]||(e[26]=u("hr",null,null,-1)),(d(!0),p(_,null,A(s.groups,t=>(d(),g(y,{key:t,collapsible:!0,collapsed:!0,onExpanded:r=>m.getGroup(t)},{header:l(()=>[a(k,{icon:["fas","users"]}),o(" "+C(t),1)]),actions:l(r=>[!r.collapsed&&![s.anonymousGroupName,s.userGroupName].includes(t)?(d(),g(R,{key:0,class:"bg-danger clickable",title:"Gruppe löschen",onClick:G(v=>m.deleteGroup(t),["stop"])},{default:l(()=>[a(h,{icon:["fas","trash"]})]),_:1},8,["onClick"])):D("",!0)]),footer:l(()=>[a(N,{"form-name":`groupForm-${t}`,"save-id":`saveGroupBtn-${t}`,"hide-reset":!0,"hide-defaults":!0,onSave:r=>m.modifyGroup(t)},null,8,["form-name","save-id","onSave"])]),default:l(()=>[s.groupDetails[t]?(d(),p("div",ne,[t===s.anonymousGroupName?(d(),g(w,{key:0,subtype:"info"},{default:l(()=>[o(' Die Gruppe "'+C(t)+'" kann nicht gelöscht werden, da sie für den anonymen Zugriff (ohne Anmeldung) auf openWB benötigt wird. ',1)]),_:2},1024)):D("",!0),t===s.userGroupName?(d(),g(w,{key:1,subtype:"info"},{default:l(()=>[o(' Die Gruppe "'+C(t)+'" kann nicht bearbeitet werden, da sie von openWB für reguläre Benutzer verwendet wird. Es wird empfohlen, diese Gruppe für alle Benutzer zu verwenden und weitere Rollen durch separate Gruppen oder direkt bei den Benutzern zuzuweisen. ',1)]),_:2},1024)):D("",!0),u("form",{name:`groupForm-${t}`},[a(b,{modelValue:s.groupDetails[t].groupname,"onUpdate:modelValue":r=>s.groupDetails[t].groupname=r,title:"Gruppenname",subtype:"text",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),a(b,{modelValue:s.groupDetails[t].textname,"onUpdate:modelValue":r=>s.groupDetails[t].textname=r,title:"Beschreibung",subtype:"text",disabled:[s.anonymousGroupName,s.userGroupName].includes(t)},null,8,["modelValue","onUpdate:modelValue","disabled"]),a(z,{title:"Zugewiesene Benutzer","valid-elements":s.clients,"model-value":s.groupDetails[t].clients.map(r=>r.username),"onUpdate:modelValue":r=>{s.groupDetails[t].clients=r.map(v=>({username:v}))}},{"input-prefix":l(()=>[a(h,{icon:["fas","circle-user"]})]),"element-prefix":l(()=>[a(h,{icon:["fas","circle-user"]})]),_:1},8,["valid-elements","model-value","onUpdate:modelValue"]),a(z,{title:"Zugewiesene Rollen","valid-elements":m.rolesList.map(r=>({value:r.name,label:r.friendlyName})),disabled:[s.anonymousGroupName,s.userGroupName].includes(t),readonly:[s.anonymousGroupName,s.userGroupName].includes(t),"model-value":s.groupDetails[t].roles.map(r=>r.rolename),"onUpdate:modelValue":r=>{s.groupDetails[t].roles=r.map(v=>({rolename:v}))}},{"input-prefix":l(()=>[a(h,{icon:["fas","file-shield"]})]),"element-prefix":l(()=>[a(h,{icon:["fas","file-shield"]})]),_:1},8,["valid-elements","disabled","readonly","model-value","onUpdate:modelValue"]),a(B,{modelValue:s.groupDetails[t].textdescription,"onUpdate:modelValue":r=>s.groupDetails[t].textdescription=r,title:"Zusatzinformationen",subtype:"text",disabled:[s.anonymousGroupName,s.userGroupName].includes(t)},{help:l(()=>[...e[25]||(e[25]=[o(" Hier können zusätzliche Informationen zur Gruppe hinterlegt werden. ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])],8,te)])):(d(),p("div",se,"Lade Gruppendetails..."))]),_:2},1032,["onExpanded"]))),128))]))]),_:1}),a(y,{collapsible:!0,collapsed:!0},{header:l(()=>[a(k,{icon:["fas","file-shield"]}),e[27]||(e[27]=o(" Rollen ",-1))]),default:l(()=>[n.roles.length===0?(d(),g(w,{key:0,subtype:"info"},{default:l(()=>[...e[28]||(e[28]=[o(" Es sind noch keine Rollen angelegt oder Du hast nicht die benötigten Rechte, Daten anzuzeigen. ",-1)])]),_:1})):(d(),p("div",re,[a(w,{subtype:"info"},{default:l(()=>[...e[29]||(e[29]=[o(" Rollen definieren die Zugriffsrechte (Access Control Lists, ACLs) für Benutzer und Gruppen. Jeder Benutzer oder jede Gruppe kann mehrere Rollen zugewiesen bekommen, wodurch sich die effektiven Zugriffsrechte zusammensetzen.",-1),u("br",null,null,-1),o(" openWB erstellt automatisch relevante Rollen während der Installation und bei der Aktivierung bestimmter Funktionen oder Bearbeitung von Ladepunkten, Geräten und Komponenten etc. Rollen können hier nicht bearbeitet oder gelöscht werden. ",-1)])]),_:1}),a(b,{"model-value":s.rolesVersion,title:"Versionsnummer der Rollendefinitionen",disabled:""},{help:l(()=>[...e[30]||(e[30]=[o(" Hier wird die aktuell verwendete Rollen-Version der openWB Benutzerverwaltung angezeigt. Diese Version gibt an, welche vordefinierten Rollen und Zugriffsrechte (ACLs) von openWB generiert werden. Bei einem Update von openWB kann sich die Rollen-Version ändern, wodurch neue Rollen hinzugefügt oder bestehende Rollen angepasst werden können. ",-1)])]),_:1},8,["model-value"]),a(B,{title:"Standard-Zugriffsrechte","model-value":m.readableAcls(s.defaultAclAccess),disabled:""},{help:l(()=>[...e[31]||(e[31]=[o(" Hier werden die Standard Zugriffsrechte (Access Control Lists, ACLs) angezeigt. Diese werden verwendet, wenn keine spezifischen ACLs für einen Benutzer oder eine Gruppe definiert sind oder die Topics nicht explizit abgedeckt werden. ",-1)])]),_:1},8,["model-value"]),e[33]||(e[33]=u("hr",null,null,-1)),(d(!0),p(_,null,A(m.rolesList,t=>(d(),g(y,{key:t.name,collapsible:!0,collapsed:!0,onExpanded:r=>m.getRole(t.name)},{header:l(()=>[a(k,{icon:["fas","file-shield"]}),o(" "+C(t.friendlyName),1)]),default:l(()=>[s.roleDetails[t.name]?(d(),p("div",le,[u("form",{name:`roleForm-${t.name}`},[a(b,{modelValue:s.roleDetails[t.name].rolename,"onUpdate:modelValue":r=>s.roleDetails[t.name].rolename=r,title:"Rollenname",subtype:"text",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),a(b,{modelValue:s.roleDetails[t.name].textname,"onUpdate:modelValue":r=>s.roleDetails[t.name].textname=r,title:"Beschreibung",subtype:"text",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),s.roleDetails[t.name].textdescription?(d(),g(w,{key:0,subtype:"info"},{default:l(()=>[o(C(s.roleDetails[t.name].textdescription),1)]),_:2},1024)):D("",!0),a(B,{title:"Zugriffsrechte (ACLs)","model-value":m.readableAcls(s.roleDetails[t.name].acls),disabled:""},{help:l(()=>[...e[32]||(e[32]=[o(" Hier werden die Zugriffsrechte (Access Control Lists, ACLs) für diese Rolle angezeigt. ",-1)])]),_:1},8,["model-value"])],8,ie)])):(d(),p("div",ae,"Lade Rollendetails..."))]),_:2},1032,["onExpanded"]))),128))]))]),_:1})])):(d(),p("div",oe,[a(w,{subtype:"info"},{default:l(()=>[...e[34]||(e[34]=[o(" Die Benutzerverwaltung ist deaktiviert. In diesem Modus haben alle Benutzer uneingeschränkten Zugriff auf openWB.",-1),u("br",null,null,-1),o(" Um Benutzer, Gruppen und Rollen zu verwalten, muss die Benutzerverwaltung zuerst aktiviert werden. ",-1)])]),_:1})]))])}const he=M(F,[["render",ue],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/SecurityConfiguration.vue"]]);export{he as default};
