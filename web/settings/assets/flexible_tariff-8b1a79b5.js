import{a as d}from"./vendor-axios-8e1a46ae.js";import{F as c}from"./GeneralChargeConfig-eb4e97fc.js";import{_ as h,u,l as w,m as _,G as i,E as o,B as a}from"./vendor-1833c026.js";import"./index-25097726.js";import"./vendor-fortawesome-77ba272b.js";import"./vendor-bootstrap-4e7ebeee.js";import"./vendor-jquery-1765c81b.js";import"./vendor-sortablejs-5493eb90.js";import"./dynamic-import-helper-be004503.js";const x={name:"FlexibleTariffRabot",mixins:[c],data(){return{contractNumbers:[]}},computed:{contractOptions(){const t=this.contractNumbers.map(e=>({value:e,text:e}));return t.length===0&&this.flexibleTariff.configuration.contract_number&&t.push({value:this.flexibleTariff.configuration.contract_number,text:this.flexibleTariff.configuration.contract_number}),t}},methods:{rabot_login_window(){const t=window.open("about:blank","RabotLogin","width=800,height=600,status=yes,scrollbars=yes,resizable=yes");t.focus(),this.createAuthUrl().then(e=>{t.location.href=e.authorizationUrl}).catch(e=>{var n,r;t.close(),console.error("Fehler beim Erstellen des Rabot-Links:",e),this.$root.postClientMessage("Fehler beim Erstellen der Rabot-Authentifizierung: "+(((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||e.message),"danger")})},async createAuthUrl(){const t=await d.post("https://rabot.openwb.de/rabot-auth.php",{headers:{"Content-Type":"application/json"}});if(!t.data.success)throw new Error("Server-Fehler beim Erstellen der Rabot-Authentifizierung");return t.data},async fetch_contract_number(){var t,e;if(!this.flexibleTariff.configuration.customer_number){this.$root.postClientMessage("Bitte gib zuerst eine Kundennummer ein.","warning");return}try{const n=await d.get(`https://rabot.openwb.de/rabot-proxy.php/customers/${this.flexibleTariff.configuration.customer_number}/contracts`,{headers:{"Content-Type":"application/json"}});if(n.data&&n.data.contractNumbers&&n.data.contractNumbers.length>0){const r=n.data.contractNumbers;this.contractNumbers=r;const s=r[0];this.updateConfiguration(s,"configuration.contract_number"),r.length>1?this.$root.postClientMessage(`${r.length} Verträge gefunden. Erster Vertrag ausgewählt: ${s}. Du kannst einen anderen Vertrag aus der Liste wählen.`,"success"):this.$root.postClientMessage("Vertragsnummer erfolgreich abgerufen: "+s,"success")}else this.$root.postClientMessage("Keine Verträge für diese Kundennummer gefunden.","warning")}catch(n){console.error("Fehler beim Abrufen der Vertragsnummer:",n),this.$root.postClientMessage("Fehler beim Abrufen der Vertragsnummer: "+(((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||n.message),"danger")}}}},C={class:"flexible-tariff-rabot"};function V(t,e,n,r,s,l){const b=u("openwb-base-alert"),f=u("openwb-base-button-input"),g=u("openwb-base-text-input"),p=u("openwb-base-select-input");return w(),_("div",C,[i(b,{subtype:"info"},{default:o(()=>[...e[3]||(e[3]=[a(" Über die Rabot-Authentifizierung kannst Du Deine Stromtarif-Daten für die Ladeplanung nutzen. Nach der Anmeldung bei Rabot wird eine Kundennummer in der Adresszeile angezeigt, die Du hier einfügen musst. ",-1)])]),_:1}),i(b,{subtype:"warning"},{default:o(()=>[...e[4]||(e[4]=[a(" Die Rabot-Authentifizierung kann nur über einen Computer oder die openWB-Cloud (remote.openwb.de) durchgeführt werden. Das Eintragen von Kunden- und Vertragsnummer ist nicht ausreichend, da nach der Anmeldung bei Rabot noch die Zustimmung erteilt werden muss. ",-1)])]),_:1}),i(f,{title:"1. Bei Rabot anmelden","button-text":"Bei Rabot Anmelden",subtype:"success",onButtonClicked:e[0]||(e[0]=()=>l.rabot_login_window())},{help:o(()=>[...e[5]||(e[5]=[a(" Es wird ein neues Browserfenster geöffnet, in dem Du Dich bei Rabot mit Deinen Zugangsdaten anmelden kannst. ",-1)])]),_:1}),i(g,{title:"2. Kundennummer kopieren und einfügen",required:"","model-value":t.flexibleTariff.configuration.customer_number,"onUpdate:modelValue":e[1]||(e[1]=m=>t.updateConfiguration(m,"configuration.customer_number"))},{help:o(()=>[...e[6]||(e[6]=[a(" Nachdem die Rabot-Authentifizierung abgeschlossen wurde, wird im geöffneten Browserfenster eine Kundennummer angezeigt. Diese kopieren und hier einfügen. Diese wird benötigt, um auf Ihre Tarif-Daten zugreifen zu können. ",-1)])]),_:1},8,["model-value"]),i(f,{title:"3. Vertragsnummer abrufen","button-text":"Vertrag laden",subtype:"info",disabled:!t.flexibleTariff.configuration.customer_number,onButtonClicked:l.fetch_contract_number},{help:o(()=>[...e[7]||(e[7]=[a(" Mit der Kundennummer wird automatisch die zugehörige Vertragsnummer von Rabot abgerufen. ",-1)])]),_:1},8,["disabled","onButtonClicked"]),i(p,{title:"Vertragsnummer",options:l.contractOptions,"model-value":t.flexibleTariff.configuration.contract_number,"onUpdate:modelValue":e[2]||(e[2]=m=>t.updateConfiguration(m,"configuration.contract_number"))},{help:o(()=>[...e[8]||(e[8]=[a(" Wähle eine der verfügbaren Vertragsnummern aus. Diese wird für den Zugriff auf die Tarif-Daten benötigt. ",-1)])]),_:1},8,["options","model-value"])])}const N=h(x,[["render",V],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/electricity_pricing/flexible_tariffs/rabot/flexible_tariff.vue"]]);export{N as default};
