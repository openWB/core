import{l as P,a6 as z,F as S}from"./vendor-fortawesome-231ff303.js";import{C as Z}from"./index-6ffbdc7e.js";import{_ as I,u as d,l,m as w,G as r,E as t,x as m,z as p,B as i,D,N as x,y as u,q as V}from"./vendor-0c15df0c.js";import"./vendor-bootstrap-83e2d5a1.js";import"./vendor-jquery-84e2bf4a.js";import"./vendor-axios-c9d2afa0.js";import"./vendor-sortablejs-1a751103.js";P.add(z);const M={name:"OpenwbCloudConfigView",components:{FontAwesomeIcon:S},mixins:[Z],emits:["sendCommand","save","reset","defaults"],data(){return{mqttTopicsToSubscribe:["openWB/general/extern","openWB/system/dataprotection_acknowledged","openWB/system/mqtt/bridge/+","openWB/system/mqtt/valid_partner_ids"],enableNewCloudButton:!0,newCloudData:{email:"",username:"",partner:!1},enableCloudConnectButton:!0,connectCloudData:{username:"",password:"",partner:!1},enableRemoveCloudButton:!0,showCloudRemoveModal:!1}},computed:{cloudBridge:{get(){let o=this.getWildcardTopics("openWB/system/mqtt/bridge/+");for(const[e,c]of Object.entries(o))c.remote.is_openwb_cloud||delete o[e];return o}},cloudBridgeKey:{get(){for(const[o,e]of Object.entries(this.cloudBridge))if(e.remote.is_openwb_cloud)return o}},cloudSettings:{get(){return{username:this.cloudBridge[this.cloudBridgeKey].remote.username,password:this.cloudBridge[this.cloudBridgeKey].remote.password,partner:this.cloudBridge[this.cloudBridgeKey].access?this.cloudBridge[this.cloudBridgeKey].access.partner:!1}}}},methods:{getMqttBridgeIndex(o){return parseInt(o.match(/(?:\/)(\d+)$/)[1])},createCloud(){document.forms.cloudConfigCreateForm.reportValidity()&&(this.$emit("save"),this.$emit("sendCommand",{command:"initCloud",data:this.newCloudData}),this.enableNewCloudButton=!1)},connectCloud(){document.forms.cloudConfigConnectForm.reportValidity()&&(this.$emit("save"),this.$emit("sendCommand",{command:"connectCloud",data:this.connectCloudData}),this.enableCloudConnectButton=!1)},removeCloudModal(o){o.stopPropagation(),this.showCloudRemoveModal=!0},removeCloud(o){this.showCloudRemoveModal=!1,o=="confirm"&&(console.info("request removal of cloud"),this.updateState("openWB/system/mqtt/valid_partner_ids",[]),this.$emit("sendCommand",{command:"removeMqttBridge",data:{bridge:this.getMqttBridgeIndex(this.cloudBridgeKey)}}),this.enableCloudConnectButton=!0)}}},h={class:"cloud-config"},K={key:1},U={key:1,name:"cloudConfigCreateForm"},N={class:"row justify-content-center"},R={key:2,name:"cloudConfigConnectForm"},A={class:"row justify-content-center"},F={key:3,name:"cloudConfigured"},j={class:"row justify-content-center"};function G(o,e,c,T,s,a){const W=d("openwb-base-modal-dialog"),k=d("router-link"),g=d("openwb-base-alert"),b=d("openwb-base-text-input"),C=d("openwb-base-button-group-input"),f=d("font-awesome-icon"),B=d("openwb-base-array-input"),y=d("openwb-base-click-button"),v=d("openwb-base-card"),_=d("openwb-base-heading"),q=d("openwb-base-submit-buttons");return l(),w(x,null,[r(W,{show:s.showCloudRemoveModal,title:"Cloud Zugang löschen",subtype:"danger",buttons:[{text:"Löschen",event:"confirm",subtype:"danger"}],onModalResult:e[0]||(e[0]=n=>a.removeCloud(n))},{default:t(()=>e[17]||(e[17]=[u(" Willst Du den vorhandenen Cloud Zugang wirklich entfernen? Dieser Vorgang kann nicht rückgängig gemacht werden! ")])),_:1},8,["show"]),m("div",h,[o.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]!==!0?(l(),p(g,{key:0,subtype:"danger"},{default:t(()=>[e[19]||(e[19]=u(" Du musst der ")),r(k,{to:"/System/LegalSettings"},{default:t(()=>e[18]||(e[18]=[u(" Datenschutzerklärung ")])),_:1}),e[20]||(e[20]=u(" zustimmen, um die openWB Cloud nutzen zu können. "))]),_:1})):(l(),w("div",K,[r(g,{subtype:"success"},{default:t(()=>[e[22]||(e[22]=u(" Du hast der ")),r(k,{to:"/System/LegalSettings"},{default:t(()=>e[21]||(e[21]=[u(" Datenschutzerklärung ")])),_:1}),e[23]||(e[23]=u(" zugestimmt und kannst die openWB Cloud nutzen. "))]),_:1}),s.enableRemoveCloudButton?i("",!0):(l(),p(g,{key:0,subtype:"warning"},{default:t(()=>e[24]||(e[24]=[u(" Der Zugang wurde entfernt. Bitte starte die openWB neu, um die Änderungen anzuwenden! ")])),_:1})),a.cloudBridgeKey?i("",!0):(l(),w("form",U,[r(v,{title:"Neuen Zugang erstellen"},D({default:t(()=>[r(g,{subtype:"warning"},{default:t(()=>e[25]||(e[25]=[u(" Derzeit können keine neuen Zugänge für die openWB Cloud angelegt werden. Bitte nutze die in/an der openWB notierten Zugangsdaten im unteren Bereich dieser Seite. Wenn bei einer gekauften openWB keine Zugangsdaten vorhanden sind, schreibe bitte eine Mail unter Angabe der Bestell- und/oder Seriennummer an "),m("a",{href:"mailto:support@openwb.de",subject:"Cloud Zugangsdaten"}," support@openwb.de ",-1),u(" . ")])),_:1}),r(b,{modelValue:s.newCloudData.username,"onUpdate:modelValue":e[1]||(e[1]=n=>s.newCloudData.username=n),title:"Benutzername",required:"",subtype:"user",pattern:"[a-zA-Z]+",disabled:""},null,8,["modelValue"]),r(b,{modelValue:s.newCloudData.email,"onUpdate:modelValue":e[2]||(e[2]=n=>s.newCloudData.email=n),title:"E-Mail",required:"",subtype:"email",disabled:""},null,8,["modelValue"]),r(C,{modelValue:s.newCloudData.partner,"onUpdate:modelValue":e[3]||(e[3]=n=>s.newCloudData.partner=n),disabled:"",title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}]},{help:t(()=>e[26]||(e[26]=[u(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")])),_:1},8,["modelValue"]),s.newCloudData.partner?(l(),p(B,{key:0,title:"Gültige Partner-IDs","no-elements-message":"Keine Partner-ID zugeordnet.","model-value":o.$store.state.mqtt["openWB/system/mqtt/valid_partner_ids"],"onUpdate:modelValue":e[4]||(e[4]=n=>o.updateState("openWB/system/mqtt/valid_partner_ids",n))},{"input-prefix":t(()=>[r(f,{"fixed-width":"",icon:["fas","user-gear"]})]),"element-prefix":t(()=>[r(f,{"fixed-width":"",icon:["fas","user-gear"]})]),help:t(()=>e[27]||(e[27]=[u(" Die Partner-ID erhältst Du von Deinem Installateur. Ist hier keine Partner-ID eingetragen, dann kann auch niemand - trotz aktiviertem Zugang für Partner - über das Partner-Portal auf diese openWB zugreifen! ")])),_:1},8,["model-value"])):i("",!0)]),_:2},[o.$store.state.mqtt["openWB/general/extern"]===!1&&o.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[m("div",N,[r(y,{class:"col-4 btn-outline-success",disabled:""},{default:t(()=>e[28]||(e[28]=[u(" Zugang erstellen ")])),_:1})])]),key:"0"}:void 0]),1024),s.enableNewCloudButton?i("",!0):(l(),p(g,{key:0,subtype:"info",class:"mb-2"},{default:t(()=>e[29]||(e[29]=[u(" Der neue Zugang wird eingerichtet. Dieser Vorgang kann bis zu einer Minute dauern. Bitte warten. ")])),_:1}))])),a.cloudBridgeKey?i("",!0):(l(),w("form",R,[r(v,{title:"Vorhandenen Zugang einrichten"},D({default:t(()=>[r(b,{modelValue:s.connectCloudData.username,"onUpdate:modelValue":e[5]||(e[5]=n=>s.connectCloudData.username=n),title:"Benutzername",required:"",subtype:"user"},null,8,["modelValue"]),r(b,{modelValue:s.connectCloudData.password,"onUpdate:modelValue":e[6]||(e[6]=n=>s.connectCloudData.password=n),title:"Passwort",required:"",subtype:"password"},null,8,["modelValue"]),r(C,{modelValue:s.connectCloudData.partner,"onUpdate:modelValue":e[7]||(e[7]=n=>s.connectCloudData.partner=n),title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}]},{help:t(()=>e[30]||(e[30]=[u(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")])),_:1},8,["modelValue"]),s.connectCloudData.partner?(l(),p(B,{key:0,title:"Gültige Partner-IDs","no-elements-message":"Keine Partner-ID zugeordnet.","model-value":o.$store.state.mqtt["openWB/system/mqtt/valid_partner_ids"],"onUpdate:modelValue":e[8]||(e[8]=n=>o.updateState("openWB/system/mqtt/valid_partner_ids",n))},{"input-prefix":t(()=>[r(f,{"fixed-width":"",icon:["fas","user-gear"]})]),"element-prefix":t(()=>[r(f,{"fixed-width":"",icon:["fas","user-gear"]})]),help:t(()=>e[31]||(e[31]=[u(" Die Partner-ID erhältst Du von Deinem Installateur. Ist hier keine Partner-ID eingetragen, dann kann auch niemand - trotz aktiviertem Zugang für Partner - über das Partner-Portal auf diese openWB zugreifen! ")])),_:1},8,["model-value"])):i("",!0)]),_:2},[o.$store.state.mqtt["openWB/general/extern"]===!1&&o.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[m("div",A,[r(y,{class:V(["col-4",s.enableCloudConnectButton?"btn-success":"btn-outline-success"]),disabled:!s.enableCloudConnectButton,onButtonClicked:a.connectCloud},{default:t(()=>e[32]||(e[32]=[u(" Mit Cloud verbinden ")])),_:1},8,["class","disabled","onButtonClicked"])])]),key:"0"}:void 0]),1024)])),a.cloudBridgeKey?(l(),w("form",F,[!s.enableCloudConnectButton||!s.enableNewCloudButton?(l(),p(g,{key:0,subtype:"warning"},{default:t(()=>e[33]||(e[33]=[u(" Der Zugang wurde eingerichtet. Bitte starte die die openWB neu, um die Änderungen anzuwenden! ")])),_:1})):i("",!0),r(v,{title:"Vorhandener Cloud Zugang"},{footer:t(()=>[m("div",j,[r(y,{class:V(["col-4",s.enableRemoveCloudButton?"btn-danger":"btn-outline-danger"]),disabled:!s.enableRemoveCloudButton,onButtonClicked:e[13]||(e[13]=n=>a.removeCloudModal(n))},{default:t(()=>e[37]||(e[37]=[u(" Zugang löschen ")])),_:1},8,["class","disabled"])])]),default:t(()=>[r(_,null,{default:t(()=>e[34]||(e[34]=[m("span",null,[u(" Mit diesen Zugangsdaten kannst Du dich in der "),m("a",{href:"https://remote.openwb.de/",target:"_blank",rel:"noopener noreferrer"}," openWB Cloud "),u(" anmelden. ")],-1)])),_:1}),r(b,{modelValue:a.cloudSettings.username,"onUpdate:modelValue":e[9]||(e[9]=n=>a.cloudSettings.username=n),title:"Benutzername",required:"",subtype:"user",disabled:""},null,8,["modelValue"]),r(b,{modelValue:a.cloudSettings.password,"onUpdate:modelValue":e[10]||(e[10]=n=>a.cloudSettings.password=n),title:"Passwort",required:"",subtype:"password",disabled:""},null,8,["modelValue"]),e[38]||(e[38]=m("hr",null,null,-1)),r(C,{title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":a.cloudSettings.partner,"onUpdate:modelValue":e[11]||(e[11]=n=>o.updateState(a.cloudBridgeKey,n,"access.partner"))},{help:t(()=>e[35]||(e[35]=[u(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")])),_:1},8,["model-value"]),a.cloudSettings.partner?(l(),p(B,{key:0,title:"Gültige Partner-IDs","no-elements-message":"Keine Partner-ID zugeordnet.","model-value":o.$store.state.mqtt["openWB/system/mqtt/valid_partner_ids"],"onUpdate:modelValue":e[12]||(e[12]=n=>o.updateState("openWB/system/mqtt/valid_partner_ids",n))},{"input-prefix":t(()=>[r(f,{"fixed-width":"",icon:["fas","user-gear"]})]),"element-prefix":t(()=>[r(f,{"fixed-width":"",icon:["fas","user-gear"]})]),help:t(()=>e[36]||(e[36]=[u(" Die Partner-ID erhältst Du von Deinem Installateur. Ist hier keine Partner-ID eingetragen, dann kann auch niemand - trotz aktiviertem Zugang für Partner - über das Partner-Portal auf diese openWB zugreifen! ")])),_:1},8,["model-value"])):i("",!0)]),_:1})])):i("",!0),a.cloudBridgeKey?(l(),p(q,{key:4,"form-name":"cloudConfigured",onSave:e[14]||(e[14]=n=>o.$emit("save")),onReset:e[15]||(e[15]=n=>o.$emit("reset")),onDefaults:e[16]||(e[16]=n=>o.$emit("defaults"))})):i("",!0)]))])],64)}const Y=I(M,[["render",G],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/CloudConfig.vue"]]);export{Y as default};
