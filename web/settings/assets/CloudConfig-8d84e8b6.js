import{C as W}from"./index-e3aeceea.js";import{_ as S,p as m,k as l,l as c,z as a,A as o,L as t,q as g,y as p,a2 as y,G as D,u as s,n as k}from"./vendor-20bb207d.js";import"./vendor-fortawesome-63a0ad05.js";import"./vendor-bootstrap-d275de6c.js";import"./vendor-jquery-89b63fca.js";import"./vendor-axios-13ef03ae.js";import"./vendor-sortablejs-ad1d2cc8.js";const Z={name:"OpenwbCloudConfig",mixins:[W],emits:["sendCommand"],data(){return{mqttTopicsToSubscribe:["openWB/general/extern","openWB/system/dataprotection_acknowledged","openWB/system/mqtt/bridge/+"],enableNewCloudButton:!0,newCloudData:{email:"",username:"",partner:!1},enableCloudConnectButton:!0,connectCloudData:{username:"",password:"",partner:!1},enableRemoveCloudButton:!0,showCloudRemoveModal:!1}},computed:{cloudBridge:{get(){let u=this.getWildcardTopics("openWB/system/mqtt/bridge/+");for(const[e,B]of Object.entries(u))B.remote.is_openwb_cloud||delete u[e];return u}},cloudBridgeKey:{get(){for(const[u,e]of Object.entries(this.cloudBridge))if(e.remote.is_openwb_cloud)return u}},cloudSettings:{get(){return{username:this.cloudBridge[this.cloudBridgeKey].remote.username,password:this.cloudBridge[this.cloudBridgeKey].remote.password,partner:this.cloudBridge[this.cloudBridgeKey].access?this.cloudBridge[this.cloudBridgeKey].access.partner:!1}}}},methods:{getMqttBridgeIndex(u){return parseInt(u.match(/(?:\/)(\d+)$/)[1])},createCloud(){document.forms.cloudConfigCreateForm.reportValidity()&&(this.$emit("sendCommand",{command:"initCloud",data:this.newCloudData}),this.enableNewCloudButton=!1)},connectCloud(){document.forms.cloudConfigConnectForm.reportValidity()&&(this.$emit("sendCommand",{command:"connectCloud",data:this.connectCloudData}),this.enableCloudConnectButton=!1)},removeCloudModal(u){u.stopPropagation(),this.showCloudRemoveModal=!0},removeCloud(u){this.showCloudRemoveModal=!1,u=="confirm"&&(console.info("request removal of cloud"),this.$emit("sendCommand",{command:"removeMqttBridge",data:{bridge:this.getMqttBridgeIndex(this.cloudBridgeKey)}}),this.enableCloudConnectButton=!0)}}},q={class:"cloud-config"},z={key:1},M={key:1,name:"cloudConfigCreateForm"},N=g("a",{href:"mailto:support@openwb.de",subject:"Cloud Zugangsdaten"}," support@openwb.de ",-1),x={key:0},K={key:1},R={class:"row justify-content-center"},A={key:2,name:"cloudConfigConnectForm"},P={key:0},T={key:1},U={class:"row justify-content-center"},F={key:3,name:"cloudConfigured"},j=g("span",null,[s(" Mit diesen Zugangsdaten können Sie sich in der "),g("a",{href:"https://web.openwb.de/",target:"_blank",rel:"noopener noreferrer"},"openWB Cloud "),s(" anmelden. ")],-1),E=g("hr",null,null,-1),L={class:"row justify-content-center"};function I(u,e,B,O,d,r){const h=m("openwb-base-modal-dialog"),i=m("openwb-base-alert"),_=m("router-link"),b=m("openwb-base-text-input"),f=m("openwb-base-button-group-input"),C=m("openwb-base-click-button"),w=m("openwb-base-card"),v=m("openwb-base-heading"),V=m("openwb-base-submit-buttons");return l(),c(D,null,[a(" modal dialogs "),o(h,{show:d.showCloudRemoveModal,title:"Cloud Zugang löschen",subtype:"danger",buttons:[{text:"Löschen",event:"confirm",subtype:"danger"}],onModalResult:e[0]||(e[0]=n=>r.removeCloud(n))},{default:t(()=>[s(" Wollen Sie den vorhandenen Cloud Zugang wirklich entfernen? Dieser Vorgang kann nicht rückgängig gemacht werden! ")]),_:1},8,["show"]),a(" main content "),g("div",q,[o(i,{subtype:"danger"},{default:t(()=>[s(" Für diese Version gibt es noch keine Weboberfläche in der Cloud! Wenn der Zugang eingerichtet wurde, können z. B. Daten mit einem MQTT-Client von dem MQTT-Broker web.openwb.de abgerufen werden. Ebenfalls kann ein Support-Tunnel aufgebaut werden. Weitere Funktionen sind in der Entwicklung. ")]),_:1}),u.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]!==!0?(l(),p(i,{key:0,subtype:"danger"},{default:t(()=>[s(" Sie müssen der "),o(_,{to:"/System/LegalSettings"},{default:t(()=>[s(" Datenschutzerklärung ")]),_:1}),s(" zustimmen, um die openWB Cloud nutzen zu können. ")]),_:1})):(l(),c("div",z,[o(i,{subtype:"success"},{default:t(()=>[s(" Sie haben der "),o(_,{to:"/System/LegalSettings"},{default:t(()=>[s(" Datenschutzerklärung ")]),_:1}),s(" zugestimmt und können die openWB Cloud nutzen. ")]),_:1}),d.enableRemoveCloudButton?a("v-if",!0):(l(),p(i,{key:0,subtype:"warning"},{default:t(()=>[s(" Der Zugang wurde entfernt. Bitte starten Sie die openWB neu, um die Änderungen anzuwenden! ")]),_:1})),r.cloudBridgeKey?a("v-if",!0):(l(),c("form",M,[o(w,{title:"Neuen Zugang erstellen"},y({default:t(()=>[o(i,{subtype:"warning"},{default:t(()=>[s(" Derzeit können keine neuen Zugänge für die openWB Cloud angelegt werden. Bitte nutzen Sie die in/an der openWB notierten Zugangsdaten im unteren Bereich dieser Seite. Wenn bei einer gekauften openWB keine Zugangsdaten vorhanden sind, schreiben Sie bitte eine Mail unter Angabe der Bestell- und/oder Seriennummer an "),N,s(" . ")]),_:1}),u.$store.state.mqtt["openWB/general/extern"]===!0?(l(),c("div",x,[o(i,{subtype:"info"},{default:t(()=>[s(' Diese openWB befindet sich im Steuerungsmodus "secondary". Bitte richten Sie die openWB Cloud auf der regelnden openWB ein. ')]),_:1})])):(l(),c("div",K,[o(b,{title:"Benutzername",required:"",subtype:"user",pattern:"[a-zA-Z]+",modelValue:d.newCloudData.username,"onUpdate:modelValue":e[1]||(e[1]=n=>d.newCloudData.username=n),disabled:""},null,8,["modelValue"]),o(b,{title:"E-Mail",required:"",subtype:"email",modelValue:d.newCloudData.email,"onUpdate:modelValue":e[2]||(e[2]=n=>d.newCloudData.email=n),disabled:""},null,8,["modelValue"]),o(f,{disabled:"",title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],modelValue:d.newCloudData.partner,"onUpdate:modelValue":e[3]||(e[3]=n=>d.newCloudData.partner=n)},{help:t(()=>[s(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")]),_:1},8,["modelValue"])]))]),_:2},[u.$store.state.mqtt["openWB/general/extern"]===!1&&u.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[g("div",R,[a(` <openwb-base-click-button
								class="col-4"
								:class="
									enableNewCloudButton
										? 'btn-success'
										: 'btn-outline-success'
								"
								:disabled="!enableNewCloudButton"
								@buttonClicked="createCloud"
							>
								Zugang erstellen
							</openwb-base-click-button> `),o(C,{class:"col-4 btn-outline-success",disabled:""},{default:t(()=>[s(" Zugang erstellen ")]),_:1})])]),key:"0"}:void 0]),1024),d.enableNewCloudButton?a("v-if",!0):(l(),p(i,{key:0,subtype:"info",class:"mb-2"},{default:t(()=>[s(" Der neue Zugang wird eingerichtet. Dieser Vorgang kann bis zu einer Minute dauern. Bitte warten. ")]),_:1}))])),r.cloudBridgeKey?a("v-if",!0):(l(),c("form",A,[o(w,{title:"Vorhandenen Zugang einrichten"},y({default:t(()=>[u.$store.state.mqtt["openWB/general/extern"]===!0?(l(),c("div",P,[o(i,{subtype:"info"},{default:t(()=>[s(' Diese openWB befindet sich im Steuerungsmodus "secondary". Bitte richten Sie die openWB Cloud auf der regelnden openWB ein. ')]),_:1})])):(l(),c("div",T,[o(b,{title:"Benutzername",required:"",subtype:"user",modelValue:d.connectCloudData.username,"onUpdate:modelValue":e[4]||(e[4]=n=>d.connectCloudData.username=n)},null,8,["modelValue"]),o(b,{title:"Passwort",required:"",subtype:"password",modelValue:d.connectCloudData.password,"onUpdate:modelValue":e[5]||(e[5]=n=>d.connectCloudData.password=n)},null,8,["modelValue"]),o(f,{title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],modelValue:d.connectCloudData.partner,"onUpdate:modelValue":e[6]||(e[6]=n=>d.connectCloudData.partner=n)},{help:t(()=>[s(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")]),_:1},8,["modelValue"])]))]),_:2},[u.$store.state.mqtt["openWB/general/extern"]===!1&&u.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[g("div",U,[o(C,{class:k(["col-4",d.enableCloudConnectButton?"btn-success":"btn-outline-success"]),disabled:!d.enableCloudConnectButton,onButtonClicked:r.connectCloud},{default:t(()=>[s(" Mit Cloud verbinden ")]),_:1},8,["class","disabled","onButtonClicked"])])]),key:"0"}:void 0]),1024)])),r.cloudBridgeKey?(l(),c("form",F,[!d.enableCloudConnectButton||!d.enableNewCloudButton?(l(),p(i,{key:0,subtype:"warning"},{default:t(()=>[s(" Der Zugang wurde eingerichtet. Bitte starten Sie die openWB neu, um die Änderungen anzuwenden! ")]),_:1})):a("v-if",!0),o(w,{title:"Vorhandener Cloud Zugang"},{footer:t(()=>[g("div",L,[o(C,{class:k(["col-4",d.enableRemoveCloudButton?"btn-danger":"btn-outline-danger"]),disabled:!d.enableRemoveCloudButton,onButtonClicked:e[10]||(e[10]=n=>r.removeCloudModal(n))},{default:t(()=>[s(" Zugang löschen ")]),_:1},8,["class","disabled"])])]),default:t(()=>[o(v,null,{default:t(()=>[j]),_:1}),o(b,{title:"Benutzername",required:"",subtype:"user",modelValue:r.cloudSettings.username,"onUpdate:modelValue":e[7]||(e[7]=n=>r.cloudSettings.username=n),disabled:""},null,8,["modelValue"]),o(b,{title:"Passwort",required:"",subtype:"password",modelValue:r.cloudSettings.password,"onUpdate:modelValue":e[8]||(e[8]=n=>r.cloudSettings.password=n),disabled:""},null,8,["modelValue"]),E,o(f,{title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":r.cloudSettings.partner,"onUpdate:modelValue":e[9]||(e[9]=n=>u.updateState(r.cloudBridgeKey,n,"access.partner"))},{help:t(()=>[s(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")]),_:1},8,["model-value"])]),_:1})])):a("v-if",!0),r.cloudBridgeKey?(l(),p(V,{key:4,formName:"cloudConfigured",onSave:e[11]||(e[11]=n=>u.$emit("save")),onReset:e[12]||(e[12]=n=>u.$emit("reset")),onDefaults:e[13]||(e[13]=n=>u.$emit("defaults"))})):a("v-if",!0)]))])],64)}const ee=S(Z,[["render",I],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/CloudConfig.vue"]]);export{ee as default};
