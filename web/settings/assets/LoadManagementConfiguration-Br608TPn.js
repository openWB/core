import{F as x,l as L,a1 as V,a0 as q}from"./vendor-fortawesome-DunXjMUr.js";import{C as Z}from"./index-UZ-qidAy.js";import{S as $}from"./OpenwbSortableList-u2_DOtAF.js";import{_ as A,m as l,l as u,f as m,y as d,q as s,u as i,D as o,z as f,x as M,L as W,M as _,K as v}from"./vendor-Cm2BcoGA.js";import"./vendor-bootstrap-CFWPZPj5.js";import"./vendor-jquery-CEMonh9Y.js";import"./vendor-axios-DnM0A367.js";import"./vendor-sortablejs-BIKIFH7x.js";L.add(V,q);const E={name:"OpenwbLoadManagementConfigView",components:{SortableList:$,FontAwesomeIcon:x},mixins:[Z],props:{installAssistantActive:{type:Boolean,required:!1,default:!1}},emits:["sendCommand","save","reset","defaults"],data(){return{mqttTopicsToSubscribe:["openWB/general/extern","openWB/counter/config/home_consumption_source_id","openWB/counter/config/consider_less_charging","openWB/counter/get/hierarchy","openWB/system/device/+/component/+/config","openWB/counter/+/config/max_power_errorcase","openWB/counter/+/config/max_currents","openWB/counter/+/config/max_total_power","openWB/pv/+/config/max_ac_out","openWB/chargepoint/+/config"],mqttTopicsToPublish:["openWB/counter/config/consider_less_charging","openWB/counter/config/home_consumption_source_id","openWB/counter/+/config/max_power_errorcase","openWB/counter/+/config/max_currents","openWB/counter/+/config/max_total_power","openWB/pv/+/config/max_ac_out","openWB/counter/get/hierarchy"]}},computed:{componentConfigurations(){return this.getWildcardTopics("openWB/system/device/+/component/+/config")},counterConfigs:{get(){let n=this.getWildcardTopics("openWB/system/device/+/component/+/config");return Object.keys(n).filter(e=>n[e]?.type.includes("counter")).reduce((e,r)=>({...e,[r]:n[r]}),{})}},counterOptions(){var n=[];for(const e of Object.values(this.componentConfigurations))this.isComponentType(e?.type,"counter")&&n.push({value:e.id,text:e.name});return n.sort((e,r)=>e.text==r.text?0:e.text>r.text?1:-1)},inverterConfigs:{get(){let n=this.getWildcardTopics("openWB/system/device/+/component/+/config");return Object.keys(n).filter(e=>n[e]?.type.includes("inverter")).reduce((e,r)=>({...e,[r]:n[r]}),{})}},hierarchyLabels:{get(){let n={};for(const e of Object.values(this.$store.state.mqtt["openWB/counter/get/hierarchy"]))n={...n,...this.getElementTreeNames(e)};return n}},getHcSourceIdOptions(){let n=[{value:null,text:"von openWB berechnen (in 99% der Fälle die richtige Einstellung)"}],e=[{label:"Eingerichtete Zähler-Komponenten",options:[...this.counterOptions]}];return{options:n,groups:e}}},methods:{getElementTreeNames(n){let e={};if(n.type=="cp"){let r=this.getChargePoint(n.id);r&&(e[n.id]=r.name)}else{let r=this.getComponent(n.id);r&&(e[n.id]=r.name)}return n.children.forEach(r=>{e={...e,...this.getElementTreeNames(r)}}),e},getComponent(n){let e;return Object.keys(this.$store.state.mqtt).forEach(r=>{r.match("^openWB/system/device/[0-9]+/component/"+n+"/config$")&&(e=this.$store.state.mqtt[r])}),e},getChargePoint(n){let e;return Object.keys(this.$store.state.mqtt).forEach(r=>{r.match("^openWB/chargepoint/"+n+"/config$")&&(e=this.$store.state.mqtt[r])}),e},isComponentType(n,e){return n?.split("_").includes(e)}}},U={class:"loadManagementConfig"},D={name:"loadManagementConfigForm"},F={key:0},T={key:1},P={key:0},O={key:1};function H(n,e,r,N,k,g){const c=l("openwb-base-alert"),B=l("router-link"),S=l("openwb-base-button-group-input"),y=l("openwb-base-select-input"),b=l("openwb-base-heading"),w=l("font-awesome-icon"),p=l("openwb-base-number-input"),h=l("openwb-base-card"),z=l("sortable-list"),C=l("openwb-base-submit-buttons");return u(),m("div",U,[d("form",D,[s(h,{title:"Einstellungen",collapsible:!0,collapsed:!1},{default:i(()=>[n.$store.state.mqtt["openWB/general/extern"]===!0?(u(),m("div",F,[s(c,{subtype:"info"},{default:i(()=>[...e[6]||(e[6]=[o(' Diese Einstellungen sind nicht verfügbar, solange sich diese openWB im Steuerungsmodus "secondary" befindet. ',-1)])]),_:1})])):(u(),m("div",T,[r.installAssistantActive?M("",!0):(u(),f(c,{key:0,subtype:"info"},{default:i(()=>[e[8]||(e[8]=o(" Die Konfiguration für die externe Steuerung durch den Netzbetreiber (RSE, EMS, §14a) erfolgt in den ",-1)),s(B,{to:"/IoConfiguration"},{default:i(()=>[...e[7]||(e[7]=[o("Einstellungen der Ein-/Ausgänge",-1)])]),_:1}),e[9]||(e[9]=o(" im Bereich der Aktionen. ",-1))]),_:1})),s(S,{title:"Fahrzeuge, die nicht mit Sollstrom laden",buttons:[{buttonValue:!1,text:"nicht berücksichtigen",class:"btn-outline-danger"},{buttonValue:!0,text:"berücksichtigen",class:"btn-outline-success"}],"model-value":n.$store.state.mqtt["openWB/counter/config/consider_less_charging"],"onUpdate:modelValue":e[0]||(e[0]=t=>n.updateState("openWB/counter/config/consider_less_charging",t))},{help:i(()=>[...e[10]||(e[10]=[d("p",null," Wenn angesteckte Fahrzeuge, die nicht oder nicht mit der Sollstromstärke laden, im Lastmanagement berücksichtigt werden, wird für diese der Sollstrom reserviert. Dadurch können bei Eingreifen des Lastmanagements andere Fahrzeuge möglicherweise nur mit reduzierter Stromstärke laden und der reservierte Strom wird nicht genutzt. Wenn die Fahrzeuge wieder Leistung beziehen, z.B. um vorzuklimatisieren, nutzen sie den für sie reservierten Strom. ",-1),d("p",null," Wenn angesteckte Fahrzeuge, die nicht oder nicht mit der Sollstromstärke laden, nicht im Lastmanagement berücksichtigt werden, wird für diese auch kein Strom bei vorliegender Ladefreigabe reserviert bzw. es wird nur der tatsächlich genutzte Strom im Lastmanagement berücksichtigt. Andere Fahrzeuge können dadurch mit höherer Stromstärke laden. Wenn die maximalen Lastmanagement-Grenzen fast erreicht sind und die Fahrzeuge wieder Leistung beziehen, z.B. um vorzuklimatisieren, kann es zu einer kurzzeitigen Überschreitung der Lastmanagement-Grenzen kommen, bis im nächsten Zyklus die Stromstärken aller Ladepunkte an die neue Situation angepasst wurden. Das kurzzeitige Überschreiten der Maximal-Werte stellt für die Sicherungen in der Regel kein Problem dar. ",-1)])]),_:1},8,["model-value"]),s(y,{title:"Hausverbrauch",options:g.getHcSourceIdOptions.options,groups:g.getHcSourceIdOptions.groups,"model-value":n.$store.state.mqtt["openWB/counter/config/home_consumption_source_id"],"onUpdate:modelValue":e[1]||(e[1]=t=>n.updateState("openWB/counter/config/home_consumption_source_id",t))},{help:i(()=>[...e[11]||(e[11]=[o(" Meist ist der Zähler am EVU-Punkt installiert, dann muss hier 'von openWB berechnen' ausgewählt werden. Wenn der Zähler im Hausverbrauchszweig installiert ist, die Struktur wie im ",-1),d("a",{href:"https://github.com/openWB/core/wiki/Hausverbrauchs-Zähler",target:"_blank",rel:"noopener noreferrer"}," Wiki ",-1),o(" beschrieben anordnen und hier den Hausverbrauchszähler auswählen. Dann wird dieser Wert abzüglich der Ladeleistung als Hausverbrauch erfasst. ",-1)])]),_:1},8,["options","groups","model-value"]),s(b,null,{default:i(()=>[...e[12]||(e[12]=[o(" Vorhandene Zählermodule ",-1)])]),_:1}),s(c,{subtype:"info"},{default:i(()=>[...e[13]||(e[13]=[o(" Die maximale Leistung wird nur für den EVU-Zähler berücksichtigt. Bei Zwischenzählern begrenzt das Lastmanagement rein anhand der maximalen Phasenströme.",-1),d("br",null,null,-1),o(" Wenn ein Zähler nicht auslesbar ist, wird weiterhin versucht, diesen auszulesen und nach 60s die angenommene Leistung im Fehlerfall verwendet, die unten für jeden Zähler eingestellt wird, um eine Überlast zu vermeiden. Die angenommene Leistung wird gleichmäßig auf die Phasen verteilt.",-1),d("br",null,null,-1),o(" Überlicherweise sind Hausanschlüsse mit 24kW und 3*35A bzw. 43kW und 3*63A abgesichert. ",-1)])]),_:1}),(u(!0),m(W,null,_(g.counterConfigs,t=>(u(),f(h,{key:t.id,collapsible:!0,collapsed:!0,subtype:"danger"},{header:i(()=>[s(w,{icon:["fas","gauge-high"]}),o(" "+v(t.name),1)]),default:i(()=>[s(p,{title:"Maximale Leistung",min:1,step:.1,required:"",unit:"kW","model-value":n.$store.state.mqtt["openWB/counter/"+t.id+"/config/max_total_power"]/1e3,"onUpdate:modelValue":a=>n.updateState("openWB/counter/"+t.id+"/config/max_total_power",a*1e3)},{help:i(()=>[...e[14]||(e[14]=[o(" Maximal zulässige Leistung für diesen (Zwischen-)Zähler. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),s(p,{title:"Maximaler Strom L1",min:6,step:1,unit:"A",required:"","model-value":n.$store.state.mqtt["openWB/counter/"+t.id+"/config/max_currents"][0],"onUpdate:modelValue":a=>n.updateState("openWB/counter/"+t.id+"/config/max_currents",a,"0")},{help:i(()=>[...e[15]||(e[15]=[o(" Maximal zulässiger Strom für die Phase 1 dieses (Zwischen-)Zählers. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),s(p,{title:"Maximaler Strom L2",min:6,step:1,unit:"A",required:"","model-value":n.$store.state.mqtt["openWB/counter/"+t.id+"/config/max_currents"][1],"onUpdate:modelValue":a=>n.updateState("openWB/counter/"+t.id+"/config/max_currents",a,"1")},{help:i(()=>[...e[16]||(e[16]=[o(" Maximal zulässiger Strom für die Phase 2 dieses (Zwischen-)Zählers. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),s(p,{title:"Maximaler Strom L3",min:6,step:1,unit:"A",required:"","model-value":n.$store.state.mqtt["openWB/counter/"+t.id+"/config/max_currents"][2],"onUpdate:modelValue":a=>n.updateState("openWB/counter/"+t.id+"/config/max_currents",a,"2")},{help:i(()=>[...e[17]||(e[17]=[o(" Maximal zulässiger Strom für die Phase 3 dieses (Zwischen-)Zählers. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),s(p,{title:"Maximale Leistung im Fehlerfall",min:0,step:.1,unit:"kW","model-value":n.$store.state.mqtt["openWB/counter/"+t.id+"/config/max_power_errorcase"]/1e3,"onUpdate:modelValue":a=>n.updateState("openWB/counter/"+t.id+"/config/max_power_errorcase",a*1e3)},{help:i(()=>[...e[18]||(e[18]=[o(" Angenommen Leistung für diesen (Zwischen-)Zähler, falls vom Zähler keine Werte abgefragt werden können. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:2},1024))),128)),s(b,null,{default:i(()=>[...e[19]||(e[19]=[o(" Vorhandene Wechselrichtermodule ",-1)])]),_:1}),(u(!0),m(W,null,_(g.inverterConfigs,t=>(u(),f(h,{key:t.id,collapsible:!0,collapsed:!0,subtype:"success"},{header:i(()=>[s(w,{icon:["fas","solar-panel"]}),o(" "+v(t.name),1)]),default:i(()=>[s(p,{title:"Maximale Ausgangsleistung des Wechselrichters",min:0,step:.1,unit:"kW",required:"","model-value":n.$store.state.mqtt["openWB/pv/"+t.id+"/config/max_ac_out"]/1e3,"onUpdate:modelValue":a=>n.updateState("openWB/pv/"+t.id+"/config/max_ac_out",a*1e3)},{help:i(()=>[...e[20]||(e[20]=[o(" Bei 0 kW erfolgt keine Berücksichtigung der maximalen Ausgangsleistung. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"])]),_:2},1024))),128))]))]),_:1}),s(h,{title:"Struktur",collapsible:!0,collapsed:!0},{default:i(()=>[n.$store.state.mqtt["openWB/general/extern"]===!0?(u(),m("div",P,[s(c,{subtype:"info"},{default:i(()=>[...e[21]||(e[21]=[o(' Diese Einstellungen sind nicht verfügbar, solange sich diese openWB im Steuerungsmodus "secondary" befindet. ',-1)])]),_:1})])):(u(),m("div",O,[s(z,{title:"Anordnung der Komponenten","model-value":n.$store.state.mqtt["openWB/counter/get/hierarchy"],labels:g.hierarchyLabels,"onUpdate:modelValue":e[2]||(e[2]=t=>n.updateState("openWB/counter/get/hierarchy",t))},{help:i(()=>[...e[22]||(e[22]=[o(" Durch die Anordnung der Komponenten werden Abhängigkeiten abgebildet.",-1),d("br",null,null,-1),o(" An erster Stelle muss eine Zählerkomponente stehen, die den Netzanschlusspunkt erfasst. Dafür kann auch ein virtueller Zähler genutzt werden.",-1),d("br",null,null,-1),o(" Die weiteren Komponenten müssen hierarchisch so angeordnet werden, wie sie auch physisch im Stromnetz angeschlossen werden.",-1),d("br",null,null,-1),o(" Bei DC-gekoppelten Speichern sind diese hinter dem zugehörigen Wechselrichter zu platzieren, damit die Abhängigkeit in der Regelung berücksichtigt werden kann. ",-1)])]),_:1},8,["model-value","labels"])]))]),_:1}),s(C,{"form-name":"loadManagementConfigForm",onSave:e[3]||(e[3]=t=>n.$emit("save",k.mqttTopicsToPublish)),onReset:e[4]||(e[4]=t=>n.$emit("reset")),onDefaults:e[5]||(e[5]=t=>n.$emit("defaults"))})])])}const Y=A(E,[["render",H],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/LoadManagementConfiguration.vue"]]);export{Y as default};
