import{F as q,l as L,A as x,ad as T,B as E,am as Z,d as M,ah as O}from"./vendor-fortawesome-Bn25cRey.js";import{C as I}from"./index-izo6aVi2.js";import{_ as H,l as b,k as u,e as p,m as l,q as r,A as i,y as m,x as d,J as z,u as w,K as S,L as W,z as R,j as F}from"./vendor-CPWhyePA.js";import"./vendor-bootstrap-DoSh2SwU.js";import"./vendor-jquery-CEMonh9Y.js";import"./vendor-axios-BuID6n48.js";L.add(x,T,E,Z,M,O);const P={name:"OpenwbSecurityView",components:{FontAwesomeIcon:q},mixins:[I],props:{installAssistantActive:{type:Boolean,required:!1,default:!1}},emits:["save","reset","defaults","sendCommand"],data(){return{mqttTopicsToSubscribe:["openWB/general/allow_unencrypted_access","openWB/general/extern","openWB/general/web_theme","openWB/optional/int_display/theme","openWB/system/security/user_management_active","openWB/system/dataprotection_acknowledged","openWB/system/device/+/component/+/config","openWB/chargepoint/+/config","openWB/system/io/+/config","openWB/io/action/+/config","openWB/vehicle/+/name","$CONTROL/dynamic-security/v1/response"],mqttTopicsToPublish:["openWB/general/allow_unencrypted_access","openWB/system/security/user_management_active"],activeControlCommand:null,controlCommandsQueue:[],clients:[],clientDetails:{},groups:[],groupDetails:{},rawRoles:[],roleDetails:{},rolesVersion:null,newClientName:null,newGroupName:null,anonymousGroupName:null,userGroupName:"user",displayGroupName:"display",defaultAclAccess:[],showResetModal:!1}},computed:{dynSecResponse(){return this.$store.state.mqtt["$CONTROL/dynamic-security/v1/response"]},loggedInUser(){return this.$store.state.local.username||null},readableAcls(){return n=>!n||!Array.isArray(n)?"":n.sort((e,g)=>e.topic<g.topic?-1:e.topic>g.topic?1:0).map(e=>{const h={publishClientSend:"Veröffentlichen",publishClientReceive:"Empfangen",subscribe:"Abonnieren",unsubscribe:"Abonnement aufheben",subscribeLiteral:"Abonnieren (exakt)",unsubscribeLiteral:"Abonnement aufheben (exakt)",subscribePattern:"Abonnieren (Muster)",unsubscribePattern:"Abonnement aufheben (Muster)"}[e.acltype]||e.acltype,s=e.allow===!0?"erlaubt":e.allow===!1?"verboten":"unbekannt";return`${e.topic?'"'+e.topic+'"':"<alle Topics>"} -> ${h} ${s}`}).join(`
`)},componentName(){return n=>{const e=`openWB/system/device/+/component/${n}/config`;return Object.values(this.getWildcardTopics(e))[0]?.name||void 0}},chargePointName(){return n=>{const e=`openWB/chargepoint/${n}/config`;return this.$store.state.mqtt[e]?.name||void 0}},vehicleName(){return n=>{const e=`openWB/vehicle/${n}/name`;return this.$store.state.mqtt[e]||void 0}},ioDeviceName(){return n=>{const e=`openWB/system/io/${n}/config`;return this.$store.state.mqtt[e]?.name||void 0}},ioActionName(){return n=>{const e=`openWB/io/action/${n}/config`;return this.$store.state.mqtt[e]?.name||void 0}},routes(){const n=this.$router.getRoutes();return console.debug("All route names:",n.map(e=>e.name).sort()),n},routeName(){return n=>{const e=n.split("-").map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(""),g=this.routes.find(h=>h.name===e);if(g===void 0){console.warn("No route found for view:",n,"(searched for route name:",e+")");return}return g.meta.heading}},friendlyRoleName(){return n=>{const e=a=>{switch(a[0]){case"counter":return"Zähler";case"inverter":return"Wechselrichter";case"bat":return"Speicher";case"chargepoint":return"Ladepunkt";case"vehicle":return"Fahrzeug";case"io":switch(a[1]){case"device":return"Ein-/Ausgangs Gerät";case"action":return"Ein-/Ausgangs Aktion"}break;default:return a[0]}},g=a=>{let f=a[1],c=e(a),y="";switch(a[0]){case"counter":case"inverter":case"bat":y=this.componentName(f)||f;break;case"chargepoint":y=this.chargePointName(f)||f;break;case"vehicle":y=this.vehicleName(f)||f;break;case"io":switch(f=a[2],a[1]){case"device":y=this.ioDeviceName(f)||f;break;case"action":y=this.ioActionName(f)||f;break;default:y=f}break}return`Daten: ${c} '${y}' (${f}) ${s[s.length-2]=="write"?"schreiben":"lesen"}`};let h=null;switch(n){case"charge-log-access":case"install-assistant-access":case"data-management-access":case"legal-settings-access":h=n.replace("-access","");break;case"settings-access":return"Einstellungen: Zugang ermöglichen";case"legacy-smart-home-configuration-access":return"Einstellungen: Konfiguration - SmartHome";case"full-access":return"Voller Zugang lesen und schreiben";case"dynsec-admin":return"Sicherheits-Administrator";case"basic-display-data":return"Basisdaten: Display";case"basic-system-data":return"Basisdaten: System";case"basic-theme-data":return"Basisdaten: Hauptseite/Theme";case"basic-user-data":return"Basisdaten: Benutzer";case"other-data":return"Daten: Externe Anwendungen lesen und schreiben";case"electricity-price-access":return"Daten: Strompreise lesen";case"graph-access":return"Daten: Verlaufsdiagramm lesen";case"home-consumption-access":return"Daten: Hausverbrauch lesen"}const s=n.split("-");if((n.endsWith("-configuration-access")||n.endsWith("-installation-access")||n.endsWith("-access")&&s.length==2)&&(h=n.replace("-access","")),h!==null){const a=this.routeName(h);if(a!==void 0)return`Einstellungen: ${a}`}if(s[1]=="sum")switch(s[0]){case"inverter":return"Daten: Wechselrichter Summendaten lesen";case"bat":return"Daten: Speicher Summendaten lesen";case"chargepoint":return"Daten: Ladepunkt Summendaten lesen"}if(!isNaN(s[1])&&["counter","inverter","bat","chargepoint","vehicle"].includes(s[0]))return g(s);switch(s[0]){case"vehicle":if(s[1]==="configuration")return"Einstellungen: Fahrzeuge";break;case"io":return s[1]==="configuration"?"Einstellungen: Ein-/Ausgänge":g(s)}return`*${n}*`}},rolesList(){return this.roles.map(n=>({name:n,friendlyName:this.friendlyRoleName(n)})).sort((n,e)=>n.friendlyName<e.friendlyName?-1:n.friendlyName>e.friendlyName?1:0)},webThemeSupported(){return this.$store.state.mqtt["openWB/general/web_theme"]?.userManagementSupported===!0},displayThemeSupported(){return this.$store.state.mqtt["openWB/optional/int_display/theme"]?.userManagementSupported===!0}},watch:{dynSecResponse(n){n&&n.responses&&n.responses.forEach(e=>{switch(e.command){case"listClients":this.clients=JSON.parse(JSON.stringify(e.data.clients));break;case"getClient":this.clientDetails[e.data.client.username]=JSON.parse(JSON.stringify(e.data.client));break;case"createClient":case"disableClient":case"enableClient":this.getClientList();break;case"modifyClient":case"deleteClient":this.getClientList(),this.getGroupsDetails();break;case"listGroups":this.groups=JSON.parse(JSON.stringify(e.data.groups));break;case"getAnonymousGroup":this.anonymousGroupName=e.data.group.groupname;break;case"getGroup":this.groupDetails[e.data.group.groupname]=JSON.parse(JSON.stringify(e.data.group));break;case"createGroup":this.getGroupList();break;case"modifyGroup":case"deleteGroup":this.getGroupList(),this.getClientsDetails();break;case"listRoles":this.roles=JSON.parse(JSON.stringify(e.data.roles)).filter(g=>g.startsWith("openwb-version:")?(this.rolesVersion=g.split(":")[1],!1):!0);break;case"getRole":this.roleDetails[e.data.role.rolename]=JSON.parse(JSON.stringify(e.data.role));break;case"getDefaultACLAccess":this.defaultAclAccess=JSON.parse(JSON.stringify(e.data.acls));break;default:console.warn("Unhandled dynamic security response:",e);break}}),this.activeControlCommand=null,this.processControlCommandQueue()},loggedInUser(n,e){n!==e&&this.$router.go()}},mounted(){this.init()},methods:{init(){this.clients=[],this.clientDetails={},this.groups=[],this.groupDetails={},this.roles=[],this.roleDetails={},this.$store.state.mqtt["openWB/system/security/user_management_active"]===!0&&(console.debug("Initializing Security view for user:",this.loggedInUser),this.getAnonymousGroupName(),this.getDefaultAclAccess(),this.getClientList(),this.getGroupList(),this.getRoleList())},handleResetModal(n){this.showResetModal=!1,n==="confirm"&&(console.info("Resetting user management!"),this.$emit("sendCommand",{command:"resetUserManagement"}))},saveSecuritySettings(){this.$store.state.mqtt["openWB/system/security/user_management_active"]===!1&&(console.info("User management deactivated, removing mqtt cookie."),this.$cookies.remove("mqtt")),this.$emit("save",this.mqttTopicsToPublish)},sendControlCommand(n,e={}){if(this.activeControlCommand!==null){console.warn("Control command already running, please wait.");return}this.activeControlCommand=n;const g={commands:[{command:n,...e}]};console.debug("$CONTROL command:",g),this.$root.doPublish("$CONTROL/dynamic-security/v1",g)},queueControlCommand(n,e={}){this.controlCommandsQueue.push({command:n,payload:e}),this.processControlCommandQueue()},processControlCommandQueue(){if(this.activeControlCommand!==null||this.controlCommandsQueue.length===0)return;const{command:n,payload:e}=this.controlCommandsQueue.shift();this.sendControlCommand(n,e)},getClientList(){this.queueControlCommand("listClients")},getClientsDetails(){this.clients.forEach(n=>{this.queueControlCommand("getClient",{username:n})})},getClient(n){this.queueControlCommand("getClient",{username:n})},createClient(){console.debug("Creating new client:",this.newClientName),this.queueControlCommand("createClient",{username:this.newClientName}),this.newClientName=null},deleteClient(n){if(n===this.loggedInUser){console.error("Cannot delete currently logged in user:",n),this.$root.postClientMessage("Der aktuell angemeldete Benutzer kann nicht gelöscht werden.","danger");return}console.debug("Deleting client:",n),this.queueControlCommand("deleteClient",{username:n})},toggleClientDisabled(n){const e=this.clientDetails[n]?.disabled||!1;if(n===this.loggedInUser&&e===!1){console.error("Cannot disable currently logged in user:",n),this.$root.postClientMessage("Der aktuell angemeldete Benutzer kann nicht deaktiviert werden.","danger");return}this.queueControlCommand(e?"enableClient":"disableClient",{username:n}),this.queueControlCommand("getClient",{username:n})},modifyClient(n){console.debug("Modifying client:",n),[null,void 0,""].includes(this.clientDetails[n].password)?delete this.clientDetails[n].password:this.clientDetails[n].username==="admin"&&(console.debug("Updating password for client:",n),this.$emit("sendCommand",{command:"updateAdminPassword",data:{newPassword:this.clientDetails[n].password}})),this.queueControlCommand("modifyClient",{username:n,...this.clientDetails[n]})},getGroupList(){this.queueControlCommand("listGroups")},getAnonymousGroupName(){this.queueControlCommand("getAnonymousGroup")},getGroupsDetails(){this.groups.forEach(n=>{this.queueControlCommand("getGroup",{groupname:n})})},getGroup(n){this.queueControlCommand("getGroup",{groupname:n})},createGroup(){console.debug("Creating new group:",this.newGroupName),this.queueControlCommand("createGroup",{groupname:this.newGroupName}),this.newGroupName=null},deleteGroup(n){console.debug("Deleting group:",n),this.queueControlCommand("deleteGroup",{groupname:n})},modifyGroup(n){console.debug("Modifying group:",n),this.queueControlCommand("modifyGroup",{groupname:n,...this.groupDetails[n]})},getRoleList(){this.queueControlCommand("listRoles")},getRole(n){this.queueControlCommand("getRole",{rolename:n})},getDefaultAclAccess(){this.queueControlCommand("getDefaultACLAccess")}}},J={class:"security"},Q={key:1},j={name:"accessForm"},K={key:0},X={key:1},Y=["title","onClick"],$={key:0},ee=["name"],ne={key:1},te={key:1},se={key:0},re=["name"],ie={key:1},le={key:1},oe={key:0},ae=["name"],ue={key:1},de={key:1};function me(n,e,g,h,s,a){const f=b("openwb-base-modal-dialog"),c=b("openwb-base-alert"),y=b("openwb-base-button-group-input"),N=b("router-link"),U=b("openwb-base-button-input"),V=b("openwb-base-submit-buttons"),B=b("openwb-base-card"),D=b("FontAwesomeIcon"),v=b("openwb-base-text-input"),k=b("font-awesome-icon"),_=b("openwb-base-avatar"),G=b("openwb-base-array-input"),A=b("openwb-base-textarea");return u(),p("div",J,[l(f,{show:s.showResetModal,title:"Benutzerverwaltung zurücksetzten",subtype:"danger",buttons:[{text:"Alles zurücksetzen!",event:"confirm",subtype:"danger"}],onModalResult:e[0]||(e[0]=t=>a.handleResetModal(t))},{default:r(()=>[...e[11]||(e[11]=[i(" Bist Du sicher, dass Du die openWB Benutzerverwaltung zurücksetzen möchtest? Hiermit werden alle Benutzer, Gruppen und Rollen gelöscht und auf die Werkseinstellungen zurückgesetzt. Diese Aktion ist irreversibel! ",-1)])]),_:1},8,["show"]),n.$store.state.mqtt["openWB/general/extern"]!==!1?(u(),m(c,{key:0,subtype:"info"},{default:r(()=>[...e[12]||(e[12]=[i(" Die Einstellungen zur Sicherheit und Benutzerverwaltung werden aktuell nur für primary openWB unterstützt! ",-1)])]),_:1})):(u(),p("div",Q,[d("form",j,[l(B,{title:"Allgemein"},{footer:r(()=>[l(V,{"form-name":"accessForm",onSave:a.saveSecuritySettings,onReset:e[4]||(e[4]=t=>n.$emit("reset")),onDefaults:e[5]||(e[5]=t=>n.$emit("defaults"))},null,8,["onSave"])]),default:r(()=>[l(y,{title:"Unverschlüsselten Zugang erlauben","model-value":n.$store.state.mqtt["openWB/general/allow_unencrypted_access"],disabled:n.$store.state.mqtt["openWB/system/security/user_management_active"]===!0,buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"onUpdate:modelValue":e[1]||(e[1]=t=>n.updateState("openWB/general/allow_unencrypted_access",t))},{help:r(()=>[...e[13]||(e[13]=[d("p",null," Hier kann eingestellt werden, ob unverschlüsselter Zugang zu openWB erlaubt ist. Dies betrifft sowohl den Zugriff über MQTT (Ports 1883 und 9001) als auch über HTTP (Port 80) (Weboberfläche). ",-1),d("p",null,[d("strong",null,"Hinweis:"),i(" Aus Sicherheitsgründen sollte der unverschlüsselte Zugang nur in geschützten Netzwerken aktiviert werden. Für die integrierten Benutzerverwaltung muss der unverschlüsselte Zugang zuerst deaktiviert werden. ")],-1)])]),_:1},8,["model-value","disabled"]),l(y,{title:"Benutzerverwaltung","model-value":n.$store.state.mqtt["openWB/system/security/user_management_active"],disabled:n.$store.state.mqtt["openWB/general/allow_unencrypted_access"]===!0||!a.webThemeSupported||!a.displayThemeSupported,buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"onUpdate:modelValue":e[2]||(e[2]=t=>n.updateState("openWB/system/security/user_management_active",t))},{help:r(()=>[...e[14]||(e[14]=[d("p",null," Hier kann die integrierte Benutzerverwaltung von openWB aktiviert oder deaktiviert werden. Mit aktivierter Benutzerverwaltung ist der Zugriff auf den Mosquitto Broker (MQTT) und davon abhängige Dienste (Weboberfläche, API) nur mit einem gültigen Benutzerkonto (oder anonym ohne Anmeldung, falls erlaubt) möglich. ",-1),d("p",null,[d("strong",null,"Hinweis:"),i(" Die Benutzerverwaltung erfordert zwingend die Abschaltung des unverschlüsselten Zugangs. ")],-1)])]),_:1},8,["model-value","disabled"]),l(c,{subtype:"warning",class:"mt-2"},{default:r(()=>[e[16]||(e[16]=i(" Werden Änderungen an dem unverschlüsselten Zugang oder dem Status der Benutzerverwaltung vorgenommen, so ist zwingend ein ",-1)),l(N,{to:"/System/SystemConfiguration"},{default:r(()=>[...e[15]||(e[15]=[i("Neustart dieser openWB",-1)])]),_:1}),e[17]||(e[17]=i(" erforderlich, damit die Änderungen wirksam werden! Erst danach können Benutzer, Gruppen und Rollen angelegt und verwaltet werden.",-1)),e[18]||(e[18]=d("br",null,null,-1)),e[19]||(e[19]=i(" Standard-Admin-Benutzer nach der ersten Aktivierung oder dem Zurücksetzen: ",-1)),e[20]||(e[20]=d("ul",null,[d("li",null,[i("Benutzername: "),d("strong",null,"admin")]),d("li",null,[i("Passwort: "),d("strong",null,"openwb")])],-1))]),_:1}),a.webThemeSupported?w("",!0):(u(),m(c,{key:0,subtype:"danger",class:"mt-2"},{default:r(()=>[i(' Das ausgewählte Theme "'+z(n.$store.state.mqtt["openWB/general/web_theme"]?.name)+'" für die ',1),l(N,{to:"/GeneralConfiguration"},{default:r(()=>[...e[21]||(e[21]=[i("Hauptseite",-1)])]),_:1}),e[22]||(e[22]=i(" unterstützt die Benutzerverwaltung nicht. ",-1))]),_:1})),a.displayThemeSupported?w("",!0):(u(),m(c,{key:1,subtype:"danger",class:"mt-2"},{default:r(()=>[i(' Das ausgewählte Theme "'+z(n.$store.state.mqtt["openWB/optional/int_display/theme"]?.name)+'" für das ',1),l(N,{to:"/DisplayConfiguration"},{default:r(()=>[...e[23]||(e[23]=[i("Display",-1)])]),_:1}),e[24]||(e[24]=i(" unterstützt die Benutzerverwaltung nicht. ",-1))]),_:1})),e[26]||(e[26]=d("hr",null,null,-1)),l(U,{title:"Benutzerverwaltung zurücksetzen","button-text":"Zurücksetzen",subtype:"danger",disabled:n.$store.state.mqtt["openWB/system/security/user_management_active"]===!0||a.loggedInUser!==null,onButtonClicked:e[3]||(e[3]=t=>s.showResetModal=!0)},{help:r(()=>[...e[25]||(e[25]=[i(" Hiermit werden alle Benutzer, Gruppen und Rollen der openWB Benutzerverwaltung gelöscht und auf die Werkseinstellungen zurückgesetzt. Diese Aktion ist irreversibel!",-1),d("br",null,null,-1),d("strong",null,"Hinweis:",-1),i(" Die Benutzerverwaltung muss deaktiviert sein, um die Benutzerverwaltung zurücksetzen zu können. ",-1)])]),_:1},8,["disabled"])]),_:1})]),n.$store.state.mqtt["openWB/system/security/user_management_active"]===!0&&s.anonymousGroupName!==null?(u(),p("div",K,[n.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]!==!0?(u(),m(c,{key:0,subtype:"warning"},{default:r(()=>[e[28]||(e[28]=i(" Sie müssen der ",-1)),l(N,{to:"/System/LegalSettings"},{default:r(()=>[...e[27]||(e[27]=[i("Datenschutzerklärung",-1)])]),_:1}),e[29]||(e[29]=i(' zustimmen, um die Funktion "Kennwort vergessen" nutzen zu können! ',-1))]),_:1})):w("",!0),l(B,{collapsible:!0,collapsed:!0,onExpanded:e[8]||(e[8]=t=>a.getClientsDetails())},{header:r(()=>[l(D,{icon:["fas","user"]}),e[30]||(e[30]=i(" Benutzer ",-1))]),default:r(()=>[s.clients.length===0?(u(),m(c,{key:0,subtype:"info"},{default:r(()=>[...e[31]||(e[31]=[i(" Es sind noch keine Benutzer angelegt oder Du hast nicht die benötigten Rechte, Daten anzuzeigen. ",-1)])]),_:1})):(u(),p("div",X,[l(v,{modelValue:s.newClientName,"onUpdate:modelValue":e[6]||(e[6]=t=>s.newClientName=t),title:"Neuen Benutzer erstellen",subtype:"user","add-button":"","onInput:add":e[7]||(e[7]=t=>a.createClient())},{help:r(()=>[...e[32]||(e[32]=[i(" Hier kann ein neuer Benutzer für die openWB Benutzerverwaltung angelegt werden. Der Benutzername kann nicht mehr geändert werden! ",-1)])]),_:1},8,["modelValue"]),e[38]||(e[38]=d("hr",null,null,-1)),(u(!0),p(S,null,W(s.clients,t=>(u(),m(B,{key:t,collapsible:!0,collapsed:!0,onExpanded:o=>a.getClient(t)},{header:r(()=>[l(D,{icon:["fas",s.clientDetails[t]?.disabled?"user-slash":"user"]},null,8,["icon"]),i(" "+z(t),1)]),actions:r(o=>[o.collapsed?w("",!0):(u(),p("span",{key:0,class:F(["pill mr-2",[s.clientDetails[t]?.disabled?"bg-danger":"bg-success",{clickable:a.loggedInUser!==t}]]),title:a.loggedInUser!==t?`Benutzer ${s.clientDetails[t]?.disabled?"aktivieren":"deaktivieren"}`:"Der aktuell angemeldete Benutzer kann nicht deaktiviert werden.",onClick:R(C=>{a.loggedInUser!==t&&a.toggleClientDisabled(t)},["stop"])},z(s.clientDetails[t]?.disabled?"Deaktiviert":"Aktiv"),11,Y)),!o.collapsed&&a.loggedInUser!==t&&!t.startsWith("Display-")?(u(),m(_,{key:1,class:"bg-danger clickable",title:"Benutzer löschen",onClick:R(C=>{a.loggedInUser!==t&&a.deleteClient(t)},["stop"])},{default:r(()=>[l(k,{icon:["fas","trash"]})]),_:1},8,["onClick"])):w("",!0)]),footer:r(()=>[l(V,{"form-name":`clientForm-${t}`,"save-id":`saveClientBtn-${t}`,"hide-reset":!0,"hide-defaults":!0,onSave:o=>a.modifyClient(t)},null,8,["form-name","save-id","onSave"])]),default:r(()=>[s.clientDetails[t]?(u(),p("div",$,[d("form",{name:`clientForm-${t}`},[l(v,{modelValue:s.clientDetails[t].username,"onUpdate:modelValue":o=>s.clientDetails[t].username=o,title:"Benutzername",subtype:"user",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),s.clientDetails[t].username.startsWith("Display-")?w("",!0):(u(),m(v,{key:0,modelValue:s.clientDetails[t].textname,"onUpdate:modelValue":o=>s.clientDetails[t].textname=o,title:"E-Mail",subtype:"email",required:!s.clientDetails[t].username.startsWith("Display-")},{help:r(()=>[...e[33]||(e[33]=[i(' Die hier angegebene E-Mail wird für die Funktion "Kennwort vergessen" verwendet. ',-1)])]),_:1},8,["modelValue","onUpdate:modelValue","required"])),s.clientDetails[t].username.startsWith("Display-")?w("",!0):(u(),m(v,{key:1,modelValue:s.clientDetails[t].password,"onUpdate:modelValue":o=>s.clientDetails[t].password=o,title:"Passwort",subtype:"password"},{help:r(()=>[...e[34]||(e[34]=[i(" Bereits festgelegte Passwörter werden nicht angezeigt!",-1),d("br",null,null,-1),i(" Um das Passwort zu ändern, bitte ein neues Passwort eingeben und speichern, andernfalls das Feld leer lassen. ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"])),l(G,{title:"Zugewiesene Gruppen","valid-elements":s.groups,"model-value":s.clientDetails[t].groups.map(o=>o.groupname),"onUpdate:modelValue":o=>{s.clientDetails[t].groups=o.map(C=>({groupname:C}))}},{"input-prefix":r(()=>[l(k,{icon:["fas","users"]})]),"element-prefix":r(()=>[l(k,{icon:["fas","users"]})]),help:r(()=>[...e[35]||(e[35]=[i(" Hier können Gruppen zugewiesen werden, denen der Benutzer angehört. Über die Gruppen werden Rollen und damit verbundene Zugriffsrechte (ACLs) vererbt. Es wird empfohlen, Berechtigungen über Gruppen zu verwalten, damit bei mehreren Benutzern mit ähnlichen Rechten die Verwaltung einfacher und übersichtlicher bleibt. Es können aber auch direkt Rollen zugewiesen werden, um Ergänzungen zu den Gruppenrechten abzubilden. ",-1)])]),_:1},8,["valid-elements","model-value","onUpdate:modelValue"]),l(G,{title:"Zugewiesene Rollen","valid-elements":a.rolesList.map(o=>({value:o.name,label:o.friendlyName})),"model-value":s.clientDetails[t].roles.map(o=>o.rolename),"onUpdate:modelValue":o=>{s.clientDetails[t].roles=o.map(C=>({rolename:C}))}},{"input-prefix":r(()=>[l(k,{icon:["fas","file-shield"]})]),"element-prefix":r(()=>[l(k,{icon:["fas","file-shield"]})]),help:r(()=>[...e[36]||(e[36]=[i(" Hier können Rollen zugewiesen werden, die dem Benutzer direkt zugeordnet werden. Über die Rollen werden Zugriffsrechte (ACLs) vererbt. Es wird empfohlen, Berechtigungen über Gruppen zu verwalten und hier nur ergänzende Rollen zuzuweisen, um die Übersicht zu behalten. ",-1)])]),_:1},8,["valid-elements","model-value","onUpdate:modelValue"]),l(A,{modelValue:s.clientDetails[t].textdescription,"onUpdate:modelValue":o=>s.clientDetails[t].textdescription=o,title:"Zusatzinformationen",subtype:"text"},{help:r(()=>[...e[37]||(e[37]=[i(" Hier können zusätzliche Informationen zum Benutzer hinterlegt werden. ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue"])],8,ee)])):(u(),p("div",ne,"Lade Benutzerdetails..."))]),_:2},1032,["onExpanded"]))),128))]))]),_:1}),l(B,{collapsible:!0,collapsed:!0},{header:r(()=>[l(D,{icon:["fas","users"]}),e[39]||(e[39]=i(" Gruppen ",-1))]),default:r(()=>[s.groups.length===0?(u(),m(c,{key:0,subtype:"info"},{default:r(()=>[...e[40]||(e[40]=[i(" Es sind noch keine Gruppen angelegt oder Du hast nicht die benötigten Rechte, Daten anzuzeigen. ",-1)])]),_:1})):(u(),p("div",te,[l(v,{modelValue:s.newGroupName,"onUpdate:modelValue":e[9]||(e[9]=t=>s.newGroupName=t),title:"Neue Gruppe erstellen",subtype:"group","add-button":"","onInput:add":e[10]||(e[10]=t=>a.createGroup())},{help:r(()=>[...e[41]||(e[41]=[i(" Hier kann eine neue Gruppe für die openWB Benutzerverwaltung angelegt werden. Der Gruppenname kann nicht mehr geändert werden! ",-1)])]),_:1},8,["modelValue"]),e[43]||(e[43]=d("hr",null,null,-1)),(u(!0),p(S,null,W(s.groups,t=>(u(),m(B,{key:t,collapsible:!0,collapsed:!0,onExpanded:o=>a.getGroup(t)},{header:r(()=>[l(D,{icon:["fas","users"]}),i(" "+z(t),1)]),actions:r(o=>[!o.collapsed&&![s.anonymousGroupName,s.userGroupName,s.displayGroupName].includes(t)?(u(),m(_,{key:0,class:"bg-danger clickable",title:"Gruppe löschen",onClick:R(C=>a.deleteGroup(t),["stop"])},{default:r(()=>[l(k,{icon:["fas","trash"]})]),_:1},8,["onClick"])):w("",!0)]),footer:r(()=>[l(V,{"form-name":`groupForm-${t}`,"save-id":`saveGroupBtn-${t}`,"hide-reset":!0,"hide-defaults":!0,onSave:o=>a.modifyGroup(t)},null,8,["form-name","save-id","onSave"])]),default:r(()=>[s.groupDetails[t]?(u(),p("div",se,[t===s.anonymousGroupName?(u(),m(c,{key:0,subtype:"info"},{default:r(()=>[i(' Die Gruppe "'+z(t)+'" kann nicht gelöscht werden, da sie für den anonymen Zugriff (ohne Anmeldung) auf openWB benötigt wird. ',1)]),_:2},1024)):w("",!0),t===s.userGroupName?(u(),m(c,{key:1,subtype:"info"},{default:r(()=>[i(' Die Gruppe "'+z(t)+'" kann nicht bearbeitet werden, da sie von openWB für reguläre Benutzer verwendet wird. Es wird empfohlen, diese Gruppe allen Benutzern zuzuweisen und weitere Rollen durch separate Gruppen oder direkt bei den Benutzern zu hinterlegen. ',1)]),_:2},1024)):w("",!0),t===s.displayGroupName?(u(),m(c,{key:2,subtype:"info"},{default:r(()=>[i(' Die Gruppe "'+z(t)+'" kann nicht bearbeitet werden, da sie von openWB für integrierte Displays verwendet wird. Es wird empfohlen, diese Gruppe allen Displays zuzuweisen und weitere Rollen durch separate Gruppen oder direkt bei den Display-Benutzern zu hinterlegen. ',1)]),_:2},1024)):w("",!0),d("form",{name:`groupForm-${t}`},[l(v,{modelValue:s.groupDetails[t].groupname,"onUpdate:modelValue":o=>s.groupDetails[t].groupname=o,title:"Gruppenname",subtype:"text",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),l(v,{modelValue:s.groupDetails[t].textname,"onUpdate:modelValue":o=>s.groupDetails[t].textname=o,title:"Beschreibung",subtype:"text",disabled:[s.anonymousGroupName,s.userGroupName,s.displayGroupName].includes(t)},null,8,["modelValue","onUpdate:modelValue","disabled"]),l(G,{title:"Zugewiesene Benutzer","valid-elements":s.clients,"model-value":s.groupDetails[t].clients.map(o=>o.username),"onUpdate:modelValue":o=>{s.groupDetails[t].clients=o.map(C=>({username:C}))}},{"input-prefix":r(()=>[l(k,{icon:["fas","circle-user"]})]),"element-prefix":r(()=>[l(k,{icon:["fas","circle-user"]})]),_:1},8,["valid-elements","model-value","onUpdate:modelValue"]),l(G,{title:"Zugewiesene Rollen","valid-elements":a.rolesList.map(o=>({value:o.name,label:o.friendlyName})),disabled:[s.anonymousGroupName,s.userGroupName,s.displayGroupName].includes(t),readonly:[s.anonymousGroupName,s.userGroupName,s.displayGroupName].includes(t),"model-value":s.groupDetails[t].roles.map(o=>o.rolename),"onUpdate:modelValue":o=>{s.groupDetails[t].roles=o.map(C=>({rolename:C}))}},{"input-prefix":r(()=>[l(k,{icon:["fas","file-shield"]})]),"element-prefix":r(()=>[l(k,{icon:["fas","file-shield"]})]),_:1},8,["valid-elements","disabled","readonly","model-value","onUpdate:modelValue"]),l(A,{modelValue:s.groupDetails[t].textdescription,"onUpdate:modelValue":o=>s.groupDetails[t].textdescription=o,title:"Zusatzinformationen",subtype:"text",disabled:[s.anonymousGroupName,s.userGroupName,s.displayGroupName].includes(t)},{help:r(()=>[...e[42]||(e[42]=[i(" Hier können zusätzliche Informationen zur Gruppe hinterlegt werden. ",-1)])]),_:1},8,["modelValue","onUpdate:modelValue","disabled"])],8,re)])):(u(),p("div",ie,"Lade Gruppendetails..."))]),_:2},1032,["onExpanded"]))),128))]))]),_:1}),l(B,{collapsible:!0,collapsed:!0},{header:r(()=>[l(D,{icon:["fas","file-shield"]}),e[44]||(e[44]=i(" Rollen ",-1))]),default:r(()=>[n.roles.length===0?(u(),m(c,{key:0,subtype:"info"},{default:r(()=>[...e[45]||(e[45]=[i(" Es sind noch keine Rollen angelegt oder Du hast nicht die benötigten Rechte, Daten anzuzeigen. ",-1)])]),_:1})):(u(),p("div",le,[l(c,{subtype:"info"},{default:r(()=>[...e[46]||(e[46]=[i(" Rollen definieren die Zugriffsrechte (Access Control Lists, ACLs) für Benutzer und Gruppen. Jeder Benutzer oder jede Gruppe kann mehrere Rollen zugewiesen bekommen, wodurch sich die effektiven Zugriffsrechte zusammensetzen.",-1),d("br",null,null,-1),i(" openWB erstellt automatisch relevante Rollen während der Installation und bei der Aktivierung bestimmter Funktionen oder Bearbeitung von Ladepunkten, Geräten und Komponenten etc. Rollen können hier nicht bearbeitet oder gelöscht werden. ",-1)])]),_:1}),l(v,{"model-value":s.rolesVersion,title:"Versionsnummer der Rollendefinitionen",disabled:""},{help:r(()=>[...e[47]||(e[47]=[i(" Hier wird die aktuell verwendete Rollen-Version der openWB Benutzerverwaltung angezeigt. Diese Version gibt an, welche vordefinierten Rollen und Zugriffsrechte (ACLs) von openWB generiert werden. Bei einem Update von openWB kann sich die Rollen-Version ändern, wodurch neue Rollen hinzugefügt oder bestehende Rollen angepasst werden können. ",-1)])]),_:1},8,["model-value"]),l(A,{title:"Standard-Zugriffsrechte","model-value":a.readableAcls(s.defaultAclAccess),disabled:""},{help:r(()=>[...e[48]||(e[48]=[i(" Hier werden die Standard Zugriffsrechte (Access Control Lists, ACLs) angezeigt. Diese werden verwendet, wenn keine spezifischen ACLs für einen Benutzer oder eine Gruppe definiert sind oder die Topics nicht explizit abgedeckt werden. ",-1)])]),_:1},8,["model-value"]),e[50]||(e[50]=d("hr",null,null,-1)),(u(!0),p(S,null,W(a.rolesList,t=>(u(),m(B,{key:t.name,collapsible:!0,collapsed:!0,onExpanded:o=>a.getRole(t.name)},{header:r(()=>[l(D,{icon:["fas","file-shield"]}),i(" "+z(t.friendlyName),1)]),default:r(()=>[s.roleDetails[t.name]?(u(),p("div",oe,[d("form",{name:`roleForm-${t.name}`},[l(v,{modelValue:s.roleDetails[t.name].rolename,"onUpdate:modelValue":o=>s.roleDetails[t.name].rolename=o,title:"Rollenname",subtype:"text",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),l(v,{modelValue:s.roleDetails[t.name].textname,"onUpdate:modelValue":o=>s.roleDetails[t.name].textname=o,title:"Beschreibung",subtype:"text",disabled:""},null,8,["modelValue","onUpdate:modelValue"]),s.roleDetails[t.name].textdescription?(u(),m(c,{key:0,subtype:"info"},{default:r(()=>[i(z(s.roleDetails[t.name].textdescription),1)]),_:2},1024)):w("",!0),l(A,{title:"Zugriffsrechte (ACLs)","model-value":a.readableAcls(s.roleDetails[t.name].acls),disabled:""},{help:r(()=>[...e[49]||(e[49]=[i(" Hier werden die Zugriffsrechte (Access Control Lists, ACLs) für diese Rolle angezeigt. ",-1)])]),_:1},8,["model-value"])],8,ae)])):(u(),p("div",ue,"Lade Rollendetails..."))]),_:2},1032,["onExpanded"]))),128))]))]),_:1})])):(u(),p("div",de,[l(c,{subtype:"info"},{default:r(()=>[e[52]||(e[52]=i(" Die Benutzerverwaltung ist deaktiviert. In diesem Modus haben alle Benutzer uneingeschränkten Zugriff auf openWB.",-1)),e[53]||(e[53]=d("br",null,null,-1)),e[54]||(e[54]=i(" Um Benutzer, Gruppen und Rollen zu verwalten, muss die Benutzerverwaltung zuerst aktiviert werden. Dazu ist nach der Aktivierung zwingend ein ",-1)),l(N,{to:"/System/SystemConfiguration"},{default:r(()=>[...e[51]||(e[51]=[i("Neustart dieser openWB",-1)])]),_:1}),e[55]||(e[55]=i(" erforderlich, damit die Änderungen wirksam werden. ",-1))]),_:1})]))]))])}const we=H(P,[["render",me],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/SecurityConfiguration.vue"]]);export{we as default};
