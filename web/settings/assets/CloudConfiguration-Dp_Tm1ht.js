import{F as q,l as h,ae as P}from"./vendor-fortawesome-CaZSeuAc.js";import{C as S}from"./index-BFYuTgoH.js";import{_ as z,m as l,f as C,x as s,u as a,y as t,D as r,z as p,q as m,E as Z,k as _,L as I,l as i}from"./vendor-BoRpwYSS.js";import"./vendor-bootstrap-C_iHcwa3.js";import"./vendor-jquery-CEMonh9Y.js";import"./vendor-axios-B0SCfrz2.js";import"./vendor-sortablejs-B7wL87hN.js";h.add(P);const M={name:"OpenwbCloudConfigView",components:{FontAwesomeIcon:q},mixins:[S],emits:["sendCommand","save","reset","defaults"],data(){return{mqttTopicsToSubscribe:["openWB/general/extern","openWB/system/dataprotection_acknowledged","openWB/system/mqtt/bridge/+","openWB/system/mqtt/valid_partner_ids"],mqttTopicsToPublish:["openWB/system/mqtt/bridge/+","openWB/system/mqtt/valid_partner_ids"],enableNewCloudButton:!0,newCloudData:{email:"",username:"",partner:!1},enableCloudConnectButton:!0,connectCloudData:{username:"",password:"",partner:!1},enableRemoveCloudButton:!0,showCloudRemoveModal:!1}},computed:{cloudBridge:{get(){let n=this.getWildcardTopics("openWB/system/mqtt/bridge/+");for(const[e,c]of Object.entries(n))c.remote.is_openwb_cloud||delete n[e];return n}},cloudBridgeKey:{get(){for(const[n,e]of Object.entries(this.cloudBridge))if(e.remote.is_openwb_cloud)return n}},cloudSettings:{get(){return{username:this.cloudBridge[this.cloudBridgeKey].remote.username,password:this.cloudBridge[this.cloudBridgeKey].remote.password,partner:this.cloudBridge[this.cloudBridgeKey].access?this.cloudBridge[this.cloudBridgeKey].access.partner:!1}}}},methods:{getMqttBridgeIndex(n){return parseInt(n.match(/(?:\/)(\d+)$/)[1])},createCloud(){document.forms.cloudConfigCreateForm.reportValidity()&&(this.$emit("save",this.mqttTopicsToPublish),this.$emit("sendCommand",{command:"initCloud",data:this.newCloudData}),this.enableNewCloudButton=!1)},connectCloud(){document.forms.cloudConfigConnectForm.reportValidity()&&(this.$emit("save",this.mqttTopicsToPublish),this.$emit("sendCommand",{command:"connectCloud",data:this.connectCloudData}),this.enableCloudConnectButton=!1)},removeCloudModal(n){n.stopPropagation(),this.showCloudRemoveModal=!0},removeCloud(n){this.showCloudRemoveModal=!1,n=="confirm"&&(this.updateState("openWB/system/mqtt/valid_partner_ids",[]),this.$emit("sendCommand",{command:"removeMqttBridge",data:{bridge:this.getMqttBridgeIndex(this.cloudBridgeKey)}}),this.enableCloudConnectButton=!0)}}},K={class:"cloud-config"},T={key:1},x={key:1,name:"cloudConfigConnectForm"},R={class:"row justify-content-center"},U={key:2,name:"cloudConfigured"},A={class:"row justify-content-center"};function N(n,e,c,F,u,d){const D=l("openwb-base-modal-dialog"),w=l("router-link"),g=l("openwb-base-alert"),b=l("openwb-base-text-input"),B=l("openwb-base-button-group-input"),f=l("font-awesome-icon"),y=l("openwb-base-array-input"),v=l("openwb-base-click-button"),k=l("openwb-base-card"),W=l("openwb-base-heading"),V=l("openwb-base-submit-buttons");return i(),C(I,null,[s(D,{show:u.showCloudRemoveModal,title:"Cloud Zugang löschen",subtype:"danger",buttons:[{text:"Löschen",event:"confirm",subtype:"danger"}],onModalResult:e[0]||(e[0]=o=>d.removeCloud(o))},{default:t(()=>[...e[13]||(e[13]=[r(" Willst Du den vorhandenen Cloud Zugang wirklich entfernen? Dieser Vorgang kann nicht rückgängig gemacht werden! ",-1)])]),_:1},8,["show"]),a("div",K,[n.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]!==!0?(i(),p(g,{key:0,subtype:"danger"},{default:t(()=>[e[15]||(e[15]=r(" Du musst der ",-1)),s(w,{to:"/System/LegalSettings"},{default:t(()=>[...e[14]||(e[14]=[r(" Datenschutzerklärung ",-1)])]),_:1}),e[16]||(e[16]=r(" zustimmen, um die openWB Cloud nutzen zu können. ",-1))]),_:1})):(i(),C("div",T,[s(g,{subtype:"success"},{default:t(()=>[e[18]||(e[18]=r(" Du hast der ",-1)),s(w,{to:"/System/LegalSettings"},{default:t(()=>[...e[17]||(e[17]=[r(" Datenschutzerklärung ",-1)])]),_:1}),e[19]||(e[19]=r(" zugestimmt und kannst die openWB Cloud nutzen. ",-1))]),_:1}),u.enableRemoveCloudButton?m("",!0):(i(),p(g,{key:0,subtype:"warning"},{default:t(()=>[...e[20]||(e[20]=[r(" Der Zugang wurde entfernt. Bitte starte die openWB neu, um die Änderungen anzuwenden! ",-1)])]),_:1})),d.cloudBridgeKey?m("",!0):(i(),C("form",x,[s(k,{title:"Vorhandenen Zugang einrichten"},Z({default:t(()=>[s(g,{subtype:"info"},{default:t(()=>[...e[21]||(e[21]=[a("p",null,[r(" Bitte nutze die in/an der openWB notierten Zugangsdaten. Wenn bei einer gekauften openWB keine Zugangsdaten vorhanden sind, schreibe bitte eine Mail unter Angabe der Bestell- und/oder Seriennummer an "),a("a",{href:"mailto:support@openwb.de",subject:"Cloud Zugangsdaten"}," support@openwb.de "),r(" . ")],-1),a("p",null,[r(" Eine Anleitung zur Einrichtung der openWB Cloud findest Du im "),a("a",{href:"https://wiki.openwb.de/doku.php?id=openwb:tutorials:cloudeinrichten",target:"_blank",rel:"noopener noreferrer"}," Wiki "),r(". ")],-1)])]),_:1}),s(b,{modelValue:u.connectCloudData.username,"onUpdate:modelValue":e[1]||(e[1]=o=>u.connectCloudData.username=o),title:"Benutzername",required:"",subtype:"user"},null,8,["modelValue"]),s(b,{modelValue:u.connectCloudData.password,"onUpdate:modelValue":e[2]||(e[2]=o=>u.connectCloudData.password=o),title:"Passwort",required:"",subtype:"password"},null,8,["modelValue"]),s(B,{modelValue:u.connectCloudData.partner,"onUpdate:modelValue":e[3]||(e[3]=o=>u.connectCloudData.partner=o),title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}]},{help:t(()=>[...e[22]||(e[22]=[r(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ",-1)])]),_:1},8,["modelValue"]),u.connectCloudData.partner?(i(),p(y,{key:0,title:"Gültige Partner-IDs","no-elements-message":"Keine Partner-ID zugeordnet.","model-value":n.$store.state.mqtt["openWB/system/mqtt/valid_partner_ids"],"onUpdate:modelValue":e[4]||(e[4]=o=>n.updateState("openWB/system/mqtt/valid_partner_ids",o))},{"input-prefix":t(()=>[s(f,{icon:["fas","user-gear"]})]),"element-prefix":t(()=>[s(f,{icon:["fas","user-gear"]})]),help:t(()=>[...e[23]||(e[23]=[r(" Die Partner-ID erhältst Du von Deinem Installateur. Ist hier keine Partner-ID eingetragen, dann kann auch niemand - trotz aktiviertem Zugang für Partner - über das Partner-Portal auf diese openWB zugreifen! ",-1)])]),_:1},8,["model-value"])):m("",!0)]),_:2},[n.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[a("div",R,[s(v,{class:_(["col-4",u.enableCloudConnectButton?"btn-success":"btn-outline-success"]),disabled:!u.enableCloudConnectButton,onButtonClicked:d.connectCloud},{default:t(()=>[...e[24]||(e[24]=[r(" Mit Cloud verbinden ",-1)])]),_:1},8,["class","disabled","onButtonClicked"])])]),key:"0"}:void 0]),1024)])),d.cloudBridgeKey?(i(),C("form",U,[!u.enableCloudConnectButton||!u.enableNewCloudButton?(i(),p(g,{key:0,subtype:"warning"},{default:t(()=>[...e[25]||(e[25]=[r(" Der Zugang wurde eingerichtet. Bitte starte die die openWB neu, um die Änderungen anzuwenden! ",-1)])]),_:1})):m("",!0),s(k,{title:"Vorhandener Cloud Zugang"},{footer:t(()=>[a("div",A,[s(v,{class:_(["col-4",u.enableRemoveCloudButton?"btn-danger":"btn-outline-danger"]),disabled:!u.enableRemoveCloudButton,onButtonClicked:e[9]||(e[9]=o=>d.removeCloudModal(o))},{default:t(()=>[...e[29]||(e[29]=[r(" Zugang löschen ",-1)])]),_:1},8,["class","disabled"])])]),default:t(()=>[s(W,null,{default:t(()=>[...e[26]||(e[26]=[a("span",null,[r(" Mit diesen Zugangsdaten kannst Du dich in der "),a("a",{href:"https://remote.openwb.de/",target:"_blank",rel:"noopener noreferrer"}," openWB Cloud "),r(" anmelden. ")],-1)])]),_:1}),s(b,{modelValue:d.cloudSettings.username,"onUpdate:modelValue":e[5]||(e[5]=o=>d.cloudSettings.username=o),title:"Benutzername",required:"",subtype:"user",disabled:""},null,8,["modelValue"]),s(b,{modelValue:d.cloudSettings.password,"onUpdate:modelValue":e[6]||(e[6]=o=>d.cloudSettings.password=o),title:"Passwort",required:"",subtype:"password",disabled:""},null,8,["modelValue"]),e[30]||(e[30]=a("hr",null,null,-1)),s(B,{title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":d.cloudSettings.partner,"onUpdate:modelValue":e[7]||(e[7]=o=>n.updateState(d.cloudBridgeKey,o,"access.partner"))},{help:t(()=>[...e[27]||(e[27]=[r(" Wenn diese openWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ",-1)])]),_:1},8,["model-value"]),d.cloudSettings.partner?(i(),p(y,{key:0,title:"Gültige Partner-IDs","no-elements-message":"Keine Partner-ID zugeordnet.","model-value":n.$store.state.mqtt["openWB/system/mqtt/valid_partner_ids"],"onUpdate:modelValue":e[8]||(e[8]=o=>n.updateState("openWB/system/mqtt/valid_partner_ids",o))},{"input-prefix":t(()=>[s(f,{icon:["fas","user-gear"]})]),"element-prefix":t(()=>[s(f,{icon:["fas","user-gear"]})]),help:t(()=>[...e[28]||(e[28]=[r(" Die Partner-ID erhältst Du von Deinem Installateur. Ist hier keine Partner-ID eingetragen, dann kann auch niemand - trotz aktiviertem Zugang für Partner - über das Partner-Portal auf diese openWB zugreifen! ",-1)])]),_:1},8,["model-value"])):m("",!0)]),_:1})])):m("",!0),d.cloudBridgeKey?(i(),p(V,{key:3,"form-name":"cloudConfigured",onSave:e[10]||(e[10]=o=>n.$emit("save",u.mqttTopicsToPublish)),onReset:e[11]||(e[11]=o=>n.$emit("reset")),onDefaults:e[12]||(e[12]=o=>n.$emit("defaults"))})):m("",!0)]))])],64)}const Q=z(M,[["render",N],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/CloudConfiguration.vue"]]);export{Q as default};
