import{l as z,ap as E,u as U,af as x,a3 as L,aq as F,F as j}from"./vendor-fortawesome-66071a0e.js";import{C as D}from"./index-9e1a7ef3.js";import{_ as R,u as g,l as f,m as y,x as B,E as l,z as v,G as r,A as a,q as k,N as V,M as q,F as _,B as i}from"./vendor-25d394b4.js";import"./vendor-bootstrap-374cd88e.js";import"./vendor-jquery-3364d39b.js";import"./vendor-axios-ac33d60c.js";import"./vendor-sortablejs-0eb84ec8.js";z.add(E,U,x,L,F);const T={name:"OpenwbSystemView",components:{FontAwesomeIcon:j},mixins:[D],props:{installAssistantActive:{type:Boolean,required:!1,default:!1}},emits:["save","reset","sendCommand"],data(){return{mqttTopicsToSubscribe:["openWB/system/optionBackup","openWB/system/secondary_auto_update","openWB/system/current_commit","openWB/system/current_branch_commit","openWB/system/current_missing_commits","openWB/system/available_branches","openWB/system/current_branch","openWB/system/version","openWB/system/serial_number","openWB/system/ip_address","openWB/system/mac_address","openWB/chargepoint/+/get/version","openWB/chargepoint/+/get/current_branch","openWB/chargepoint/+/config","openWB/general/extern"],warningAcknowledged:!1,selectedTag:"*HEAD*"}},computed:{externalChargepoints:{get(){let t=this.getWildcardTopics("openWB/chargepoint/+/config"),e={};for(const[m,c]of Object.entries(t))c.type==="external_openwb"&&(e[m]=c);return e}},updateAvailable(){return this.$store.state.mqtt["openWB/system/current_branch_commit"]&&this.$store.state.mqtt["openWB/system/current_branch_commit"]!=this.$store.state.mqtt["openWB/system/current_commit"]},releaseChangeValid(){return this.$store.state.mqtt["openWB/system/current_branch"]in this.$store.state.mqtt["openWB/system/available_branches"]&&"tags"in this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]]&&this.selectedTag in this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]].tags},branchGroups(){const t="Release",e="Beta",m="master",c=[t,e],b=(u,p)=>u.value==p.value?0:u.value==t?-1:p.value==t?1:u.value==e?-1:p.value==e?1:u.value==m?-1:p.value==m||u.value>p.value?1:u.value<p.value?-1:0;var d=this.$store.state.mqtt["openWB/system/available_branches"],o=[{label:"Allgemein",options:[]},{label:"Alpha-Zweig",options:[]},{label:"Experimentell",options:[]}];if(d!==void 0){var n=0;for(const[u,p]of Object.entries(d))c.includes(u)?n=0:u==m?n=1:n=2,o[n].options.push({value:u,text:u+" ("+p.commit+")"});o[0].options.sort(b),o[1].options.sort(b)}return o},branchTagOptions(){const t=(c,b)=>{const d=u=>{const p=u.split("-"),h=p[0].split(".");let w=[];return p.length>1?w=p[1].split("."):w=["release","0"],{semver:h,suffix:w}},o=d(c.value),n=d(b.value);if(o.semver[0]=="*HEAD*")return-1;if(n.semver[0]=="*HEAD*")return 1;if(o.semver[0]>n.semver[0])return-1;if(o.semver[0]<n.semver[0])return 1;if(o.semver[1]>n.semver[1])return-1;if(o.semver[1]<n.semver[1])return 1;if(o.semver[2]>n.semver[2])return-1;if(o.semver[2]<n.semver[2])return 1;switch(o.suffix[0].toLowerCase()){case"alpha":if(["beta","rc","release","patch"].includes(n.suffix[0].toLowerCase())||o.suffix[1]>n.suffix[1])return-1;if(o.suffix[1]<n.suffix[1])return 1;break;case"beta":if(["alpha"].includes(n.suffix[0].toLowerCase()))return-1;if(["rc","release","patch"].includes(n.suffix[0].toLowerCase()))return 1;if(o.suffix[1]>n.suffix[1])return-1;if(o.suffix[1]<n.suffix[1])return 1;break;case"rc":if(["alpha","beta"].includes(n.suffix[0].toLowerCase()))return-1;if(["release","patch"].includes(n.suffix[0].toLowerCase()))return 1;if(o.suffix[1]>n.suffix[1])return-1;if(o.suffix[1]<n.suffix[1])return 1;break;case"release":if(["alpha","beta","rc"].includes(n.suffix[0].toLowerCase()))return-1;if(["patch"].includes(n.suffix[0].toLowerCase()))return 1;break;case"patch":if(["alpha","beta","rc","release"].includes(n.suffix[0].toLowerCase())||o.suffix[1]>n.suffix[1])return-1;if(o.suffix[1]<n.suffix[1])return 1;break}return 0};if(!(this.$store.state.mqtt["openWB/system/current_branch"]in this.$store.state.mqtt["openWB/system/available_branches"]))return[];var e=this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]].tags,m=[];if(e!==void 0)for(const[c,b]of Object.entries(e))m.unshift({value:c,text:b});return m.sort(t)}},methods:{sendSystemCommand(t,e={}){this.$emit("sendCommand",{command:t,data:e})},updateConfiguration(t,e){console.debug("updateConfiguration",t,e),this.updateState(t,e.value,e.object)},systemUpdate(){this.sendSystemCommand("systemUpdate",{}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})},switchBranch(){this.sendSystemCommand("systemUpdate",{branch:this.$store.state.mqtt["openWB/system/current_branch"],tag:this.selectedTag}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})},filterComponentsByType(t,e){return Object.keys(t).filter(m=>t[m].type.includes(e)).reduce((m,c)=>({...m,[c]:t[c]}),{})}}},I={class:"system"},P={key:1},N={name:"versionInfoForm"},O={class:"missing-commits"},Z={class:"row justify-content-center"},G={class:"col-md-4 d-flex py-1 justify-content-center"},H={class:"col-md-4 d-flex py-1 justify-content-center"},J={key:2},M={key:0},K={class:"table table-striped"},Q={key:0,name:"powerForm"},X={class:"row justify-content-center"},Y={class:"col-md-4 d-flex py-1 justify-content-center"},ee={class:"col-md-4 d-flex py-1 justify-content-center"},te={key:1,name:"releaseChangeForm"},se={class:"row justify-content-center"},ne={class:"col-md-4 d-flex py-1 justify-content-center"};function re(t,e,m,c,b,d){const o=g("openwb-base-button-group-input"),n=g("openwb-base-alert"),u=g("openwb-base-text-input"),p=g("openwb-base-card"),h=g("font-awesome-icon"),w=g("openwb-base-click-button"),S=g("openwb-base-heading"),A=g("openwb-base-submit-buttons"),C=g("router-link"),W=g("openwb-base-select-input");return f(),y("div",I,[m.installAssistantActive?v("",!0):(f(),B(n,{key:0,subtype:"danger"},{default:l(()=>[e[18]||(e[18]=a("h2",null,"Achtung!",-1)),e[19]||(e[19]=a("p",null," Vor allen Aktionen auf dieser Seite ist sicherzustellen, dass kein Ladevorgang aktiv ist! Zur Sicherheit bitte zusätzlich alle Fahrzeuge von der Ladestation / den Ladestationen abstecken! ",-1)),r(o,{modelValue:b.warningAcknowledged,"onUpdate:modelValue":e[0]||(e[0]=s=>b.warningAcknowledged=s),title:"Ich habe die Warnung verstanden",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}]},null,8,["modelValue"])]),_:1,__:[18,19]})),b.warningAcknowledged||m.installAssistantActive?(f(),y("div",P,[r(p,{title:"System Information",subtype:"info",collapsible:!0,collapsed:!0},{default:l(()=>[r(u,{modelValue:t.$store.state.mqtt["openWB/system/serial_number"],"onUpdate:modelValue":e[1]||(e[1]=s=>t.$store.state.mqtt["openWB/system/serial_number"]=s),title:"Seriennummer",readonly:""},null,8,["modelValue"]),r(u,{modelValue:t.$store.state.mqtt["openWB/system/ip_address"],"onUpdate:modelValue":e[2]||(e[2]=s=>t.$store.state.mqtt["openWB/system/ip_address"]=s),title:"IP-Adresse",readonly:""},null,8,["modelValue"]),r(u,{modelValue:t.$store.state.mqtt["openWB/system/mac_address"],"onUpdate:modelValue":e[3]||(e[3]=s=>t.$store.state.mqtt["openWB/system/mac_address"]=s),title:"MAC-Adresse",readonly:""},null,8,["modelValue"])]),_:1}),a("form",N,[r(p,{title:"Versions-Informationen / Aktualisierung",subtype:"success",collapsible:!0,collapsed:!m.installAssistantActive},{default:l(()=>[r(u,{modelValue:t.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":e[4]||(e[4]=s=>t.$store.state.mqtt["openWB/system/current_branch"]=s),title:"Entwicklungszweig",readonly:""},null,8,["modelValue"]),r(u,{modelValue:t.$store.state.mqtt["openWB/system/version"],"onUpdate:modelValue":e[5]||(e[5]=s=>t.$store.state.mqtt["openWB/system/version"]=s),title:"Bezeichnung",readonly:""},null,8,["modelValue"]),r(u,{modelValue:t.$store.state.mqtt["openWB/system/current_commit"],"onUpdate:modelValue":e[6]||(e[6]=s=>t.$store.state.mqtt["openWB/system/current_commit"]=s),title:"installierte Version",readonly:"",class:k(d.updateAvailable?"text-danger":"text-success")},null,8,["modelValue","class"]),r(u,{modelValue:t.$store.state.mqtt["openWB/system/current_branch_commit"],"onUpdate:modelValue":e[7]||(e[7]=s=>t.$store.state.mqtt["openWB/system/current_branch_commit"]=s),title:"aktuellste Version",readonly:""},null,8,["modelValue"]),d.updateAvailable?(f(),B(p,{key:0,title:"Änderungen",subtype:"info",collapsible:!0,collapsed:!0},{default:l(()=>[a("ul",O,[(f(!0),y(V,null,q(t.$store.state.mqtt["openWB/system/current_missing_commits"],(s,$)=>(f(),y("li",{key:$},_(s),1))),128))])]),_:1})):v("",!0),r(n,{subtype:"danger"},{default:l(()=>e[20]||(e[20]=[i(" Nach einem Update wird die Ladestation direkt neu gestartet! Es werden alle eventuell vorhandenen lokalen Änderungen am Programmcode mit dem Update verworfen! ",-1)])),_:1,__:[20]}),t.$store.state.mqtt["openWB/system/current_branch"]!="Release"?(f(),B(n,{key:1,subtype:"danger"},{default:l(()=>e[21]||(e[21]=[i(' Du bist nicht auf dem für den normalen Gebrauch empfohlenen Entwicklungszweig "Release". Wir empfehlen, auf diesen Zweig zu wechseln, sobald dort eine neue Version verfügbar ist.',-1),a("br",null,null,-1),i(" Bevor ein Update angestoßen wird, sollte immer eine Sicherung erstellt werden! Es kann zwar wieder auf eine ältere Version gewechselt werden, jedoch ist nicht sichergestellt, dass es dabei keine Probleme gibt. Gerade wenn das Datenformat in der neuen Version angepasst wurde, wird eine ältere damit Fehler produzieren. ",-1)])),_:1,__:[21]})):v("",!0),a("div",Z,[a("div",G,[r(w,{class:"btn-info",onButtonClicked:e[8]||(e[8]=s=>d.sendSystemCommand("systemFetchVersions"))},{default:l(()=>[e[22]||(e[22]=i(" Informationen aktualisieren ",-1)),r(h,{icon:["fas","download"]})]),_:1,__:[22]})]),a("div",H,[r(w,{class:k(d.updateAvailable?"btn-success clickable":"btn-outline-success"),disabled:!d.updateAvailable,onButtonClicked:e[9]||(e[9]=s=>d.systemUpdate())},{default:l(()=>[e[23]||(e[23]=i(" Update ",-1)),r(h,{icon:["fas","arrow-alt-circle-up"]})]),_:1,__:[23]},8,["class","disabled"])])]),t.$store.state.mqtt["openWB/general/extern"]!=!0?(f(),y("div",J,[e[28]||(e[28]=a("hr",null,null,-1)),r(S,null,{default:l(()=>e[24]||(e[24]=[i("Automatisches Update von Secondary openWBs",-1)])),_:1,__:[24]}),r(n,{subtype:"info"},{default:l(()=>e[25]||(e[25]=[i(' Die automatische Updatefunktion für Secondary openWBs ist nur verfügbar, wenn sich die Primary openWB auf dem Entwicklungszweig "Release" befindet. Das Update wird nur auf Secondary openWBs durchgeführt, welche sich ebenfalls auf dem Entwicklungszweig "Release" befinden. Ist die dort installierte Releaseversion zu alt, muss ein einmaliges Update auf die aktuelle Version manuell auf der betroffenen openWB durchgeführt werden. ',-1)])),_:1,__:[25]}),t.$store.state.mqtt["openWB/system/current_branch"]=="Release"?(f(),y("div",M,[r(o,{title:"Secondary openWBs automatisch mit der Primary updaten",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}],"model-value":t.$store.state.mqtt["openWB/system/secondary_auto_update"],"onUpdate:modelValue":e[10]||(e[10]=s=>t.updateState("openWB/system/secondary_auto_update",s))},{help:l(()=>e[26]||(e[26]=[i(' Diese Option ist nur auf dem Entwicklungszweig "Release" verfügbar. Ist diese Option aktiviert, dann werden Secondary openWBs, welche sich ebenfalls auf dem Entwicklungszweig "Release" befinden gleichzeitig mit der Primary openWB aktualisiert. ',-1)])),_:1},8,["model-value"]),a("table",K,[e[27]||(e[27]=a("thead",null,[a("tr",null,[a("th",null,"Secondary"),a("th",null,"Software-Status"),a("th",null,"IP-Adresse")])],-1)),a("tbody",null,[(f(!0),y(V,null,q(d.externalChargepoints,s=>(f(),y("tr",{key:s.id},[a("td",null,_(s.name),1),a("td",null,_(t.$store.state.mqtt["openWB/chargepoint/"+s.id+"/get/current_branch"]===void 0?"Version zu alt oder openWB ist nicht erreichbar. Bitte manuell updaten bzw. prüfen.":t.$store.state.mqtt["openWB/chargepoint/"+s.id+"/get/current_branch"]!="Release"?"Secondary ist nicht auf dem Release-Zweig. Bitte manuell updaten.":t.$store.state.mqtt["openWB/chargepoint/"+s.id+"/get/current_branch"]+" "+t.$store.state.mqtt["openWB/chargepoint/"+s.id+"/get/version"]),1),a("td",null,_(s.configuration.ip_address),1)]))),128))])]),r(A,{"form-name":"versionInfoForm","hide-defaults":!0,onSave:e[11]||(e[11]=s=>t.$emit("save")),onReset:e[12]||(e[12]=s=>t.$emit("reset"))})])):v("",!0)])):v("",!0)]),_:1},8,["collapsed"])]),m.installAssistantActive?v("",!0):(f(),y("form",Q,[r(p,{title:"Betrieb",collapsible:!0,collapsed:!0},{footer:l(()=>[a("div",X,[a("div",Y,[r(w,{class:"btn-warning",onButtonClicked:e[13]||(e[13]=s=>d.sendSystemCommand("systemReboot"))},{default:l(()=>[e[35]||(e[35]=i(" Neustart ",-1)),r(h,{icon:["fas","undo"]})]),_:1,__:[35]})]),a("div",ee,[r(w,{class:"btn-danger",onButtonClicked:e[14]||(e[14]=s=>d.sendSystemCommand("systemShutdown"))},{default:l(()=>[e[36]||(e[36]=i(" Ausschalten ",-1)),r(h,{icon:["fas","power-off"]})]),_:1,__:[36]})])])]),default:l(()=>[r(n,{subtype:"danger"},{default:l(()=>e[29]||(e[29]=[i(" Wenn die Ladestation ausgeschaltet wird, muss sie komplett spannungsfrei geschaltet werden. Erst beim erneuten Zuschalten der Spannung fährt das System wieder hoch. ",-1)])),_:1,__:[29]}),r(n,{subtype:"info"},{default:l(()=>[e[31]||(e[31]=i(" Ein Neustart löscht wichtige Protokolle, die bei der Fehlersuche helfen können. ",-1)),e[32]||(e[32]=a("br",null,null,-1)),e[33]||(e[33]=i("Tipp: Erstelle stattdessen zuerst einen ",-1)),r(C,{to:"/Support"},{default:l(()=>e[30]||(e[30]=[i(" Systembericht ",-1)])),_:1,__:[30]}),e[34]||(e[34]=i(" – das hilft oft mehr und bewahrt alle relevanten Logs. ",-1))]),_:1,__:[31,32,33,34]})]),_:1})])),m.installAssistantActive?v("",!0):(f(),y("form",te,[r(p,{title:"Entwicklungszweig",subtype:"danger",collapsible:!0,collapsed:!0},{footer:l(()=>[a("div",se,[a("div",ne,[r(w,{class:k(d.releaseChangeValid?"btn-danger clickable":"btn-outline-danger"),disabled:!d.releaseChangeValid,onButtonClicked:e[17]||(e[17]=s=>d.switchBranch())},{default:l(()=>[r(h,{icon:["fas","skull-crossbones"]}),e[39]||(e[39]=i(" Branch und Tag wechseln ",-1)),r(h,{icon:["fas","skull-crossbones"]})]),_:1,__:[39]},8,["class","disabled"])])])]),default:l(()=>[r(n,{subtype:"danger"},{default:l(()=>e[37]||(e[37]=[i(" Nach einem Wechsel wird die Ladestation direkt neu gestartet! Es werden alle lokalen Änderungen mit dem Wechsel verworfen! ",-1)])),_:1,__:[37]}),r(n,{subtype:"warning"},{default:l(()=>e[38]||(e[38]=[i(" Bevor auf einen neuen Entwicklungszweig gewechselt wird sollte immer eine Sicherung erstellt werden! Es kann zwar wieder auf eine ältere Version gewechselt werden, jedoch ist nicht sichergestellt, dass es dabei keine Probleme gibt. Gerade wenn das Datenformat in der neuen Version angepasst wurde, wird eine ältere damit Fehler produzieren.",-1),a("br",null,null,-1),i(' Für den normalen Betrieb wird der Zweig "Release" empfohlen. Der Softwarestand wurde ausgiebig getestet, sodass ein Fehlverhalten relativ unwahrscheinlich ist.',-1),a("br",null,null,-1),i(' Der "Beta" Zweig beinhaltet Vorabversionen, bei denen die Entwicklung soweit abgeschlossen ist. Die enthaltenen Anpassungen wurden rudimentär getestet, können aber durchaus noch Fehler enthalten.',-1),a("br",null,null,-1),i(' Die aktuelle Softwareentwicklung findet im Zweig "master" statt. Die enthaltenen Anpassungen sind teilweise noch nicht getestet und enthalten potentiell Fehler.',-1),a("br",null,null,-1),i(' Einträge, die mit "feature" beginnen, sind experimentelle Entwicklungszweige, die nicht für den allgemeinen Gebrauch gedacht sind. ',-1)])),_:1,__:[38]}),r(W,{title:"Entwicklungszweig",groups:d.branchGroups,"model-value":t.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":e[15]||(e[15]=s=>t.updateState("openWB/system/current_branch",s))},null,8,["groups","model-value"]),r(W,{modelValue:b.selectedTag,"onUpdate:modelValue":e[16]||(e[16]=s=>b.selectedTag=s),title:"Tag",options:d.branchTagOptions},null,8,["modelValue","options"])]),_:1})]))])):v("",!0)])}const pe=R(T,[["render",re],["__scopeId","data-v-059847f6"],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/System.vue"]]);export{pe as default};
