import{l as W,an as A,t as x,ae as q,a2 as C,ao as S,F as $}from"./vendor-fortawesome-9c5ed7ee.js";import{C as U}from"./index-7116c4bc.js";import{_ as E,u as g,l as b,m as y,x as _,E as l,z as v,G as n,A as d,B as m,q as B,N as z,M as L,F}from"./vendor-253b919f.js";import"./vendor-bootstrap-41f992c3.js";import"./vendor-jquery-e288bc43.js";import"./vendor-axios-403a452d.js";import"./vendor-sortablejs-15c4534f.js";W.add(A,x,q,C,S);const j={name:"OpenwbSystemView",components:{FontAwesomeIcon:$},mixins:[U],props:{installAssistantActive:{type:Boolean,required:!1,default:!1}},emits:["sendCommand"],data(){return{mqttTopicsToSubscribe:["openWB/system/optionBackup","openWB/system/current_commit","openWB/system/current_branch_commit","openWB/system/current_missing_commits","openWB/system/available_branches","openWB/system/current_branch","openWB/system/version","openWB/system/serial_number","openWB/system/ip_address","openWB/system/mac_address"],warningAcknowledged:!1,selectedTag:"*HEAD*"}},computed:{updateAvailable(){return this.$store.state.mqtt["openWB/system/current_branch_commit"]&&this.$store.state.mqtt["openWB/system/current_branch_commit"]!=this.$store.state.mqtt["openWB/system/current_commit"]},releaseChangeValid(){return this.$store.state.mqtt["openWB/system/current_branch"]in this.$store.state.mqtt["openWB/system/available_branches"]&&"tags"in this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]]&&this.selectedTag in this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]].tags},branchGroups(){const s="Release",e="Beta",c="master",h=[s,e],f=(o,u)=>o.value==u.value?0:o.value==s?-1:u.value==s?1:o.value==e?-1:u.value==e?1:o.value==c?-1:u.value==c||o.value>u.value?1:o.value<u.value?-1:0;var i=this.$store.state.mqtt["openWB/system/available_branches"],a=[{label:"Allgemein",options:[]},{label:"Alpha-Zweig",options:[]},{label:"Experimentell",options:[]}];if(i!==void 0){var t=0;for(const[o,u]of Object.entries(i))h.includes(o)?t=0:o==c?t=1:t=2,a[t].options.push({value:o,text:o+" ("+u.commit+")"});a[0].options.sort(f),a[1].options.sort(f)}return a},branchTagOptions(){const s=(h,f)=>{const i=o=>{const u=o.split("-"),w=u[0].split(".");let p=[];return u.length>1?p=u[1].split("."):p=["release","0"],{semver:w,suffix:p}},a=i(h.value),t=i(f.value);if(a.semver[0]=="*HEAD*")return-1;if(t.semver[0]=="*HEAD*")return 1;if(a.semver[0]>t.semver[0])return-1;if(a.semver[0]<t.semver[0])return 1;if(a.semver[1]>t.semver[1])return-1;if(a.semver[1]<t.semver[1])return 1;if(a.semver[2]>t.semver[2])return-1;if(a.semver[2]<t.semver[2])return 1;switch(a.suffix[0].toLowerCase()){case"alpha":if(["beta","rc","release","patch"].includes(t.suffix[0].toLowerCase())||a.suffix[1]>t.suffix[1])return-1;if(a.suffix[1]<t.suffix[1])return 1;break;case"beta":if(["alpha"].includes(t.suffix[0].toLowerCase()))return-1;if(["rc","release","patch"].includes(t.suffix[0].toLowerCase()))return 1;if(a.suffix[1]>t.suffix[1])return-1;if(a.suffix[1]<t.suffix[1])return 1;break;case"rc":if(["alpha","beta"].includes(t.suffix[0].toLowerCase()))return-1;if(["release","patch"].includes(t.suffix[0].toLowerCase()))return 1;if(a.suffix[1]>t.suffix[1])return-1;if(a.suffix[1]<t.suffix[1])return 1;break;case"release":if(["alpha","beta","rc"].includes(t.suffix[0].toLowerCase()))return-1;if(["patch"].includes(t.suffix[0].toLowerCase()))return 1;break;case"patch":if(["alpha","beta","rc","release"].includes(t.suffix[0].toLowerCase())||a.suffix[1]>t.suffix[1])return-1;if(a.suffix[1]<t.suffix[1])return 1;break}return 0};if(!(this.$store.state.mqtt["openWB/system/current_branch"]in this.$store.state.mqtt["openWB/system/available_branches"]))return[];var e=this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]].tags,c=[];if(e!==void 0)for(const[h,f]of Object.entries(e))c.unshift({value:h,text:f});return c.sort(s)}},methods:{sendSystemCommand(s,e={}){this.$emit("sendCommand",{command:s,data:e})},updateConfiguration(s,e){console.debug("updateConfiguration",s,e),this.updateState(s,e.value,e.object)},systemUpdate(){this.sendSystemCommand("systemUpdate",{}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})},switchBranch(){this.sendSystemCommand("systemUpdate",{branch:this.$store.state.mqtt["openWB/system/current_branch"],tag:this.selectedTag}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})}}},D={class:"system"},T={key:1},N={name:"versionInfoForm"},I={class:"missing-commits"},R={class:"row justify-content-center"},Z={class:"col-md-4 d-flex py-1 justify-content-center"},O={class:"col-md-4 d-flex py-1 justify-content-center"},P={key:0,name:"powerForm"},G={class:"row justify-content-center"},H={class:"col-md-4 d-flex py-1 justify-content-center"},M={class:"col-md-4 d-flex py-1 justify-content-center"},J={key:1,name:"releaseChangeForm"},K={class:"row justify-content-center"},Q={class:"col-md-4 d-flex py-1 justify-content-center"};function X(s,e,c,h,f,i){const a=g("openwb-base-button-group-input"),t=g("openwb-base-alert"),o=g("openwb-base-text-input"),u=g("openwb-base-card"),w=g("font-awesome-icon"),p=g("openwb-base-click-button"),k=g("openwb-base-select-input");return b(),y("div",D,[c.installAssistantActive?v("",!0):(b(),_(t,{key:0,subtype:"danger"},{default:l(()=>[e[15]||(e[15]=d("h2",null,"Achtung!",-1)),e[16]||(e[16]=d("p",null," Vor allen Aktionen auf dieser Seite ist sicherzustellen, dass kein Ladevorgang aktiv ist! Zur Sicherheit bitte zusätzlich alle Fahrzeuge von der Ladestation / den Ladestationen abstecken! ",-1)),n(a,{modelValue:f.warningAcknowledged,"onUpdate:modelValue":e[0]||(e[0]=r=>f.warningAcknowledged=r),title:"Ich habe die Warnung verstanden",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}]},null,8,["modelValue"])]),_:1})),f.warningAcknowledged||c.installAssistantActive?(b(),y("div",T,[n(u,{title:"System Information",subtype:"info",collapsible:!0,collapsed:!0},{default:l(()=>[n(o,{modelValue:s.$store.state.mqtt["openWB/system/serial_number"],"onUpdate:modelValue":e[1]||(e[1]=r=>s.$store.state.mqtt["openWB/system/serial_number"]=r),title:"Seriennummer",readonly:""},null,8,["modelValue"]),n(o,{modelValue:s.$store.state.mqtt["openWB/system/ip_address"],"onUpdate:modelValue":e[2]||(e[2]=r=>s.$store.state.mqtt["openWB/system/ip_address"]=r),title:"IP-Adresse",readonly:""},null,8,["modelValue"]),n(o,{modelValue:s.$store.state.mqtt["openWB/system/mac_address"],"onUpdate:modelValue":e[3]||(e[3]=r=>s.$store.state.mqtt["openWB/system/mac_address"]=r),title:"MAC-Adresse",readonly:""},null,8,["modelValue"])]),_:1}),d("form",N,[n(u,{title:"Versions-Informationen / Aktualisierung",subtype:"success",collapsible:!0,collapsed:!c.installAssistantActive},{footer:l(()=>[d("div",R,[d("div",Z,[n(p,{class:"btn-info",onButtonClicked:e[8]||(e[8]=r=>i.sendSystemCommand("systemFetchVersions"))},{default:l(()=>[e[19]||(e[19]=m(" Informationen aktualisieren ")),n(w,{"fixed-width":"",icon:["fas","download"]})]),_:1})]),d("div",O,[n(p,{class:B(i.updateAvailable?"btn-success clickable":"btn-outline-success"),disabled:!i.updateAvailable,onButtonClicked:e[9]||(e[9]=r=>i.systemUpdate())},{default:l(()=>[e[20]||(e[20]=m(" Update ")),n(w,{"fixed-width":"",icon:["fas","arrow-alt-circle-up"]})]),_:1},8,["class","disabled"])])])]),default:l(()=>[n(o,{modelValue:s.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":e[4]||(e[4]=r=>s.$store.state.mqtt["openWB/system/current_branch"]=r),title:"Entwicklungszweig",readonly:""},null,8,["modelValue"]),n(o,{modelValue:s.$store.state.mqtt["openWB/system/version"],"onUpdate:modelValue":e[5]||(e[5]=r=>s.$store.state.mqtt["openWB/system/version"]=r),title:"Bezeichnung",readonly:""},null,8,["modelValue"]),n(o,{modelValue:s.$store.state.mqtt["openWB/system/current_commit"],"onUpdate:modelValue":e[6]||(e[6]=r=>s.$store.state.mqtt["openWB/system/current_commit"]=r),title:"installierte Version",readonly:"",class:B(i.updateAvailable?"text-danger":"text-success")},null,8,["modelValue","class"]),n(o,{modelValue:s.$store.state.mqtt["openWB/system/current_branch_commit"],"onUpdate:modelValue":e[7]||(e[7]=r=>s.$store.state.mqtt["openWB/system/current_branch_commit"]=r),title:"aktuellste Version",readonly:""},null,8,["modelValue"]),i.updateAvailable?(b(),_(u,{key:0,title:"Änderungen",subtype:"info",collapsible:!0,collapsed:!0},{default:l(()=>[d("ul",I,[(b(!0),y(z,null,L(s.$store.state.mqtt["openWB/system/current_missing_commits"],(r,V)=>(b(),y("li",{key:V},F(r),1))),128))])]),_:1})):v("",!0),n(t,{subtype:"danger"},{default:l(()=>e[17]||(e[17]=[m(" Nach einem Update wird die Ladestation direkt neu gestartet! Es werden alle eventuell vorhandenen lokalen Änderungen am Programmcode mit dem Update verworfen! ")])),_:1}),s.$store.state.mqtt["openWB/system/current_branch"]!="Release"?(b(),_(t,{key:1,subtype:"danger"},{default:l(()=>e[18]||(e[18]=[m(' Du bist nicht auf dem für den normalen Gebrauch empfohlenen Entwicklungszweig "Release". Wir empfehlen, auf diesen Zweig zu wechseln, sobald dort eine neue Version verfügbar ist.'),d("br",null,null,-1),m(" Bevor ein Update angestoßen wird, sollte immer eine Sicherung erstellt werden! Es kann zwar wieder auf eine ältere Version gewechselt werden, jedoch ist nicht sichergestellt, dass es dabei keine Probleme gibt. Gerade wenn das Datenformat in der neuen Version angepasst wurde, wird eine ältere damit Fehler produzieren. ")])),_:1})):v("",!0)]),_:1},8,["collapsed"])]),c.installAssistantActive?v("",!0):(b(),y("form",P,[n(u,{title:"Betrieb",collapsible:!0,collapsed:!0},{footer:l(()=>[d("div",G,[d("div",H,[n(p,{class:"btn-warning",onButtonClicked:e[10]||(e[10]=r=>i.sendSystemCommand("systemReboot"))},{default:l(()=>[e[22]||(e[22]=m(" Neustart ")),n(w,{"fixed-width":"",icon:["fas","undo"]})]),_:1})]),d("div",M,[n(p,{class:"btn-danger",onButtonClicked:e[11]||(e[11]=r=>i.sendSystemCommand("systemShutdown"))},{default:l(()=>[e[23]||(e[23]=m(" Ausschalten ")),n(w,{"fixed-width":"",icon:["fas","power-off"]})]),_:1})])])]),default:l(()=>[n(t,{subtype:"danger"},{default:l(()=>e[21]||(e[21]=[m(" Wenn die Ladestation ausgeschaltet wird, muss sie komplett spannungsfrei geschaltet werden. Erst beim erneuten Zuschalten der Spannung fährt das System wieder hoch. ")])),_:1})]),_:1})])),c.installAssistantActive?v("",!0):(b(),y("form",J,[n(u,{title:"Entwicklungszweig",subtype:"danger",collapsible:!0,collapsed:!0},{footer:l(()=>[d("div",K,[d("div",Q,[n(p,{class:B(i.releaseChangeValid?"btn-danger clickable":"btn-outline-danger"),disabled:!i.releaseChangeValid,onButtonClicked:e[14]||(e[14]=r=>i.switchBranch())},{default:l(()=>[n(w,{"fixed-width":"",icon:["fas","skull-crossbones"]}),e[26]||(e[26]=m(" Branch und Tag wechseln ")),n(w,{"fixed-width":"",icon:["fas","skull-crossbones"]})]),_:1},8,["class","disabled"])])])]),default:l(()=>[n(t,{subtype:"danger"},{default:l(()=>e[24]||(e[24]=[m(" Nach einem Wechsel wird die Ladestation direkt neu gestartet! Es werden alle lokalen Änderungen mit dem Wechsel verworfen! ")])),_:1}),n(t,{subtype:"warning"},{default:l(()=>e[25]||(e[25]=[m(" Bevor auf einen neuen Entwicklungszweig gewechselt wird sollte immer eine Sicherung erstellt werden! Es kann zwar wieder auf eine ältere Version gewechselt werden, jedoch ist nicht sichergestellt, dass es dabei keine Probleme gibt. Gerade wenn das Datenformat in der neuen Version angepasst wurde, wird eine ältere damit Fehler produzieren."),d("br",null,null,-1),m(' Für den normalen Betrieb wird der Zweig "Release" empfohlen. Der Softwarestand wurde ausgiebig getestet, sodass ein Fehlverhalten relativ unwahrscheinlich ist.'),d("br",null,null,-1),m(' Der "Beta" Zweig beinhaltet Vorabversionen, bei denen die Entwicklung soweit abgeschlossen ist. Die enthaltenen Anpassungen wurden rudimentär getestet, können aber durchaus noch Fehler enthalten.'),d("br",null,null,-1),m(' Die aktuelle Softwareentwicklung findet im Zweig "master" statt. Die enthaltenen Anpassungen sind teilweise noch nicht getestet und enthalten potentiell Fehler.'),d("br",null,null,-1),m(' Einträge, die mit "feature" beginnen, sind experimentelle Entwicklungszweige, die nicht für den allgemeinen Gebrauch gedacht sind. ')])),_:1}),n(k,{title:"Entwicklungszweig",groups:i.branchGroups,"model-value":s.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":e[12]||(e[12]=r=>s.updateState("openWB/system/current_branch",r))},null,8,["groups","model-value"]),n(k,{modelValue:f.selectedTag,"onUpdate:modelValue":e[13]||(e[13]=r=>f.selectedTag=r),title:"Tag",options:i.branchTagOptions},null,8,["modelValue","options"])]),_:1})]))])):v("",!0)])}const oe=E(j,[["render",X],["__scopeId","data-v-059847f6"],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/System.vue"]]);export{oe as default};
