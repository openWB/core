import{a as f}from"./vendor-axios-B0SCfrz2.js";import{F as g}from"./GeneralChargeConfiguration-DPYPi5iC.js";import{_ as p,m as a,f as c,l as h,x as n,y as r,D as i}from"./vendor-BoRpwYSS.js";import"./index-BFYuTgoH.js";import"./vendor-fortawesome-CaZSeuAc.js";import"./vendor-bootstrap-C_iHcwa3.js";import"./vendor-jquery-CEMonh9Y.js";import"./vendor-sortablejs-B7wL87hN.js";import"./dynamic-import-helper-BheWnx7M.js";const w={name:"FlexibleTariffRabot",mixins:[g],data(){return{contractNumbers:[]}},computed:{contractOptions(){const t=this.contractNumbers.map(e=>({value:e,text:e}));return t.length===0&&this.flexibleTariff.configuration.contract_number&&t.push({value:this.flexibleTariff.configuration.contract_number,text:this.flexibleTariff.configuration.contract_number}),t}},methods:{rabot_login_window(){const t=window.open("about:blank","RabotLogin","width=800,height=600,status=yes,scrollbars=yes,resizable=yes");t.focus(),this.createAuthUrl().then(e=>{t.location.href=e.authorizationUrl}).catch(e=>{t.close(),console.error("Fehler beim Erstellen des Rabot-Links:",e),this.$root.postClientMessage("Fehler beim Erstellen der Rabot-Authentifizierung: "+(e.response?.data?.message||e.message),"danger")})},async createAuthUrl(){const t=await f.post("https://rabot.openwb.de/rabot-auth.php",{headers:{"Content-Type":"application/json"}});if(!t.data.success)throw new Error("Server-Fehler beim Erstellen der Rabot-Authentifizierung");return t.data},async fetch_contract_number(){if(!this.flexibleTariff.configuration.customer_number){this.$root.postClientMessage("Bitte gib zuerst eine Kundennummer ein.","warning");return}try{const t=await f.get(`https://rabot.openwb.de/rabot-proxy.php/customers/${this.flexibleTariff.configuration.customer_number}/contracts`,{headers:{"Content-Type":"application/json"}});if(t.data&&t.data.contractNumbers&&t.data.contractNumbers.length>0){const e=t.data.contractNumbers;this.contractNumbers=e;const o=e[0];this.updateConfiguration(o,"configuration.contract_number"),e.length>1?this.$root.postClientMessage(`${e.length} Verträge gefunden. Erster Vertrag ausgewählt: ${o}. Du kannst einen anderen Vertrag aus der Liste wählen.`,"success"):this.$root.postClientMessage("Vertragsnummer erfolgreich abgerufen: "+o,"success")}else this.$root.postClientMessage("Keine Verträge für diese Kundennummer gefunden.","warning")}catch(t){console.error("Fehler beim Abrufen der Vertragsnummer:",t),this.$root.postClientMessage("Fehler beim Abrufen der Vertragsnummer: "+(t.response?.data?.message||t.message),"danger")}}}},_={class:"flexible-tariff-rabot"};function x(t,e,o,C,V,s){const l=a("openwb-base-alert"),m=a("openwb-base-button-input"),b=a("openwb-base-text-input"),d=a("openwb-base-select-input");return h(),c("div",_,[n(l,{subtype:"info"},{default:r(()=>[...e[3]||(e[3]=[i(" Über die Rabot-Authentifizierung kannst Du Deine Stromtarif-Daten für die Ladeplanung nutzen. Nach der Anmeldung bei Rabot wird eine Kundennummer in der Adresszeile angezeigt, die Du hier einfügen musst. ",-1)])]),_:1}),n(l,{subtype:"warning"},{default:r(()=>[...e[4]||(e[4]=[i(" Die Rabot-Authentifizierung kann nur über einen Computer oder die openWB-Cloud (remote.openwb.de) durchgeführt werden. Das Eintragen von Kunden- und Vertragsnummer ist nicht ausreichend, da nach der Anmeldung bei Rabot noch die Zustimmung erteilt werden muss. ",-1)])]),_:1}),n(m,{title:"1. Bei Rabot anmelden","button-text":"Bei Rabot Anmelden",subtype:"success",onButtonClicked:e[0]||(e[0]=()=>s.rabot_login_window())},{help:r(()=>[...e[5]||(e[5]=[i(" Es wird ein neues Browserfenster geöffnet, in dem Du Dich bei Rabot mit Deinen Zugangsdaten anmelden kannst. ",-1)])]),_:1}),n(b,{title:"2. Kundennummer kopieren und einfügen",required:"","model-value":t.flexibleTariff.configuration.customer_number,"onUpdate:modelValue":e[1]||(e[1]=u=>t.updateConfiguration(u,"configuration.customer_number"))},{help:r(()=>[...e[6]||(e[6]=[i(" Nachdem die Rabot-Authentifizierung abgeschlossen wurde, wird im geöffneten Browserfenster eine Kundennummer angezeigt. Diese kopieren und hier einfügen. Diese wird benötigt, um auf Ihre Tarif-Daten zugreifen zu können. ",-1)])]),_:1},8,["model-value"]),n(m,{title:"3. Vertragsnummer abrufen","button-text":"Vertrag laden",subtype:"info",disabled:!t.flexibleTariff.configuration.customer_number,onButtonClicked:s.fetch_contract_number},{help:r(()=>[...e[7]||(e[7]=[i(" Mit der Kundennummer wird automatisch die zugehörige Vertragsnummer von Rabot abgerufen. ",-1)])]),_:1},8,["disabled","onButtonClicked"]),n(d,{title:"Vertragsnummer",options:s.contractOptions,"model-value":t.flexibleTariff.configuration.contract_number,"onUpdate:modelValue":e[2]||(e[2]=u=>t.updateConfiguration(u,"configuration.contract_number"))},{help:r(()=>[...e[8]||(e[8]=[i(" Wähle eine der verfügbaren Vertragsnummern aus. Diese wird für den Zugriff auf die Tarif-Daten benötigt. ",-1)])]),_:1},8,["options","model-value"])])}const N=p(w,[["render",x],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/electricity_pricing/flexible_tariffs/rabot/flexible_tariff.vue"]]);export{N as default};
