import{F as c}from"./GeneralChargeConfig-b70ae4b4.js";import{_ as g,u as s,l as _,m as h,G as r,E as T,B as d,A as x}from"./vendor-50125810.js";import"./index-81bbe772.js";import"./vendor-fortawesome-641b8eb6.js";import"./vendor-bootstrap-01761fad.js";import"./vendor-jquery-a46fe321.js";import"./vendor-axios-1a87d4ae.js";import"./vendor-sortablejs-8982fad4.js";import"./dynamic-import-helper-be004503.js";const k={name:"FlexibleTariffTibber",mixins:[c],data(){return{tibberAPI:"https://api.tibber.com/v1-beta/gql",tibberHomeList:[]}},methods:{async getTibberHomeList(){if(this.flexibleTariff.configuration.token===null)return;const i='{ "query": "{viewer {homes{id address{address1 address2 address3 postalCode city country}}}}" }';try{const e=await this.axios.post(this.tibberAPI,i,{headers:{Authorization:"Bearer "+this.flexibleTariff.configuration.token,"Content-Type":"application/json"}});this.tibberHomeList=e.data.data.viewer.homes.map(t=>{let n=t.address.address1;return t.address.address2&&(n=n+", "+t.address.address2),t.address.address3&&(n=n+", "+t.address.address3),n=n+`, ${t.address.postalCode} ${t.address.city}, ${t.address.country}`,{value:t.id,text:n}}),this.flexibleTariff.configuration.home_id||this.updateConfiguration(this.tibberHomeList[0].value,"configuration.home_id"),this.$root.postClientMessage("Home IDs erfolgreich abgerufen.","success")}catch(e){console.error(e),this.$root.postClientMessage("Beim Abfragen der Tibber API ist ein Fehler aufgetreten!<pre>"+e+"</pre>","danger")}}}},v={class:"flexible-tariff-tibber"};function w(i,e,t,n,b,u){var l;const f=s("openwb-base-alert"),a=s("openwb-base-text-input"),p=s("openwb-base-button-input"),m=s("openwb-base-select-input");return _(),h("div",v,[r(f,{subtype:"info"},{default:T(()=>[...e[3]||(e[3]=[d(" Deinen persönlichen Tibber-Token erhältst Du über die ",-1),x("a",{href:"https://developer.tibber.com/explorer",target:"_blank",rel:"noopener noreferrer"}," Tibber-Developer-Seite ",-1),d(" . Behandle Deinen Token wie ein Passwort, da sich darüber auch persönliche Daten aus Deinem Tibber-Account abfragen lassen! Die Home-ID kannst Du (wenn bekannt) in das Eingabefeld selbst eintragen oder nach Eingabe Deines Token durch Klick auf den Button von der openWB ermitteln lassen. Unerlaubte Zeichen werden aus dem Token und der Home-ID automatisch gelöscht. ",-1)])]),_:1}),r(a,{ref:"tokenInput",title:"Token",required:"","model-value":i.flexibleTariff.configuration.token,"onUpdate:modelValue":e[0]||(e[0]=o=>i.updateConfiguration(o,"configuration.token"))},null,8,["model-value"]),r(p,{title:"Home-IDs abrufen","button-text":"Jetzt abrufen",subtype:"success",disabled:!((l=i.flexibleTariff.configuration.token)!=null&&l.length),onButtonClicked:u.getTibberHomeList},null,8,["disabled","onButtonClicked"]),r(m,{title:"Verfügbare Home-IDs",options:b.tibberHomeList,"model-value":i.flexibleTariff.configuration.home_id,"onUpdate:modelValue":e[1]||(e[1]=o=>i.updateConfiguration(o,"configuration.home_id"))},null,8,["options","model-value"]),r(a,{title:"Home-ID",required:"","model-value":i.flexibleTariff.configuration.home_id,"onUpdate:modelValue":e[2]||(e[2]=o=>i.updateConfiguration(o,"configuration.home_id"))},null,8,["model-value"])])}const L=g(k,[["render",w],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/electricity_pricing/flexible_tariffs/tibber/flexible_tariff.vue"]]);export{L as default};
