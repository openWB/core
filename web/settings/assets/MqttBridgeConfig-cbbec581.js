import{l as F,d as $,ab as j,F as O}from"./vendor-fortawesome-641b8eb6.js";import{C as R}from"./index-bbf7119b.js";import{_ as G,u as r,l as b,m as c,G as o,E as l,A as v,N as Z,B as u,F as H,x as L,z as y,M as J}from"./vendor-50125810.js";import"./vendor-bootstrap-01761fad.js";import"./vendor-jquery-a46fe321.js";import"./vendor-axios-1a87d4ae.js";import"./vendor-sortablejs-8982fad4.js";F.add($,j);const X={name:"OpenwbMqttBridgeConfigurationView",components:{FontAwesomeIcon:O},mixins:[R],emits:["sendCommand","save","reset"],data(){return{mqttTopicsToSubscribe:["openWB/general/extern","openWB/system/mqtt/bridge/+"],showMqttBridgeModal:!1,modalMqttBridgeIndex:void 0}},computed:{configuredMqttBridges:{get(){var h;const t=this.getWildcardTopics("openWB/system/mqtt/bridge/+");if(!t||typeof t!="object")return{};const n={...t};for(const[k,d]of Object.entries(n))(h=d==null?void 0:d.remote)!=null&&h.is_openwb_cloud&&delete n[k];return n}}},methods:{addMqttBridge(t){t.stopPropagation(),this.$emit("sendCommand",{command:"addMqttBridge",data:{}})},getMqttBridgeIndex(t){return parseInt(t.match(/(?:\/)(\d+)$/)[1])},removeMqttBridgeModal(t,n){n.stopPropagation(),this.modalMqttBridgeIndex=this.getMqttBridgeIndex(t),this.showMqttBridgeModal=!0},removeMqttBridge(t,n){this.showMqttBridgeModal=!1,n=="confirm"&&this.$emit("sendCommand",{command:"removeMqttBridge",data:{bridge:t}})},getMqttBridgeName(t){return this.$store.state.mqtt["openWB/system/mqtt/bridge/"+t]?this.$store.state.mqtt["openWB/system/mqtt/bridge/"+t].name:t}}},Y={class:"mqttBridgeConfiguration"},K={key:0},B={key:1},q=["name"];function ee(t,n,h,k,d,i){const I=r("openwb-base-modal-dialog"),w=r("openwb-base-alert"),g=r("font-awesome-icon"),V=r("openwb-base-avatar"),m=r("openwb-base-text-input"),p=r("openwb-base-button-group-input"),M=r("openwb-base-heading"),N=r("openwb-base-number-input"),P=r("openwb-base-submit-buttons"),_=r("openwb-base-card");return b(),c(Z,null,[o(I,{show:d.showMqttBridgeModal,title:"MQTT-Brücke löschen",subtype:"danger",buttons:[{text:"Löschen",event:"confirm",subtype:"danger"}],onModalResult:n[0]||(n[0]=e=>i.removeMqttBridge(d.modalMqttBridgeIndex,e))},{default:l(()=>[u(' Willst Du die MQTT-Brücke "'+H(i.getMqttBridgeName(d.modalMqttBridgeIndex))+'" wirklich entfernen? Dieser Vorgang kann nicht rückgängig gemacht werden! ',1)]),_:1},8,["show"]),v("div",Y,[o(w,{subtype:"danger"},{default:l(()=>[...n[1]||(n[1]=[u(" ACHTUNG: Die Konfiguration einer MQTT-Brücke erlaubt allen Nutzern mit Zugang zum entfernten MQTT-Server alle weitergeleiteten Daten dieser openWB einzusehen!",-1),v("br",null,null,-1),u(' Es wird dringend empfohlen, dies nur für nicht-öffentliche MQTT-Server unter Verwendung starker Transport-Verschlüsselung (TLS) mit persönlichem Login und strenger Zugriffskontrolle (zumindest für die MQTT-Themen unterhalb von "Entfernter Präfix") zu aktivieren! ',-1)])]),_:1}),o(_,{title:"Konfigurierte MQTT-Brücken"},{actions:l(()=>[t.$store.state.mqtt["openWB/general/extern"]===!1?(b(),L(V,{key:0,class:"bg-success clickable",onClick:i.addMqttBridge},{default:l(()=>[o(g,{icon:["fas","plus"]})]),_:1},8,["onClick"])):y("",!0)]),default:l(()=>[t.$store.state.mqtt["openWB/general/extern"]===!0?(b(),c("div",K,[o(w,{subtype:"info"},{default:l(()=>[...n[2]||(n[2]=[u(' Diese Einstellungen sind nicht verfügbar, solange sich diese openWB im Steuerungsmodus "secondary" befindet. ',-1)])]),_:1})])):(b(),c("div",B,[Object.keys(i.configuredMqttBridges).length===0?(b(),L(w,{key:0,subtype:"info"},{default:l(()=>[...n[3]||(n[3]=[u(" Es wurde noch keine MQTT-Brücke konfiguriert. ",-1)])]),_:1})):y("",!0),(b(!0),c(Z,null,J(i.configuredMqttBridges,(e,s)=>(b(),c("form",{key:s,name:"mqttBridgeConfigurationForm"+i.getMqttBridgeIndex(s)},[o(_,{title:e==null?void 0:e.name,collapsible:!0,collapsed:!0,subtype:"primary"},{actions:l(()=>[o(V,{class:"bg-danger clickable",onClick:f=>i.removeMqttBridgeModal(s,f)},{default:l(()=>[o(g,{icon:["fas","trash"]})]),_:1},8,["onClick"])]),footer:l(()=>[o(P,{"form-name":"mqttBridgeConfigurationForm"+i.getMqttBridgeIndex(s),"hide-defaults":!0,onSave:f=>t.$emit("save",[s]),onReset:f=>t.$emit("reset",[s])},null,8,["form-name","onSave","onReset"])]),default:l(()=>{var f,T,S,U,x,z,D,A,C,W,E,Q;return[o(m,{title:"Bezeichnung",subtype:"text",required:"",pattern:"[A-Za-z0-9]+","model-value":e==null?void 0:e.name,"onUpdate:modelValue":a=>t.updateState(s,a,"name")},{help:l(()=>[...n[4]||(n[4]=[u(" Die Bezeichnung darf nur aus Buchstaben ohne Umlaute und Zahlen bestehen. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),o(p,{title:"Brücke aktivieren",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}],"model-value":e==null?void 0:e.active,"onUpdate:modelValue":a=>t.updateState(s,a,"active")},null,8,["model-value","onUpdate:modelValue"]),n[14]||(n[14]=v("hr",null,null,-1)),o(M,null,{default:l(()=>[...n[5]||(n[5]=[u(" Einstellungen zur Verbindung ",-1)])]),_:1}),o(m,{title:"Entfernter Server",subtype:"host",required:"","model-value":(f=e==null?void 0:e.remote)==null?void 0:f.host,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.host")},null,8,["model-value","onUpdate:modelValue"]),o(N,{title:"Entfernter Port",required:"",min:1,max:65535,"model-value":(T=e==null?void 0:e.remote)==null?void 0:T.port,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.port")},null,8,["model-value","onUpdate:modelValue"]),o(m,{title:"Benutzername",subtype:"user",required:"",pattern:"[a-zA-Z0-9_\\-+.]+","model-value":(S=e==null?void 0:e.remote)==null?void 0:S.username,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.username")},null,8,["model-value","onUpdate:modelValue"]),o(m,{title:"Passwort",subtype:"password",required:"","model-value":(U=e==null?void 0:e.remote)==null?void 0:U.password,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.password")},null,8,["model-value","onUpdate:modelValue"]),o(m,{title:"Präfix",subtype:"text",pattern:"[A-Za-z0-9_\\-]+(\\/[A-Za-z0-9_\\-]+)?\\/","model-value":(x=e==null?void 0:e.remote)==null?void 0:x.prefix,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.prefix")},{help:l(()=>[...n[6]||(n[6]=[u(' Das Präfix darf nur aus Buchstaben ohne Umlaute, Zahlen, Binde- und Unterstrichen bestehen. Optional kann mit einem Schrägstrich "/" eine Topic-Struktur abgebildet werden. Am Ende des Präfixes muss ein Schrägstrich "/" stehen. ',-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),o(m,{title:"Client ID",subtype:"text",required:"",pattern:"[A-Za-z0-9_\\-]+","model-value":(z=e==null?void 0:e.remote)==null?void 0:z.client_id,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.client_id")},{help:l(()=>[...n[7]||(n[7]=[u(" Die Client ID darf nur aus Buchstaben ohne Umlaute, Zahlen, Binde- und Unterstrichen bestehen. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),o(p,{title:"MQTT Protokoll",required:"required",buttons:[{buttonValue:"mqttv31",text:"v3.1"},{buttonValue:"mqttv311",text:"v3.1.1"}],"model-value":(D=e==null?void 0:e.remote)==null?void 0:D.protocol,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.protocol")},null,8,["model-value","onUpdate:modelValue"]),o(p,{title:"TLS Version",buttons:[{buttonValue:"auto",text:"Automatisch",class:"btn-outline-success"},{buttonValue:"tlsv1.0",text:"v1.0",class:"btn-outline-warning"},{buttonValue:"tlsv1.1",text:"v1.1",class:"btn-outline-warning"},{buttonValue:"tlsv1.2",text:"v1.2"}],"model-value":(A=e==null?void 0:e.remote)==null?void 0:A.tls_version,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.tls_version")},{help:l(()=>[...n[8]||(n[8]=[u(' In der Einstellung "Automatisch" wird die Version zwischen Client und Server ausgehandelt. Wenn erforderlich, kann eine spezielle Version erzwungen werden. Versionen kleiner 1.2 gelten als veraltet und sollten nicht mehr verwendet werden. ',-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),o(p,{title:"Brücke signalisieren",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":(C=e==null?void 0:e.remote)==null?void 0:C.try_private,"onUpdate:modelValue":a=>t.updateState(s,a,"remote.try_private")},{help:l(()=>[...n[9]||(n[9]=[u(" Aktiviert eine proprietäre Protokoll-Erweiterung des Mosquitto Brokers, welche dem entfernten Broker signalisiert, dass es sich um eine MQTT Brücke handelt. Ergibt bessere Leistung mit Mosquitto-Brokern, ist jedoch inkompatibel mit vielen anderen MQTT-Brokern. Daher bitte nur aktivieren, wenn der Ziel-Broker sicher ein Mosquitto-Broker ist. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),n[15]||(n[15]=v("hr",null,null,-1)),o(M,null,{default:l(()=>[...n[10]||(n[10]=[u(" Datenübertragung ",-1)])]),_:1}),o(p,{title:"Alle Statusdaten",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":(W=e==null?void 0:e.data_transfer)==null?void 0:W.status,"onUpdate:modelValue":a=>t.updateState(s,a,"data_transfer.status")},{help:l(()=>[...n[11]||(n[11]=[u(" Wenn aktiviert, werden alle Statusdaten (z.B. Ladezustand, Leistung, Spannungen, Ströme, etc.) der angeschlossenen Komponenten und Ladepunkte übertragen. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),o(p,{title:"Datenserien für Diagramme",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":(E=e==null?void 0:e.data_transfer)==null?void 0:E.graph,"onUpdate:modelValue":a=>t.updateState(s,a,"data_transfer.graph")},{help:l(()=>[...n[12]||(n[12]=[u(" Wenn aktiviert, werden alle Datenserien für die Diagramme (z.B. Leistung über Zeit) der angeschlossenen Komponenten und Ladepunkte übertragen. Dies sind deutlich mehr Daten als bei den Statusdaten allein.",-1),v("br",null,null,-1),u(" Diese Einstellung sollte nur aktiviert werden, wenn die Daten auch tatsächlich benötigt und interpretiert werden können. In der Regel werden die Daten nur für die Web- und Display-Themes benötigt und können daher bei einer MQTT-Brücke deaktiviert bleiben. ",-1)])]),_:1},8,["model-value","onUpdate:modelValue"]),o(p,{title:"Fernkonfiguration ermöglichen",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],"model-value":(Q=e==null?void 0:e.data_transfer)==null?void 0:Q.configuration,"onUpdate:modelValue":a=>t.updateState(s,a,"data_transfer.configuration")},{help:l(()=>[...n[13]||(n[13]=[u(' Wenn aktiviert, können über die MQTT-Brücke auch Konfigurationsänderungen (z.B. Ladeleistung, Zeitsteuerungen, etc.) an die openWB über die Topics "openWB/set/*" gesendet werden. Dies sollte nur aktiviert werden, wenn der entfernte MQTT-Server und alle Nutzer, welche darauf Zugriff haben, absolut vertrauenswürdig sind. Ansonsten besteht die Gefahr, dass unbefugte Nutzer die Konfiguration der openWB verändern und z.B. den Ladevorgang manipulieren. ',-1)])]),_:1},8,["model-value","onUpdate:modelValue"])]}),_:2},1032,["title"])],8,q))),128))]))]),_:1})])],64)}const re=G(X,[["render",ee],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/MqttBridgeConfig.vue"]]);export{re as default};
