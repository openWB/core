import{C as V}from"./index-c516534d.js";import{_ as W,p as c,l as i,z as m,A as n,L as t,q as p,y as g,a2 as k,G as D,k as s,u as o,n as h}from"./vendor-93bd3532.js";import"./vendor-fortawesome-221885f6.js";import"./vendor-bootstrap-9ea1ec57.js";import"./vendor-jquery-15a435dc.js";import"./vendor-axios-51187820.js";import"./vendor-sortablejs-b80cade1.js";const Z={name:"OpenwbCloudConfig",mixins:[V],emits:["sendCommand"],data(){return{mqttTopicsToSubscribe:["openWB/general/extern","openWB/system/dataprotection_acknowledged","openWB/system/mqtt/bridge/+"],enableNewCloudButton:!0,newCloudData:{email:"",username:"",partner:!1},enableCloudConnectButton:!0,connectCloudData:{username:"",password:"",partner:!1},enableRemoveCloudButton:!0,showCloudRemoveModal:!1}},computed:{cloudBridge:{get(){let d=this.getWildcardTopics("openWB/system/mqtt/bridge/+");for(const[e,w]of Object.entries(d))w.remote.is_openwb_cloud||delete d[e];return d}},cloudBridgeKey:{get(){for(const[d,e]of Object.entries(this.cloudBridge))if(e.remote.is_openwb_cloud)return d}}},methods:{getCloudCredentials(){return{username:this.cloudBridge[this.cloudBridgeKey].remote.username,password:this.cloudBridge[this.cloudBridgeKey].remote.password}},getMqttBridgeIndex(d){return parseInt(d.match(/(?:\/)(\d+)$/)[1])},createCloud(){document.forms.cloudConfigCreateForm.reportValidity()&&(this.$emit("sendCommand",{command:"initCloud",data:this.newCloudData}),this.enableNewCloudButton=!1)},connectCloud(){document.forms.cloudConfigConnectForm.reportValidity()&&(this.$emit("sendCommand",{command:"connectCloud",data:this.connectCloudData}),this.enableCloudConnectButton=!1)},removeCloudModal(d){d.stopPropagation(),this.showCloudRemoveModal=!0},removeCloud(d){this.showCloudRemoveModal=!1,d=="confirm"&&(console.info("request removal of cloud"),this.$emit("sendCommand",{command:"removeMqttBridge",data:{bridge:this.getMqttBridgeIndex(this.cloudBridgeKey)}}))}}},q={class:"cloud-config"},S={key:1},z={key:1,name:"cloudConfigCreateForm"},M=p("a",{href:"mailto:support@openwb.de",subject:"Cloud Zugangsdaten"}," support@openwb.de ",-1),x={key:0},N={key:1},P={class:"row justify-content-center"},R={key:2,name:"cloudConfigConnectForm"},T={key:0},U={key:1},A={class:"row justify-content-center"},F={key:3,name:"cloudConfigured"},K=p("span",null,[o(" Mit diesen Zugangsdaten können Sie sich in der "),p("a",{href:"https://web.openwb.de/"},"openWB Cloud "),o(" anmelden. ")],-1),j={class:"row justify-content-center"};function O(d,e,w,E,u,r){const y=c("openwb-base-modal-dialog"),a=c("openwb-base-alert"),B=c("router-link"),b=c("openwb-base-text-input"),_=c("openwb-base-button-group-input"),f=c("openwb-base-click-button"),C=c("openwb-base-card"),v=c("openwb-base-heading");return s(),i(D,null,[m(" modal dialogs "),n(y,{show:u.showCloudRemoveModal,title:"Cloud Zugang löschen",subtype:"danger",buttons:[{text:"Löschen",event:"confirm",subtype:"danger"}],onModalResult:e[0]||(e[0]=l=>r.removeCloud(l))},{default:t(()=>[o(" Wollen Sie den vorhandenen Cloud Zugang wirklich entfernen? Dieser Vorgang kann nicht rückgängig gemacht werden! ")]),_:1},8,["show"]),m(" main content "),p("div",q,[n(a,{subtype:"danger"},{default:t(()=>[o(" Für diese Version gibt es noch keine Weboberfläche in der Cloud! Wenn der Zugang eingerichtet wurde, können z. B. Daten mit einem MQTT-Client von dem MQTT-Broker web.openwb.de abgerufen werden. Ebenfalls kann ein Support-Tunnel aufgebaut werden. Weitere Funktionen sind in der Entwicklung. ")]),_:1}),d.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]!==!0?(s(),g(a,{key:0,subtype:"danger"},{default:t(()=>[o(" Sie müssen der "),n(B,{to:"/System/DataProtection"},{default:t(()=>[o(" Datenschutzerklärung ")]),_:1}),o(" zustimmen, um die openWB Cloud nutzen zu können. ")]),_:1})):(s(),i("div",S,[n(a,{subtype:"success"},{default:t(()=>[o(" Sie haben der "),n(B,{to:"/System/DataProtection"},{default:t(()=>[o(" Datenschutzerklärung ")]),_:1}),o(" zugestimmt und können die openWB Cloud nutzen. ")]),_:1}),u.enableRemoveCloudButton?m("v-if",!0):(s(),g(a,{key:0,subtype:"warning"},{default:t(()=>[o(" Der Zugang wurde entfernt. Bitte starten Sie die openWB neu, um die Änderungen anzuwenden! ")]),_:1})),r.cloudBridgeKey?m("v-if",!0):(s(),i("form",z,[n(C,{title:"Neuen Zugang erstellen"},k({default:t(()=>[n(a,{subtype:"warning"},{default:t(()=>[o(" Derzeit können keine neuen Zugänge für die openWB Cloud angelegt werden. Bitte nutzen Sie die in/an der openWB notierten Zugangsdaten im unteren Bereich dieser Seite. Wenn bei einer gekauften openWB keine Zugangsdaten vorhanden sind, schreiben Sie bitte eine Mail unter Angabe der Bestell- und/oder Seriennummer an "),M,o(" . ")]),_:1}),d.$store.state.mqtt["openWB/general/extern"]===!0?(s(),i("div",x,[n(a,{subtype:"info"},{default:t(()=>[o(' Diese openWB befindet sich im Modus "Nur Ladepunkt". Bitte richten Sie die openWB Cloud auf der regelnden openWB ein. ')]),_:1})])):(s(),i("div",N,[n(b,{title:"Benutzername",required:"",subtype:"user",pattern:"[a-zA-Z]+",modelValue:u.newCloudData.username,"onUpdate:modelValue":e[1]||(e[1]=l=>u.newCloudData.username=l),disabled:""},null,8,["modelValue"]),n(b,{title:"E-Mail",required:"",subtype:"email",modelValue:u.newCloudData.email,"onUpdate:modelValue":e[2]||(e[2]=l=>u.newCloudData.email=l),disabled:""},null,8,["modelValue"]),n(_,{disabled:"",title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],modelValue:u.newCloudData.partner,"onUpdate:modelValue":e[3]||(e[3]=l=>u.newCloudData.partner=l)},{help:t(()=>[o(" Wenn diese OpenWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")]),_:1},8,["modelValue"])]))]),_:2},[d.$store.state.mqtt["openWB/general/extern"]===!1&&d.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[p("div",P,[m(` <openwb-base-click-button
								class="col-4"
								:class="
									enableNewCloudButton
										? 'btn-success'
										: 'btn-outline-success'
								"
								:disabled="!enableNewCloudButton"
								@buttonClicked="createCloud"
							>
								Zugang erstellen
							</openwb-base-click-button> `),n(f,{class:"col-4 btn-outline-success",disabled:""},{default:t(()=>[o(" Zugang erstellen ")]),_:1})])]),key:"0"}:void 0]),1024),u.enableNewCloudButton?m("v-if",!0):(s(),g(a,{key:0,subtype:"info",class:"mb-2"},{default:t(()=>[o(" Der neue Zugang wird eingerichtet. Dieser Vorgang kann bis zu einer Minute dauern. Bitte warten. ")]),_:1}))])),r.cloudBridgeKey?m("v-if",!0):(s(),i("form",R,[n(C,{title:"Vorhandenen Zugang einrichten"},k({default:t(()=>[d.$store.state.mqtt["openWB/general/extern"]===!0?(s(),i("div",T,[n(a,{subtype:"info"},{default:t(()=>[o(' Diese openWB befindet sich im Modus "Nur Ladepunkt". Bitte richten Sie die openWB Cloud auf der regelnden openWB ein. ')]),_:1})])):(s(),i("div",U,[n(b,{title:"Benutzername",required:"",subtype:"user",modelValue:u.connectCloudData.username,"onUpdate:modelValue":e[4]||(e[4]=l=>u.connectCloudData.username=l)},null,8,["modelValue"]),n(b,{title:"Passwort",required:"",subtype:"password",modelValue:u.connectCloudData.password,"onUpdate:modelValue":e[5]||(e[5]=l=>u.connectCloudData.password=l)},null,8,["modelValue"]),n(_,{title:"Zugang für Partner",buttons:[{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],modelValue:u.connectCloudData.partner,"onUpdate:modelValue":e[6]||(e[6]=l=>u.connectCloudData.partner=l)},{help:t(()=>[o(" Wenn diese OpenWB über einen Partner erworben wurde, kann hier ein Support-Zugang für diesen freigegeben werden. ")]),_:1},8,["modelValue"])]))]),_:2},[d.$store.state.mqtt["openWB/general/extern"]===!1&&d.$store.state.mqtt["openWB/system/dataprotection_acknowledged"]===!0?{name:"footer",fn:t(()=>[p("div",A,[n(f,{class:h(["col-4",u.enableCloudConnectButton?"btn-success":"btn-outline-success"]),disabled:!u.enableCloudConnectButton,onButtonClicked:r.connectCloud},{default:t(()=>[o(" Mit Cloud verbinden ")]),_:1},8,["class","disabled","onButtonClicked"])])]),key:"0"}:void 0]),1024)])),r.cloudBridgeKey?(s(),i("form",F,[!u.enableCloudConnectButton||!u.enableNewCloudButton?(s(),g(a,{key:0,subtype:"warning"},{default:t(()=>[o(" Der Zugang wurde eingerichtet. Bitte starten Sie die openWB neu, um die Änderungen anzuwenden! ")]),_:1})):m("v-if",!0),n(C,{title:"Vorhandener Cloud Zugang"},{footer:t(()=>[p("div",j,[n(f,{class:h(["col-4",u.enableRemoveCloudButton?"btn-danger":"btn-outline-danger"]),disabled:!u.enableRemoveCloudButton,onButtonClicked:e[9]||(e[9]=l=>r.removeCloudModal(l))},{default:t(()=>[o(" Zugang löschen ")]),_:1},8,["class","disabled"])])]),default:t(()=>[n(v,null,{default:t(()=>[K]),_:1}),n(b,{title:"Benutzername",required:"",subtype:"user",modelValue:r.getCloudCredentials().username,"onUpdate:modelValue":e[7]||(e[7]=l=>r.getCloudCredentials().username=l),disabled:""},null,8,["modelValue"]),n(b,{title:"Passwort",required:"",subtype:"password",modelValue:r.getCloudCredentials().password,"onUpdate:modelValue":e[8]||(e[8]=l=>r.getCloudCredentials().password=l),disabled:""},null,8,["modelValue"])]),_:1})])):m("v-if",!0)]))])],64)}const Y=W(Z,[["render",O],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/CloudConfig.vue"]]);export{Y as default};
