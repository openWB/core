import{l as A,Y as $,p as T,Z as z,O as E,_ as U,$ as j,a0 as O,a1 as L,a2 as I,F as R}from"./vendor-fortawesome-93b6b065.js";import{_ as N,C as P}from"./index-446020d3.js";import{_ as Z}from"./dynamic-import-helper-be004503.js";import{_ as W,p as u,k as f,l as w,A as t,L as o,u as i,x as v,q as s,a0 as M,y as F,a1 as H,z as S,n as k,G,I as J,Q as K,R as Q}from"./vendor-c3d409a1.js";import"./vendor-bootstrap-3e797bc8.js";import"./vendor-jquery-bf9f7728.js";import"./vendor-axios-2a1f2fc8.js";import"./vendor-sortablejs-b84c9f86.js";const Y={name:"BackupCloudConfigFallback",emits:["update:configuration"],props:{configuration:{type:Object,required:!0},backupCloudType:String},methods:{updateConfiguration(n,e=void 0){this.$emit("update:configuration",{value:n,object:e})}}},X={class:"backup-cloud-fallback"};function ee(n,e,r,g,m,l){const h=u("openwb-base-alert"),d=u("openwb-base-textarea");return f(),w("div",X,[t(h,{subtype:"warning"},{default:o(()=>[i(' Es wurde keine Konfigurationsseite für die Backup-Cloud "'+v(r.backupCloudType)+'" gefunden. Die Einstellungen können als JSON direkt bearbeitet werden. ',1)]),_:1}),t(d,{title:"Konfiguration",subtype:"json","model-value":r.configuration,"onUpdate:modelValue":e[0]||(e[0]=y=>l.updateConfiguration(y,"configuration"))},{help:o(()=>[i(" Bitte prüfen Sie, ob die Eingaben richtig interpretiert werden. ")]),_:1},8,["model-value"]),t(h,{subtype:"info"},{default:o(()=>[s("pre",null,v(JSON.stringify(r.configuration,void 0,2)),1)]),_:1})])}const te=W(Y,[["render",ee],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/backup_clouds/OpenwbBackupCloudConfigFallback.vue"]]),ne={name:"OpenwbBackupCloudProxy",emits:["update:configuration"],props:{backupCloudType:{type:String,required:!0},configuration:{type:Object,required:!0}},computed:{myComponent(){return console.debug(`loading backup cloud: ${this.backupCloudType}`),M({loader:()=>Z(Object.assign({"./nextcloud/backup_cloud.vue":()=>N(()=>import("./backup_cloud-00824e49.js"),["assets/backup_cloud-00824e49.js","assets/vendor-c3d409a1.js","assets/vendor-sortablejs-b84c9f86.js","assets/vendor-7b9e30aa.css"])}),`./${this.backupCloudType}/backup_cloud.vue`),errorComponent:te})}},methods:{updateConfiguration(n){this.$emit("update:configuration",n)}}};function se(n,e,r,g,m,l){return f(),F(H(l.myComponent),{configuration:r.configuration,backupCloudType:r.backupCloudType,"onUpdate:configuration":e[0]||(e[0]=h=>l.updateConfiguration(h))},null,40,["configuration","backupCloudType"])}const oe=W(ne,[["render",se],["__file","/opt/openWB-dev/openwb-ui-settings/src/components/backup_clouds/OpenwbBackupCloudProxy.vue"]]);A.add($,T,z,E,U,j,O,L,I);const ae={name:"OpenwbSystem",mixins:[P],emits:["sendCommand"],components:{FontAwesomeIcon:R,OpenwbBackupCloudProxy:oe},data(){return{mqttTopicsToSubscribe:["openWB/system/configurable/backup_clouds","openWB/system/current_commit","openWB/system/current_branch_commit","openWB/system/current_missing_commits","openWB/system/available_branches","openWB/system/current_branch","openWB/system/backup_cloud/config"],warningAcknowledged:!1,selectedTag:"*HEAD*",selectedFile:void 0,restoreUploadDone:!1}},computed:{backupCloudList:{get(){return this.$store.state.mqtt["openWB/system/configurable/backup_clouds"]}},updateAvailable(){return this.$store.state.mqtt["openWB/system/current_branch_commit"]&&this.$store.state.mqtt["openWB/system/current_branch_commit"]!=this.$store.state.mqtt["openWB/system/current_commit"]},releaseChangeValid(){return this.$store.state.mqtt["openWB/system/current_branch"]in this.$store.state.mqtt["openWB/system/available_branches"]&&"tags"in this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]]&&(this.selectedTag in this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]].tags||this.selectedTag=="*HEAD*")}},methods:{getBackupCloudDefaultConfiguration(n){const e=this.backupCloudList.find(r=>r.value==n);return Object.prototype.hasOwnProperty.call(e,"defaults")?{...e.defaults}:(console.warn("no default configuration found for backup cloud type!",n),{})},sendSystemCommand(n,e={}){this.$emit("sendCommand",{command:n,data:e})},getBranchOptions(){var n=this.$store.state.mqtt["openWB/system/available_branches"],e=[];if(n!==void 0)for(const[r,g]of Object.entries(n))e.push({value:r,text:r+" ("+g.commit+")"});return e},getBranchTagOptions(){if(!(this.$store.state.mqtt["openWB/system/current_branch"]in this.$store.state.mqtt["openWB/system/available_branches"]))return[];var n=this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]].tags,e=[];if(n!==void 0)for(const[r,g]of Object.entries(n))e.unshift({value:r,text:g});return e.unshift({value:"*HEAD*",text:"Aktuellster Stand"}),e},updateConfiguration(n,e){console.debug("updateConfiguration",n,e),this.updateState(n,e.value,e.object)},updateSelectedBackupCloud(n){this.updateState("openWB/system/backup_cloud/config",n,"type"),this.updateState("openWB/system/backup_cloud/config",this.getBackupCloudDefaultConfiguration(n))},updateSelectedFile(n){this.selectedFile=n.target.files[0],console.log("selectedFile",this.selectedFile)},uploadFile(){if(this.selectedFile!==void 0){let n=new FormData;n.append("backupFile",this.selectedFile),this.axios.post(location.protocol+"//"+location.host+"/openWB/web/settings/uploadBackup.php",n,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log("POST response",e.data);const r="Die Sicherungsdatei wurde erfolgreich hochgeladen. Sie können die Wiederherstellung jetzt starten.";this.$root.postClientMessage(r,"success"),this.restoreUploadDone=!0}).catch(e=>{var r="Hochladen der Datei fehlgeschlagen!<br />";e.response?(console.log(e.response.status,e.response.data),r+=e.response.status+": "+e.response.data):e.request?(console.log(e.request),r+="Es wurde keine Antwort vom Server empfangen."):(console.log("Error",e.message),r+="Es ist ein unbekannter Fehler aufgetreten."),this.$root.postClientMessage(r,"danger"),this.restoreUploadDone=!1})}else console.error("no file selected for upload")},systemUpdate(){this.sendSystemCommand("systemUpdate",{}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})},switchBranch(){this.sendSystemCommand("systemUpdate",{branch:this.$store.state.mqtt["openWB/system/current_branch"],tag:this.selectedTag}),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})},restoreBackup(){this.sendSystemCommand("restoreBackup"),this.$store.commit("storeLocal",{name:"reloadRequired",value:!0})}}},p=n=>(K("data-v-059847f6"),n=n(),Q(),n),ie={class:"system"},le=p(()=>s("h2",null,"Achtung!",-1)),re=p(()=>s("p",null," Vor allen Aktionen auf dieser Seite ist sicherzustellen, dass kein Ladevorgang aktiv ist! Zur Sicherheit bitte zusätzlich alle Fahrzeuge von der Ladestation / den Ladestationen abstecken! ",-1)),ue={key:0},de={name:"versionInfoForm"},ce={class:"missing-commits"},pe={class:"row justify-content-center"},me={class:"col-md-4 d-flex py-1 justify-content-center"},be={class:"col-md-4 d-flex py-1 justify-content-center"},fe={name:"backupForm"},ge=p(()=>s("a",{href:"/openWB/data/backup/",target:"_blank"},"hier",-1)),he={class:"row justify-content-center"},_e={class:"col-md-4 d-flex py-1 justify-content-center"},we=p(()=>s("hr",null,null,-1)),ye={name:"restoreForm"},ke=p(()=>s("br",null,null,-1)),ve={class:"input-group"},Be={class:"input-group-prepend"},Ce={class:"input-group-text"},Se={class:"custom-file"},We={id:"input-file-label",class:"custom-file-label",for:"input-file","data-browse":"Suchen"},Fe={class:"input-group-append"},De=["disabled"],qe={class:"row justify-content-center"},xe={class:"col-md-4 d-flex py-1 justify-content-center"},Ve=p(()=>s("hr",null,null,-1)),Ae={name:"cloudBackupForm"},$e=p(()=>s("br",null,null,-1)),Te=p(()=>s("a",{href:"https://github.com/openWB/core/wiki/Cloud-Sicherung",target:"_blank",rel:"noopener noreferrer"}," hier ",-1)),ze={key:0},Ee={name:"powerForm"},Ue={class:"row justify-content-center"},je={class:"col-md-4 d-flex py-1 justify-content-center"},Oe={class:"col-md-4 d-flex py-1 justify-content-center"},Le={name:"releaseChangeForm"},Ie=p(()=>s("br",null,null,-1)),Re=p(()=>s("br",null,null,-1)),Ne=p(()=>s("br",null,null,-1)),Pe=p(()=>s("br",null,null,-1)),Ze={class:"row justify-content-center"},Me={class:"col-md-4 d-flex py-1 justify-content-center"},He={name:"resetForm"},Ge={class:"row justify-content-center"},Je={class:"col-md-4 d-flex py-1 justify-content-center"};function Ke(n,e,r,g,m,l){const h=u("openwb-base-button-group-input"),d=u("openwb-base-alert"),y=u("openwb-base-text-input"),_=u("openwb-base-card"),c=u("font-awesome-icon"),b=u("openwb-base-click-button"),B=u("openwb-base-heading"),C=u("openwb-base-select-input"),D=u("openwb-base-button-input"),q=u("openwb-backup-cloud-proxy"),x=u("openwb-base-submit-buttons");return f(),w("div",ie,[t(d,{subtype:"danger"},{default:o(()=>[le,re,t(h,{title:"Ich habe die Warnung verstanden",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}],modelValue:this.warningAcknowledged,"onUpdate:modelValue":e[0]||(e[0]=a=>this.warningAcknowledged=a)},null,8,["modelValue"])]),_:1}),m.warningAcknowledged?(f(),w("div",ue,[s("form",de,[t(_,{title:"Versions-Informationen / Aktualisierung",subtype:"success",collapsible:!0,collapsed:!0},{footer:o(()=>[s("div",pe,[s("div",me,[t(b,{class:"btn-info",onButtonClicked:e[4]||(e[4]=a=>l.sendSystemCommand("systemFetchVersions"))},{default:o(()=>[i(" Informationen aktualisieren "),t(c,{"fixed-width":"",icon:["fas","download"]})]),_:1})]),s("div",be,[t(b,{class:k(l.updateAvailable?"btn-success clickable":"btn-outline-success"),disabled:!l.updateAvailable,onButtonClicked:e[5]||(e[5]=a=>l.systemUpdate())},{default:o(()=>[i(" Update "),t(c,{"fixed-width":"",icon:["fas","arrow-alt-circle-up"]})]),_:1},8,["class","disabled"])])])]),default:o(()=>[t(y,{title:"Entwicklungszweig",readonly:"",modelValue:n.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":e[1]||(e[1]=a=>n.$store.state.mqtt["openWB/system/current_branch"]=a)},null,8,["modelValue"]),t(y,{title:"installierte Version",readonly:"",class:k(l.updateAvailable?"text-danger":"text-success"),modelValue:n.$store.state.mqtt["openWB/system/current_commit"],"onUpdate:modelValue":e[2]||(e[2]=a=>n.$store.state.mqtt["openWB/system/current_commit"]=a)},null,8,["class","modelValue"]),t(y,{title:"aktuellste Version",readonly:"",modelValue:n.$store.state.mqtt["openWB/system/current_branch_commit"],"onUpdate:modelValue":e[3]||(e[3]=a=>n.$store.state.mqtt["openWB/system/current_branch_commit"]=a)},null,8,["modelValue"]),l.updateAvailable?(f(),F(_,{key:0,title:"Änderungen",subtype:"info",collapsible:!0,collapsed:!0},{default:o(()=>[s("ul",ce,[(f(!0),w(G,null,J(n.$store.state.mqtt["openWB/system/current_missing_commits"],(a,V)=>(f(),w("li",{key:V},v(a),1))),128))])]),_:1})):S("v-if",!0),t(d,{subtype:"danger"},{default:o(()=>[i(" Nach einem Update wird die Ladestation direkt neu gestartet! Es werden alle eventuell vorhandenen lokalen Änderungen am Programmcode mit dem Update verworfen! ")]),_:1})]),_:1})]),t(_,{title:"Sicherung / Wiederherstellung",subtype:"success",collapsible:!0,collapsed:!0},{default:o(()=>[s("form",fe,[t(B,null,{default:o(()=>[i("Sicherung")]),_:1}),t(d,{subtype:"danger"},{default:o(()=>[i(' Aktuell können nur Sicherungen wiederhergestellt werden, die in den Entwicklungszweigen "master", "Beta" oder "Release" erstellt wurden! ')]),_:1}),t(d,{subtype:"info"},{default:o(()=>[i(" Nachdem die Sicherung abgeschlossen ist, kann die erstellte Datei über den Link in der Benachrichtigung oder "),ge,i(" heruntergeladen werden. ")]),_:1}),s("div",he,[s("div",_e,[t(b,{class:"btn-success clickable",onButtonClicked:e[6]||(e[6]=a=>l.sendSystemCommand("createBackup",{use_extended_filename:!0}))},{default:o(()=>[i(" Sicherung erstellen "),t(c,{"fixed-width":"",icon:["fas","archive"]})]),_:1})])])]),we,s("form",ye,[t(B,null,{default:o(()=>[i("Wiederherstellung")]),_:1}),t(d,{subtype:"danger"},{default:o(()=>[i(" Für die Wiederherstellung wird eine aktive Internetverbindung benötigt."),ke,i(' Aktuell können nur Sicherungen wiederhergestellt werden, die in den Entwicklungszweigen "master", "Beta" oder "Release" erstellt wurden! ')]),_:1}),s("div",ve,[s("div",Be,[s("div",Ce,[t(c,{"fixed-width":"",icon:["fas","file-archive"]})])]),s("div",Se,[s("input",{id:"input-file",type:"file",class:"custom-file-input",accept:".tar.gz,application/gzip,application/tar+gzip",onChange:e[7]||(e[7]=a=>l.updateSelectedFile(a))},null,32),s("label",We,v(m.selectedFile?m.selectedFile.name:"Bitte eine Datei auswählen"),1)]),s("div",Fe,[s("button",{class:k(["btn",m.selectedFile?"btn-success clickable":"btn-outline-success"]),disabled:!m.selectedFile,type:"button",onClick:e[8]||(e[8]=a=>l.uploadFile())},[i(" Hochladen "),t(c,{"fixed-width":"",icon:["fas","upload"]})],10,De)])]),s("div",qe,[s("div",xe,[t(b,{class:k(m.restoreUploadDone?"btn-success clickable":"btn-outline-success"),disabled:!m.restoreUploadDone,onButtonClicked:e[9]||(e[9]=a=>l.restoreBackup())},{default:o(()=>[i(" Wiederherstellung starten "),t(c,{"fixed-width":"",icon:["fas","box-open"]})]),_:1},8,["class","disabled"])])])]),Ve,s("form",Ae,[t(B,null,{default:o(()=>[i(" Automatische Sicherung in einen Cloud-Dienst ")]),_:1}),t(d,{subtype:"info"},{default:o(()=>[i(" Zwischen Mitternacht und 5:00 Uhr wird automatisch eine Sicherung erstellt und in den angegebenen Cloud-Dienst (nicht openWB Cloud!) hochgeladen. Ist kein Cloud-Dienst konfiguriert, wird keine automatische Sicherung erstellt. Die automatische Sicherung kann unabhängig von der openWB Cloud genutzt werden."),$e,i(" Die Anleitung zur Konfiguration des Cloud-Dienstes findest Du "),Te,i(" . ")]),_:1}),t(C,{class:"mb-2",title:"Backup-Cloud",options:l.backupCloudList,"model-value":n.$store.state.mqtt["openWB/system/backup_cloud/config"].type,"onUpdate:modelValue":e[10]||(e[10]=a=>l.updateSelectedBackupCloud(a))},null,8,["options","model-value"]),n.$store.state.mqtt["openWB/system/backup_cloud/config"].type?(f(),w("div",ze,[t(D,{title:"Manuelle Cloud-Sicherung",buttonText:"Sicherung erstellen und hochladen",subtype:"success",onButtonClicked:e[11]||(e[11]=a=>l.sendSystemCommand("createCloudBackup",{}))}),t(q,{backupCloudType:n.$store.state.mqtt["openWB/system/backup_cloud/config"].type,configuration:n.$store.state.mqtt["openWB/system/backup_cloud/config"].configuration,"onUpdate:configuration":e[12]||(e[12]=a=>l.updateConfiguration("openWB/system/backup_cloud/config",a))},null,8,["backupCloudType","configuration"])])):S("v-if",!0),t(x,{formName:"cloudBackupForm",hideReset:!0,hideDefaults:!0,onSave:e[13]||(e[13]=a=>n.$emit("save")),onReset:e[14]||(e[14]=a=>n.$emit("reset")),onDefaults:e[15]||(e[15]=a=>n.$emit("defaults"))})])]),_:1}),s("form",Ee,[t(_,{title:"Betrieb",collapsible:!0,collapsed:!0},{footer:o(()=>[s("div",Ue,[s("div",je,[t(b,{class:"btn-warning",onButtonClicked:e[16]||(e[16]=a=>l.sendSystemCommand("systemReboot"))},{default:o(()=>[i(" Neustart "),t(c,{"fixed-width":"",icon:["fas","undo"]})]),_:1})]),s("div",Oe,[t(b,{class:"btn-danger",onButtonClicked:e[17]||(e[17]=a=>l.sendSystemCommand("systemShutdown"))},{default:o(()=>[i(" Ausschalten "),t(c,{"fixed-width":"",icon:["fas","power-off"]})]),_:1})])])]),default:o(()=>[t(d,{subtype:"danger"},{default:o(()=>[i(" Wenn die Ladestation ausgeschaltet wird, muss sie komplett spannungsfrei geschaltet werden. Erst beim erneuten Zuschalten der Spannung fährt das System wieder hoch. ")]),_:1})]),_:1})]),s("form",Le,[t(_,{title:"Entwicklungszweig",subtype:"danger",collapsible:!0,collapsed:!0},{footer:o(()=>[s("div",Ze,[s("div",Me,[t(b,{class:k(l.releaseChangeValid?"btn-danger clickable":"btn-outline-danger"),disabled:!l.releaseChangeValid,onButtonClicked:e[20]||(e[20]=a=>l.switchBranch())},{default:o(()=>[t(c,{"fixed-width":"",icon:["fas","skull-crossbones"]}),i(" Branch und Tag wechseln "),t(c,{"fixed-width":"",icon:["fas","skull-crossbones"]})]),_:1},8,["class","disabled"])])])]),default:o(()=>[t(d,{subtype:"danger"},{default:o(()=>[i(" Nach einem Wechsel wird die Ladestation direkt neu gestartet! Es werden alle lokalen Änderungen mit dem Wechsel verworfen! ")]),_:1}),t(d,{subtype:"warning"},{default:o(()=>[i(" Bevor auf einen neuen Entwicklungszweig gewechselt wird sollte immer eine Sicherung erstellt werden! Es kann zwar wieder auf eine ältere Version gewechselt werden, jedoch ist nicht sichergestellt, dass es dabei keine Probleme gibt. Gerade wenn das Datenformat in der neuen Version angepasst wurde, wird eine ältere damit Fehler produzieren."),Ie,i(' Für den normalen Betrieb wird der Zweig "Release" empfohlen. Der Softwarestand wurde ausgiebig getestet, sodass ein Fehlverhalten relativ unwahrscheinlich ist.'),Re,i(' Der "Beta" Zweig beinhaltet Vorabversionen, bei denen die Entwicklung soweit abgeschlossen ist. Die enthaltenen Anpassungen wurden rudimentär getestet, können aber durchaus noch Fehler enthalten.'),Ne,i(' Die aktuelle Softwareentwicklung findet im Zweig "master" statt. Die enthaltenen Anpassungen sind teilweise noch nicht getestet und enthalten potentiell Fehler.'),Pe,i(' Einträge, die mit "feature" beginnen, sind experimentelle Entwicklungszweige, die nicht für den allgemeinen Gebrauch gedacht sind. ')]),_:1}),t(C,{title:"Entwicklungszweig",options:l.getBranchOptions(),"model-value":n.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":e[18]||(e[18]=a=>n.updateState("openWB/system/current_branch",a))},null,8,["options","model-value"]),t(C,{title:"Tag",options:l.getBranchTagOptions(),modelValue:m.selectedTag,"onUpdate:modelValue":e[19]||(e[19]=a=>m.selectedTag=a)},null,8,["options","modelValue"])]),_:1})]),s("form",He,[t(_,{title:"Zurücksetzen",subtype:"danger",collapsible:!0,collapsed:!0},{footer:o(()=>[s("div",Ge,[s("div",Je,[t(b,{class:"btn-danger clickable",onButtonClicked:e[21]||(e[21]=a=>l.sendSystemCommand("factoryReset",{}))},{default:o(()=>[t(c,{"fixed-width":"",icon:["fas","skull-crossbones"]}),i(" Zurücksetzen "),t(c,{"fixed-width":"",icon:["fas","skull-crossbones"]})]),_:1})])])]),default:o(()=>[t(d,{subtype:"danger"},{default:o(()=>[i(" Alle Einstellungen, angelegte Geräte/Komponenten, Ladepunkte und Fahrzeuge, etc, Tages-, Monats- und Jahresauswertungen sowie das Ladeprotokoll werden unwiederbringlich gelöscht. Auch die Vorkonfiguration im Auslieferungszustand wird gelöscht. Die openWB muss danach komplett neu eingerichtet werden. Die openWB wird hierfür automatisch neu gestartet. Bitte erstelle vor dem Zurücksetzen eine Sicherung! ")]),_:1})]),_:1})])])):S("v-if",!0)])}const at=W(ae,[["render",Ke],["__scopeId","data-v-059847f6"],["__file","/opt/openWB-dev/openwb-ui-settings/src/views/System.vue"]]);export{at as default};
