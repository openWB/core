import{o as p,e as y,k as u,y as m,j as C,F as k,l,p as f,q as i,f as w,t as d,G as N,R as V,H as R,i as S,A as E,n as A,I as O,J as M,K as H,L as F,M as U}from"./vendor-22eb535b.js";import{_ as v,I as z,c as j}from"./vendor-inkline-417cb89c.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerpolicy&&(t.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?t.credentials="include":n.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(n){if(n.ep)return;n.ep=!0;const t=a(n);fetch(n.href,t)}})();const G={name:"DateTime",props:{separator:{String,default:"<br />"}},data(){return{dateTimeInterval:"",date:"",time:""}},methods:{update(){const e=new Date,o={weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"},a={hour:"2-digit",minute:"2-digit",second:"2-digit"};this.date=e.toLocaleDateString(void 0,o),this.time=e.toLocaleTimeString(void 0,a)}},mounted(){this.update(),this.dateTimeInterval=setInterval(this.update,1e3)},beforeUnmount(){clearInterval(this.dateTimeInterval)}},J=["innerHTML"];function K(e,o,a,s,n,t){return p(),y(k,null,[u(m(n.time),1),C("span",{innerHTML:a.separator},null,8,J),u(m(n.date),1)],64)}const Y=v(G,[["render",K],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/components/DateTime.vue"]]);const Z={name:"NavItem",props:{to:{type:Object,required:!0}}};function Q(e,o,a,s,n,t){const r=l("i-nav-item");return p(),f(r,{to:a.to,"active-class":"-active",class:"_border _border-color:primary _text-align:center"},{default:i(()=>[w(e.$slots,"default",{},void 0,!0)]),_:3},8,["to"])}const X=v(Z,[["render",Q],["__scopeId","data-v-079bc5e0"],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/components/NavItem.vue"]]),ee={name:"NavBar",components:{NavItem:X}};function te(e,o,a,s,n,t){const r=l("nav-item"),c=l("i-nav");return p(),f(c,{vertical:"",class:"_align-items:stretch"},{default:i(()=>[d(r,{to:{name:"dash-board"}},{default:i(()=>[u(" DashBoard ")]),_:1}),d(r,{to:{name:"charge-points"}},{default:i(()=>[u(" Ladepunkte ")]),_:1}),d(r,{to:{name:"status"}},{default:i(()=>[u(" Status ")]),_:1})]),_:1})}const oe=v(ee,[["render",te],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/components/NavBar.vue"]]),T=N("mqtt",{state:()=>({topics:{},chartData:{}}),getters:{getWildcardIndexList:e=>(o,a=!1)=>{let s=o;a||(s="^"+o.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$");let n=Object.keys(e.topics).filter(t=>t.match(s));return n.forEach((t,r,c)=>{c[r]=parseInt(t.match(/(?:\/)([0-9]+)(?=\/)*/g)[0].replace(/[^0-9]+/g,""))}),n},getWildcardTopics:e=>(o,a=!1)=>{let s=o;return a||(s="^"+o.replaceAll("/","\\/").replaceAll("+","[^+/]+").replaceAll("#","[^#/]+")+"$"),Object.keys(e.topics).filter(n=>n.match(s)).reduce((n,t)=>({...n,[t]:e.topics[t]}),{})},getObjectIds:e=>o=>{function a(s){let n=[];return s!==void 0&&s.forEach(t=>{t.type==o&&n.push(t.id),n=[...n,...a(t.children)]}),n}return a(e.topics["openWB/counter/get/hierarchy"])},getGridId(e){let o=e.topics["openWB/counter/get/hierarchy"];if(o!==void 0&&Object.keys(o).length>0){let a=Object.keys(e.topics["openWB/counter/get/hierarchy"])[0];if(console.debug("getGridId",a,e.topics["openWB/counter/get/hierarchy"][a]),e.topics["openWB/counter/get/hierarchy"][a].type=="counter")return e.topics["openWB/counter/get/hierarchy"][a].id}},getValueBool:e=>o=>{let a=e.topics[o];return a!==void 0?a:!1},getValueString:e=>(o,a="W",s=!1)=>{var n="",t=e.topics[o];if(t===void 0)return`--- ${n}${a}`;s&&(t*=-1);var r=t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0});return(t>999||t<-999)&&(r=(t/1e3).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),n="k",(t>999999||t<-999999)&&(r=(t/1e6).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),n="M")),`${r} ${n}${a}`}},actions:{initTopic(e,o=void 0){e.includes("#")||e.includes("+")?console.debug("skipping init of wildcard topic:",e):this.addTopic(e,o)},addTopic(e,o){console.debug("addTopic",e,o),this.topics[e]=o,(e.endsWith("home_consumption")||e.endsWith("power")||e.endsWith("soc"))&&o!==void 0&&(this.chartData[e]===void 0&&(this.chartData[e]=[]),this.chartData[e].push(o),this.chartData[e].slice(-128))},removeTopic(e){e.includes("#")||e.includes("+")?(console.debug("expanding wildcard topic for removal:",e),Object.keys(this.getWildcardTopics(e)).forEach(o=>{console.debug("removing wildcardTopic:",o),delete this.topics[o]})):delete this.topics[e]},updateTopic(e,o,a=void 0){const s=(n,t,r)=>t.split(".").reduce((c,_,h)=>c[_]=t.split(".").length===++h?r:c[_]||{},n);e in this.topics?a!=null?s(this.topics[e],a,o):this.topics[e]=o:console.debug("topic not found: ",e)},updateState(e,o,a=void 0){console.debug("updateState:",e,o,a),this.updateTopic(e,o,a)}}});const re={name:"openwbDisplayCardsApp",components:{RouterView:V,DateTime:Y,NavBar:oe},data(){return{client:{connected:!1},connection:{protocol:location.protocol=="https:"?"wss":"ws",host:location.hostname,port:parseInt(location.port)||(location.protocol=="https:"?443:80),endpoint:"/ws",connectTimeout:4e3,reconnectPeriod:4e3},mqttTopicsToSubscribe:["openWB/counter/get/hierarchy","openWB/counter/set/home_consumption","openWB/counter/+/get/power","openWB/bat/config/configured","openWB/bat/get/power","openWB/bat/get/soc","openWB/chargepoint/get/power","openWB/pv/config/configured","openWB/pv/get/power","openWB/chargepoint/+/get/power","openWB/chargepoint/+/get/plug_state","openWB/chargepoint/+/get/charge_state","openWB/chargepoint/+/get/phases_in_use","openWB/chargepoint/+/set/current","openWB/chargepoint/+/config"],mqttStore:T()}},methods:{createConnection(){const{protocol:e,host:o,port:a,endpoint:s,...n}=this.connection,t=`${e}://${o}:${a}${s}`;console.debug("connecting to broker:",t);try{this.client=R.connect(t,n)}catch(r){console.error("mqtt.connect error",r)}this.client.on("connect",()=>{console.debug("Connection succeeded! ClientId: ",this.client.options.clientId)}),this.client.on("error",r=>{console.error("Connection failed",r)}),this.client.on("message",(r,c)=>{if(console.debug(`Received message "${c}" from topic "${r}"`),c.toString().length>0){let _;try{_=JSON.parse(c.toString())}catch{console.debug("Json parsing failed, fallback to string: ",r),_=c.toString()}this.mqttStore.addTopic(r,_)}else this.mqttStore.removeTopic(r)})},doSubscribe(e){e.forEach(o=>{this.mqttStore.initTopic(o)}),this.client.subscribe(e,{},o=>{if(o){console.error("Subscribe to topics error",o);return}})},doUnsubscribe(e){e.forEach(o=>{this.mqttStore.removeTopic(o)}),this.client.unsubscribe(e,o=>{o&&console.error("Unsubscribe error",o)})}},created(){this.createConnection()},mounted(){this.doSubscribe(this.mqttTopicsToSubscribe)},beforeUnmount(){this.doUnsubscribe(this.mqttTopicsToSubscribe)}};function ne(e,o,a,s,n,t){const r=l("DateTime"),c=l("i-column"),_=l("i-row"),h=l("i-container"),g=l("NavBar"),b=l("i-layout-aside"),L=l("RouterView"),q=l("i-layout-content"),I=l("i-layout");return p(),f(I,{vertical:""},{default:i(()=>[d(b,{class:"_position:fixed"},{default:i(()=>[d(h,{fluid:"",class:"_margin-bottom:1"},{default:i(()=>[d(_,{center:""},{default:i(()=>[d(c,null,{default:i(()=>[d(r)]),_:1})]),_:1})]),_:1}),d(g)]),_:1}),d(q,null,{default:i(()=>[d(L)]),_:1})]),_:1})}const ae=v(re,[["render",ne],["__scopeId","data-v-7a7a37b1"],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/App.vue"]]),ie="modulepreload",se=function(e){return"/openWB/web/display/themes/cards/"+e},D={},P=function(o,a,s){if(!a||a.length===0)return o();const n=document.getElementsByTagName("link");return Promise.all(a.map(t=>{if(t=se(t),t in D)return;D[t]=!0;const r=t.endsWith(".css"),c=r?'[rel="stylesheet"]':"";if(!!s)for(let g=n.length-1;g>=0;g--){const b=n[g];if(b.href===t&&(!r||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${t}"]${c}`))return;const h=document.createElement("link");if(h.rel=r?"stylesheet":ie,r||(h.as="script",h.crossOrigin=""),h.href=t,document.head.appendChild(h),r)return new Promise((g,b)=>{h.addEventListener("load",g),h.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>o())};const ce={name:"DashBoardCard",props:{color:String}};function de(e,o,a,s,n,t){const r=l("i-column"),c=l("i-row"),_=l("i-container"),h=l("i-card");return p(),f(h,{color:a.color},{header:i(()=>[d(_,null,{default:i(()=>[d(c,null,{default:i(()=>[d(r,null,{default:i(()=>[w(e.$slots,"headerLeft",{},void 0,!0)]),_:3}),e.$slots.headerRight?(p(),f(r,{key:0,class:"_text-align:right"},{default:i(()=>[w(e.$slots,"headerRight",{},void 0,!0)]),_:3})):S("v-if",!0)]),_:3})]),_:3})]),default:i(()=>[w(e.$slots,"default",{},void 0,!0)]),_:3},8,["color"])}const le=v(ce,[["render",de],["__scopeId","data-v-aa92abad"],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/components/DashBoardCard.vue"]]);const W={props:{data:{required:!0,type:Array,default(){return[]}},width:{Number,default:250},height:{Number,default:70},gap:{Number,default:2},stroke:{Number,default:3},min:{Number,default:0},max:{Number,default:1},color:{String,default:"var(--color--primary)"},colorNegative:{String,default:void 0}},computed:{highestPoint(){return Math.max(1,this.max,...this.slicedData)},lowestPoint(){return Math.min(0,this.min,...this.slicedData)},maxPoints(){return Math.floor(this.width/(this.stroke+this.gap))},slicedData(){return this.data.slice(-this.maxPoints)},zeroHeight(){return this.height-(0-this.lowestPoint)/(this.highestPoint-this.lowestPoint)*this.height},coordinates(){const e=[];return this.slicedData.forEach((o,a)=>{const s=a*this.width/this.maxPoints,n=this.height-(o-this.lowestPoint)/(this.highestPoint-this.lowestPoint)*this.height;e.push({x:s,y:n})}),e},bars(){const e=[];return this.coordinates.forEach(o=>{const a=o.x,s=o.y,n=this.stroke,t=Math.min(s,this.zeroHeight),r=Math.abs(s-this.zeroHeight),c=s>this.zeroHeight;e.push({x:a,y:t,width:n,height:r,negative:c})}),e},fillEndPath(){return`V ${this.height} L 4 ${this.height} Z`}}},$=()=>{O(e=>({"fc7172b1-color":e.color,"fc7172b1-colorNegative":e.colorNegative}))},x=W.setup;W.setup=x?(e,o)=>($(),x(e,o)):$;const ue=W,he=["viewBox"],pe=["x","y","width","height"],_e=["d"];function me(e,o,a,s,n,t){return p(),y("svg",{class:"spark-line",viewBox:`0 0 ${a.width} ${a.height}`,width:"100%",preserveAspectRatio:"xMinYMin"},[(p(!0),y(k,null,E(t.bars,r=>(p(),y("rect",{key:r.x,x:r.x,y:r.y,width:r.width,height:r.height,class:A(a.colorNegative&&r.negative?"negative":"")},null,10,pe))),128)),C("path",{class:"zero-line",d:`M 0 ${t.zeroHeight} L ${a.width} ${t.zeroHeight}`},null,8,_e)],8,he)}const fe=v(ue,[["render",me],["__scopeId","data-v-fc7172b1"],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/components/SparkLine.vue"]]);const ge={name:"DashBoard",data(){return{mqttStore:T()}},components:{DashBoardCard:le,SparkLine:fe},computed:{gridPower(){let e=0;return e=this.mqttStore.getGridId,e===void 0?"---":this.mqttStore.getValueString(`openWB/counter/${e}/get/power`,"W")},gridPowerChartData(){let e=0;return e=this.mqttStore.getGridId,e===void 0?[]:this.mqttStore.chartData[`openWB/counter/${e}/get/power`]},homePower(){return this.mqttStore.getValueString("openWB/counter/set/home_consumption","W")},homePowerChartData(){return this.mqttStore.chartData["openWB/counter/set/home_consumption"]},batteryConfigured(){return this.mqttStore.getValueBool("openWB/bat/config/configured")},batteryPower(){return this.mqttStore.getValueString("openWB/bat/get/power","W")},batteryPowerChartData(){return this.mqttStore.chartData["openWB/bat/get/power"]},batterySoc(){return this.mqttStore.getValueString("openWB/bat/get/soc","%")},batterySocChartData(){return this.mqttStore.chartData["openWB/bat/get/soc"]},chargePointSumPower(){return this.mqttStore.getValueString("openWB/chargepoint/get/power","W")},chargePointSumPowerChartData(){return this.mqttStore.chartData["openWB/chargepoint/get/power"]},pvConfigured(){return this.mqttStore.getValueBool("openWB/pv/config/configured")},pvPower(){return this.mqttStore.getValueString("openWB/pv/get/power","W",!0)},pvPowerChartData(){return this.mqttStore.chartData["openWB/pv/get/power"].map(e=>e*-1)}}},ve={class:"dash-board-card-wrapper"};function be(e,o,a,s,n,t){const r=l("spark-line"),c=l("dash-board-card");return p(),y("div",ve,[d(c,{color:"danger"},{headerLeft:i(()=>[u(" EVU ")]),headerRight:i(()=>[u(m(t.gridPower),1)]),default:i(()=>[d(r,{color:"var(--color--danger)",colorNegative:"var(--color--success)",data:t.gridPowerChartData},null,8,["data"])]),_:1}),d(c,{color:"light"},{headerLeft:i(()=>[u(" Hausverbrauch ")]),headerRight:i(()=>[u(m(t.homePower),1)]),default:i(()=>[d(r,{color:"var(--color--light)",data:t.homePowerChartData},null,8,["data"])]),_:1}),t.batteryConfigured?(p(),f(c,{key:0,color:"warning"},{headerLeft:i(()=>[u(" Speicher ")]),headerRight:i(()=>[u(m(t.batteryPower),1)]),default:i(()=>[d(r,{color:"var(--color--warning)",data:t.batteryPowerChartData},null,8,["data"])]),_:1})):S("v-if",!0),t.batteryConfigured?(p(),f(c,{key:1,color:"warning"},{headerLeft:i(()=>[u(" Speicher SoC ")]),headerRight:i(()=>[u(m(t.batterySoc),1)]),default:i(()=>[d(r,{color:"var(--color--warning)",data:t.batterySocChartData,min:0,max:100},null,8,["data"])]),_:1})):S("v-if",!0),d(c,{color:"primary"},{headerLeft:i(()=>[u(" Ladepunkte ")]),headerRight:i(()=>[u(m(t.chargePointSumPower),1)]),default:i(()=>[d(r,{color:"var(--color--primary)",data:t.chargePointSumPowerChartData},null,8,["data"])]),_:1}),t.pvConfigured?(p(),f(c,{key:2,color:"success"},{headerLeft:i(()=>[u(" PV ")]),headerRight:i(()=>[u(m(t.pvPower),1)]),default:i(()=>[d(r,{color:"var(--color--success)",data:t.pvPowerChartData,inverted:!0},null,8,["data"])]),_:1})):S("v-if",!0)])}const ye=v(ge,[["render",be],["__scopeId","data-v-4e1e3ea5"],["__file","/opt/openWB-dev/openwb-display/openwb-display-cards/src/views/DashBoardView.vue"]]),we=M({history:H("/openWB/web/display/themes/cards/"),routes:[{path:"/",alias:"/DashBoard",name:"dash-board",component:ye},{path:"/ChargePoints",name:"charge-points",component:()=>P(()=>import("./ChargePointsView-89a32db3.js"),["assets/ChargePointsView-89a32db3.js","assets/vendor-fortawesome-160a56ab.js","assets/vendor-22eb535b.js","assets/vendor-inkline-417cb89c.js","assets/vendor-inkline-7b5371f4.css","assets/ChargePointsView-79233e53.css"])},{path:"/Status",name:"status",component:()=>P(()=>import("./StatusView-17cc89db.js"),["assets/StatusView-17cc89db.js","assets/vendor-inkline-417cb89c.js","assets/vendor-22eb535b.js","assets/vendor-inkline-7b5371f4.css"])}]});const B=F(ae);B.use(U());B.use(we);B.use(z,{colorMode:"dark",components:j});B.mount("#app");export{le as D,fe as S,T as u};
